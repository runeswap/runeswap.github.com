!function(){var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{};function e(t){return t&&t.__esModule?t.default:t}var i={};var r=function(t){var e=i[t];if(null==e)throw new Error("Could not resolve bundle with id "+t);return e};(function(t){for(var e=Object.keys(t),r=0;r<e.length;r++)i[e[r]]=t[e[r]]})(JSON.parse('{"3Leim":"index.b244b0e2.js","219mM":"terminal12x12.946b718e.png"}'));var n={};
/*!
  * jQuery JavaScript Library v2.2.4
  * http://jquery.com/
  *
  * Includes Sizzle.js
  * http://sizzlejs.com/
  *
  * Copyright jQuery Foundation and other contributors
  * Released under the MIT license
  * http://jquery.org/license
  *
  * Date: 2016-05-20T17:23Z
  */
!function(t,e){"object"==typeof n?n=t.document?e(t,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return e(t)}:e(t)}("undefined"!=typeof window?window:n,(function(t,e){var i=[],r=t.document,n=i.slice,s=i.concat,o=i.push,a=i.indexOf,h={},l=h.toString,c=h.hasOwnProperty,u={},d="2.2.4",p=function(t,e){return new p.fn.init(t,e)},f=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,g=/^-ms-/,v=/-([\da-z])/gi,m=function(t,e){return e.toUpperCase()};function y(t){var e=!!t&&"length"in t&&t.length,i=p.type(t);return"function"!==i&&!p.isWindow(t)&&("array"===i||0===e||"number"==typeof e&&e>0&&e-1 in t)}p.fn=p.prototype={jquery:d,constructor:p,selector:"",length:0,toArray:function(){return n.call(this)},get:function(t){return null!=t?t<0?this[t+this.length]:this[t]:n.call(this)},pushStack:function(t){var e=p.merge(this.constructor(),t);return e.prevObject=this,e.context=this.context,e},each:function(t){return p.each(this,t)},map:function(t){return this.pushStack(p.map(this,(function(e,i){return t.call(e,i,e)})))},slice:function(){return this.pushStack(n.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(t){var e=this.length,i=+t+(t<0?e:0);return this.pushStack(i>=0&&i<e?[this[i]]:[])},end:function(){return this.prevObject||this.constructor()},push:o,sort:i.sort,splice:i.splice},p.extend=p.fn.extend=function(){var t,e,i,r,n,s,o=arguments[0]||{},a=1,h=arguments.length,l=!1;for("boolean"==typeof o&&(l=o,o=arguments[a]||{},a++),"object"==typeof o||p.isFunction(o)||(o={}),a===h&&(o=this,a--);a<h;a++)if(null!=(t=arguments[a]))for(e in t)i=o[e],o!==(r=t[e])&&(l&&r&&(p.isPlainObject(r)||(n=p.isArray(r)))?(n?(n=!1,s=i&&p.isArray(i)?i:[]):s=i&&p.isPlainObject(i)?i:{},o[e]=p.extend(l,s,r)):void 0!==r&&(o[e]=r));return o},p.extend({expando:"jQuery"+(d+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isFunction:function(t){return"function"===p.type(t)},isArray:Array.isArray,isWindow:function(t){return null!=t&&t===t.window},isNumeric:function(t){var e=t&&t.toString();return!p.isArray(t)&&e-parseFloat(e)+1>=0},isPlainObject:function(t){var e;if("object"!==p.type(t)||t.nodeType||p.isWindow(t))return!1;if(t.constructor&&!c.call(t,"constructor")&&!c.call(t.constructor.prototype||{},"isPrototypeOf"))return!1;for(e in t);return void 0===e||c.call(t,e)},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},type:function(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?h[l.call(t)]||"object":typeof t},globalEval:function(t){var e,i=eval;(t=p.trim(t))&&(1===t.indexOf("use strict")?((e=r.createElement("script")).text=t,r.head.appendChild(e).parentNode.removeChild(e)):i(t))},camelCase:function(t){return t.replace(g,"ms-").replace(v,m)},nodeName:function(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()},each:function(t,e){var i,r=0;if(y(t))for(i=t.length;r<i&&!1!==e.call(t[r],r,t[r]);r++);else for(r in t)if(!1===e.call(t[r],r,t[r]))break;return t},trim:function(t){return null==t?"":(t+"").replace(f,"")},makeArray:function(t,e){var i=e||[];return null!=t&&(y(Object(t))?p.merge(i,"string"==typeof t?[t]:t):o.call(i,t)),i},inArray:function(t,e,i){return null==e?-1:a.call(e,t,i)},merge:function(t,e){for(var i=+e.length,r=0,n=t.length;r<i;r++)t[n++]=e[r];return t.length=n,t},grep:function(t,e,i){for(var r=[],n=0,s=t.length,o=!i;n<s;n++)!e(t[n],n)!==o&&r.push(t[n]);return r},map:function(t,e,i){var r,n,o=0,a=[];if(y(t))for(r=t.length;o<r;o++)null!=(n=e(t[o],o,i))&&a.push(n);else for(o in t)null!=(n=e(t[o],o,i))&&a.push(n);return s.apply([],a)},guid:1,proxy:function(t,e){var i,r,s;if("string"==typeof e&&(i=t[e],e=t,t=i),p.isFunction(t))return r=n.call(arguments,2),(s=function(){return t.apply(e||this,r.concat(n.call(arguments)))}).guid=t.guid=t.guid||p.guid++,s},now:Date.now,support:u}),"function"==typeof Symbol&&(p.fn[Symbol.iterator]=i[Symbol.iterator]),p.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),(function(t,e){h["[object "+e+"]"]=e.toLowerCase()}));var x=
/*!
    * Sizzle CSS Selector Engine v2.2.1
    * http://sizzlejs.com/
    *
    * Copyright jQuery Foundation and other contributors
    * Released under the MIT license
    * http://jquery.org/license
    *
    * Date: 2015-10-17
    */
function(t){var e,i,r,n,s,o,a,h,l,c,u,d,p,f,g,v,m,y,x,_="sizzle"+1*new Date,b=t.document,T=0,E=0,w=st(),A=st(),C=st(),S=function(t,e){return t===e&&(u=!0),0},O=1<<31,D={}.hasOwnProperty,M=[],R=M.pop,P=M.push,I=M.push,N=M.slice,L=function(t,e){for(var i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},k="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",F="[\\x20\\t\\r\\n\\f]",B="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",U="\\[[\\x20\\t\\r\\n\\f]*("+B+")(?:"+F+"*([*^$|!~]?=)"+F+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+B+"))|)"+F+"*\\]",V=":("+B+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+U+")*)|.*)\\)|)",j=new RegExp(F+"+","g"),H=new RegExp("^[\\x20\\t\\r\\n\\f]+|((?:^|[^\\\\])(?:\\\\.)*)[\\x20\\t\\r\\n\\f]+$","g"),W=new RegExp("^[\\x20\\t\\r\\n\\f]*,[\\x20\\t\\r\\n\\f]*"),K=new RegExp("^[\\x20\\t\\r\\n\\f]*([>+~]|[\\x20\\t\\r\\n\\f])[\\x20\\t\\r\\n\\f]*"),G=new RegExp("=[\\x20\\t\\r\\n\\f]*([^\\]'\"]*?)[\\x20\\t\\r\\n\\f]*\\]","g"),z=new RegExp(V),q=new RegExp("^"+B+"$"),X={ID:new RegExp("^#("+B+")"),CLASS:new RegExp("^\\.("+B+")"),TAG:new RegExp("^("+B+"|[*])"),ATTR:new RegExp("^"+U),PSEUDO:new RegExp("^"+V),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\([\\x20\\t\\r\\n\\f]*(even|odd|(([+-]|)(\\d*)n|)[\\x20\\t\\r\\n\\f]*(?:([+-]|)[\\x20\\t\\r\\n\\f]*(\\d+)|))[\\x20\\t\\r\\n\\f]*\\)|)","i"),bool:new RegExp("^(?:"+k+")$","i"),needsContext:new RegExp("^[\\x20\\t\\r\\n\\f]*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\([\\x20\\t\\r\\n\\f]*((?:-\\d)?\\d*)[\\x20\\t\\r\\n\\f]*\\)|)(?=[^-]|$)","i")},Y=/^(?:input|select|textarea|button)$/i,Q=/^h\d$/i,Z=/^[^{]+\{\s*\[native \w/,$=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,J=/[+~]/,tt=/'|\\/g,et=new RegExp("\\\\([\\da-f]{1,6}[\\x20\\t\\r\\n\\f]?|([\\x20\\t\\r\\n\\f])|.)","ig"),it=function(t,e,i){var r="0x"+e-65536;return r!=r||i?e:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)},rt=function(){d()};try{I.apply(M=N.call(b.childNodes),b.childNodes),M[b.childNodes.length].nodeType}catch(t){I={apply:M.length?function(t,e){P.apply(t,N.call(e))}:function(t,e){for(var i=t.length,r=0;t[i++]=e[r++];);t.length=i-1}}}function nt(t,e,r,n){var s,a,l,c,u,f,m,y,T=e&&e.ownerDocument,E=e?e.nodeType:9;if(r=r||[],"string"!=typeof t||!t||1!==E&&9!==E&&11!==E)return r;if(!n&&((e?e.ownerDocument||e:b)!==p&&d(e),e=e||p,g)){if(11!==E&&(f=$.exec(t)))if(s=f[1]){if(9===E){if(!(l=e.getElementById(s)))return r;if(l.id===s)return r.push(l),r}else if(T&&(l=T.getElementById(s))&&x(e,l)&&l.id===s)return r.push(l),r}else{if(f[2])return I.apply(r,e.getElementsByTagName(t)),r;if((s=f[3])&&i.getElementsByClassName&&e.getElementsByClassName)return I.apply(r,e.getElementsByClassName(s)),r}if(i.qsa&&!C[t+" "]&&(!v||!v.test(t))){if(1!==E)T=e,y=t;else if("object"!==e.nodeName.toLowerCase()){for((c=e.getAttribute("id"))?c=c.replace(tt,"\\$&"):e.setAttribute("id",c=_),a=(m=o(t)).length,u=q.test(c)?"#"+c:"[id='"+c+"']";a--;)m[a]=u+" "+gt(m[a]);y=m.join(","),T=J.test(t)&&pt(e.parentNode)||e}if(y)try{return I.apply(r,T.querySelectorAll(y)),r}catch(t){}finally{c===_&&e.removeAttribute("id")}}}return h(t.replace(H,"$1"),e,r,n)}function st(){var t=[];return function e(i,n){return t.push(i+" ")>r.cacheLength&&delete e[t.shift()],e[i+" "]=n}}function ot(t){return t[_]=!0,t}function at(t){var e=p.createElement("div");try{return!!t(e)}catch(t){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function ht(t,e){for(var i=t.split("|"),n=i.length;n--;)r.attrHandle[i[n]]=e}function lt(t,e){var i=e&&t,r=i&&1===t.nodeType&&1===e.nodeType&&(~e.sourceIndex||O)-(~t.sourceIndex||O);if(r)return r;if(i)for(;i=i.nextSibling;)if(i===e)return-1;return t?1:-1}function ct(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}function ut(t){return function(e){var i=e.nodeName.toLowerCase();return("input"===i||"button"===i)&&e.type===t}}function dt(t){return ot((function(e){return e=+e,ot((function(i,r){for(var n,s=t([],i.length,e),o=s.length;o--;)i[n=s[o]]&&(i[n]=!(r[n]=i[n]))}))}))}function pt(t){return t&&void 0!==t.getElementsByTagName&&t}for(e in i=nt.support={},s=nt.isXML=function(t){var e=t&&(t.ownerDocument||t).documentElement;return!!e&&"HTML"!==e.nodeName},d=nt.setDocument=function(t){var e,n,o=t?t.ownerDocument||t:b;return o!==p&&9===o.nodeType&&o.documentElement?(f=(p=o).documentElement,g=!s(p),(n=p.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",rt,!1):n.attachEvent&&n.attachEvent("onunload",rt)),i.attributes=at((function(t){return t.className="i",!t.getAttribute("className")})),i.getElementsByTagName=at((function(t){return t.appendChild(p.createComment("")),!t.getElementsByTagName("*").length})),i.getElementsByClassName=Z.test(p.getElementsByClassName),i.getById=at((function(t){return f.appendChild(t).id=_,!p.getElementsByName||!p.getElementsByName(_).length})),i.getById?(r.find.ID=function(t,e){if(void 0!==e.getElementById&&g){var i=e.getElementById(t);return i?[i]:[]}},r.filter.ID=function(t){var e=t.replace(et,it);return function(t){return t.getAttribute("id")===e}}):(delete r.find.ID,r.filter.ID=function(t){var e=t.replace(et,it);return function(t){var i=void 0!==t.getAttributeNode&&t.getAttributeNode("id");return i&&i.value===e}}),r.find.TAG=i.getElementsByTagName?function(t,e){return void 0!==e.getElementsByTagName?e.getElementsByTagName(t):i.qsa?e.querySelectorAll(t):void 0}:function(t,e){var i,r=[],n=0,s=e.getElementsByTagName(t);if("*"===t){for(;i=s[n++];)1===i.nodeType&&r.push(i);return r}return s},r.find.CLASS=i.getElementsByClassName&&function(t,e){if(void 0!==e.getElementsByClassName&&g)return e.getElementsByClassName(t)},m=[],v=[],(i.qsa=Z.test(p.querySelectorAll))&&(at((function(t){f.appendChild(t).innerHTML="<a id='"+_+"'></a><select id='"+_+"-\r\\' msallowcapture=''><option selected=''></option></select>",t.querySelectorAll("[msallowcapture^='']").length&&v.push("[*^$]=[\\x20\\t\\r\\n\\f]*(?:''|\"\")"),t.querySelectorAll("[selected]").length||v.push("\\[[\\x20\\t\\r\\n\\f]*(?:value|"+k+")"),t.querySelectorAll("[id~="+_+"-]").length||v.push("~="),t.querySelectorAll(":checked").length||v.push(":checked"),t.querySelectorAll("a#"+_+"+*").length||v.push(".#.+[+~]")})),at((function(t){var e=p.createElement("input");e.setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),t.querySelectorAll("[name=d]").length&&v.push("name[\\x20\\t\\r\\n\\f]*[*^$|!~]?="),t.querySelectorAll(":enabled").length||v.push(":enabled",":disabled"),t.querySelectorAll("*,:x"),v.push(",.*:")}))),(i.matchesSelector=Z.test(y=f.matches||f.webkitMatchesSelector||f.mozMatchesSelector||f.oMatchesSelector||f.msMatchesSelector))&&at((function(t){i.disconnectedMatch=y.call(t,"div"),y.call(t,"[s!='']:x"),m.push("!=",V)})),v=v.length&&new RegExp(v.join("|")),m=m.length&&new RegExp(m.join("|")),e=Z.test(f.compareDocumentPosition),x=e||Z.test(f.contains)?function(t,e){var i=9===t.nodeType?t.documentElement:t,r=e&&e.parentNode;return t===r||!(!r||1!==r.nodeType||!(i.contains?i.contains(r):t.compareDocumentPosition&&16&t.compareDocumentPosition(r)))}:function(t,e){if(e)for(;e=e.parentNode;)if(e===t)return!0;return!1},S=e?function(t,e){if(t===e)return u=!0,0;var r=!t.compareDocumentPosition-!e.compareDocumentPosition;return r||(1&(r=(t.ownerDocument||t)===(e.ownerDocument||e)?t.compareDocumentPosition(e):1)||!i.sortDetached&&e.compareDocumentPosition(t)===r?t===p||t.ownerDocument===b&&x(b,t)?-1:e===p||e.ownerDocument===b&&x(b,e)?1:c?L(c,t)-L(c,e):0:4&r?-1:1)}:function(t,e){if(t===e)return u=!0,0;var i,r=0,n=t.parentNode,s=e.parentNode,o=[t],a=[e];if(!n||!s)return t===p?-1:e===p?1:n?-1:s?1:c?L(c,t)-L(c,e):0;if(n===s)return lt(t,e);for(i=t;i=i.parentNode;)o.unshift(i);for(i=e;i=i.parentNode;)a.unshift(i);for(;o[r]===a[r];)r++;return r?lt(o[r],a[r]):o[r]===b?-1:a[r]===b?1:0},p):p},nt.matches=function(t,e){return nt(t,null,null,e)},nt.matchesSelector=function(t,e){if((t.ownerDocument||t)!==p&&d(t),e=e.replace(G,"='$1']"),i.matchesSelector&&g&&!C[e+" "]&&(!m||!m.test(e))&&(!v||!v.test(e)))try{var r=y.call(t,e);if(r||i.disconnectedMatch||t.document&&11!==t.document.nodeType)return r}catch(t){}return nt(e,p,null,[t]).length>0},nt.contains=function(t,e){return(t.ownerDocument||t)!==p&&d(t),x(t,e)},nt.attr=function(t,e){(t.ownerDocument||t)!==p&&d(t);var n=r.attrHandle[e.toLowerCase()],s=n&&D.call(r.attrHandle,e.toLowerCase())?n(t,e,!g):void 0;return void 0!==s?s:i.attributes||!g?t.getAttribute(e):(s=t.getAttributeNode(e))&&s.specified?s.value:null},nt.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},nt.uniqueSort=function(t){var e,r=[],n=0,s=0;if(u=!i.detectDuplicates,c=!i.sortStable&&t.slice(0),t.sort(S),u){for(;e=t[s++];)e===t[s]&&(n=r.push(s));for(;n--;)t.splice(r[n],1)}return c=null,t},n=nt.getText=function(t){var e,i="",r=0,s=t.nodeType;if(s){if(1===s||9===s||11===s){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)i+=n(t)}else if(3===s||4===s)return t.nodeValue}else for(;e=t[r++];)i+=n(e);return i},(r=nt.selectors={cacheLength:50,createPseudo:ot,match:X,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(et,it),t[3]=(t[3]||t[4]||t[5]||"").replace(et,it),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||nt.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&nt.error(t[0]),t},PSEUDO:function(t){var e,i=!t[6]&&t[2];return X.CHILD.test(t[0])?null:(t[3]?t[2]=t[4]||t[5]||"":i&&z.test(i)&&(e=o(i,!0))&&(e=i.indexOf(")",i.length-e)-i.length)&&(t[0]=t[0].slice(0,e),t[2]=i.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(et,it).toLowerCase();return"*"===t?function(){return!0}:function(t){return t.nodeName&&t.nodeName.toLowerCase()===e}},CLASS:function(t){var e=w[t+" "];return e||(e=new RegExp("(^|[\\x20\\t\\r\\n\\f])"+t+"("+F+"|$)"))&&w(t,(function(t){return e.test("string"==typeof t.className&&t.className||void 0!==t.getAttribute&&t.getAttribute("class")||"")}))},ATTR:function(t,e,i){return function(r){var n=nt.attr(r,t);return null==n?"!="===e:!e||(n+="","="===e?n===i:"!="===e?n!==i:"^="===e?i&&0===n.indexOf(i):"*="===e?i&&n.indexOf(i)>-1:"$="===e?i&&n.slice(-i.length)===i:"~="===e?(" "+n.replace(j," ")+" ").indexOf(i)>-1:"|="===e&&(n===i||n.slice(0,i.length+1)===i+"-"))}},CHILD:function(t,e,i,r,n){var s="nth"!==t.slice(0,3),o="last"!==t.slice(-4),a="of-type"===e;return 1===r&&0===n?function(t){return!!t.parentNode}:function(e,i,h){var l,c,u,d,p,f,g=s!==o?"nextSibling":"previousSibling",v=e.parentNode,m=a&&e.nodeName.toLowerCase(),y=!h&&!a,x=!1;if(v){if(s){for(;g;){for(d=e;d=d[g];)if(a?d.nodeName.toLowerCase()===m:1===d.nodeType)return!1;f=g="only"===t&&!f&&"nextSibling"}return!0}if(f=[o?v.firstChild:v.lastChild],o&&y){for(x=(p=(l=(c=(u=(d=v)[_]||(d[_]={}))[d.uniqueID]||(u[d.uniqueID]={}))[t]||[])[0]===T&&l[1])&&l[2],d=p&&v.childNodes[p];d=++p&&d&&d[g]||(x=p=0)||f.pop();)if(1===d.nodeType&&++x&&d===e){c[t]=[T,p,x];break}}else if(y&&(x=p=(l=(c=(u=(d=e)[_]||(d[_]={}))[d.uniqueID]||(u[d.uniqueID]={}))[t]||[])[0]===T&&l[1]),!1===x)for(;(d=++p&&d&&d[g]||(x=p=0)||f.pop())&&((a?d.nodeName.toLowerCase()!==m:1!==d.nodeType)||!++x||(y&&((c=(u=d[_]||(d[_]={}))[d.uniqueID]||(u[d.uniqueID]={}))[t]=[T,x]),d!==e)););return(x-=n)===r||x%r==0&&x/r>=0}}},PSEUDO:function(t,e){var i,n=r.pseudos[t]||r.setFilters[t.toLowerCase()]||nt.error("unsupported pseudo: "+t);return n[_]?n(e):n.length>1?(i=[t,t,"",e],r.setFilters.hasOwnProperty(t.toLowerCase())?ot((function(t,i){for(var r,s=n(t,e),o=s.length;o--;)t[r=L(t,s[o])]=!(i[r]=s[o])})):function(t){return n(t,0,i)}):n}},pseudos:{not:ot((function(t){var e=[],i=[],r=a(t.replace(H,"$1"));return r[_]?ot((function(t,e,i,n){for(var s,o=r(t,null,n,[]),a=t.length;a--;)(s=o[a])&&(t[a]=!(e[a]=s))})):function(t,n,s){return e[0]=t,r(e,null,s,i),e[0]=null,!i.pop()}})),has:ot((function(t){return function(e){return nt(t,e).length>0}})),contains:ot((function(t){return t=t.replace(et,it),function(e){return(e.textContent||e.innerText||n(e)).indexOf(t)>-1}})),lang:ot((function(t){return q.test(t||"")||nt.error("unsupported lang: "+t),t=t.replace(et,it).toLowerCase(),function(e){var i;do{if(i=g?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(i=i.toLowerCase())===t||0===i.indexOf(t+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}})),target:function(e){var i=t.location&&t.location.hash;return i&&i.slice(1)===e.id},root:function(t){return t===f},focus:function(t){return t===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(t.type||t.href||~t.tabIndex)},enabled:function(t){return!1===t.disabled},disabled:function(t){return!0===t.disabled},checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,!0===t.selected},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!r.pseudos.empty(t)},header:function(t){return Q.test(t.nodeName)},input:function(t){return Y.test(t.nodeName)},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},text:function(t){var e;return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:dt((function(){return[0]})),last:dt((function(t,e){return[e-1]})),eq:dt((function(t,e,i){return[i<0?i+e:i]})),even:dt((function(t,e){for(var i=0;i<e;i+=2)t.push(i);return t})),odd:dt((function(t,e){for(var i=1;i<e;i+=2)t.push(i);return t})),lt:dt((function(t,e,i){for(var r=i<0?i+e:i;--r>=0;)t.push(r);return t})),gt:dt((function(t,e,i){for(var r=i<0?i+e:i;++r<e;)t.push(r);return t}))}}).pseudos.nth=r.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[e]=ct(e);for(e in{submit:!0,reset:!0})r.pseudos[e]=ut(e);function ft(){}function gt(t){for(var e=0,i=t.length,r="";e<i;e++)r+=t[e].value;return r}function vt(t,e,i){var r=e.dir,n=i&&"parentNode"===r,s=E++;return e.first?function(e,i,s){for(;e=e[r];)if(1===e.nodeType||n)return t(e,i,s)}:function(e,i,o){var a,h,l,c=[T,s];if(o){for(;e=e[r];)if((1===e.nodeType||n)&&t(e,i,o))return!0}else for(;e=e[r];)if(1===e.nodeType||n){if((a=(h=(l=e[_]||(e[_]={}))[e.uniqueID]||(l[e.uniqueID]={}))[r])&&a[0]===T&&a[1]===s)return c[2]=a[2];if(h[r]=c,c[2]=t(e,i,o))return!0}}}function mt(t){return t.length>1?function(e,i,r){for(var n=t.length;n--;)if(!t[n](e,i,r))return!1;return!0}:t[0]}function yt(t,e,i,r,n){for(var s,o=[],a=0,h=t.length,l=null!=e;a<h;a++)(s=t[a])&&(i&&!i(s,r,n)||(o.push(s),l&&e.push(a)));return o}function xt(t,e,i,r,n,s){return r&&!r[_]&&(r=xt(r)),n&&!n[_]&&(n=xt(n,s)),ot((function(s,o,a,h){var l,c,u,d=[],p=[],f=o.length,g=s||function(t,e,i){for(var r=0,n=e.length;r<n;r++)nt(t,e[r],i);return i}(e||"*",a.nodeType?[a]:a,[]),v=!t||!s&&e?g:yt(g,d,t,a,h),m=i?n||(s?t:f||r)?[]:o:v;if(i&&i(v,m,a,h),r)for(l=yt(m,p),r(l,[],a,h),c=l.length;c--;)(u=l[c])&&(m[p[c]]=!(v[p[c]]=u));if(s){if(n||t){if(n){for(l=[],c=m.length;c--;)(u=m[c])&&l.push(v[c]=u);n(null,m=[],l,h)}for(c=m.length;c--;)(u=m[c])&&(l=n?L(s,u):d[c])>-1&&(s[l]=!(o[l]=u))}}else m=yt(m===o?m.splice(f,m.length):m),n?n(null,o,m,h):I.apply(o,m)}))}function _t(t){for(var e,i,n,s=t.length,o=r.relative[t[0].type],a=o||r.relative[" "],h=o?1:0,c=vt((function(t){return t===e}),a,!0),u=vt((function(t){return L(e,t)>-1}),a,!0),d=[function(t,i,r){var n=!o&&(r||i!==l)||((e=i).nodeType?c(t,i,r):u(t,i,r));return e=null,n}];h<s;h++)if(i=r.relative[t[h].type])d=[vt(mt(d),i)];else{if((i=r.filter[t[h].type].apply(null,t[h].matches))[_]){for(n=++h;n<s&&!r.relative[t[n].type];n++);return xt(h>1&&mt(d),h>1&&gt(t.slice(0,h-1).concat({value:" "===t[h-2].type?"*":""})).replace(H,"$1"),i,h<n&&_t(t.slice(h,n)),n<s&&_t(t=t.slice(n)),n<s&&gt(t))}d.push(i)}return mt(d)}return ft.prototype=r.filters=r.pseudos,r.setFilters=new ft,o=nt.tokenize=function(t,e){var i,n,s,o,a,h,l,c=A[t+" "];if(c)return e?0:c.slice(0);for(a=t,h=[],l=r.preFilter;a;){for(o in i&&!(n=W.exec(a))||(n&&(a=a.slice(n[0].length)||a),h.push(s=[])),i=!1,(n=K.exec(a))&&(i=n.shift(),s.push({value:i,type:n[0].replace(H," ")}),a=a.slice(i.length)),r.filter)!(n=X[o].exec(a))||l[o]&&!(n=l[o](n))||(i=n.shift(),s.push({value:i,type:o,matches:n}),a=a.slice(i.length));if(!i)break}return e?a.length:a?nt.error(t):A(t,h).slice(0)},a=nt.compile=function(t,e){var i,n=[],s=[],a=C[t+" "];if(!a){for(e||(e=o(t)),i=e.length;i--;)(a=_t(e[i]))[_]?n.push(a):s.push(a);(a=C(t,function(t,e){var i=e.length>0,n=t.length>0,s=function(s,o,a,h,c){var u,f,v,m=0,y="0",x=s&&[],_=[],b=l,E=s||n&&r.find.TAG("*",c),w=T+=null==b?1:Math.random()||.1,A=E.length;for(c&&(l=o===p||o||c);y!==A&&null!=(u=E[y]);y++){if(n&&u){for(f=0,o||u.ownerDocument===p||(d(u),a=!g);v=t[f++];)if(v(u,o||p,a)){h.push(u);break}c&&(T=w)}i&&((u=!v&&u)&&m--,s&&x.push(u))}if(m+=y,i&&y!==m){for(f=0;v=e[f++];)v(x,_,o,a);if(s){if(m>0)for(;y--;)x[y]||_[y]||(_[y]=R.call(h));_=yt(_)}I.apply(h,_),c&&!s&&_.length>0&&m+e.length>1&&nt.uniqueSort(h)}return c&&(T=w,l=b),x};return i?ot(s):s}(s,n))).selector=t}return a},h=nt.select=function(t,e,n,s){var h,l,c,u,d,p="function"==typeof t&&t,f=!s&&o(t=p.selector||t);if(n=n||[],1===f.length){if((l=f[0]=f[0].slice(0)).length>2&&"ID"===(c=l[0]).type&&i.getById&&9===e.nodeType&&g&&r.relative[l[1].type]){if(!(e=(r.find.ID(c.matches[0].replace(et,it),e)||[])[0]))return n;p&&(e=e.parentNode),t=t.slice(l.shift().value.length)}for(h=X.needsContext.test(t)?0:l.length;h--&&(c=l[h],!r.relative[u=c.type]);)if((d=r.find[u])&&(s=d(c.matches[0].replace(et,it),J.test(l[0].type)&&pt(e.parentNode)||e))){if(l.splice(h,1),!(t=s.length&&gt(l)))return I.apply(n,s),n;break}}return(p||a(t,f))(s,e,!g,n,!e||J.test(t)&&pt(e.parentNode)||e),n},i.sortStable=_.split("").sort(S).join("")===_,i.detectDuplicates=!!u,d(),i.sortDetached=at((function(t){return 1&t.compareDocumentPosition(p.createElement("div"))})),at((function(t){return t.innerHTML="<a href='#'></a>","#"===t.firstChild.getAttribute("href")}))||ht("type|href|height|width",(function(t,e,i){if(!i)return t.getAttribute(e,"type"===e.toLowerCase()?1:2)})),i.attributes&&at((function(t){return t.innerHTML="<input/>",t.firstChild.setAttribute("value",""),""===t.firstChild.getAttribute("value")}))||ht("value",(function(t,e,i){if(!i&&"input"===t.nodeName.toLowerCase())return t.defaultValue})),at((function(t){return null==t.getAttribute("disabled")}))||ht(k,(function(t,e,i){var r;if(!i)return!0===t[e]?e.toLowerCase():(r=t.getAttributeNode(e))&&r.specified?r.value:null})),nt}(t);p.find=x,p.expr=x.selectors,p.expr[":"]=p.expr.pseudos,p.uniqueSort=p.unique=x.uniqueSort,p.text=x.getText,p.isXMLDoc=x.isXML,p.contains=x.contains;var _=function(t,e,i){for(var r=[],n=void 0!==i;(t=t[e])&&9!==t.nodeType;)if(1===t.nodeType){if(n&&p(t).is(i))break;r.push(t)}return r},b=function(t,e){for(var i=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&i.push(t);return i},T=p.expr.match.needsContext,E=/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/,w=/^.[^:#\[\.,]*$/;function A(t,e,i){if(p.isFunction(e))return p.grep(t,(function(t,r){return!!e.call(t,r,t)!==i}));if(e.nodeType)return p.grep(t,(function(t){return t===e!==i}));if("string"==typeof e){if(w.test(e))return p.filter(e,t,i);e=p.filter(e,t)}return p.grep(t,(function(t){return a.call(e,t)>-1!==i}))}p.filter=function(t,e,i){var r=e[0];return i&&(t=":not("+t+")"),1===e.length&&1===r.nodeType?p.find.matchesSelector(r,t)?[r]:[]:p.find.matches(t,p.grep(e,(function(t){return 1===t.nodeType})))},p.fn.extend({find:function(t){var e,i=this.length,r=[],n=this;if("string"!=typeof t)return this.pushStack(p(t).filter((function(){for(e=0;e<i;e++)if(p.contains(n[e],this))return!0})));for(e=0;e<i;e++)p.find(t,n[e],r);return(r=this.pushStack(i>1?p.unique(r):r)).selector=this.selector?this.selector+" "+t:t,r},filter:function(t){return this.pushStack(A(this,t||[],!1))},not:function(t){return this.pushStack(A(this,t||[],!0))},is:function(t){return!!A(this,"string"==typeof t&&T.test(t)?p(t):t||[],!1).length}});var C,S=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/;(p.fn.init=function(t,e,i){var n,s;if(!t)return this;if(i=i||C,"string"==typeof t){if(!(n="<"===t[0]&&">"===t[t.length-1]&&t.length>=3?[null,t,null]:S.exec(t))||!n[1]&&e)return!e||e.jquery?(e||i).find(t):this.constructor(e).find(t);if(n[1]){if(e=e instanceof p?e[0]:e,p.merge(this,p.parseHTML(n[1],e&&e.nodeType?e.ownerDocument||e:r,!0)),E.test(n[1])&&p.isPlainObject(e))for(n in e)p.isFunction(this[n])?this[n](e[n]):this.attr(n,e[n]);return this}return(s=r.getElementById(n[2]))&&s.parentNode&&(this.length=1,this[0]=s),this.context=r,this.selector=t,this}return t.nodeType?(this.context=this[0]=t,this.length=1,this):p.isFunction(t)?void 0!==i.ready?i.ready(t):t(p):(void 0!==t.selector&&(this.selector=t.selector,this.context=t.context),p.makeArray(t,this))}).prototype=p.fn,C=p(r);var O=/^(?:parents|prev(?:Until|All))/,D={children:!0,contents:!0,next:!0,prev:!0};function M(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}p.fn.extend({has:function(t){var e=p(t,this),i=e.length;return this.filter((function(){for(var t=0;t<i;t++)if(p.contains(this,e[t]))return!0}))},closest:function(t,e){for(var i,r=0,n=this.length,s=[],o=T.test(t)||"string"!=typeof t?p(t,e||this.context):0;r<n;r++)for(i=this[r];i&&i!==e;i=i.parentNode)if(i.nodeType<11&&(o?o.index(i)>-1:1===i.nodeType&&p.find.matchesSelector(i,t))){s.push(i);break}return this.pushStack(s.length>1?p.uniqueSort(s):s)},index:function(t){return t?"string"==typeof t?a.call(p(t),this[0]):a.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(p.uniqueSort(p.merge(this.get(),p(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),p.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return _(t,"parentNode")},parentsUntil:function(t,e,i){return _(t,"parentNode",i)},next:function(t){return M(t,"nextSibling")},prev:function(t){return M(t,"previousSibling")},nextAll:function(t){return _(t,"nextSibling")},prevAll:function(t){return _(t,"previousSibling")},nextUntil:function(t,e,i){return _(t,"nextSibling",i)},prevUntil:function(t,e,i){return _(t,"previousSibling",i)},siblings:function(t){return b((t.parentNode||{}).firstChild,t)},children:function(t){return b(t.firstChild)},contents:function(t){return t.contentDocument||p.merge([],t.childNodes)}},(function(t,e){p.fn[t]=function(i,r){var n=p.map(this,e,i);return"Until"!==t.slice(-5)&&(r=i),r&&"string"==typeof r&&(n=p.filter(r,n)),this.length>1&&(D[t]||p.uniqueSort(n),O.test(t)&&n.reverse()),this.pushStack(n)}}));var R,P=/\S+/g;function I(){r.removeEventListener("DOMContentLoaded",I),t.removeEventListener("load",I),p.ready()}p.Callbacks=function(t){t="string"==typeof t?function(t){var e={};return p.each(t.match(P)||[],(function(t,i){e[i]=!0})),e}(t):p.extend({},t);var e,i,r,n,s=[],o=[],a=-1,h=function(){for(n=t.once,r=e=!0;o.length;a=-1)for(i=o.shift();++a<s.length;)!1===s[a].apply(i[0],i[1])&&t.stopOnFalse&&(a=s.length,i=!1);t.memory||(i=!1),e=!1,n&&(s=i?[]:"")},l={add:function(){return s&&(i&&!e&&(a=s.length-1,o.push(i)),function e(i){p.each(i,(function(i,r){p.isFunction(r)?t.unique&&l.has(r)||s.push(r):r&&r.length&&"string"!==p.type(r)&&e(r)}))}(arguments),i&&!e&&h()),this},remove:function(){return p.each(arguments,(function(t,e){for(var i;(i=p.inArray(e,s,i))>-1;)s.splice(i,1),i<=a&&a--})),this},has:function(t){return t?p.inArray(t,s)>-1:s.length>0},empty:function(){return s&&(s=[]),this},disable:function(){return n=o=[],s=i="",this},disabled:function(){return!s},lock:function(){return n=o=[],i||(s=i=""),this},locked:function(){return!!n},fireWith:function(t,i){return n||(i=[t,(i=i||[]).slice?i.slice():i],o.push(i),e||h()),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!r}};return l},p.extend({Deferred:function(t){var e=[["resolve","done",p.Callbacks("once memory"),"resolved"],["reject","fail",p.Callbacks("once memory"),"rejected"],["notify","progress",p.Callbacks("memory")]],i="pending",r={state:function(){return i},always:function(){return n.done(arguments).fail(arguments),this},then:function(){var t=arguments;return p.Deferred((function(i){p.each(e,(function(e,s){var o=p.isFunction(t[e])&&t[e];n[s[1]]((function(){var t=o&&o.apply(this,arguments);t&&p.isFunction(t.promise)?t.promise().progress(i.notify).done(i.resolve).fail(i.reject):i[s[0]+"With"](this===r?i.promise():this,o?[t]:arguments)}))})),t=null})).promise()},promise:function(t){return null!=t?p.extend(t,r):r}},n={};return r.pipe=r.then,p.each(e,(function(t,s){var o=s[2],a=s[3];r[s[1]]=o.add,a&&o.add((function(){i=a}),e[1^t][2].disable,e[2][2].lock),n[s[0]]=function(){return n[s[0]+"With"](this===n?r:this,arguments),this},n[s[0]+"With"]=o.fireWith})),r.promise(n),t&&t.call(n,n),n},when:function(t){var e,i,r,s=0,o=n.call(arguments),a=o.length,h=1!==a||t&&p.isFunction(t.promise)?a:0,l=1===h?t:p.Deferred(),c=function(t,i,r){return function(s){i[t]=this,r[t]=arguments.length>1?n.call(arguments):s,r===e?l.notifyWith(i,r):--h||l.resolveWith(i,r)}};if(a>1)for(e=new Array(a),i=new Array(a),r=new Array(a);s<a;s++)o[s]&&p.isFunction(o[s].promise)?o[s].promise().progress(c(s,i,e)).done(c(s,r,o)).fail(l.reject):--h;return h||l.resolveWith(r,o),l.promise()}}),p.fn.ready=function(t){return p.ready.promise().done(t),this},p.extend({isReady:!1,readyWait:1,holdReady:function(t){t?p.readyWait++:p.ready(!0)},ready:function(t){(!0===t?--p.readyWait:p.isReady)||(p.isReady=!0,!0!==t&&--p.readyWait>0||(R.resolveWith(r,[p]),p.fn.triggerHandler&&(p(r).triggerHandler("ready"),p(r).off("ready"))))}}),p.ready.promise=function(e){return R||(R=p.Deferred(),"complete"===r.readyState||"loading"!==r.readyState&&!r.documentElement.doScroll?t.setTimeout(p.ready):(r.addEventListener("DOMContentLoaded",I),t.addEventListener("load",I))),R.promise(e)},p.ready.promise();var N=function(t,e,i,r,n,s,o){var a=0,h=t.length,l=null==i;if("object"===p.type(i))for(a in n=!0,i)N(t,e,a,i[a],!0,s,o);else if(void 0!==r&&(n=!0,p.isFunction(r)||(o=!0),l&&(o?(e.call(t,r),e=null):(l=e,e=function(t,e,i){return l.call(p(t),i)})),e))for(;a<h;a++)e(t[a],i,o?r:r.call(t[a],a,e(t[a],i)));return n?t:l?e.call(t):h?e(t[0],i):s},L=function(t){return 1===t.nodeType||9===t.nodeType||!+t.nodeType};function k(){this.expando=p.expando+k.uid++}k.uid=1,k.prototype={register:function(t,e){var i=e||{};return t.nodeType?t[this.expando]=i:Object.defineProperty(t,this.expando,{value:i,writable:!0,configurable:!0}),t[this.expando]},cache:function(t){if(!L(t))return{};var e=t[this.expando];return e||(e={},L(t)&&(t.nodeType?t[this.expando]=e:Object.defineProperty(t,this.expando,{value:e,configurable:!0}))),e},set:function(t,e,i){var r,n=this.cache(t);if("string"==typeof e)n[e]=i;else for(r in e)n[r]=e[r];return n},get:function(t,e){return void 0===e?this.cache(t):t[this.expando]&&t[this.expando][e]},access:function(t,e,i){var r;return void 0===e||e&&"string"==typeof e&&void 0===i?void 0!==(r=this.get(t,e))?r:this.get(t,p.camelCase(e)):(this.set(t,e,i),void 0!==i?i:e)},remove:function(t,e){var i,r,n,s=t[this.expando];if(void 0!==s){if(void 0===e)this.register(t);else{p.isArray(e)?r=e.concat(e.map(p.camelCase)):(n=p.camelCase(e),r=e in s?[e,n]:(r=n)in s?[r]:r.match(P)||[]),i=r.length;for(;i--;)delete s[r[i]]}(void 0===e||p.isEmptyObject(s))&&(t.nodeType?t[this.expando]=void 0:delete t[this.expando])}},hasData:function(t){var e=t[this.expando];return void 0!==e&&!p.isEmptyObject(e)}};var F=new k,B=new k,U=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,V=/[A-Z]/g;function j(t,e,i){var r;if(void 0===i&&1===t.nodeType)if(r="data-"+e.replace(V,"-$&").toLowerCase(),"string"==typeof(i=t.getAttribute(r))){try{i="true"===i||"false"!==i&&("null"===i?null:+i+""===i?+i:U.test(i)?p.parseJSON(i):i)}catch(t){}B.set(t,e,i)}else i=void 0;return i}p.extend({hasData:function(t){return B.hasData(t)||F.hasData(t)},data:function(t,e,i){return B.access(t,e,i)},removeData:function(t,e){B.remove(t,e)},_data:function(t,e,i){return F.access(t,e,i)},_removeData:function(t,e){F.remove(t,e)}}),p.fn.extend({data:function(t,e){var i,r,n,s=this[0],o=s&&s.attributes;if(void 0===t){if(this.length&&(n=B.get(s),1===s.nodeType&&!F.get(s,"hasDataAttrs"))){for(i=o.length;i--;)o[i]&&0===(r=o[i].name).indexOf("data-")&&(r=p.camelCase(r.slice(5)),j(s,r,n[r]));F.set(s,"hasDataAttrs",!0)}return n}return"object"==typeof t?this.each((function(){B.set(this,t)})):N(this,(function(e){var i,r;if(s&&void 0===e)return void 0!==(i=B.get(s,t)||B.get(s,t.replace(V,"-$&").toLowerCase()))?i:(r=p.camelCase(t),void 0!==(i=B.get(s,r))||void 0!==(i=j(s,r,void 0))?i:void 0);r=p.camelCase(t),this.each((function(){var i=B.get(this,r);B.set(this,r,e),t.indexOf("-")>-1&&void 0!==i&&B.set(this,t,e)}))}),null,e,arguments.length>1,null,!0)},removeData:function(t){return this.each((function(){B.remove(this,t)}))}}),p.extend({queue:function(t,e,i){var r;if(t)return e=(e||"fx")+"queue",r=F.get(t,e),i&&(!r||p.isArray(i)?r=F.access(t,e,p.makeArray(i)):r.push(i)),r||[]},dequeue:function(t,e){e=e||"fx";var i=p.queue(t,e),r=i.length,n=i.shift(),s=p._queueHooks(t,e);"inprogress"===n&&(n=i.shift(),r--),n&&("fx"===e&&i.unshift("inprogress"),delete s.stop,n.call(t,(function(){p.dequeue(t,e)}),s)),!r&&s&&s.empty.fire()},_queueHooks:function(t,e){var i=e+"queueHooks";return F.get(t,i)||F.access(t,i,{empty:p.Callbacks("once memory").add((function(){F.remove(t,[e+"queue",i])}))})}}),p.fn.extend({queue:function(t,e){var i=2;return"string"!=typeof t&&(e=t,t="fx",i--),arguments.length<i?p.queue(this[0],t):void 0===e?this:this.each((function(){var i=p.queue(this,t,e);p._queueHooks(this,t),"fx"===t&&"inprogress"!==i[0]&&p.dequeue(this,t)}))},dequeue:function(t){return this.each((function(){p.dequeue(this,t)}))},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){var i,r=1,n=p.Deferred(),s=this,o=this.length,a=function(){--r||n.resolveWith(s,[s])};for("string"!=typeof t&&(e=t,t=void 0),t=t||"fx";o--;)(i=F.get(s[o],t+"queueHooks"))&&i.empty&&(r++,i.empty.add(a));return a(),n.promise(e)}});var H=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,W=new RegExp("^(?:([+-])=|)("+H+")([a-z%]*)$","i"),K=["Top","Right","Bottom","Left"],G=function(t,e){return t=e||t,"none"===p.css(t,"display")||!p.contains(t.ownerDocument,t)};function z(t,e,i,r){var n,s=1,o=20,a=r?function(){return r.cur()}:function(){return p.css(t,e,"")},h=a(),l=i&&i[3]||(p.cssNumber[e]?"":"px"),c=(p.cssNumber[e]||"px"!==l&&+h)&&W.exec(p.css(t,e));if(c&&c[3]!==l){l=l||c[3],i=i||[],c=+h||1;do{c/=s=s||".5",p.style(t,e,c+l)}while(s!==(s=a()/h)&&1!==s&&--o)}return i&&(c=+c||+h||0,n=i[1]?c+(i[1]+1)*i[2]:+i[2],r&&(r.unit=l,r.start=c,r.end=n)),n}var q=/^(?:checkbox|radio)$/i,X=/<([\w:-]+)/,Y=/^$|\/(?:java|ecma)script/i,Q={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function Z(t,e){var i=void 0!==t.getElementsByTagName?t.getElementsByTagName(e||"*"):void 0!==t.querySelectorAll?t.querySelectorAll(e||"*"):[];return void 0===e||e&&p.nodeName(t,e)?p.merge([t],i):i}function $(t,e){for(var i=0,r=t.length;i<r;i++)F.set(t[i],"globalEval",!e||F.get(e[i],"globalEval"))}Q.optgroup=Q.option,Q.tbody=Q.tfoot=Q.colgroup=Q.caption=Q.thead,Q.th=Q.td;var J,tt,et=/<|&#?\w+;/;function it(t,e,i,r,n){for(var s,o,a,h,l,c,u=e.createDocumentFragment(),d=[],f=0,g=t.length;f<g;f++)if((s=t[f])||0===s)if("object"===p.type(s))p.merge(d,s.nodeType?[s]:s);else if(et.test(s)){for(o=o||u.appendChild(e.createElement("div")),a=(X.exec(s)||["",""])[1].toLowerCase(),h=Q[a]||Q._default,o.innerHTML=h[1]+p.htmlPrefilter(s)+h[2],c=h[0];c--;)o=o.lastChild;p.merge(d,o.childNodes),(o=u.firstChild).textContent=""}else d.push(e.createTextNode(s));for(u.textContent="",f=0;s=d[f++];)if(r&&p.inArray(s,r)>-1)n&&n.push(s);else if(l=p.contains(s.ownerDocument,s),o=Z(u.appendChild(s),"script"),l&&$(o),i)for(c=0;s=o[c++];)Y.test(s.type||"")&&i.push(s);return u}J=r.createDocumentFragment().appendChild(r.createElement("div")),(tt=r.createElement("input")).setAttribute("type","radio"),tt.setAttribute("checked","checked"),tt.setAttribute("name","t"),J.appendChild(tt),u.checkClone=J.cloneNode(!0).cloneNode(!0).lastChild.checked,J.innerHTML="<textarea>x</textarea>",u.noCloneChecked=!!J.cloneNode(!0).lastChild.defaultValue;var rt=/^key/,nt=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,st=/^([^.]*)(?:\.(.+)|)/;function ot(){return!0}function at(){return!1}function ht(){try{return r.activeElement}catch(t){}}function lt(t,e,i,r,n,s){var o,a;if("object"==typeof e){for(a in"string"!=typeof i&&(r=r||i,i=void 0),e)lt(t,a,i,r,e[a],s);return t}if(null==r&&null==n?(n=i,r=i=void 0):null==n&&("string"==typeof i?(n=r,r=void 0):(n=r,r=i,i=void 0)),!1===n)n=at;else if(!n)return t;return 1===s&&(o=n,(n=function(t){return p().off(t),o.apply(this,arguments)}).guid=o.guid||(o.guid=p.guid++)),t.each((function(){p.event.add(this,e,n,r,i)}))}p.event={global:{},add:function(t,e,i,r,n){var s,o,a,h,l,c,u,d,f,g,v,m=F.get(t);if(m)for(i.handler&&(i=(s=i).handler,n=s.selector),i.guid||(i.guid=p.guid++),(h=m.events)||(h=m.events={}),(o=m.handle)||(o=m.handle=function(e){return void 0!==p&&p.event.triggered!==e.type?p.event.dispatch.apply(t,arguments):void 0}),l=(e=(e||"").match(P)||[""]).length;l--;)f=v=(a=st.exec(e[l])||[])[1],g=(a[2]||"").split(".").sort(),f&&(u=p.event.special[f]||{},f=(n?u.delegateType:u.bindType)||f,u=p.event.special[f]||{},c=p.extend({type:f,origType:v,data:r,handler:i,guid:i.guid,selector:n,needsContext:n&&p.expr.match.needsContext.test(n),namespace:g.join(".")},s),(d=h[f])||((d=h[f]=[]).delegateCount=0,u.setup&&!1!==u.setup.call(t,r,g,o)||t.addEventListener&&t.addEventListener(f,o)),u.add&&(u.add.call(t,c),c.handler.guid||(c.handler.guid=i.guid)),n?d.splice(d.delegateCount++,0,c):d.push(c),p.event.global[f]=!0)},remove:function(t,e,i,r,n){var s,o,a,h,l,c,u,d,f,g,v,m=F.hasData(t)&&F.get(t);if(m&&(h=m.events)){for(l=(e=(e||"").match(P)||[""]).length;l--;)if(f=v=(a=st.exec(e[l])||[])[1],g=(a[2]||"").split(".").sort(),f){for(u=p.event.special[f]||{},d=h[f=(r?u.delegateType:u.bindType)||f]||[],a=a[2]&&new RegExp("(^|\\.)"+g.join("\\.(?:.*\\.|)")+"(\\.|$)"),o=s=d.length;s--;)c=d[s],!n&&v!==c.origType||i&&i.guid!==c.guid||a&&!a.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(d.splice(s,1),c.selector&&d.delegateCount--,u.remove&&u.remove.call(t,c));o&&!d.length&&(u.teardown&&!1!==u.teardown.call(t,g,m.handle)||p.removeEvent(t,f,m.handle),delete h[f])}else for(f in h)p.event.remove(t,f+e[l],i,r,!0);p.isEmptyObject(h)&&F.remove(t,"handle events")}},dispatch:function(t){t=p.event.fix(t);var e,i,r,s,o,a=[],h=n.call(arguments),l=(F.get(this,"events")||{})[t.type]||[],c=p.event.special[t.type]||{};if(h[0]=t,t.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,t)){for(a=p.event.handlers.call(this,t,l),e=0;(s=a[e++])&&!t.isPropagationStopped();)for(t.currentTarget=s.elem,i=0;(o=s.handlers[i++])&&!t.isImmediatePropagationStopped();)t.rnamespace&&!t.rnamespace.test(o.namespace)||(t.handleObj=o,t.data=o.data,void 0!==(r=((p.event.special[o.origType]||{}).handle||o.handler).apply(s.elem,h))&&!1===(t.result=r)&&(t.preventDefault(),t.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,t),t.result}},handlers:function(t,e){var i,r,n,s,o=[],a=e.delegateCount,h=t.target;if(a&&h.nodeType&&("click"!==t.type||isNaN(t.button)||t.button<1))for(;h!==this;h=h.parentNode||this)if(1===h.nodeType&&(!0!==h.disabled||"click"!==t.type)){for(r=[],i=0;i<a;i++)void 0===r[n=(s=e[i]).selector+" "]&&(r[n]=s.needsContext?p(n,this).index(h)>-1:p.find(n,this,null,[h]).length),r[n]&&r.push(s);r.length&&o.push({elem:h,handlers:r})}return a<e.length&&o.push({elem:this,handlers:e.slice(a)}),o},props:"altKey bubbles cancelable ctrlKey currentTarget detail eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(t,e){return null==t.which&&(t.which=null!=e.charCode?e.charCode:e.keyCode),t}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(t,e){var i,n,s,o=e.button;return null==t.pageX&&null!=e.clientX&&(n=(i=t.target.ownerDocument||r).documentElement,s=i.body,t.pageX=e.clientX+(n&&n.scrollLeft||s&&s.scrollLeft||0)-(n&&n.clientLeft||s&&s.clientLeft||0),t.pageY=e.clientY+(n&&n.scrollTop||s&&s.scrollTop||0)-(n&&n.clientTop||s&&s.clientTop||0)),t.which||void 0===o||(t.which=1&o?1:2&o?3:4&o?2:0),t}},fix:function(t){if(t[p.expando])return t;var e,i,n,s=t.type,o=t,a=this.fixHooks[s];for(a||(this.fixHooks[s]=a=nt.test(s)?this.mouseHooks:rt.test(s)?this.keyHooks:{}),n=a.props?this.props.concat(a.props):this.props,t=new p.Event(o),e=n.length;e--;)t[i=n[e]]=o[i];return t.target||(t.target=r),3===t.target.nodeType&&(t.target=t.target.parentNode),a.filter?a.filter(t,o):t},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==ht()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===ht()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&p.nodeName(this,"input"))return this.click(),!1},_default:function(t){return p.nodeName(t.target,"a")}},beforeunload:{postDispatch:function(t){void 0!==t.result&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}}},p.removeEvent=function(t,e,i){t.removeEventListener&&t.removeEventListener(e,i)},p.Event=function(t,e){if(!(this instanceof p.Event))return new p.Event(t,e);t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||void 0===t.defaultPrevented&&!1===t.returnValue?ot:at):this.type=t,e&&p.extend(this,e),this.timeStamp=t&&t.timeStamp||p.now(),this[p.expando]=!0},p.Event.prototype={constructor:p.Event,isDefaultPrevented:at,isPropagationStopped:at,isImmediatePropagationStopped:at,isSimulated:!1,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=ot,t&&!this.isSimulated&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=ot,t&&!this.isSimulated&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=ot,t&&!this.isSimulated&&t.stopImmediatePropagation(),this.stopPropagation()}},p.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},(function(t,e){p.event.special[t]={delegateType:e,bindType:e,handle:function(t){var i,r=this,n=t.relatedTarget,s=t.handleObj;return n&&(n===r||p.contains(r,n))||(t.type=s.origType,i=s.handler.apply(this,arguments),t.type=e),i}}})),p.fn.extend({on:function(t,e,i,r){return lt(this,t,e,i,r)},one:function(t,e,i,r){return lt(this,t,e,i,r,1)},off:function(t,e,i){var r,n;if(t&&t.preventDefault&&t.handleObj)return r=t.handleObj,p(t.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof t){for(n in t)this.off(n,e,t[n]);return this}return!1!==e&&"function"!=typeof e||(i=e,e=void 0),!1===i&&(i=at),this.each((function(){p.event.remove(this,t,i,e)}))}});var ct=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,ut=/<script|<style|<link/i,dt=/checked\s*(?:[^=]|=\s*.checked.)/i,pt=/^true\/(.*)/,ft=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function gt(t,e){return p.nodeName(t,"table")&&p.nodeName(11!==e.nodeType?e:e.firstChild,"tr")?t.getElementsByTagName("tbody")[0]||t.appendChild(t.ownerDocument.createElement("tbody")):t}function vt(t){return t.type=(null!==t.getAttribute("type"))+"/"+t.type,t}function mt(t){var e=pt.exec(t.type);return e?t.type=e[1]:t.removeAttribute("type"),t}function yt(t,e){var i,r,n,s,o,a,h,l;if(1===e.nodeType){if(F.hasData(t)&&(s=F.access(t),o=F.set(e,s),l=s.events))for(n in delete o.handle,o.events={},l)for(i=0,r=l[n].length;i<r;i++)p.event.add(e,n,l[n][i]);B.hasData(t)&&(a=B.access(t),h=p.extend({},a),B.set(e,h))}}function xt(t,e,i,r){e=s.apply([],e);var n,o,a,h,l,c,d=0,f=t.length,g=f-1,v=e[0],m=p.isFunction(v);if(m||f>1&&"string"==typeof v&&!u.checkClone&&dt.test(v))return t.each((function(n){var s=t.eq(n);m&&(e[0]=v.call(this,n,s.html())),xt(s,e,i,r)}));if(f&&(o=(n=it(e,t[0].ownerDocument,!1,t,r)).firstChild,1===n.childNodes.length&&(n=o),o||r)){for(h=(a=p.map(Z(n,"script"),vt)).length;d<f;d++)l=n,d!==g&&(l=p.clone(l,!0,!0),h&&p.merge(a,Z(l,"script"))),i.call(t[d],l,d);if(h)for(c=a[a.length-1].ownerDocument,p.map(a,mt),d=0;d<h;d++)l=a[d],Y.test(l.type||"")&&!F.access(l,"globalEval")&&p.contains(c,l)&&(l.src?p._evalUrl&&p._evalUrl(l.src):p.globalEval(l.textContent.replace(ft,"")))}return t}function _t(t,e,i){for(var r,n=e?p.filter(e,t):t,s=0;null!=(r=n[s]);s++)i||1!==r.nodeType||p.cleanData(Z(r)),r.parentNode&&(i&&p.contains(r.ownerDocument,r)&&$(Z(r,"script")),r.parentNode.removeChild(r));return t}p.extend({htmlPrefilter:function(t){return t.replace(ct,"<$1></$2>")},clone:function(t,e,i){var r,n,s,o,a,h,l,c=t.cloneNode(!0),d=p.contains(t.ownerDocument,t);if(!(u.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||p.isXMLDoc(t)))for(o=Z(c),r=0,n=(s=Z(t)).length;r<n;r++)a=s[r],h=o[r],l=void 0,"input"===(l=h.nodeName.toLowerCase())&&q.test(a.type)?h.checked=a.checked:"input"!==l&&"textarea"!==l||(h.defaultValue=a.defaultValue);if(e)if(i)for(s=s||Z(t),o=o||Z(c),r=0,n=s.length;r<n;r++)yt(s[r],o[r]);else yt(t,c);return(o=Z(c,"script")).length>0&&$(o,!d&&Z(t,"script")),c},cleanData:function(t){for(var e,i,r,n=p.event.special,s=0;void 0!==(i=t[s]);s++)if(L(i)){if(e=i[F.expando]){if(e.events)for(r in e.events)n[r]?p.event.remove(i,r):p.removeEvent(i,r,e.handle);i[F.expando]=void 0}i[B.expando]&&(i[B.expando]=void 0)}}}),p.fn.extend({domManip:xt,detach:function(t){return _t(this,t,!0)},remove:function(t){return _t(this,t)},text:function(t){return N(this,(function(t){return void 0===t?p.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=t)}))}),null,t,arguments.length)},append:function(){return xt(this,arguments,(function(t){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||gt(this,t).appendChild(t)}))},prepend:function(){return xt(this,arguments,(function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=gt(this,t);e.insertBefore(t,e.firstChild)}}))},before:function(){return xt(this,arguments,(function(t){this.parentNode&&this.parentNode.insertBefore(t,this)}))},after:function(){return xt(this,arguments,(function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)}))},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(p.cleanData(Z(t,!1)),t.textContent="");return this},clone:function(t,e){return t=null!=t&&t,e=null==e?t:e,this.map((function(){return p.clone(this,t,e)}))},html:function(t){return N(this,(function(t){var e=this[0]||{},i=0,r=this.length;if(void 0===t&&1===e.nodeType)return e.innerHTML;if("string"==typeof t&&!ut.test(t)&&!Q[(X.exec(t)||["",""])[1].toLowerCase()]){t=p.htmlPrefilter(t);try{for(;i<r;i++)1===(e=this[i]||{}).nodeType&&(p.cleanData(Z(e,!1)),e.innerHTML=t);e=0}catch(t){}}e&&this.empty().append(t)}),null,t,arguments.length)},replaceWith:function(){var t=[];return xt(this,arguments,(function(e){var i=this.parentNode;p.inArray(this,t)<0&&(p.cleanData(Z(this)),i&&i.replaceChild(e,this))}),t)}}),p.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},(function(t,e){p.fn[t]=function(t){for(var i,r=[],n=p(t),s=n.length-1,a=0;a<=s;a++)i=a===s?this:this.clone(!0),p(n[a])[e](i),o.apply(r,i.get());return this.pushStack(r)}}));var bt,Tt={HTML:"block",BODY:"block"};function Et(t,e){var i=p(e.createElement(t)).appendTo(e.body),r=p.css(i[0],"display");return i.detach(),r}function wt(t){var e=r,i=Tt[t];return i||("none"!==(i=Et(t,e))&&i||((e=(bt=(bt||p("<iframe frameborder='0' width='0' height='0'/>")).appendTo(e.documentElement))[0].contentDocument).write(),e.close(),i=Et(t,e),bt.detach()),Tt[t]=i),i}var At=/^margin/,Ct=new RegExp("^("+H+")(?!px)[a-z%]+$","i"),St=function(e){var i=e.ownerDocument.defaultView;return i&&i.opener||(i=t),i.getComputedStyle(e)},Ot=function(t,e,i,r){var n,s,o={};for(s in e)o[s]=t.style[s],t.style[s]=e[s];for(s in n=i.apply(t,r||[]),e)t.style[s]=o[s];return n},Dt=r.documentElement;function Mt(t,e,i){var r,n,s,o,a=t.style;return""!==(o=(i=i||St(t))?i.getPropertyValue(e)||i[e]:void 0)&&void 0!==o||p.contains(t.ownerDocument,t)||(o=p.style(t,e)),i&&!u.pixelMarginRight()&&Ct.test(o)&&At.test(e)&&(r=a.width,n=a.minWidth,s=a.maxWidth,a.minWidth=a.maxWidth=a.width=o,o=i.width,a.width=r,a.minWidth=n,a.maxWidth=s),void 0!==o?o+"":o}function Rt(t,e){return{get:function(){if(!t())return(this.get=e).apply(this,arguments);delete this.get}}}!function(){var e,i,n,s,o=r.createElement("div"),a=r.createElement("div");function h(){a.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",a.innerHTML="",Dt.appendChild(o);var r=t.getComputedStyle(a);e="1%"!==r.top,s="2px"===r.marginLeft,i="4px"===r.width,a.style.marginRight="50%",n="4px"===r.marginRight,Dt.removeChild(o)}a.style&&(a.style.backgroundClip="content-box",a.cloneNode(!0).style.backgroundClip="",u.clearCloneStyle="content-box"===a.style.backgroundClip,o.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",o.appendChild(a),p.extend(u,{pixelPosition:function(){return h(),e},boxSizingReliable:function(){return null==i&&h(),i},pixelMarginRight:function(){return null==i&&h(),n},reliableMarginLeft:function(){return null==i&&h(),s},reliableMarginRight:function(){var e,i=a.appendChild(r.createElement("div"));return i.style.cssText=a.style.cssText="-webkit-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",i.style.marginRight=i.style.width="0",a.style.width="1px",Dt.appendChild(o),e=!parseFloat(t.getComputedStyle(i).marginRight),Dt.removeChild(o),a.removeChild(i),e}}))}();var Pt=/^(none|table(?!-c[ea]).+)/,It={position:"absolute",visibility:"hidden",display:"block"},Nt={letterSpacing:"0",fontWeight:"400"},Lt=["Webkit","O","Moz","ms"],kt=r.createElement("div").style;function Ft(t){if(t in kt)return t;for(var e=t[0].toUpperCase()+t.slice(1),i=Lt.length;i--;)if((t=Lt[i]+e)in kt)return t}function Bt(t,e,i){var r=W.exec(e);return r?Math.max(0,r[2]-(i||0))+(r[3]||"px"):e}function Ut(t,e,i,r,n){for(var s=i===(r?"border":"content")?4:"width"===e?1:0,o=0;s<4;s+=2)"margin"===i&&(o+=p.css(t,i+K[s],!0,n)),r?("content"===i&&(o-=p.css(t,"padding"+K[s],!0,n)),"margin"!==i&&(o-=p.css(t,"border"+K[s]+"Width",!0,n))):(o+=p.css(t,"padding"+K[s],!0,n),"padding"!==i&&(o+=p.css(t,"border"+K[s]+"Width",!0,n)));return o}function Vt(t,e,i){var r=!0,n="width"===e?t.offsetWidth:t.offsetHeight,s=St(t),o="border-box"===p.css(t,"boxSizing",!1,s);if(n<=0||null==n){if(((n=Mt(t,e,s))<0||null==n)&&(n=t.style[e]),Ct.test(n))return n;r=o&&(u.boxSizingReliable()||n===t.style[e]),n=parseFloat(n)||0}return n+Ut(t,e,i||(o?"border":"content"),r,s)+"px"}function jt(t,e){for(var i,r,n,s=[],o=0,a=t.length;o<a;o++)(r=t[o]).style&&(s[o]=F.get(r,"olddisplay"),i=r.style.display,e?(s[o]||"none"!==i||(r.style.display=""),""===r.style.display&&G(r)&&(s[o]=F.access(r,"olddisplay",wt(r.nodeName)))):(n=G(r),"none"===i&&n||F.set(r,"olddisplay",n?i:p.css(r,"display"))));for(o=0;o<a;o++)(r=t[o]).style&&(e&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=e?s[o]||"":"none"));return t}function Ht(t,e,i,r,n){return new Ht.prototype.init(t,e,i,r,n)}p.extend({cssHooks:{opacity:{get:function(t,e){if(e){var i=Mt(t,"opacity");return""===i?"1":i}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(t,e,i,r){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var n,s,o,a=p.camelCase(e),h=t.style;if(e=p.cssProps[a]||(p.cssProps[a]=Ft(a)||a),o=p.cssHooks[e]||p.cssHooks[a],void 0===i)return o&&"get"in o&&void 0!==(n=o.get(t,!1,r))?n:h[e];"string"===(s=typeof i)&&(n=W.exec(i))&&n[1]&&(i=z(t,e,n),s="number"),null!=i&&i==i&&("number"===s&&(i+=n&&n[3]||(p.cssNumber[a]?"":"px")),u.clearCloneStyle||""!==i||0!==e.indexOf("background")||(h[e]="inherit"),o&&"set"in o&&void 0===(i=o.set(t,i,r))||(h[e]=i))}},css:function(t,e,i,r){var n,s,o,a=p.camelCase(e);return e=p.cssProps[a]||(p.cssProps[a]=Ft(a)||a),(o=p.cssHooks[e]||p.cssHooks[a])&&"get"in o&&(n=o.get(t,!0,i)),void 0===n&&(n=Mt(t,e,r)),"normal"===n&&e in Nt&&(n=Nt[e]),""===i||i?(s=parseFloat(n),!0===i||isFinite(s)?s||0:n):n}}),p.each(["height","width"],(function(t,e){p.cssHooks[e]={get:function(t,i,r){if(i)return Pt.test(p.css(t,"display"))&&0===t.offsetWidth?Ot(t,It,(function(){return Vt(t,e,r)})):Vt(t,e,r)},set:function(t,i,r){var n,s=r&&St(t),o=r&&Ut(t,e,r,"border-box"===p.css(t,"boxSizing",!1,s),s);return o&&(n=W.exec(i))&&"px"!==(n[3]||"px")&&(t.style[e]=i,i=p.css(t,e)),Bt(0,i,o)}}})),p.cssHooks.marginLeft=Rt(u.reliableMarginLeft,(function(t,e){if(e)return(parseFloat(Mt(t,"marginLeft"))||t.getBoundingClientRect().left-Ot(t,{marginLeft:0},(function(){return t.getBoundingClientRect().left})))+"px"})),p.cssHooks.marginRight=Rt(u.reliableMarginRight,(function(t,e){if(e)return Ot(t,{display:"inline-block"},Mt,[t,"marginRight"])})),p.each({margin:"",padding:"",border:"Width"},(function(t,e){p.cssHooks[t+e]={expand:function(i){for(var r=0,n={},s="string"==typeof i?i.split(" "):[i];r<4;r++)n[t+K[r]+e]=s[r]||s[r-2]||s[0];return n}},At.test(t)||(p.cssHooks[t+e].set=Bt)})),p.fn.extend({css:function(t,e){return N(this,(function(t,e,i){var r,n,s={},o=0;if(p.isArray(e)){for(r=St(t),n=e.length;o<n;o++)s[e[o]]=p.css(t,e[o],!1,r);return s}return void 0!==i?p.style(t,e,i):p.css(t,e)}),t,e,arguments.length>1)},show:function(){return jt(this,!0)},hide:function(){return jt(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each((function(){G(this)?p(this).show():p(this).hide()}))}}),p.Tween=Ht,Ht.prototype={constructor:Ht,init:function(t,e,i,r,n,s){this.elem=t,this.prop=i,this.easing=n||p.easing._default,this.options=e,this.start=this.now=this.cur(),this.end=r,this.unit=s||(p.cssNumber[i]?"":"px")},cur:function(){var t=Ht.propHooks[this.prop];return t&&t.get?t.get(this):Ht.propHooks._default.get(this)},run:function(t){var e,i=Ht.propHooks[this.prop];return this.options.duration?this.pos=e=p.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):this.pos=e=t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):Ht.propHooks._default.set(this),this}},Ht.prototype.init.prototype=Ht.prototype,Ht.propHooks={_default:{get:function(t){var e;return 1!==t.elem.nodeType||null!=t.elem[t.prop]&&null==t.elem.style[t.prop]?t.elem[t.prop]:(e=p.css(t.elem,t.prop,""))&&"auto"!==e?e:0},set:function(t){p.fx.step[t.prop]?p.fx.step[t.prop](t):1!==t.elem.nodeType||null==t.elem.style[p.cssProps[t.prop]]&&!p.cssHooks[t.prop]?t.elem[t.prop]=t.now:p.style(t.elem,t.prop,t.now+t.unit)}}},Ht.propHooks.scrollTop=Ht.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},p.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2},_default:"swing"},p.fx=Ht.prototype.init,p.fx.step={};var Wt,Kt,Gt=/^(?:toggle|show|hide)$/,zt=/queueHooks$/;function qt(){return t.setTimeout((function(){Wt=void 0})),Wt=p.now()}function Xt(t,e){var i,r=0,n={height:t};for(e=e?1:0;r<4;r+=2-e)n["margin"+(i=K[r])]=n["padding"+i]=t;return e&&(n.opacity=n.width=t),n}function Yt(t,e,i){for(var r,n=(Qt.tweeners[e]||[]).concat(Qt.tweeners["*"]),s=0,o=n.length;s<o;s++)if(r=n[s].call(i,e,t))return r}function Qt(t,e,i){var r,n,s=0,o=Qt.prefilters.length,a=p.Deferred().always((function(){delete h.elem})),h=function(){if(n)return!1;for(var e=Wt||qt(),i=Math.max(0,l.startTime+l.duration-e),r=1-(i/l.duration||0),s=0,o=l.tweens.length;s<o;s++)l.tweens[s].run(r);return a.notifyWith(t,[l,r,i]),r<1&&o?i:(a.resolveWith(t,[l]),!1)},l=a.promise({elem:t,props:p.extend({},e),opts:p.extend(!0,{specialEasing:{},easing:p.easing._default},i),originalProperties:e,originalOptions:i,startTime:Wt||qt(),duration:i.duration,tweens:[],createTween:function(e,i){var r=p.Tween(t,l.opts,e,i,l.opts.specialEasing[e]||l.opts.easing);return l.tweens.push(r),r},stop:function(e){var i=0,r=e?l.tweens.length:0;if(n)return this;for(n=!0;i<r;i++)l.tweens[i].run(1);return e?(a.notifyWith(t,[l,1,0]),a.resolveWith(t,[l,e])):a.rejectWith(t,[l,e]),this}}),c=l.props;for(!function(t,e){var i,r,n,s,o;for(i in t)if(n=e[r=p.camelCase(i)],s=t[i],p.isArray(s)&&(n=s[1],s=t[i]=s[0]),i!==r&&(t[r]=s,delete t[i]),(o=p.cssHooks[r])&&"expand"in o)for(i in s=o.expand(s),delete t[r],s)i in t||(t[i]=s[i],e[i]=n);else e[r]=n}(c,l.opts.specialEasing);s<o;s++)if(r=Qt.prefilters[s].call(l,t,c,l.opts))return p.isFunction(r.stop)&&(p._queueHooks(l.elem,l.opts.queue).stop=p.proxy(r.stop,r)),r;return p.map(c,Yt,l),p.isFunction(l.opts.start)&&l.opts.start.call(t,l),p.fx.timer(p.extend(h,{elem:t,anim:l,queue:l.opts.queue})),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always)}p.Animation=p.extend(Qt,{tweeners:{"*":[function(t,e){var i=this.createTween(t,e);return z(i.elem,t,W.exec(e),i),i}]},tweener:function(t,e){p.isFunction(t)?(e=t,t=["*"]):t=t.match(P);for(var i,r=0,n=t.length;r<n;r++)i=t[r],Qt.tweeners[i]=Qt.tweeners[i]||[],Qt.tweeners[i].unshift(e)},prefilters:[function(t,e,i){var r,n,s,o,a,h,l,c=this,u={},d=t.style,f=t.nodeType&&G(t),g=F.get(t,"fxshow");for(r in i.queue||(null==(a=p._queueHooks(t,"fx")).unqueued&&(a.unqueued=0,h=a.empty.fire,a.empty.fire=function(){a.unqueued||h()}),a.unqueued++,c.always((function(){c.always((function(){a.unqueued--,p.queue(t,"fx").length||a.empty.fire()}))}))),1===t.nodeType&&("height"in e||"width"in e)&&(i.overflow=[d.overflow,d.overflowX,d.overflowY],"inline"===("none"===(l=p.css(t,"display"))?F.get(t,"olddisplay")||wt(t.nodeName):l)&&"none"===p.css(t,"float")&&(d.display="inline-block")),i.overflow&&(d.overflow="hidden",c.always((function(){d.overflow=i.overflow[0],d.overflowX=i.overflow[1],d.overflowY=i.overflow[2]}))),e)if(n=e[r],Gt.exec(n)){if(delete e[r],s=s||"toggle"===n,n===(f?"hide":"show")){if("show"!==n||!g||void 0===g[r])continue;f=!0}u[r]=g&&g[r]||p.style(t,r)}else l=void 0;if(p.isEmptyObject(u))"inline"===("none"===l?wt(t.nodeName):l)&&(d.display=l);else for(r in g?"hidden"in g&&(f=g.hidden):g=F.access(t,"fxshow",{}),s&&(g.hidden=!f),f?p(t).show():c.done((function(){p(t).hide()})),c.done((function(){var e;for(e in F.remove(t,"fxshow"),u)p.style(t,e,u[e])})),u)o=Yt(f?g[r]:0,r,c),r in g||(g[r]=o.start,f&&(o.end=o.start,o.start="width"===r||"height"===r?1:0))}],prefilter:function(t,e){e?Qt.prefilters.unshift(t):Qt.prefilters.push(t)}}),p.speed=function(t,e,i){var r=t&&"object"==typeof t?p.extend({},t):{complete:i||!i&&e||p.isFunction(t)&&t,duration:t,easing:i&&e||e&&!p.isFunction(e)&&e};return r.duration=p.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in p.fx.speeds?p.fx.speeds[r.duration]:p.fx.speeds._default,null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){p.isFunction(r.old)&&r.old.call(this),r.queue&&p.dequeue(this,r.queue)},r},p.fn.extend({fadeTo:function(t,e,i,r){return this.filter(G).css("opacity",0).show().end().animate({opacity:e},t,i,r)},animate:function(t,e,i,r){var n=p.isEmptyObject(t),s=p.speed(e,i,r),o=function(){var e=Qt(this,p.extend({},t),s);(n||F.get(this,"finish"))&&e.stop(!0)};return o.finish=o,n||!1===s.queue?this.each(o):this.queue(s.queue,o)},stop:function(t,e,i){var r=function(t){var e=t.stop;delete t.stop,e(i)};return"string"!=typeof t&&(i=e,e=t,t=void 0),e&&!1!==t&&this.queue(t||"fx",[]),this.each((function(){var e=!0,n=null!=t&&t+"queueHooks",s=p.timers,o=F.get(this);if(n)o[n]&&o[n].stop&&r(o[n]);else for(n in o)o[n]&&o[n].stop&&zt.test(n)&&r(o[n]);for(n=s.length;n--;)s[n].elem!==this||null!=t&&s[n].queue!==t||(s[n].anim.stop(i),e=!1,s.splice(n,1));!e&&i||p.dequeue(this,t)}))},finish:function(t){return!1!==t&&(t=t||"fx"),this.each((function(){var e,i=F.get(this),r=i[t+"queue"],n=i[t+"queueHooks"],s=p.timers,o=r?r.length:0;for(i.finish=!0,p.queue(this,t,[]),n&&n.stop&&n.stop.call(this,!0),e=s.length;e--;)s[e].elem===this&&s[e].queue===t&&(s[e].anim.stop(!0),s.splice(e,1));for(e=0;e<o;e++)r[e]&&r[e].finish&&r[e].finish.call(this);delete i.finish}))}}),p.each(["toggle","show","hide"],(function(t,e){var i=p.fn[e];p.fn[e]=function(t,r,n){return null==t||"boolean"==typeof t?i.apply(this,arguments):this.animate(Xt(e,!0),t,r,n)}})),p.each({slideDown:Xt("show"),slideUp:Xt("hide"),slideToggle:Xt("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},(function(t,e){p.fn[t]=function(t,i,r){return this.animate(e,t,i,r)}})),p.timers=[],p.fx.tick=function(){var t,e=0,i=p.timers;for(Wt=p.now();e<i.length;e++)(t=i[e])()||i[e]!==t||i.splice(e--,1);i.length||p.fx.stop(),Wt=void 0},p.fx.timer=function(t){p.timers.push(t),t()?p.fx.start():p.timers.pop()},p.fx.interval=13,p.fx.start=function(){Kt||(Kt=t.setInterval(p.fx.tick,p.fx.interval))},p.fx.stop=function(){t.clearInterval(Kt),Kt=null},p.fx.speeds={slow:600,fast:200,_default:400},p.fn.delay=function(e,i){return e=p.fx&&p.fx.speeds[e]||e,i=i||"fx",this.queue(i,(function(i,r){var n=t.setTimeout(i,e);r.stop=function(){t.clearTimeout(n)}}))},function(){var t=r.createElement("input"),e=r.createElement("select"),i=e.appendChild(r.createElement("option"));t.type="checkbox",u.checkOn=""!==t.value,u.optSelected=i.selected,e.disabled=!0,u.optDisabled=!i.disabled,(t=r.createElement("input")).value="t",t.type="radio",u.radioValue="t"===t.value}();var Zt,$t=p.expr.attrHandle;p.fn.extend({attr:function(t,e){return N(this,p.attr,t,e,arguments.length>1)},removeAttr:function(t){return this.each((function(){p.removeAttr(this,t)}))}}),p.extend({attr:function(t,e,i){var r,n,s=t.nodeType;if(3!==s&&8!==s&&2!==s)return void 0===t.getAttribute?p.prop(t,e,i):(1===s&&p.isXMLDoc(t)||(e=e.toLowerCase(),n=p.attrHooks[e]||(p.expr.match.bool.test(e)?Zt:void 0)),void 0!==i?null===i?void p.removeAttr(t,e):n&&"set"in n&&void 0!==(r=n.set(t,i,e))?r:(t.setAttribute(e,i+""),i):n&&"get"in n&&null!==(r=n.get(t,e))?r:null==(r=p.find.attr(t,e))?void 0:r)},attrHooks:{type:{set:function(t,e){if(!u.radioValue&&"radio"===e&&p.nodeName(t,"input")){var i=t.value;return t.setAttribute("type",e),i&&(t.value=i),e}}}},removeAttr:function(t,e){var i,r,n=0,s=e&&e.match(P);if(s&&1===t.nodeType)for(;i=s[n++];)r=p.propFix[i]||i,p.expr.match.bool.test(i)&&(t[r]=!1),t.removeAttribute(i)}}),Zt={set:function(t,e,i){return!1===e?p.removeAttr(t,i):t.setAttribute(i,i),i}},p.each(p.expr.match.bool.source.match(/\w+/g),(function(t,e){var i=$t[e]||p.find.attr;$t[e]=function(t,e,r){var n,s;return r||(s=$t[e],$t[e]=n,n=null!=i(t,e,r)?e.toLowerCase():null,$t[e]=s),n}}));var Jt=/^(?:input|select|textarea|button)$/i,te=/^(?:a|area)$/i;p.fn.extend({prop:function(t,e){return N(this,p.prop,t,e,arguments.length>1)},removeProp:function(t){return this.each((function(){delete this[p.propFix[t]||t]}))}}),p.extend({prop:function(t,e,i){var r,n,s=t.nodeType;if(3!==s&&8!==s&&2!==s)return 1===s&&p.isXMLDoc(t)||(e=p.propFix[e]||e,n=p.propHooks[e]),void 0!==i?n&&"set"in n&&void 0!==(r=n.set(t,i,e))?r:t[e]=i:n&&"get"in n&&null!==(r=n.get(t,e))?r:t[e]},propHooks:{tabIndex:{get:function(t){var e=p.find.attr(t,"tabindex");return e?parseInt(e,10):Jt.test(t.nodeName)||te.test(t.nodeName)&&t.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),u.optSelected||(p.propHooks.selected={get:function(t){var e=t.parentNode;return e&&e.parentNode&&e.parentNode.selectedIndex,null},set:function(t){var e=t.parentNode;e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex)}}),p.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){p.propFix[this.toLowerCase()]=this}));var ee=/[\t\r\n\f]/g;function ie(t){return t.getAttribute&&t.getAttribute("class")||""}p.fn.extend({addClass:function(t){var e,i,r,n,s,o,a,h=0;if(p.isFunction(t))return this.each((function(e){p(this).addClass(t.call(this,e,ie(this)))}));if("string"==typeof t&&t)for(e=t.match(P)||[];i=this[h++];)if(n=ie(i),r=1===i.nodeType&&(" "+n+" ").replace(ee," ")){for(o=0;s=e[o++];)r.indexOf(" "+s+" ")<0&&(r+=s+" ");n!==(a=p.trim(r))&&i.setAttribute("class",a)}return this},removeClass:function(t){var e,i,r,n,s,o,a,h=0;if(p.isFunction(t))return this.each((function(e){p(this).removeClass(t.call(this,e,ie(this)))}));if(!arguments.length)return this.attr("class","");if("string"==typeof t&&t)for(e=t.match(P)||[];i=this[h++];)if(n=ie(i),r=1===i.nodeType&&(" "+n+" ").replace(ee," ")){for(o=0;s=e[o++];)for(;r.indexOf(" "+s+" ")>-1;)r=r.replace(" "+s+" "," ");n!==(a=p.trim(r))&&i.setAttribute("class",a)}return this},toggleClass:function(t,e){var i=typeof t;return"boolean"==typeof e&&"string"===i?e?this.addClass(t):this.removeClass(t):p.isFunction(t)?this.each((function(i){p(this).toggleClass(t.call(this,i,ie(this),e),e)})):this.each((function(){var e,r,n,s;if("string"===i)for(r=0,n=p(this),s=t.match(P)||[];e=s[r++];)n.hasClass(e)?n.removeClass(e):n.addClass(e);else void 0!==t&&"boolean"!==i||((e=ie(this))&&F.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",e||!1===t?"":F.get(this,"__className__")||""))}))},hasClass:function(t){var e,i,r=0;for(e=" "+t+" ";i=this[r++];)if(1===i.nodeType&&(" "+ie(i)+" ").replace(ee," ").indexOf(e)>-1)return!0;return!1}});var re=/\r/g,ne=/[\x20\t\r\n\f]+/g;p.fn.extend({val:function(t){var e,i,r,n=this[0];return arguments.length?(r=p.isFunction(t),this.each((function(i){var n;1===this.nodeType&&(null==(n=r?t.call(this,i,p(this).val()):t)?n="":"number"==typeof n?n+="":p.isArray(n)&&(n=p.map(n,(function(t){return null==t?"":t+""}))),(e=p.valHooks[this.type]||p.valHooks[this.nodeName.toLowerCase()])&&"set"in e&&void 0!==e.set(this,n,"value")||(this.value=n))}))):n?(e=p.valHooks[n.type]||p.valHooks[n.nodeName.toLowerCase()])&&"get"in e&&void 0!==(i=e.get(n,"value"))?i:"string"==typeof(i=n.value)?i.replace(re,""):null==i?"":i:void 0}}),p.extend({valHooks:{option:{get:function(t){var e=p.find.attr(t,"value");return null!=e?e:p.trim(p.text(t)).replace(ne," ")}},select:{get:function(t){for(var e,i,r=t.options,n=t.selectedIndex,s="select-one"===t.type||n<0,o=s?null:[],a=s?n+1:r.length,h=n<0?a:s?n:0;h<a;h++)if(((i=r[h]).selected||h===n)&&(u.optDisabled?!i.disabled:null===i.getAttribute("disabled"))&&(!i.parentNode.disabled||!p.nodeName(i.parentNode,"optgroup"))){if(e=p(i).val(),s)return e;o.push(e)}return o},set:function(t,e){for(var i,r,n=t.options,s=p.makeArray(e),o=n.length;o--;)((r=n[o]).selected=p.inArray(p.valHooks.option.get(r),s)>-1)&&(i=!0);return i||(t.selectedIndex=-1),s}}}}),p.each(["radio","checkbox"],(function(){p.valHooks[this]={set:function(t,e){if(p.isArray(e))return t.checked=p.inArray(p(t).val(),e)>-1}},u.checkOn||(p.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})}));var se=/^(?:focusinfocus|focusoutblur)$/;p.extend(p.event,{trigger:function(e,i,n,s){var o,a,h,l,u,d,f,g=[n||r],v=c.call(e,"type")?e.type:e,m=c.call(e,"namespace")?e.namespace.split("."):[];if(a=h=n=n||r,3!==n.nodeType&&8!==n.nodeType&&!se.test(v+p.event.triggered)&&(v.indexOf(".")>-1&&(m=v.split("."),v=m.shift(),m.sort()),u=v.indexOf(":")<0&&"on"+v,(e=e[p.expando]?e:new p.Event(v,"object"==typeof e&&e)).isTrigger=s?2:3,e.namespace=m.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),i=null==i?[e]:p.makeArray(i,[e]),f=p.event.special[v]||{},s||!f.trigger||!1!==f.trigger.apply(n,i))){if(!s&&!f.noBubble&&!p.isWindow(n)){for(l=f.delegateType||v,se.test(l+v)||(a=a.parentNode);a;a=a.parentNode)g.push(a),h=a;h===(n.ownerDocument||r)&&g.push(h.defaultView||h.parentWindow||t)}for(o=0;(a=g[o++])&&!e.isPropagationStopped();)e.type=o>1?l:f.bindType||v,(d=(F.get(a,"events")||{})[e.type]&&F.get(a,"handle"))&&d.apply(a,i),(d=u&&a[u])&&d.apply&&L(a)&&(e.result=d.apply(a,i),!1===e.result&&e.preventDefault());return e.type=v,s||e.isDefaultPrevented()||f._default&&!1!==f._default.apply(g.pop(),i)||!L(n)||u&&p.isFunction(n[v])&&!p.isWindow(n)&&((h=n[u])&&(n[u]=null),p.event.triggered=v,n[v](),p.event.triggered=void 0,h&&(n[u]=h)),e.result}},simulate:function(t,e,i){var r=p.extend(new p.Event,i,{type:t,isSimulated:!0});p.event.trigger(r,null,e)}}),p.fn.extend({trigger:function(t,e){return this.each((function(){p.event.trigger(t,e,this)}))},triggerHandler:function(t,e){var i=this[0];if(i)return p.event.trigger(t,e,i,!0)}}),p.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),(function(t,e){p.fn[e]=function(t,i){return arguments.length>0?this.on(e,null,t,i):this.trigger(e)}})),p.fn.extend({hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)}}),u.focusin="onfocusin"in t,u.focusin||p.each({focus:"focusin",blur:"focusout"},(function(t,e){var i=function(t){p.event.simulate(e,t.target,p.event.fix(t))};p.event.special[e]={setup:function(){var r=this.ownerDocument||this,n=F.access(r,e);n||r.addEventListener(t,i,!0),F.access(r,e,(n||0)+1)},teardown:function(){var r=this.ownerDocument||this,n=F.access(r,e)-1;n?F.access(r,e,n):(r.removeEventListener(t,i,!0),F.remove(r,e))}}}));var oe=t.location,ae=p.now(),he=/\?/;p.parseJSON=function(t){return JSON.parse(t+"")},p.parseXML=function(e){var i;if(!e||"string"!=typeof e)return null;try{i=(new t.DOMParser).parseFromString(e,"text/xml")}catch(t){i=void 0}return i&&!i.getElementsByTagName("parsererror").length||p.error("Invalid XML: "+e),i};var le=/#.*$/,ce=/([?&])_=[^&]*/,ue=/^(.*?):[ \t]*([^\r\n]*)$/gm,de=/^(?:GET|HEAD)$/,pe=/^\/\//,fe={},ge={},ve="*/".concat("*"),me=r.createElement("a");function ye(t){return function(e,i){"string"!=typeof e&&(i=e,e="*");var r,n=0,s=e.toLowerCase().match(P)||[];if(p.isFunction(i))for(;r=s[n++];)"+"===r[0]?(r=r.slice(1)||"*",(t[r]=t[r]||[]).unshift(i)):(t[r]=t[r]||[]).push(i)}}function xe(t,e,i,r){var n={},s=t===ge;function o(a){var h;return n[a]=!0,p.each(t[a]||[],(function(t,a){var l=a(e,i,r);return"string"!=typeof l||s||n[l]?s?!(h=l):void 0:(e.dataTypes.unshift(l),o(l),!1)})),h}return o(e.dataTypes[0])||!n["*"]&&o("*")}function _e(t,e){var i,r,n=p.ajaxSettings.flatOptions||{};for(i in e)void 0!==e[i]&&((n[i]?t:r||(r={}))[i]=e[i]);return r&&p.extend(!0,t,r),t}me.href=oe.href,p.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:oe.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(oe.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":ve,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":p.parseJSON,"text xml":p.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?_e(_e(t,p.ajaxSettings),e):_e(p.ajaxSettings,t)},ajaxPrefilter:ye(fe),ajaxTransport:ye(ge),ajax:function(e,i){"object"==typeof e&&(i=e,e=void 0),i=i||{};var n,s,o,a,h,l,c,u,d=p.ajaxSetup({},i),f=d.context||d,g=d.context&&(f.nodeType||f.jquery)?p(f):p.event,v=p.Deferred(),m=p.Callbacks("once memory"),y=d.statusCode||{},x={},_={},b=0,T="canceled",E={readyState:0,getResponseHeader:function(t){var e;if(2===b){if(!a)for(a={};e=ue.exec(o);)a[e[1].toLowerCase()]=e[2];e=a[t.toLowerCase()]}return null==e?null:e},getAllResponseHeaders:function(){return 2===b?o:null},setRequestHeader:function(t,e){var i=t.toLowerCase();return b||(t=_[i]=_[i]||t,x[t]=e),this},overrideMimeType:function(t){return b||(d.mimeType=t),this},statusCode:function(t){var e;if(t)if(b<2)for(e in t)y[e]=[y[e],t[e]];else E.always(t[E.status]);return this},abort:function(t){var e=t||T;return n&&n.abort(e),w(0,e),this}};if(v.promise(E).complete=m.add,E.success=E.done,E.error=E.fail,d.url=((e||d.url||oe.href)+"").replace(le,"").replace(pe,oe.protocol+"//"),d.type=i.method||i.type||d.method||d.type,d.dataTypes=p.trim(d.dataType||"*").toLowerCase().match(P)||[""],null==d.crossDomain){l=r.createElement("a");try{l.href=d.url,l.href=l.href,d.crossDomain=me.protocol+"//"+me.host!=l.protocol+"//"+l.host}catch(t){d.crossDomain=!0}}if(d.data&&d.processData&&"string"!=typeof d.data&&(d.data=p.param(d.data,d.traditional)),xe(fe,d,i,E),2===b)return E;for(u in(c=p.event&&d.global)&&0==p.active++&&p.event.trigger("ajaxStart"),d.type=d.type.toUpperCase(),d.hasContent=!de.test(d.type),s=d.url,d.hasContent||(d.data&&(s=d.url+=(he.test(s)?"&":"?")+d.data,delete d.data),!1===d.cache&&(d.url=ce.test(s)?s.replace(ce,"$1_="+ae++):s+(he.test(s)?"&":"?")+"_="+ae++)),d.ifModified&&(p.lastModified[s]&&E.setRequestHeader("If-Modified-Since",p.lastModified[s]),p.etag[s]&&E.setRequestHeader("If-None-Match",p.etag[s])),(d.data&&d.hasContent&&!1!==d.contentType||i.contentType)&&E.setRequestHeader("Content-Type",d.contentType),E.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+("*"!==d.dataTypes[0]?", "+ve+"; q=0.01":""):d.accepts["*"]),d.headers)E.setRequestHeader(u,d.headers[u]);if(d.beforeSend&&(!1===d.beforeSend.call(f,E,d)||2===b))return E.abort();for(u in T="abort",{success:1,error:1,complete:1})E[u](d[u]);if(n=xe(ge,d,i,E)){if(E.readyState=1,c&&g.trigger("ajaxSend",[E,d]),2===b)return E;d.async&&d.timeout>0&&(h=t.setTimeout((function(){E.abort("timeout")}),d.timeout));try{b=1,n.send(x,w)}catch(t){if(!(b<2))throw t;w(-1,t)}}else w(-1,"No Transport");function w(e,i,r,a){var l,u,x,_,T,w=i;2!==b&&(b=2,h&&t.clearTimeout(h),n=void 0,o=a||"",E.readyState=e>0?4:0,l=e>=200&&e<300||304===e,r&&(_=function(t,e,i){for(var r,n,s,o,a=t.contents,h=t.dataTypes;"*"===h[0];)h.shift(),void 0===r&&(r=t.mimeType||e.getResponseHeader("Content-Type"));if(r)for(n in a)if(a[n]&&a[n].test(r)){h.unshift(n);break}if(h[0]in i)s=h[0];else{for(n in i){if(!h[0]||t.converters[n+" "+h[0]]){s=n;break}o||(o=n)}s=s||o}if(s)return s!==h[0]&&h.unshift(s),i[s]}(d,E,r)),_=function(t,e,i,r){var n,s,o,a,h,l={},c=t.dataTypes.slice();if(c[1])for(o in t.converters)l[o.toLowerCase()]=t.converters[o];for(s=c.shift();s;)if(t.responseFields[s]&&(i[t.responseFields[s]]=e),!h&&r&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),h=s,s=c.shift())if("*"===s)s=h;else if("*"!==h&&h!==s){if(!(o=l[h+" "+s]||l["* "+s]))for(n in l)if((a=n.split(" "))[1]===s&&(o=l[h+" "+a[0]]||l["* "+a[0]])){!0===o?o=l[n]:!0!==l[n]&&(s=a[0],c.unshift(a[1]));break}if(!0!==o)if(o&&t.throws)e=o(e);else try{e=o(e)}catch(t){return{state:"parsererror",error:o?t:"No conversion from "+h+" to "+s}}}return{state:"success",data:e}}(d,_,E,l),l?(d.ifModified&&((T=E.getResponseHeader("Last-Modified"))&&(p.lastModified[s]=T),(T=E.getResponseHeader("etag"))&&(p.etag[s]=T)),204===e||"HEAD"===d.type?w="nocontent":304===e?w="notmodified":(w=_.state,u=_.data,l=!(x=_.error))):(x=w,!e&&w||(w="error",e<0&&(e=0))),E.status=e,E.statusText=(i||w)+"",l?v.resolveWith(f,[u,w,E]):v.rejectWith(f,[E,w,x]),E.statusCode(y),y=void 0,c&&g.trigger(l?"ajaxSuccess":"ajaxError",[E,d,l?u:x]),m.fireWith(f,[E,w]),c&&(g.trigger("ajaxComplete",[E,d]),--p.active||p.event.trigger("ajaxStop")))}return E},getJSON:function(t,e,i){return p.get(t,e,i,"json")},getScript:function(t,e){return p.get(t,void 0,e,"script")}}),p.each(["get","post"],(function(t,e){p[e]=function(t,i,r,n){return p.isFunction(i)&&(n=n||r,r=i,i=void 0),p.ajax(p.extend({url:t,type:e,dataType:n,data:i,success:r},p.isPlainObject(t)&&t))}})),p._evalUrl=function(t){return p.ajax({url:t,type:"GET",dataType:"script",async:!1,global:!1,throws:!0})},p.fn.extend({wrapAll:function(t){var e;return p.isFunction(t)?this.each((function(e){p(this).wrapAll(t.call(this,e))})):(this[0]&&(e=p(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map((function(){for(var t=this;t.firstElementChild;)t=t.firstElementChild;return t})).append(this)),this)},wrapInner:function(t){return p.isFunction(t)?this.each((function(e){p(this).wrapInner(t.call(this,e))})):this.each((function(){var e=p(this),i=e.contents();i.length?i.wrapAll(t):e.append(t)}))},wrap:function(t){var e=p.isFunction(t);return this.each((function(i){p(this).wrapAll(e?t.call(this,i):t)}))},unwrap:function(){return this.parent().each((function(){p.nodeName(this,"body")||p(this).replaceWith(this.childNodes)})).end()}}),p.expr.filters.hidden=function(t){return!p.expr.filters.visible(t)},p.expr.filters.visible=function(t){return t.offsetWidth>0||t.offsetHeight>0||t.getClientRects().length>0};var be=/%20/g,Te=/\[\]$/,Ee=/\r?\n/g,we=/^(?:submit|button|image|reset|file)$/i,Ae=/^(?:input|select|textarea|keygen)/i;function Ce(t,e,i,r){var n;if(p.isArray(e))p.each(e,(function(e,n){i||Te.test(t)?r(t,n):Ce(t+"["+("object"==typeof n&&null!=n?e:"")+"]",n,i,r)}));else if(i||"object"!==p.type(e))r(t,e);else for(n in e)Ce(t+"["+n+"]",e[n],i,r)}p.param=function(t,e){var i,r=[],n=function(t,e){e=p.isFunction(e)?e():null==e?"":e,r[r.length]=encodeURIComponent(t)+"="+encodeURIComponent(e)};if(void 0===e&&(e=p.ajaxSettings&&p.ajaxSettings.traditional),p.isArray(t)||t.jquery&&!p.isPlainObject(t))p.each(t,(function(){n(this.name,this.value)}));else for(i in t)Ce(i,t[i],e,n);return r.join("&").replace(be,"+")},p.fn.extend({serialize:function(){return p.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var t=p.prop(this,"elements");return t?p.makeArray(t):this})).filter((function(){var t=this.type;return this.name&&!p(this).is(":disabled")&&Ae.test(this.nodeName)&&!we.test(t)&&(this.checked||!q.test(t))})).map((function(t,e){var i=p(this).val();return null==i?null:p.isArray(i)?p.map(i,(function(t){return{name:e.name,value:t.replace(Ee,"\r\n")}})):{name:e.name,value:i.replace(Ee,"\r\n")}})).get()}}),p.ajaxSettings.xhr=function(){try{return new t.XMLHttpRequest}catch(t){}};var Se={0:200,1223:204},Oe=p.ajaxSettings.xhr();u.cors=!!Oe&&"withCredentials"in Oe,u.ajax=Oe=!!Oe,p.ajaxTransport((function(e){var i,r;if(u.cors||Oe&&!e.crossDomain)return{send:function(n,s){var o,a=e.xhr();if(a.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(o in e.xhrFields)a[o]=e.xhrFields[o];for(o in e.mimeType&&a.overrideMimeType&&a.overrideMimeType(e.mimeType),e.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest"),n)a.setRequestHeader(o,n[o]);i=function(t){return function(){i&&(i=r=a.onload=a.onerror=a.onabort=a.onreadystatechange=null,"abort"===t?a.abort():"error"===t?"number"!=typeof a.status?s(0,"error"):s(a.status,a.statusText):s(Se[a.status]||a.status,a.statusText,"text"!==(a.responseType||"text")||"string"!=typeof a.responseText?{binary:a.response}:{text:a.responseText},a.getAllResponseHeaders()))}},a.onload=i(),r=a.onerror=i("error"),void 0!==a.onabort?a.onabort=r:a.onreadystatechange=function(){4===a.readyState&&t.setTimeout((function(){i&&r()}))},i=i("abort");try{a.send(e.hasContent&&e.data||null)}catch(t){if(i)throw t}},abort:function(){i&&i()}}})),p.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(t){return p.globalEval(t),t}}}),p.ajaxPrefilter("script",(function(t){void 0===t.cache&&(t.cache=!1),t.crossDomain&&(t.type="GET")})),p.ajaxTransport("script",(function(t){var e,i;if(t.crossDomain)return{send:function(n,s){e=p("<script>").prop({charset:t.scriptCharset,src:t.url}).on("load error",i=function(t){e.remove(),i=null,t&&s("error"===t.type?404:200,t.type)}),r.head.appendChild(e[0])},abort:function(){i&&i()}}}));var De=[],Me=/(=)\?(?=&|$)|\?\?/;p.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=De.pop()||p.expando+"_"+ae++;return this[t]=!0,t}}),p.ajaxPrefilter("json jsonp",(function(e,i,r){var n,s,o,a=!1!==e.jsonp&&(Me.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Me.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return n=e.jsonpCallback=p.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Me,"$1"+n):!1!==e.jsonp&&(e.url+=(he.test(e.url)?"&":"?")+e.jsonp+"="+n),e.converters["script json"]=function(){return o||p.error(n+" was not called"),o[0]},e.dataTypes[0]="json",s=t[n],t[n]=function(){o=arguments},r.always((function(){void 0===s?p(t).removeProp(n):t[n]=s,e[n]&&(e.jsonpCallback=i.jsonpCallback,De.push(n)),o&&p.isFunction(s)&&s(o[0]),o=s=void 0})),"script"})),p.parseHTML=function(t,e,i){if(!t||"string"!=typeof t)return null;"boolean"==typeof e&&(i=e,e=!1),e=e||r;var n=E.exec(t),s=!i&&[];return n?[e.createElement(n[1])]:(n=it([t],e,s),s&&s.length&&p(s).remove(),p.merge([],n.childNodes))};var Re=p.fn.load;function Pe(t){return p.isWindow(t)?t:9===t.nodeType&&t.defaultView}p.fn.load=function(t,e,i){if("string"!=typeof t&&Re)return Re.apply(this,arguments);var r,n,s,o=this,a=t.indexOf(" ");return a>-1&&(r=p.trim(t.slice(a)),t=t.slice(0,a)),p.isFunction(e)?(i=e,e=void 0):e&&"object"==typeof e&&(n="POST"),o.length>0&&p.ajax({url:t,type:n||"GET",dataType:"html",data:e}).done((function(t){s=arguments,o.html(r?p("<div>").append(p.parseHTML(t)).find(r):t)})).always(i&&function(t,e){o.each((function(){i.apply(this,s||[t.responseText,e,t])}))}),this},p.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],(function(t,e){p.fn[e]=function(t){return this.on(e,t)}})),p.expr.filters.animated=function(t){return p.grep(p.timers,(function(e){return t===e.elem})).length},p.offset={setOffset:function(t,e,i){var r,n,s,o,a,h,l=p.css(t,"position"),c=p(t),u={};"static"===l&&(t.style.position="relative"),a=c.offset(),s=p.css(t,"top"),h=p.css(t,"left"),("absolute"===l||"fixed"===l)&&(s+h).indexOf("auto")>-1?(o=(r=c.position()).top,n=r.left):(o=parseFloat(s)||0,n=parseFloat(h)||0),p.isFunction(e)&&(e=e.call(t,i,p.extend({},a))),null!=e.top&&(u.top=e.top-a.top+o),null!=e.left&&(u.left=e.left-a.left+n),"using"in e?e.using.call(t,u):c.css(u)}},p.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each((function(e){p.offset.setOffset(this,t,e)}));var e,i,r=this[0],n={top:0,left:0},s=r&&r.ownerDocument;return s?(e=s.documentElement,p.contains(e,r)?(n=r.getBoundingClientRect(),i=Pe(s),{top:n.top+i.pageYOffset-e.clientTop,left:n.left+i.pageXOffset-e.clientLeft}):n):void 0},position:function(){if(this[0]){var t,e,i=this[0],r={top:0,left:0};return"fixed"===p.css(i,"position")?e=i.getBoundingClientRect():(t=this.offsetParent(),e=this.offset(),p.nodeName(t[0],"html")||(r=t.offset()),r.top+=p.css(t[0],"borderTopWidth",!0),r.left+=p.css(t[0],"borderLeftWidth",!0)),{top:e.top-r.top-p.css(i,"marginTop",!0),left:e.left-r.left-p.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map((function(){for(var t=this.offsetParent;t&&"static"===p.css(t,"position");)t=t.offsetParent;return t||Dt}))}}),p.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},(function(t,e){var i="pageYOffset"===e;p.fn[t]=function(r){return N(this,(function(t,r,n){var s=Pe(t);if(void 0===n)return s?s[e]:t[r];s?s.scrollTo(i?s.pageXOffset:n,i?n:s.pageYOffset):t[r]=n}),t,r,arguments.length)}})),p.each(["top","left"],(function(t,e){p.cssHooks[e]=Rt(u.pixelPosition,(function(t,i){if(i)return i=Mt(t,e),Ct.test(i)?p(t).position()[e]+"px":i}))})),p.each({Height:"height",Width:"width"},(function(t,e){p.each({padding:"inner"+t,content:e,"":"outer"+t},(function(i,r){p.fn[r]=function(r,n){var s=arguments.length&&(i||"boolean"!=typeof r),o=i||(!0===r||!0===n?"margin":"border");return N(this,(function(e,i,r){var n;return p.isWindow(e)?e.document.documentElement["client"+t]:9===e.nodeType?(n=e.documentElement,Math.max(e.body["scroll"+t],n["scroll"+t],e.body["offset"+t],n["offset"+t],n["client"+t])):void 0===r?p.css(e,i,o):p.style(e,i,r,o)}),e,s?r:void 0,s,null)}}))})),p.fn.extend({bind:function(t,e,i){return this.on(t,null,e,i)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,i,r){return this.on(e,t,i,r)},undelegate:function(t,e,i){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",i)},size:function(){return this.length}}),p.fn.andSelf=p.fn.addBack;var Ie=t.jQuery,Ne=t.$;return p.noConflict=function(e){return t.$===p&&(t.$=Ne),e&&t.jQuery===p&&(t.jQuery=Ie),p},e||(t.jQuery=t.$=p),p}));var s,o=null;var a,h=function(){return o||(o=function(){try{throw new Error}catch(e){var t=(""+e.stack).match(/(https?|file|ftp):\/\/[^)\n]+/g);if(t)return(""+t[0]).replace(/^((?:https?|file|ftp):\/\/.+)\/[^/]+$/,"$1")+"/"}return"/"}()),o},l=r;function c(t){if(""===t)return".";var e="/"===t[t.length-1]?t.slice(0,t.length-1):t,i=e.lastIndexOf("/");return-1===i?".":e.slice(0,i)}function u(t,e){if(t===e)return"";var i=t.split("/");"."===i[0]&&i.shift();var r,n,s=e.split("/");for("."===s[0]&&s.shift(),r=0;(r<s.length||r<i.length)&&null==n;r++)i[r]!==s[r]&&(n=r);var o=[];for(r=0;r<i.length-n;r++)o.push("..");return s.length>n&&o.push.apply(o,s.slice(n)),o.join("/")}(a=function(t,e){return u(c(l(t)),l(e))})._dirname=c,a._relative=u,s=h()+a("3Leim","219mM");const d="#000000",p="#FFFFFF",f="#console",g=e(s),v="LOG",m="START_DRAG",y="CANCEL_DRAG",x="END_DRAG",_="DROP";let b;var T;let E;var w;let A;var C;(T=b||(b={}))[T.LEFT=1]="LEFT",T[T.MIDDLE=2]="MIDDLE",T[T.RIGHT=3]="RIGHT",(w=E||(E={}))[w.DOM_VK_CANCEL=3]="DOM_VK_CANCEL",w[w.DOM_VK_HELP=6]="DOM_VK_HELP",w[w.DOM_VK_BACK_SPACE=8]="DOM_VK_BACK_SPACE",w[w.DOM_VK_TAB=9]="DOM_VK_TAB",w[w.DOM_VK_CLEAR=12]="DOM_VK_CLEAR",w[w.DOM_VK_RETURN=13]="DOM_VK_RETURN",w[w.DOM_VK_ENTER=14]="DOM_VK_ENTER",w[w.DOM_VK_SHIFT=16]="DOM_VK_SHIFT",w[w.DOM_VK_CONTROL=17]="DOM_VK_CONTROL",w[w.DOM_VK_ALT=18]="DOM_VK_ALT",w[w.DOM_VK_PAUSE=19]="DOM_VK_PAUSE",w[w.DOM_VK_CAPS_LOCK=20]="DOM_VK_CAPS_LOCK",w[w.DOM_VK_ESCAPE=27]="DOM_VK_ESCAPE",w[w.DOM_VK_SPACE=32]="DOM_VK_SPACE",w[w.DOM_VK_PAGE_UP=33]="DOM_VK_PAGE_UP",w[w.DOM_VK_PAGE_DOWN=34]="DOM_VK_PAGE_DOWN",w[w.DOM_VK_END=35]="DOM_VK_END",w[w.DOM_VK_HOME=36]="DOM_VK_HOME",w[w.DOM_VK_LEFT=37]="DOM_VK_LEFT",w[w.DOM_VK_UP=38]="DOM_VK_UP",w[w.DOM_VK_RIGHT=39]="DOM_VK_RIGHT",w[w.DOM_VK_DOWN=40]="DOM_VK_DOWN",w[w.DOM_VK_PRINTSCREEN=44]="DOM_VK_PRINTSCREEN",w[w.DOM_VK_INSERT=45]="DOM_VK_INSERT",w[w.DOM_VK_DELETE=46]="DOM_VK_DELETE",w[w.DOM_VK_0=48]="DOM_VK_0",w[w.DOM_VK_1=49]="DOM_VK_1",w[w.DOM_VK_2=50]="DOM_VK_2",w[w.DOM_VK_3=51]="DOM_VK_3",w[w.DOM_VK_4=52]="DOM_VK_4",w[w.DOM_VK_5=53]="DOM_VK_5",w[w.DOM_VK_6=54]="DOM_VK_6",w[w.DOM_VK_7=55]="DOM_VK_7",w[w.DOM_VK_8=56]="DOM_VK_8",w[w.DOM_VK_9=57]="DOM_VK_9",w[w.DOM_VK_SEMICOLON=59]="DOM_VK_SEMICOLON",w[w.DOM_VK_EQUALS=61]="DOM_VK_EQUALS",w[w.DOM_VK_A=65]="DOM_VK_A",w[w.DOM_VK_B=66]="DOM_VK_B",w[w.DOM_VK_C=67]="DOM_VK_C",w[w.DOM_VK_D=68]="DOM_VK_D",w[w.DOM_VK_E=69]="DOM_VK_E",w[w.DOM_VK_F=70]="DOM_VK_F",w[w.DOM_VK_G=71]="DOM_VK_G",w[w.DOM_VK_H=72]="DOM_VK_H",w[w.DOM_VK_I=73]="DOM_VK_I",w[w.DOM_VK_J=74]="DOM_VK_J",w[w.DOM_VK_K=75]="DOM_VK_K",w[w.DOM_VK_L=76]="DOM_VK_L",w[w.DOM_VK_M=77]="DOM_VK_M",w[w.DOM_VK_N=78]="DOM_VK_N",w[w.DOM_VK_O=79]="DOM_VK_O",w[w.DOM_VK_P=80]="DOM_VK_P",w[w.DOM_VK_Q=81]="DOM_VK_Q",w[w.DOM_VK_R=82]="DOM_VK_R",w[w.DOM_VK_S=83]="DOM_VK_S",w[w.DOM_VK_T=84]="DOM_VK_T",w[w.DOM_VK_U=85]="DOM_VK_U",w[w.DOM_VK_V=86]="DOM_VK_V",w[w.DOM_VK_W=87]="DOM_VK_W",w[w.DOM_VK_X=88]="DOM_VK_X",w[w.DOM_VK_Y=89]="DOM_VK_Y",w[w.DOM_VK_Z=90]="DOM_VK_Z",w[w.DOM_VK_CONTEXT_MENU=93]="DOM_VK_CONTEXT_MENU",w[w.DOM_VK_NUMPAD0=96]="DOM_VK_NUMPAD0",w[w.DOM_VK_NUMPAD1=97]="DOM_VK_NUMPAD1",w[w.DOM_VK_NUMPAD2=98]="DOM_VK_NUMPAD2",w[w.DOM_VK_NUMPAD3=99]="DOM_VK_NUMPAD3",w[w.DOM_VK_NUMPAD4=100]="DOM_VK_NUMPAD4",w[w.DOM_VK_NUMPAD5=101]="DOM_VK_NUMPAD5",w[w.DOM_VK_NUMPAD6=102]="DOM_VK_NUMPAD6",w[w.DOM_VK_NUMPAD7=103]="DOM_VK_NUMPAD7",w[w.DOM_VK_NUMPAD8=104]="DOM_VK_NUMPAD8",w[w.DOM_VK_NUMPAD9=105]="DOM_VK_NUMPAD9",w[w.DOM_VK_MULTIPLY=106]="DOM_VK_MULTIPLY",w[w.DOM_VK_ADD=107]="DOM_VK_ADD",w[w.DOM_VK_SEPARATOR=108]="DOM_VK_SEPARATOR",w[w.DOM_VK_SUBTRACT=109]="DOM_VK_SUBTRACT",w[w.DOM_VK_DECIMAL=110]="DOM_VK_DECIMAL",w[w.DOM_VK_DIVIDE=111]="DOM_VK_DIVIDE",w[w.DOM_VK_F1=112]="DOM_VK_F1",w[w.DOM_VK_F2=113]="DOM_VK_F2",w[w.DOM_VK_F3=114]="DOM_VK_F3",w[w.DOM_VK_F4=115]="DOM_VK_F4",w[w.DOM_VK_F5=116]="DOM_VK_F5",w[w.DOM_VK_F6=117]="DOM_VK_F6",w[w.DOM_VK_F7=118]="DOM_VK_F7",w[w.DOM_VK_F8=119]="DOM_VK_F8",w[w.DOM_VK_F9=120]="DOM_VK_F9",w[w.DOM_VK_F10=121]="DOM_VK_F10",w[w.DOM_VK_F11=122]="DOM_VK_F11",w[w.DOM_VK_F12=123]="DOM_VK_F12",w[w.DOM_VK_F13=124]="DOM_VK_F13",w[w.DOM_VK_F14=125]="DOM_VK_F14",w[w.DOM_VK_F15=126]="DOM_VK_F15",w[w.DOM_VK_F16=127]="DOM_VK_F16",w[w.DOM_VK_F17=128]="DOM_VK_F17",w[w.DOM_VK_F18=129]="DOM_VK_F18",w[w.DOM_VK_F19=130]="DOM_VK_F19",w[w.DOM_VK_F20=131]="DOM_VK_F20",w[w.DOM_VK_F21=132]="DOM_VK_F21",w[w.DOM_VK_F22=133]="DOM_VK_F22",w[w.DOM_VK_F23=134]="DOM_VK_F23",w[w.DOM_VK_F24=135]="DOM_VK_F24",w[w.DOM_VK_NUM_LOCK=144]="DOM_VK_NUM_LOCK",w[w.DOM_VK_SCROLL_LOCK=145]="DOM_VK_SCROLL_LOCK",w[w.DOM_VK_COMMA=188]="DOM_VK_COMMA",w[w.DOM_VK_PERIOD=190]="DOM_VK_PERIOD",w[w.DOM_VK_SLASH=191]="DOM_VK_SLASH",w[w.DOM_VK_BACK_QUOTE=192]="DOM_VK_BACK_QUOTE",w[w.DOM_VK_OPEN_BRACKET=219]="DOM_VK_OPEN_BRACKET",w[w.DOM_VK_BACK_SLASH=220]="DOM_VK_BACK_SLASH",w[w.DOM_VK_CLOSE_BRACKET=221]="DOM_VK_CLOSE_BRACKET",w[w.DOM_VK_QUOTE=222]="DOM_VK_QUOTE",w[w.DOM_VK_META=224]="DOM_VK_META",(C=A||(A={}))[C.KEY_OR_BUTTON=1]="KEY_OR_BUTTON",C[C.MOUSE_MOVEMENT=2]="MOUSE_MOVEMENT",C[C.JOYSTICK_AXIS=3]="JOYSTICK_AXIS";class S{static multiply(t,e){let i,r,n;if("number"==typeof t)i=(16711680&t)>>16,r=(65280&t)>>8,n=255&t;else{let e=S.toRgb(t);i=e[0],r=e[1],n=e[2]}return i=Math.round(i*e),r=Math.round(r*e),n=Math.round(n*e),i=i<0?0:i>255?255:i,r=r<0?0:r>255?255:r,n=n<0?0:n>255?255:n,n|r<<8|i<<16}static max(t,e){let i,r,n,s,o,a;if("number"==typeof t)i=(16711680&t)>>16,r=(65280&t)>>8,n=255&t;else{let e=S.toRgb(t);i=e[0],r=e[1],n=e[2]}if("number"==typeof e)s=(16711680&e)>>16,o=(65280&e)>>8,a=255&e;else{let t=S.toRgb(e);s=t[0],o=t[1],a=t[2]}return s>i&&(i=s),o>r&&(r=o),a>n&&(n=a),n|r<<8|i<<16}static min(t,e){let i,r,n,s,o,a;if("number"==typeof t)i=(16711680&t)>>16,r=(65280&t)>>8,n=255&t;else{let e=S.toRgb(t);i=e[0],r=e[1],n=e[2]}if("number"==typeof e)s=(16711680&e)>>16,o=(65280&e)>>8,a=255&e;else{let t=S.toRgb(e);s=t[0],o=t[1],a=t[2]}return s<i&&(i=s),o<r&&(r=o),a<n&&(n=a),n|r<<8|i<<16}static colorMultiply(t,e){let i,r,n,s,o,a;if("number"==typeof t)i=(16711680&t)>>16,r=(65280&t)>>8,n=255&t;else{let e=S.toRgb(t);i=e[0],r=e[1],n=e[2]}if("number"==typeof e)s=(16711680&e)>>16,o=(65280&e)>>8,a=255&e;else{let t=S.toRgb(e);s=t[0],o=t[1],a=t[2]}return i=Math.floor(i*s/255),r=Math.floor(r*o/255),n=Math.floor(n*a/255),i=i<0?0:i>255?255:i,r=r<0?0:r>255?255:r,n=n<0?0:n>255?255:n,n|r<<8|i<<16}static computeIntensity(t){let e,i,r;if("number"==typeof t)e=(16711680&t)>>16,i=(65280&t)>>8,r=255&t;else{let n=S.toRgb(t);e=n[0],i=n[1],r=n[2]}return 1/255*(.2126*e+.7152*i+.0722*r)}static add(t,e){let i=((16711680&t)>>16)+((16711680&e)>>16),r=((65280&t)>>8)+((65280&e)>>8),n=(255&t)+(255&e);return i>255&&(i=255),r>255&&(r=255),n>255&&(n=255),n|r<<8|i<<16}static toRgb(t){return"number"==typeof t?S.toRgbFromNumber(t):S.toRgbFromString(t)}static toWeb(t){if("number"==typeof t){let e=t.toString(16),i=6-e.length;return i>0&&(e="000000".substr(0,i)+e),"#"+e}return t}static toNumber(t){if("number"==typeof t)return t;let e=t;if("#"===e.charAt(0)&&7===e.length)return parseInt(e.substr(1),16);{let t=S.toRgbFromString(e);return 65536*t[0]+256*t[1]+t[2]}}static stdCol={aqua:[0,255,255],black:[0,0,0],blue:[0,0,255],fuchsia:[255,0,255],gray:[128,128,128],green:[0,128,0],lime:[0,255,0],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],purple:[128,0,128],red:[255,0,0],silver:[192,192,192],teal:[0,128,128],white:[255,255,255],yellow:[255,255,0]};static toRgbFromNumber(t){return[(16711680&t)>>16,(65280&t)>>8,255&t]}static toRgbFromString(t){t=t.toLowerCase();let e=S.stdCol[String(t)];if(e)return e;if("#"===t.charAt(0)){return 4===t.length&&(t="#"+t.charAt(1)+t.charAt(1)+t.charAt(2)+t.charAt(2)+t.charAt(3)+t.charAt(3)),[parseInt(t.substr(1,2),16),parseInt(t.substr(3,2),16),parseInt(t.substr(5,2),16)]}if(0===t.indexOf("rgb(")){let e=t.substr(4,t.length-5).split(",");return[parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10)]}return[0,0,0]}}class O{static distance(t,e){let i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)}static taxiDistance(t,e){let i=t.x-e.x,r=t.y-e.y;return Math.max(Math.abs(i),Math.abs(r))}static TDX=[-1,1,0,0,-1,1,-1,1];static TDY=[0,0,-1,1,-1,-1,1,1];constructor(t=0,e=0){this.x=t,this.y=e}set(t){this.x=t.x,this.y=t.y}clone(){return new O(this.x,this.y)}toString(){return this.x+","+this.y}moveTo(t,e){this.x=t,this.y=e}equals(t){return this.x===t.x&&this.y===t.y}isAdjacent(t,e=!0){let i=Math.abs(this.x-t.x),r=Math.abs(this.y-t.y);return e?1===i&&r<=1||i<=1&&1===r:1===i&&0===r||0===i&&1===r}getAdjacentCells(t,e,i=!0){let r=[];for(let n=0,s=i?8:4;n<s;++n){let i=this.x+O.TDX[n];if(i>=0&&i<t){let t=this.y+O.TDY[n];t>=0&&t<e&&r.push(new O(i,t))}}return r}}class D extends O{constructor(t=0,e=0,i=0,r=0){super(t,e),this.w=i,this.h=r}toString(){return super.toString()+"("+this.w+","+this.h+")"}resize(t,e){this.w=t,this.h=e}equals(t){return this.x===t.x&&this.y===t.y&&this.w===t.w&&this.h===t.h}containsPos(t){return t.x>=this.x&&t.y>=this.y&&t.x<this.x+this.w&&t.y<this.y+this.h}contains(t,e){return t>=this.x&&e>=this.y&&t<this.x+this.w&&e<this.y+this.h}containsRect(t){return this.x<=t.x&&this.y<=t.y&&this.x+this.w>=t.x+t.w&&this.y+this.h>=t.y+t.h}intersects(t){return!(this.x+this.w<=t.x||t.x+t.w<=this.x||this.y+this.h<=t.y||t.y+t.h<=this.y)}expand(t){t.x<this.x?(this.w+=this.x-t.x,this.x=t.x):t.x>=this.x+this.w&&(this.w+=t.x-this.x-this.w+1),t.y<this.y?(this.h+=this.y-t.y,this.y=t.y):t.y>=this.y+this.h&&(this.h+=t.y-this.y-this.h+1)}expandRect(t){this.expand(t),this.expand(new O(t.x+t.w-1,t.y+t.h-1))}set(t){this.x=t.x,this.y=t.y,this.w=t.w,this.h=t.h}clamp(t,e,i,r){this.x<t&&(this.w-=t-this.x,this.x=t),this.x+this.w>i&&(this.w=i-this.x),this.y<e&&(this.h-=e-this.y,this.y=e),this.y+this.h>r&&(this.h=r-this.y)}}class M{constructor(t,e=[]){this.__parent=t,this.children=e}addChild(t){return this.children.push(t),t.__parent=this,t}removeChild(t){let e=this.children.indexOf(t);return-1!==e&&this.children.splice(e,1),t}contains(t){if(!this.children)return!1;for(let e of this.children)if(e===t||e.contains(t))return!0;return!1}clearChildren(){this.children=[]}postLoad(){for(let t of this.children)t.__parent=this}}let R,P;function I(t){let e=[];for(let i=0;i<t;++i)e[i]=[];return e}function N(t){R||function(){let t;R=[];for(let e=0;e<256;e++){t=e;for(let e=0;e<8;e++)t=1&t?3988292384^t>>>1:t>>>1;R[e]=t}}();let e=-1;for(let i=0,r=t.length;i<r;++i)e=e>>>8^R[255&(e^t.charCodeAt(i))];return(-1^e)>>>0}function L(t,e,i){return t<e?e:t>i?i:t}var k;(k=P||(P={}))[k.NONE=0]="NONE",k[k.HORIZONTAL=1]="HORIZONTAL",k[k.VERTICAL=2]="VERTICAL",k[k.BOTH=3]="BOTH";class F extends M{boundingBox=new D;visible=!0;zOrder=0;setExpandFlag(t){this._expand=t}logSceneGraph(t="",e=!0){e&&console.log("##### Umbra node stats :"+this.computeNodeCount(!0)+" nodes ("+this.computeNodeCount(!1)+" visibles) #####"),console.log(t+(this.visible?"":"*")+this.toString());for(let e of this.children)e.logSceneGraph(t+"  ",!1)}computeNodeCount(t=!1){if(!t&&!this.isVisible())return 0;let e=1;for(let i of this.children)e+=i.computeNodeCount(t);return e}toString(){return this.constructor.name+":"+this.boundingBox.toString()}expand(t,e){this.visible&&(t&&t>this.boundingBox.w&&(this._expand===P.HORIZONTAL||this._expand===P.BOTH)?this.boundingBox.w=t:t=this.boundingBox.w,e&&e>this.boundingBox.h&&(this._expand===P.VERTICAL||this._expand===P.BOTH)?this.boundingBox.h=e:e=this.boundingBox.h,this.expandChildren(t,e))}clearChildren(){this.termHierarchy(),super.clearChildren()}show(){this.visible=!0}hide(){this.visible=!1}getVisibleFlag(){return this.visible}isVisible(){return this.visible&&(void 0===this.__parent||this.__parent.isVisible())}getBoundingBox(){return this.boundingBox}getParentBoundingBox(){return this.__parent?this.__parent.getBoundingBox():void 0}moveTo(t,e){if("number"==typeof t)this.boundingBox.moveTo(t,e||this.boundingBox.y);else{let e=t;this.boundingBox.moveTo(e.x,e.y)}}moveToBottomLeft(){let t=this.getParentBoundingBox(),e=t?t.h:be.getConsole().height;this.moveTo(0,e-this.boundingBox.h)}moveToTopLeft(){this.moveTo(0,0)}moveToBottomRight(){let t=this.getParentBoundingBox(),e=t?t.w:be.getConsole().width,i=t?t.h:be.getConsole().height;this.moveTo(e-this.boundingBox.w,i-this.boundingBox.h)}moveToTopRight(){let t=this.getParentBoundingBox(),e=t?t.w:be.getConsole().width;this.moveTo(e-this.boundingBox.w,0)}resize(t,e){this.boundingBox.resize(t,e)}getZOrder(){return this.zOrder}setZOrder(t){let e=t-this.zOrder;this.zOrder=t;for(let t of this.children){let i=t;i.setZOrder(i.zOrder+e)}}containsAbsolute(t){let e=this.__parent,i=t.x,r=t.y;for(;e;)i-=e.boundingBox.x,r-=e.boundingBox.y,e=e.__parent;return this.boundingBox.contains(i,r)}abs2Local(t){let e=this;for(;e;)t.x-=e.boundingBox.x,t.y-=e.boundingBox.y,e=e.__parent}local2Abs(t){let e=this;for(;e;)t.x+=e.boundingBox.x,t.y+=e.boundingBox.y,e=e.__parent}onInit(){}onTerm(){}onPreRender(t){}onPostRender(t){}onRender(t){}onUpdate(t){}initHierarchy(){this.onInit();for(let t of this.children)t.initHierarchy()}renderHierarchy(t,e){if(this.visible){let i=void 0===e;e||(e=[]),e.push(this);for(let i of this.children)i.renderHierarchy(t,e);if(i){e.sort(((t,e)=>t.zOrder<e.zOrder?-1:t.zOrder>e.zOrder?1:0));for(let i of e)i.onPreRender(t);for(let i of e)i.onRender(t);for(let i of e)i.onPostRender(t)}}}updateHierarchy(t){this.visible&&(this.updateChildrenHierarchy(t),this.onUpdate(t))}termHierarchy(){for(let t=this.children.length-1;t>=0;--t){this.children[t].termHierarchy()}this.onTerm()}addChild(t){return super.addChild(t),t instanceof F&&t.computeBoundingBox(),t}removeChild(t){return super.removeChild(t),this.computeBoundingBox(),t}center(){let t=this.getParentBoundingBox();t&&this.moveTo(Math.floor((t.w-this.boundingBox.w)/2),Math.floor((t.h-this.boundingBox.h)/2))}computeBoundingBox(){if(this.visible){this.children.length>0&&(this.boundingBox.w=0,this.boundingBox.h=0);for(let t of this.children){let e=t;e.computeBoundingBox(),e.visible&&(this.boundingBox.w=Math.max(this.boundingBox.w,e.boundingBox.x+e.boundingBox.w),this.boundingBox.h=Math.max(this.boundingBox.h,e.boundingBox.y+e.boundingBox.h))}}}expandChildren(t,e){for(let i of this.children)i.expand(t,e)}updateChildrenHierarchy(t){for(let e of this.children)e.updateHierarchy(t)}}class B extends class{getRandomChance(t){let e=0;for(let i in t)t.hasOwnProperty(i)&&t[i]>0&&(e+=t[i]);let i=this.getNumber(0,e),r=0;for(let e in t)if(t.hasOwnProperty(e)&&t[e]>0&&(r+=t[e],i<=r))return e;return 0}}{static DIVIDER=1/Math.pow(2,32);cur=0;static get default(){return void 0===B._default&&(B._default=new B((new Date).getTime())),B._default}constructor(t){super(),t||(t=Math.floor(2147483647*Math.random()));let e=t;this.Q=[];for(let t=0;t<4096;t++)e=(1103515245*e+12345)%4294967296,this.Q[t]=e;this.c=(1103515245*e+12345)%809430660}getNumber(t,e){if(e===t)return t;if(e<t){let i=e;e=t,t=i}let i=e-t+1;return Math.abs(this.getCMWCNumber()%i)+t}getCMWCNumber(){let t,e;return this.cur=(this.cur+1)%4096,t=18782*this.Q[this.cur]+this.c,this.c=Math.floor(t*B.DIVIDER),e=(t+this.c)%4294967296,e<this.c&&(e++,this.c++),-1===e&&(this.c++,e=0),this.Q[this.cur]=4294967294-e,this.Q[this.cur]}}const U=196,V=179,j=180,H=195,W=193,K=194,G=197;class z{constructor(t,e,i=16777215,r=0,n){this.renderer=n,this._width=t,this._height=e,this.text=this.newTable(),this.fore=this.newTable(),this.back=this.newTable(),this.clearText(),this.clearFore(i),this.clearBack(r),this.renderer&&this.renderer.init(this)}get height(){return this._height}get width(){return this._width}contains(t){return t.x>=0&&t.y>=0&&t.x<this._width&&t.y<this._height}render(){this.renderer&&this.renderer.render(this)}getPositionFromPixels(t,e,i){return this.renderer?this.renderer.getPositionFromPixels(t,e,i):void 0}getPixelPositionFromCell(t,e,i){return this.renderer?this.renderer.getPixelPositionFromCell(t,e,i):void 0}print(t,e,i,r=16777215){if(!i||void 0===t||void 0===e)return;let n=0,s=i.length;t+s>this.width&&(s=this.width-t),t<0&&(s+=t,n=-t,t=0),this.clearFore(r,t,e,s,1);for(let r=n;r<s;++r)this.text[r+t][e]=i.charCodeAt(r)}clearText(t=0,e=0,i=0,r=-1,n=-1){this.clearTable(this.text,t,e,i,r,n)}clearFore(t,e=0,i=0,r=-1,n=-1){this.clearTable(this.fore,t,e,i,r,n)}clearBack(t,e=0,i=0,r=-1,n=-1){this.clearTable(this.back,t,e,i,r,n)}blit(t,e=0,i=0,r=0,n=0,s=-1,o=-1){-1===s&&(s=this.width),-1===o&&(o=this.height),e+s>t.width&&(s=t.width-e),i+o>t.height&&(o=t.height-i);for(let a=i;a<i+o;++a)for(let o=e;o<e+s;++o){let s=r+o-e,h=n+a-i;t.text[o][a]=this.text[s][h],t.back[o][a]=this.back[s][h],t.fore[o][a]=this.fore[s][h]}}clearTable(t,e,i=0,r=0,n=-1,s=-1){-1===n&&(n=this.width-i),-1===s&&(s=this.height-r),i<0&&(n+=i,i=0),r<0&&(s+=r,r=0),n=Math.min(this._width-i,n),s=Math.min(this._height-r,s);for(let o=i;o<i+n;++o)if(void 0===t[o])console.log("ERROR: column "+o+" does not exist");else for(let i=r;i<r+s;++i)t[o][i]=e}newTable(){let t=[];for(let e=0;e<this.width;++e)t[e]=[];return t}}var q={};!function(e){"object"==typeof q?q=e():("undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:this).PIXI=e()}((function(){return function t(e,i,r){function n(o,a){if(!i[o]){if(!e[o]){var h=require;if(!a&&h)return h(o,!0);if(s)return s(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=i[o]={exports:{}};e[o][0].call(c.exports,(function(t){var i=e[o][1][t];return n(i||t)}),c,c.exports,t,e,i,r)}return i[o].exports}for(var s=require,o=0;o<r.length;o++)n(r[o]);return n}({1:[function(t,e,i){var r=new ArrayBuffer(0),n=function(t,e,i,n){this.gl=t,this.buffer=t.createBuffer(),this.type=e||t.ARRAY_BUFFER,this.drawType=n||t.STATIC_DRAW,this.data=r,i&&this.upload(i),this._updateID=0};n.prototype.upload=function(t,e,i){i||this.bind();var r=this.gl;t=t||this.data,e=e||0,this.data.byteLength>=t.byteLength?r.bufferSubData(this.type,e,t):r.bufferData(this.type,t,this.drawType),this.data=t},n.prototype.bind=function(){this.gl.bindBuffer(this.type,this.buffer)},n.createVertexBuffer=function(t,e,i){return new n(t,t.ARRAY_BUFFER,e,i)},n.createIndexBuffer=function(t,e,i){return new n(t,t.ELEMENT_ARRAY_BUFFER,e,i)},n.create=function(t,e,i,r){return new n(t,e,i,r)},n.prototype.destroy=function(){this.gl.deleteBuffer(this.buffer)},e.exports=n},{}],2:[function(t,e,i){var r=t("./GLTexture"),n=function(t,e,i){this.gl=t,this.framebuffer=t.createFramebuffer(),this.stencil=null,this.texture=null,this.width=e||100,this.height=i||100};n.prototype.enableTexture=function(t){var e=this.gl;this.texture=t||new r(e),this.texture.bind(),this.bind(),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture.texture,0)},n.prototype.enableStencil=function(){if(!this.stencil){var t=this.gl;this.stencil=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.stencil),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.stencil),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,this.width,this.height)}},n.prototype.clear=function(t,e,i,r){this.bind();var n=this.gl;n.clearColor(t,e,i,r),n.clear(n.COLOR_BUFFER_BIT)},n.prototype.bind=function(){var t=this.gl;this.texture&&this.texture.unbind(),t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer)},n.prototype.unbind=function(){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,null)},n.prototype.resize=function(t,e){var i=this.gl;this.width=t,this.height=e,this.texture&&this.texture.uploadData(null,t,e),this.stencil&&(i.bindRenderbuffer(i.RENDERBUFFER,this.stencil),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t,e))},n.prototype.destroy=function(){var t=this.gl;this.texture&&this.texture.destroy(),t.deleteFramebuffer(this.framebuffer),this.gl=null,this.stencil=null,this.texture=null},n.createRGBA=function(t,e,i,s){var o=r.fromData(t,null,e,i);o.enableNearestScaling(),o.enableWrapClamp();var a=new n(t,e,i);return a.enableTexture(o),a.unbind(),a},n.createFloat32=function(t,e,i,s){var o=new r.fromData(t,s,e,i);o.enableNearestScaling(),o.enableWrapClamp();var a=new n(t,e,i);return a.enableTexture(o),a.unbind(),a},e.exports=n},{"./GLTexture":4}],3:[function(t,e,i){var r=t("./shader/compileProgram"),n=t("./shader/extractAttributes"),s=t("./shader/extractUniforms"),o=t("./shader/generateUniformAccessObject"),a=function(t,e,i,a){for(var h in this.gl=t,this.program=r(t,e,i,a),this.attributes=n(t,this.program),this.attributes)console.log(h+" : "+this.attributes[h].location);console.log(">>>>>>>");var l=s(t,this.program);this.uniforms=o(t,l)};a.prototype.bind=function(){this.gl.useProgram(this.program)},a.prototype.destroy=function(){},e.exports=a},{"./shader/compileProgram":9,"./shader/extractAttributes":11,"./shader/extractUniforms":12,"./shader/generateUniformAccessObject":13}],4:[function(t,e,i){var r=function(t,e,i,r,n){this.gl=t,this.texture=t.createTexture(),this.mipmap=!1,this.premultiplyAlpha=!1,this.width=e||-1,this.height=i||-1,this.format=r||t.RGBA,this.type=n||t.UNSIGNED_BYTE};r.prototype.upload=function(t){this.bind();var e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha);var i=t.videoWidth||t.width,r=t.videoHeight||t.height;r!==this.height||i!==this.width?e.texImage2D(e.TEXTURE_2D,0,this.format,this.format,this.type,t):e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.format,this.type,t),this.width=i,this.height=r};var n=!1;r.prototype.uploadData=function(t,e,i){this.bind();var r=this.gl;if(t instanceof Float32Array){if(!n){if(!r.getExtension("OES_texture_float"))throw new Error("floating point textures not available");n=!0}this.type=r.FLOAT}else this.type=r.UNSIGNED_BYTE;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),e!==this.width||i!==this.height?r.texImage2D(r.TEXTURE_2D,0,this.format,e,i,0,this.format,this.type,t||null):r.texSubImage2D(r.TEXTURE_2D,0,0,0,e,i,this.format,this.type,t||null),this.width=e,this.height=i},r.prototype.bind=function(t){var e=this.gl;void 0!==t&&e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this.texture)},r.prototype.unbind=function(){var t=this.gl;t.bindTexture(t.TEXTURE_2D,null)},r.prototype.minFilter=function(t){var e=this.gl;this.bind(),this.mipmap?e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t?e.LINEAR_MIPMAP_LINEAR:e.NEAREST_MIPMAP_NEAREST):e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t?e.LINEAR:e.NEAREST)},r.prototype.magFilter=function(t){var e=this.gl;this.bind(),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t?e.LINEAR:e.NEAREST)},r.prototype.enableMipmap=function(){var t=this.gl;this.bind(),this.mipmap=!0,t.generateMipmap(t.TEXTURE_2D)},r.prototype.enableLinearScaling=function(){this.minFilter(!0),this.magFilter(!0)},r.prototype.enableNearestScaling=function(){this.minFilter(!1),this.magFilter(!1)},r.prototype.enableWrapClamp=function(){var t=this.gl;this.bind(),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)},r.prototype.enableWrapRepeat=function(){var t=this.gl;this.bind(),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT)},r.prototype.enableWrapMirrorRepeat=function(){var t=this.gl;this.bind(),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.MIRRORED_REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.MIRRORED_REPEAT)},r.prototype.destroy=function(){this.gl.deleteTexture(this.texture)},r.fromSource=function(t,e,i){var n=new r(t);return n.premultiplyAlpha=i||!1,n.upload(e),n},r.fromData=function(t,e,i,n){var s=new r(t);return s.uploadData(e,i,n),s},e.exports=r},{}],5:[function(t,e,i){function r(t,e){if(this.nativeVaoExtension=null,r.FORCE_NATIVE||(this.nativeVaoExtension=t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object")),this.nativeState=e,this.nativeVaoExtension){this.nativeVao=this.nativeVaoExtension.createVertexArrayOES();var i=t.getParameter(t.MAX_VERTEX_ATTRIBS);this.nativeState={tempAttribState:new Array(i),attribState:new Array(i)}}this.gl=t,this.attributes=[],this.indexBuffer=null,this.dirty=!1}var n=t("./setVertexAttribArrays");r.prototype.constructor=r,e.exports=r,r.FORCE_NATIVE=!0,r.prototype.bind=function(){return this.nativeVao?(this.nativeVaoExtension.bindVertexArrayOES(this.nativeVao),this.dirty&&(this.dirty=!1,this.activate())):this.activate(),this},r.prototype.unbind=function(){return this.nativeVao&&this.nativeVaoExtension.bindVertexArrayOES(null),this},r.prototype.activate=function(){for(var t=this.gl,e=null,i=0;i<this.attributes.length;i++){var r=this.attributes[i];e!==r.buffer&&(r.buffer.bind(),e=r.buffer),t.vertexAttribPointer(r.attribute.location,r.attribute.size,r.type||t.FLOAT,r.normalized||!1,r.stride||0,r.start||0)}return n(t,this.attributes,this.nativeState),this.indexBuffer.bind(),this},r.prototype.addAttribute=function(t,e,i,r,n,s){return this.attributes.push({buffer:t,attribute:e,location:e.location,type:i||this.gl.FLOAT,normalized:r||!1,stride:n||0,start:s||0}),this.dirty=!0,this},r.prototype.addIndex=function(t){return this.indexBuffer=t,this.dirty=!0,this},r.prototype.clear=function(){return this.nativeVao&&this.nativeVaoExtension.bindVertexArrayOES(this.nativeVao),this.attributes.length=0,this.indexBuffer=null,this},r.prototype.draw=function(t,e,i){var r=this.gl;return r.drawElements(t,e||this.indexBuffer.data.length,r.UNSIGNED_SHORT,i||0),this},r.prototype.destroy=function(){this.gl=null,this.indexBuffer=null,this.attributes=null,this.nativeState=null,this.nativeVao&&this.nativeVaoExtension.deleteVertexArrayOES(this.nativeVao),this.nativeVaoExtension=null,this.nativeVao=null}},{"./setVertexAttribArrays":8}],6:[function(t,e,i){e.exports=function(t,e){var i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e);if(!i)throw new Error("This browser does not support webGL. Try using the canvas renderer");return i}},{}],7:[function(t,e,i){var r={createContext:t("./createContext"),setVertexAttribArrays:t("./setVertexAttribArrays"),GLBuffer:t("./GLBuffer"),GLFramebuffer:t("./GLFramebuffer"),GLShader:t("./GLShader"),GLTexture:t("./GLTexture"),VertexArrayObject:t("./VertexArrayObject"),shader:t("./shader")};void 0!==e&&e.exports&&(e.exports=r),"undefined"!=typeof window&&(window.PIXI=window.PIXI||{},window.PIXI.glCore=r)},{"./GLBuffer":1,"./GLFramebuffer":2,"./GLShader":3,"./GLTexture":4,"./VertexArrayObject":5,"./createContext":6,"./setVertexAttribArrays":8,"./shader":14}],8:[function(t,e,i){e.exports=function(t,e,i){var r;if(i){var n=i.tempAttribState,s=i.attribState;for(r=0;r<n.length;r++)n[r]=!1;for(r=0;r<e.length;r++)n[e[r].attribute.location]=!0;for(r=0;r<s.length;r++)s[r]!==n[r]&&(s[r]=n[r],i.attribState[r]?t.enableVertexAttribArray(r):t.disableVertexAttribArray(r))}else for(r=0;r<e.length;r++){var o=e[r];t.enableVertexAttribArray(o.attribute.location)}}},{}],9:[function(t,e,i){var r=function(t,e,i){var r=t.createShader(e);return t.shaderSource(r,i),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(console.log(t.getShaderInfoLog(r)),null)};e.exports=function(t,e,i,n){var s=r(t,t.VERTEX_SHADER,e),o=r(t,t.FRAGMENT_SHADER,i),a=t.createProgram();if(t.attachShader(a,s),t.attachShader(a,o),n)for(var h in n)t.bindAttribLocation(a,n[h],h);return t.linkProgram(a),t.getProgramParameter(a,t.LINK_STATUS)||(console.error("Pixi.js Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",t.getProgramParameter(a,t.VALIDATE_STATUS)),console.error("gl.getError()",t.getError()),""!==t.getProgramInfoLog(a)&&console.warn("Pixi.js Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(a)),t.deleteProgram(a),a=null),t.deleteShader(s),t.deleteShader(o),a}},{}],10:[function(t,e,i){var r=function(t){for(var e=new Array(t),i=0;i<e.length;i++)e[i]=!1;return e};e.exports=function(t,e){switch(t){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"sampler2D":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"bool":return!1;case"bvec2":return r(2*e);case"bvec3":return r(3*e);case"bvec4":return r(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}}},{}],11:[function(t,e,i){var r=t("./mapType"),n=t("./mapSize"),s=function(t,e,i,r){gl.vertexAttribPointer(this.location,this.size,t||gl.FLOAT,e||!1,i||0,r||0)};e.exports=function(t,e){for(var i={},o=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),a=0;a<o;a++){var h=t.getActiveAttrib(e,a),l=r(t,h.type);i[h.name]={type:l,size:n(l),location:t.getAttribLocation(e,h.name),pointer:s}}return i}},{"./mapSize":15,"./mapType":16}],12:[function(t,e,i){var r=t("./mapType"),n=t("./defaultValue");e.exports=function(t,e){for(var i={},s=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),o=0;o<s;o++){var a=t.getActiveUniform(e,o),h=a.name.replace(/\[.*?\]/,""),l=r(t,a.type);i[h]={type:l,size:a.size,location:t.getUniformLocation(e,h),value:n(l,a.size)}}return i}},{"./defaultValue":10,"./mapType":16}],13:[function(t,e,i){var r=function(t){var e=o.replace("%%",t);return new Function(e)},n=function(t,e){var i,r=a.replace(/%%/g,t);return(i=1===e.size?h[e.type]:l[e.type])&&(r+="\nthis.gl."+i+";"),new Function("value",r)},s=function(t,e){for(var i=e,r=0;r<t.length-1;r++){var n=i[t[r]]||{data:{}};i[t[r]]=n,i=n}return i},o=["return this.data.%%.value;"].join("\n"),a=["this.data.%%.value = value;","var location = this.data.%%.location;"].join("\n"),h={float:"uniform1f(location, value)",vec2:"uniform2f(location, value[0], value[1])",vec3:"uniform3f(location, value[0], value[1], value[2])",vec4:"uniform4f(location, value[0], value[1], value[2], value[3])",int:"uniform1i(location, value)",ivec2:"uniform2i(location, value[0], value[1])",ivec3:"uniform3i(location, value[0], value[1], value[2])",ivec4:"uniform4i(location, value[0], value[1], value[2], value[3])",bool:"uniform1i(location, value)",bvec2:"uniform2i(location, value[0], value[1])",bvec3:"uniform3i(location, value[0], value[1], value[2])",bvec4:"uniform4i(location, value[0], value[1], value[2], value[3])",mat2:"uniformMatrix2fv(location, false, value)",mat3:"uniformMatrix3fv(location, false, value)",mat4:"uniformMatrix4fv(location, false, value)",sampler2D:"uniform1i(location, value)"},l={float:"uniform1fv(location, value)",vec2:"uniform2fv(location, value)",vec3:"uniform3fv(location, value)",vec4:"uniform4fv(location, value)",int:"uniform1iv(location, value)",ivec2:"uniform2iv(location, value)",ivec3:"uniform3iv(location, value)",ivec4:"uniform4iv(location, value)",bool:"uniform1iv(location, value)",bvec2:"uniform2iv(location, value)",bvec3:"uniform3iv(location, value)",bvec4:"uniform4iv(location, value)",sampler2D:"uniform1iv(location, value)"};e.exports=function(t,e){var i={data:{}};i.gl=t;for(var o=Object.keys(e),a=0;a<o.length;a++){var h=o[a],l=h.split("."),c=l[l.length-1],u=s(l,i),d=e[h];u.data[c]=d,u.gl=t,Object.defineProperty(u,c,{get:r(c),set:n(c,d)})}return i}},{}],14:[function(t,e,i){e.exports={compileProgram:t("./compileProgram"),defaultValue:t("./defaultValue"),extractAttributes:t("./extractAttributes"),extractUniforms:t("./extractUniforms"),generateUniformAccessObject:t("./generateUniformAccessObject"),mapSize:t("./mapSize"),mapType:t("./mapType")}},{"./compileProgram":9,"./defaultValue":10,"./extractAttributes":11,"./extractUniforms":12,"./generateUniformAccessObject":13,"./mapSize":15,"./mapType":16}],15:[function(t,e,i){var r={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};e.exports=function(t){return r[t]}},{}],16:[function(t,e,i){var r=null,n={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D"};e.exports=function(t,e){if(!r){var i=Object.keys(n);r={};for(var s=0;s<i.length;++s){var o=i[s];r[t[o]]=n[o]}}return r[e]}},{}],17:[function(t,e,i){function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(t,e,i,r){(0,n.default)(e)(t,(0,s.default)(i),r)};var n=r(t("./internal/eachOfLimit")),s=r(t("./internal/withoutIndex"));e.exports=i.default},{"./internal/eachOfLimit":21,"./internal/withoutIndex":28}],18:[function(t,e,i){function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(i,"__esModule",{value:!0});var n=r(t("./eachLimit")),s=r(t("./internal/doLimit"));i.default=(0,s.default)(n.default,1),e.exports=i.default},{"./eachLimit":17,"./internal/doLimit":20}],19:[function(t,e,i){function r(){this.head=this.tail=null,this.length=0}function n(t,e){t.length=1,t.head=t.tail=e}Object.defineProperty(i,"__esModule",{value:!0}),i.default=r,r.prototype.removeLink=function(t){return t.prev?t.prev.next=t.next:this.head=t.next,t.next?t.next.prev=t.prev:this.tail=t.prev,t.prev=t.next=null,this.length-=1,t},r.prototype.empty=r,r.prototype.insertAfter=function(t,e){e.prev=t,e.next=t.next,t.next?t.next.prev=e:this.tail=e,t.next=e,this.length+=1},r.prototype.insertBefore=function(t,e){e.prev=t.prev,e.next=t,t.prev?t.prev.next=e:this.head=e,t.prev=e,this.length+=1},r.prototype.unshift=function(t){this.head?this.insertBefore(this.head,t):n(this,t)},r.prototype.push=function(t){this.tail?this.insertAfter(this.tail,t):n(this,t)},r.prototype.shift=function(){return this.head&&this.removeLink(this.head)},r.prototype.pop=function(){return this.tail&&this.removeLink(this.tail)},e.exports=i.default},{}],20:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(t,e){return function(i,r,n){return t(i,e,r,n)}},e.exports=i.default},{}],21:[function(t,e,i){function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(t){return function(e,i,r){function h(t){if(d-=1,t)u=!0,r(t);else{if(u&&d<=0)return r(null);l()}}function l(){for(;d<t&&!u;){var e=c();if(null===e)return u=!0,void(d<=0&&r(null));d+=1,i(e.value,e.key,(0,a.default)(h))}}if(r=(0,s.default)(r||n.default),t<=0||!e)return r(null);var c=(0,o.default)(e),u=!1,d=0;l()}};var n=r(t("lodash/noop")),s=r(t("./once")),o=r(t("./iterator")),a=r(t("./onlyOnce"));e.exports=i.default},{"./iterator":23,"./once":24,"./onlyOnce":25,"lodash/noop":54}],22:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(t){return r&&t[r]&&t[r]()};var r="function"==typeof Symbol&&Symbol.iterator;e.exports=i.default},{}],23:[function(t,e,i){function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(t){if((0,n.default)(t))return function(t){var e=-1,i=t.length;return function(){return++e<i?{value:t[e],key:e}:null}}(t);var e=(0,s.default)(t);return e?function(t){var e=-1;return function(){var i=t.next();return i.done?null:(e++,{value:i.value,key:e})}}(e):function(t){var e=(0,o.default)(t),i=-1,r=e.length;return function(){var n=e[++i];return i<r?{value:t[n],key:n}:null}}(t)};var n=r(t("lodash/isArrayLike")),s=r(t("./getIterator")),o=r(t("lodash/keys"));e.exports=i.default},{"./getIterator":22,"lodash/isArrayLike":46,"lodash/keys":53}],24:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(t){return function(){if(null!==t){var e=t;t=null,e.apply(this,arguments)}}},e.exports=i.default},{}],25:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(t){return function(){if(null===t)throw new Error("Callback was already called.");var e=t;t=null,e.apply(this,arguments)}},e.exports=i.default},{}],26:[function(t,e,i){function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(t,e,i){function r(t,e,i){if(null!=i&&"function"!=typeof i)throw new Error("task callback must be a function");return f.started=!0,(0,s.default)(t)||(t=[t]),0===t.length&&f.idle()?(0,l.default)((function(){f.drain()})):((0,n.default)(t,(function(t){var r={data:t,callback:i||o.default};e?f._tasks.unshift(r):f._tasks.push(r)})),void(0,l.default)(f.process))}function u(t){return(0,a.default)((function(e){d-=1,(0,n.default)(t,(function(t){(0,n.default)(p,(function(e,i){if(e===t)return p.splice(i,1),!1})),t.callback.apply(t,e),null!=e[0]&&f.error(e[0],t.data)})),d<=f.concurrency-f.buffer&&f.unsaturated(),f.idle()&&f.drain(),f.process()}))}if(null==e)e=1;else if(0===e)throw new Error("Concurrency must not be zero");var d=0,p=[],f={_tasks:new c.default,concurrency:e,payload:i,saturated:o.default,unsaturated:o.default,buffer:e/4,empty:o.default,drain:o.default,error:o.default,started:!1,paused:!1,push:function(t,e){r(t,!1,e)},kill:function(){f.drain=o.default,f._tasks.empty()},unshift:function(t,e){r(t,!0,e)},process:function(){for(;!f.paused&&d<f.concurrency&&f._tasks.length;){var e=[],i=[],r=f._tasks.length;f.payload&&(r=Math.min(r,f.payload));for(var n=0;n<r;n++){var s=f._tasks.shift();e.push(s),i.push(s.data)}0===f._tasks.length&&f.empty(),d+=1,p.push(e[0]),d===f.concurrency&&f.saturated();var o=(0,h.default)(u(e));t(i,o)}},length:function(){return f._tasks.length},running:function(){return d},workersList:function(){return p},idle:function(){return f._tasks.length+d===0},pause:function(){f.paused=!0},resume:function(){if(!1!==f.paused){f.paused=!1;for(var t=Math.min(f.concurrency,f._tasks.length),e=1;e<=t;e++)(0,l.default)(f.process)}}};return f};var n=r(t("lodash/_arrayEach")),s=r(t("lodash/isArray")),o=r(t("lodash/noop")),a=r(t("lodash/rest")),h=r(t("./onlyOnce")),l=r(t("./setImmediate")),c=r(t("./DoublyLinkedList"));e.exports=i.default},{"./DoublyLinkedList":19,"./onlyOnce":25,"./setImmediate":27,"lodash/_arrayEach":35,"lodash/isArray":45,"lodash/noop":54,"lodash/rest":55}],27:[function(t,e,i){(function(e){function r(t){setTimeout(t,0)}function n(t){return(0,o.default)((function(e,i){t((function(){e.apply(null,i)}))}))}Object.defineProperty(i,"__esModule",{value:!0}),i.hasNextTick=i.hasSetImmediate=void 0,i.fallback=r,i.wrap=n;var s,o=function(t){return t&&t.__esModule?t:{default:t}}(t("lodash/rest")),a=i.hasSetImmediate="function"==typeof setImmediate&&setImmediate,h=i.hasNextTick="object"==typeof e&&"function"==typeof e.nextTick;s=a?setImmediate:h?e.nextTick:r,i.default=n(s)}).call(this,t("_process"))},{_process:61,"lodash/rest":55}],28:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(t){return function(e,i,r){return t(e,r)}},e.exports=i.default},{}],29:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(t,e){return(0,r.default)((function(e,i){t(e[0],i)}),e,1)};var r=function(t){return t&&t.__esModule?t:{default:t}}(t("./internal/queue"));e.exports=i.default},{"./internal/queue":26}],30:[function(t,e,i){function r(t){var e=32;return(t&=-t)&&e--,65535&t&&(e-=16),16711935&t&&(e-=8),252645135&t&&(e-=4),858993459&t&&(e-=2),1431655765&t&&(e-=1),e}i.INT_BITS=32,i.INT_MAX=2147483647,i.INT_MIN=-1<<31,i.sign=function(t){return(t>0)-(t<0)},i.abs=function(t){var e=t>>31;return(t^e)-e},i.min=function(t,e){return e^(t^e)&-(t<e)},i.max=function(t,e){return t^(t^e)&-(t<e)},i.isPow2=function(t){return!(t&t-1||!t)},i.log2=function(t){var e,i;return e=(t>65535)<<4,e|=i=((t>>>=e)>255)<<3,e|=i=((t>>>=i)>15)<<2,(e|=i=((t>>>=i)>3)<<1)|(t>>>=i)>>1},i.log10=function(t){return t>=1e9?9:t>=1e8?8:t>=1e7?7:t>=1e6?6:t>=1e5?5:t>=1e4?4:t>=1e3?3:t>=100?2:t>=10?1:0},i.popCount=function(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24},i.countTrailingZeros=r,i.nextPow2=function(t){return t+=0===t,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)+1},i.prevPow2=function(t){return t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)-(t>>>1)},i.parity=function(t){return t^=t>>>16,t^=t>>>8,t^=t>>>4,27030>>>(t&=15)&1};var n=new Array(256);!function(t){for(var e=0;e<256;++e){var i=e,r=e,n=7;for(i>>>=1;i;i>>>=1)r<<=1,r|=1&i,--n;t[e]=r<<n&255}}(n),i.reverse=function(t){return n[255&t]<<24|n[t>>>8&255]<<16|n[t>>>16&255]<<8|n[t>>>24&255]},i.interleave2=function(t,e){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))<<1},i.deinterleave2=function(t,e){return(t=65535&((t=16711935&((t=252645135&((t=858993459&((t=t>>>e&1431655765)|t>>>1))|t>>>2))|t>>>4))|t>>>16))<<16>>16},i.interleave3=function(t,e,i){return t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2),(t|=(e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2))<<1)|(i=1227133513&((i=3272356035&((i=251719695&((i=4278190335&((i&=1023)|i<<16))|i<<8))|i<<4))|i<<2))<<2},i.deinterleave3=function(t,e){return(t=1023&((t=4278190335&((t=251719695&((t=3272356035&((t=t>>>e&1227133513)|t>>>2))|t>>>4))|t>>>8))|t>>>16))<<22>>22},i.nextCombination=function(t){var e=t|t-1;return e+1|(~e&-~e)-1>>>r(t)+1}},{}],31:[function(t,e,i){function r(t,e,i){i=i||2;var r,s,a,h,l,c,d,p=e&&e.length,f=p?e[0]*i:t.length,g=n(t,0,f,i,!0),v=[];if(!g)return v;if(p&&(g=u(t,e,g,i)),t.length>80*i){r=a=t[0],s=h=t[1];for(var m=i;m<f;m+=i)(l=t[m])<r&&(r=l),(c=t[m+1])<s&&(s=c),l>a&&(a=l),c>h&&(h=c);d=Math.max(a-r,h-s)}return o(g,v,i,r,s,d),v}function n(t,e,i,r,n){var s,o;if(n===S(t,e,i,r)>0)for(s=e;s<i;s+=r)o=w(s,t[s],t[s+1],o);else for(s=i-r;s>=e;s-=r)o=w(s,t[s],t[s+1],o);return o&&_(o,o.next)&&(A(o),o=o.next),o}function s(t,e){if(!t)return t;e||(e=t);var i,r=t;do{if(i=!1,r.steiner||!_(r,r.next)&&0!==x(r.prev,r,r.next))r=r.next;else{if(A(r),(r=e=r.prev)===r.next)return null;i=!0}}while(i||r!==e);return e}function o(t,e,i,r,n,u,d){if(t){!d&&u&&f(t,r,n,u);for(var p,g,v=t;t.prev!==t.next;)if(p=t.prev,g=t.next,u?h(t,r,n,u):a(t))e.push(p.i/i),e.push(t.i/i),e.push(g.i/i),A(t),t=g.next,v=g.next;else if((t=g)===v){d?1===d?o(t=l(t,e,i),e,i,r,n,u,2):2===d&&c(t,e,i,r,n,u):o(s(t),e,i,r,n,u,1);break}}}function a(t){var e=t.prev,i=t,r=t.next;if(x(e,i,r)>=0)return!1;for(var n=t.next.next;n!==t.prev;){if(m(e.x,e.y,i.x,i.y,r.x,r.y,n.x,n.y)&&x(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function h(t,e,i,r){var n=t.prev,s=t,o=t.next;if(x(n,s,o)>=0)return!1;for(var a=n.x<s.x?n.x<o.x?n.x:o.x:s.x<o.x?s.x:o.x,h=n.y<s.y?n.y<o.y?n.y:o.y:s.y<o.y?s.y:o.y,l=n.x>s.x?n.x>o.x?n.x:o.x:s.x>o.x?s.x:o.x,c=n.y>s.y?n.y>o.y?n.y:o.y:s.y>o.y?s.y:o.y,u=g(a,h,e,i,r),d=g(l,c,e,i,r),p=t.nextZ;p&&p.z<=d;){if(p!==t.prev&&p!==t.next&&m(n.x,n.y,s.x,s.y,o.x,o.y,p.x,p.y)&&x(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(p=t.prevZ;p&&p.z>=u;){if(p!==t.prev&&p!==t.next&&m(n.x,n.y,s.x,s.y,o.x,o.y,p.x,p.y)&&x(p.prev,p,p.next)>=0)return!1;p=p.prevZ}return!0}function l(t,e,i){var r=t;do{var n=r.prev,s=r.next.next;!_(n,s)&&b(n,r,r.next,s)&&T(n,s)&&T(s,n)&&(e.push(n.i/i),e.push(r.i/i),e.push(s.i/i),A(r),A(r.next),r=t=s),r=r.next}while(r!==t);return r}function c(t,e,i,r,n,a){var h=t;do{for(var l=h.next.next;l!==h.prev;){if(h.i!==l.i&&y(h,l)){var c=E(h,l);return h=s(h,h.next),c=s(c,c.next),o(h,e,i,r,n,a),void o(c,e,i,r,n,a)}l=l.next}h=h.next}while(h!==t)}function u(t,e,i,r){var o,a,h,l=[];for(o=0,a=e.length;o<a;o++)(h=n(t,e[o]*r,o<a-1?e[o+1]*r:t.length,r,!1))===h.next&&(h.steiner=!0),l.push(v(h));for(l.sort(d),o=0;o<l.length;o++)p(l[o],i),i=s(i,i.next);return i}function d(t,e){return t.x-e.x}function p(t,e){if(e=function(t,e){var i,r=e,n=t.x,s=t.y,o=-1/0;do{if(s<=r.y&&s>=r.next.y){var a=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&a>o){if(o=a,a===n){if(s===r.y)return r;if(s===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!i)return null;if(n===o)return i.prev;var h,l=i,c=i.x,u=i.y,d=1/0;for(r=i.next;r!==l;)n>=r.x&&r.x>=c&&m(s<u?n:o,s,c,u,s<u?o:n,s,r.x,r.y)&&((h=Math.abs(s-r.y)/(n-r.x))<d||h===d&&r.x>i.x)&&T(r,t)&&(i=r,d=h),r=r.next;return i}(t,e)){var i=E(e,t);s(i,i.next)}}function f(t,e,i,r){var n=t;do{null===n.z&&(n.z=g(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e,i,r,n,s,o,a,h,l=1;do{for(i=t,t=null,s=null,o=0;i;){for(o++,r=i,a=0,e=0;e<l&&(a++,r=r.nextZ);e++);for(h=l;a>0||h>0&&r;)0===a?(n=r,r=r.nextZ,h--):0!==h&&r?i.z<=r.z?(n=i,i=i.nextZ,a--):(n=r,r=r.nextZ,h--):(n=i,i=i.nextZ,a--),s?s.nextZ=n:t=n,n.prevZ=s,s=n;i=r}s.nextZ=null,l*=2}while(o>1)}(n)}function g(t,e,i,r,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)/n)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)/n)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function v(t){var e=t,i=t;do{e.x<i.x&&(i=e),e=e.next}while(e!==t);return i}function m(t,e,i,r,n,s,o,a){return(n-o)*(e-a)-(t-o)*(s-a)>=0&&(t-o)*(r-a)-(i-o)*(e-a)>=0&&(i-o)*(s-a)-(n-o)*(r-a)>=0}function y(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&b(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&T(t,e)&&T(e,t)&&function(t,e){var i=t,r=!1,n=(t.x+e.x)/2,s=(t.y+e.y)/2;do{i.y>s!=i.next.y>s&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==t);return r}(t,e)}function x(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function _(t,e){return t.x===e.x&&t.y===e.y}function b(t,e,i,r){return!!(_(t,e)&&_(i,r)||_(t,r)&&_(i,e))||x(t,e,i)>0!=x(t,e,r)>0&&x(i,r,t)>0!=x(i,r,e)>0}function T(t,e){return x(t.prev,t,t.next)<0?x(t,e,t.next)>=0&&x(t,t.prev,e)>=0:x(t,e,t.prev)<0||x(t,t.next,e)<0}function E(t,e){var i=new C(t.i,t.x,t.y),r=new C(e.i,e.x,e.y),n=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function w(t,e,i,r){var n=new C(t,e,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function A(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function C(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function S(t,e,i,r){for(var n=0,s=e,o=i-r;s<i;s+=r)n+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return n}e.exports=r,r.deviation=function(t,e,i,r){var n=e&&e.length,s=n?e[0]*i:t.length,o=Math.abs(S(t,0,s,i));if(n)for(var a=0,h=e.length;a<h;a++){var l=e[a]*i,c=a<h-1?e[a+1]*i:t.length;o-=Math.abs(S(t,l,c,i))}var u=0;for(a=0;a<r.length;a+=3){var d=r[a]*i,p=r[a+1]*i,f=r[a+2]*i;u+=Math.abs((t[d]-t[f])*(t[p+1]-t[d+1])-(t[d]-t[p])*(t[f+1]-t[d+1]))}return 0===o&&0===u?0:Math.abs((u-o)/o)},r.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,n=0;n<t.length;n++){for(var s=0;s<t[n].length;s++)for(var o=0;o<e;o++)i.vertices.push(t[n][s][o]);n>0&&(r+=t[n-1].length,i.holes.push(r))}return i}},{}],32:[function(t,e,i){function r(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function n(){}var s=Object.prototype.hasOwnProperty,o="function"!=typeof Object.create&&"~";n.prototype._events=void 0,n.prototype.eventNames=function(){var t,e=this._events,i=[];if(!e)return i;for(t in e)s.call(e,t)&&i.push(o?t.slice(1):t);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},n.prototype.listeners=function(t,e){var i=o?o+t:t,r=this._events&&this._events[i];if(e)return!!r;if(!r)return[];if(r.fn)return[r.fn];for(var n=0,s=r.length,a=new Array(s);n<s;n++)a[n]=r[n].fn;return a},n.prototype.emit=function(t,e,i,r,n,s){var a=o?o+t:t;if(!this._events||!this._events[a])return!1;var h,l,c=this._events[a],u=arguments.length;if("function"==typeof c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,i),!0;case 4:return c.fn.call(c.context,e,i,r),!0;case 5:return c.fn.call(c.context,e,i,r,n),!0;case 6:return c.fn.call(c.context,e,i,r,n,s),!0}for(l=1,h=new Array(u-1);l<u;l++)h[l-1]=arguments[l];c.fn.apply(c.context,h)}else{var d,p=c.length;for(l=0;l<p;l++)switch(c[l].once&&this.removeListener(t,c[l].fn,void 0,!0),u){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,e);break;case 3:c[l].fn.call(c[l].context,e,i);break;default:if(!h)for(d=1,h=new Array(u-1);d<u;d++)h[d-1]=arguments[d];c[l].fn.apply(c[l].context,h)}}return!0},n.prototype.on=function(t,e,i){var n=new r(e,i||this),s=o?o+t:t;return this._events||(this._events=o?{}:Object.create(null)),this._events[s]?this._events[s].fn?this._events[s]=[this._events[s],n]:this._events[s].push(n):this._events[s]=n,this},n.prototype.once=function(t,e,i){var n=new r(e,i||this,!0),s=o?o+t:t;return this._events||(this._events=o?{}:Object.create(null)),this._events[s]?this._events[s].fn?this._events[s]=[this._events[s],n]:this._events[s].push(n):this._events[s]=n,this},n.prototype.removeListener=function(t,e,i,r){var n=o?o+t:t;if(!this._events||!this._events[n])return this;var s=this._events[n],a=[];if(e)if(s.fn)(s.fn!==e||r&&!s.once||i&&s.context!==i)&&a.push(s);else for(var h=0,l=s.length;h<l;h++)(s[h].fn!==e||r&&!s[h].once||i&&s[h].context!==i)&&a.push(s[h]);return a.length?this._events[n]=1===a.length?a[0]:a:delete this._events[n],this},n.prototype.removeAllListeners=function(t){return this._events?(t?delete this._events[o?o+t:t]:this._events=o?{}:Object.create(null),this):this},n.prototype.off=n.prototype.removeListener,n.prototype.addListener=n.prototype.on,n.prototype.setMaxListeners=function(){return this},n.prefixed=o,void 0!==e&&(e.exports=n)},{}],33:[function(t,e,i){!function(t){var i=/iPhone/i,r=/iPod/i,n=/iPad/i,s=/(?=.*\bAndroid\b)(?=.*\bMobile\b)/i,o=/Android/i,a=/(?=.*\bAndroid\b)(?=.*\bSD4930UR\b)/i,h=/(?=.*\bAndroid\b)(?=.*\b(?:KFOT|KFTT|KFJWI|KFJWA|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|KFARWI|KFASWI|KFSAWI|KFSAWA)\b)/i,l=/IEMobile/i,c=/(?=.*\bWindows\b)(?=.*\bARM\b)/i,u=/BlackBerry/i,d=/BB10/i,p=/Opera Mini/i,f=/(CriOS|Chrome)(?=.*\bMobile\b)/i,g=/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i,v=new RegExp("(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)","i"),m=function(t,e){return t.test(e)},y=function(t){var e=t||navigator.userAgent,y=e.split("[FBAN");if(void 0!==y[1]&&(e=y[0]),void 0!==(y=e.split("Twitter"))[1]&&(e=y[0]),this.apple={phone:m(i,e),ipod:m(r,e),tablet:!m(i,e)&&m(n,e),device:m(i,e)||m(r,e)||m(n,e)},this.amazon={phone:m(a,e),tablet:!m(a,e)&&m(h,e),device:m(a,e)||m(h,e)},this.android={phone:m(a,e)||m(s,e),tablet:!m(a,e)&&!m(s,e)&&(m(h,e)||m(o,e)),device:m(a,e)||m(h,e)||m(s,e)||m(o,e)},this.windows={phone:m(l,e),tablet:m(c,e),device:m(l,e)||m(c,e)},this.other={blackberry:m(u,e),blackberry10:m(d,e),opera:m(p,e),firefox:m(g,e),chrome:m(f,e),device:m(u,e)||m(d,e)||m(p,e)||m(g,e)||m(f,e)},this.seven_inch=m(v,e),this.any=this.apple.device||this.android.device||this.windows.device||this.other.device||this.seven_inch,this.phone=this.apple.phone||this.android.phone||this.windows.phone,this.tablet=this.apple.tablet||this.android.tablet||this.windows.tablet,"undefined"==typeof window)return this},x=function(){var t=new y;return t.Class=y,t};void 0!==e&&e.exports&&"undefined"==typeof window?e.exports=y:void 0!==e&&e.exports&&"undefined"!=typeof window?e.exports=x():t.isMobile=x()}(this)},{}],34:[function(t,e,i){e.exports=function(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}},{}],35:[function(t,e,i){e.exports=function(t,e){for(var i=-1,r=t?t.length:0;++i<r&&!1!==e(t[i],i,t););return t}},{}],36:[function(t,e,i){var r=t("./_baseTimes"),n=t("./isArguments"),s=t("./isArray"),o=t("./_isIndex"),a=Object.prototype.hasOwnProperty;e.exports=function(t,e){var i=s(t)||n(t)?r(t.length,String):[],h=i.length,l=!!h;for(var c in t)!e&&!a.call(t,c)||l&&("length"==c||o(c,h))||i.push(c);return i}},{"./_baseTimes":39,"./_isIndex":40,"./isArguments":44,"./isArray":45}],37:[function(t,e,i){var r=t("./_isPrototype"),n=t("./_nativeKeys"),s=Object.prototype.hasOwnProperty;e.exports=function(t){if(!r(t))return n(t);var e=[];for(var i in Object(t))s.call(t,i)&&"constructor"!=i&&e.push(i);return e}},{"./_isPrototype":41,"./_nativeKeys":42}],38:[function(t,e,i){var r=t("./_apply"),n=Math.max;e.exports=function(t,e){return e=n(void 0===e?t.length-1:e,0),function(){for(var i=arguments,s=-1,o=n(i.length-e,0),a=Array(o);++s<o;)a[s]=i[e+s];s=-1;for(var h=Array(e+1);++s<e;)h[s]=i[s];return h[e]=a,r(t,this,h)}}},{"./_apply":34}],39:[function(t,e,i){e.exports=function(t,e){for(var i=-1,r=Array(t);++i<t;)r[i]=e(i);return r}},{}],40:[function(t,e,i){var r=9007199254740991,n=/^(?:0|[1-9]\d*)$/;e.exports=function(t,e){return!!(e=null==e?r:e)&&("number"==typeof t||n.test(t))&&t>-1&&t%1==0&&t<e}},{}],41:[function(t,e,i){var r=Object.prototype;e.exports=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||r)}},{}],42:[function(t,e,i){var r=t("./_overArg")(Object.keys,Object);e.exports=r},{"./_overArg":43}],43:[function(t,e,i){e.exports=function(t,e){return function(i){return t(e(i))}}},{}],44:[function(t,e,i){var r=t("./isArrayLikeObject"),n="[object Arguments]",s=Object.prototype,o=s.hasOwnProperty,a=s.toString,h=s.propertyIsEnumerable;e.exports=function(t){return r(t)&&o.call(t,"callee")&&(!h.call(t,"callee")||a.call(t)==n)}},{"./isArrayLikeObject":47}],45:[function(t,e,i){var r=Array.isArray;e.exports=r},{}],46:[function(t,e,i){var r=t("./isFunction"),n=t("./isLength");e.exports=function(t){return null!=t&&n(t.length)&&!r(t)}},{"./isFunction":48,"./isLength":49}],47:[function(t,e,i){var r=t("./isArrayLike"),n=t("./isObjectLike");e.exports=function(t){return n(t)&&r(t)}},{"./isArrayLike":46,"./isObjectLike":51}],48:[function(t,e,i){var r=t("./isObject"),n="[object Function]",s="[object GeneratorFunction]",o=Object.prototype.toString;e.exports=function(t){var e=r(t)?o.call(t):"";return e==n||e==s}},{"./isObject":50}],49:[function(t,e,i){var r=9007199254740991;e.exports=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=r}},{}],50:[function(t,e,i){e.exports=function(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}},{}],51:[function(t,e,i){e.exports=function(t){return!!t&&"object"==typeof t}},{}],52:[function(t,e,i){var r=t("./isObjectLike"),n="[object Symbol]",s=Object.prototype.toString;e.exports=function(t){return"symbol"==typeof t||r(t)&&s.call(t)==n}},{"./isObjectLike":51}],53:[function(t,e,i){var r=t("./_arrayLikeKeys"),n=t("./_baseKeys"),s=t("./isArrayLike");e.exports=function(t){return s(t)?r(t):n(t)}},{"./_arrayLikeKeys":36,"./_baseKeys":37,"./isArrayLike":46}],54:[function(t,e,i){e.exports=function(){}},{}],55:[function(t,e,i){var r=t("./_baseRest"),n=t("./toInteger"),s="Expected a function";e.exports=function(t,e){if("function"!=typeof t)throw new TypeError(s);return e=void 0===e?e:n(e),r(t,e)}},{"./_baseRest":38,"./toInteger":57}],56:[function(t,e,i){var r=t("./toNumber"),n=1/0,s=17976931348623157e292;e.exports=function(t){return t?(t=r(t))===n||t===-n?(t<0?-1:1)*s:t==t?t:0:0===t?t:0}},{"./toNumber":58}],57:[function(t,e,i){var r=t("./toFinite");e.exports=function(t){var e=r(t),i=e%1;return e==e?i?e-i:e:0}},{"./toFinite":56}],58:[function(t,e,i){var r=t("./isObject"),n=t("./isSymbol"),s=NaN,o=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,h=/^0b[01]+$/i,l=/^0o[0-7]+$/i,c=parseInt;e.exports=function(t){if("number"==typeof t)return t;if(n(t))return s;if(r(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=r(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(o,"");var i=h.test(t);return i||l.test(t)?c(t.slice(2),i?2:8):a.test(t)?s:+t}},{"./isObject":50,"./isSymbol":52}],59:[function(t,e,i){function r(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}var n=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable;e.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},i=0;i<10;i++)e["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(t){r[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var i,o,a=r(t),h=1;h<arguments.length;h++){for(var l in i=Object(arguments[h]))n.call(i,l)&&(a[l]=i[l]);if(Object.getOwnPropertySymbols){o=Object.getOwnPropertySymbols(i);for(var c=0;c<o.length;c++)s.call(i,o[c])&&(a[o[c]]=i[o[c]])}}return a}},{}],60:[function(t,e,i){(function(t){function e(t,e){for(var i=0,r=t.length-1;r>=0;r--){var n=t[r];"."===n?t.splice(r,1):".."===n?(t.splice(r,1),i++):i&&(t.splice(r,1),i--)}if(e)for(;i--;i)t.unshift("..");return t}function r(t,e){if(t.filter)return t.filter(e);for(var i=[],r=0;r<t.length;r++)e(t[r],r,t)&&i.push(t[r]);return i}var n=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,s=function(t){return n.exec(t).slice(1)};i.resolve=function(){for(var i="",n=!1,s=arguments.length-1;s>=-1&&!n;s--){var o=s>=0?arguments[s]:t.cwd();if("string"!=typeof o)throw new TypeError("Arguments to path.resolve must be strings");o&&(i=o+"/"+i,n="/"===o.charAt(0))}return(n?"/":"")+(i=e(r(i.split("/"),(function(t){return!!t})),!n).join("/"))||"."},i.normalize=function(t){var n=i.isAbsolute(t),s="/"===o(t,-1);return(t=e(r(t.split("/"),(function(t){return!!t})),!n).join("/"))||n||(t="."),t&&s&&(t+="/"),(n?"/":"")+t},i.isAbsolute=function(t){return"/"===t.charAt(0)},i.join=function(){var t=Array.prototype.slice.call(arguments,0);return i.normalize(r(t,(function(t,e){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t})).join("/"))},i.relative=function(t,e){function r(t){for(var e=0;e<t.length&&""===t[e];e++);for(var i=t.length-1;i>=0&&""===t[i];i--);return e>i?[]:t.slice(e,i-e+1)}t=i.resolve(t).substr(1),e=i.resolve(e).substr(1);for(var n=r(t.split("/")),s=r(e.split("/")),o=Math.min(n.length,s.length),a=o,h=0;h<o;h++)if(n[h]!==s[h]){a=h;break}var l=[];for(h=a;h<n.length;h++)l.push("..");return(l=l.concat(s.slice(a))).join("/")},i.sep="/",i.delimiter=":",i.dirname=function(t){var e=s(t),i=e[0],r=e[1];return i||r?(r&&(r=r.substr(0,r.length-1)),i+r):"."},i.basename=function(t,e){var i=s(t)[2];return e&&i.substr(-1*e.length)===e&&(i=i.substr(0,i.length-e.length)),i},i.extname=function(t){return s(t)[3]};var o="b"==="ab".substr(-1)?function(t,e,i){return t.substr(e,i)}:function(t,e,i){return e<0&&(e=t.length+e),t.substr(e,i)}}).call(this,t("_process"))},{_process:61}],61:[function(t,e,i){function r(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function s(t){if(c===setTimeout)return setTimeout(t,0);if((c===r||!c)&&setTimeout)return c=setTimeout,setTimeout(t,0);try{return c(t,0)}catch(e){try{return c.call(null,t,0)}catch(e){return c.call(this,t,0)}}}function o(){g&&p&&(g=!1,p.length?f=p.concat(f):v=-1,f.length&&a())}function a(){if(!g){var t=s(o);g=!0;for(var e=f.length;e;){for(p=f,f=[];++v<e;)p&&p[v].run();v=-1,e=f.length}p=null,g=!1,function(t){if(u===clearTimeout)return clearTimeout(t);if((u===n||!u)&&clearTimeout)return u=clearTimeout,clearTimeout(t);try{u(t)}catch(e){try{return u.call(null,t)}catch(e){return u.call(this,t)}}}(t)}}function h(t,e){this.fun=t,this.array=e}function l(){}var c,u,d=e.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:r}catch(t){c=r}try{u="function"==typeof clearTimeout?clearTimeout:n}catch(t){u=n}}();var p,f=[],g=!1,v=-1;d.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];f.push(new h(t,e)),1!==f.length||g||s(a)},h.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=l,d.addListener=l,d.once=l,d.off=l,d.removeListener=l,d.removeAllListeners=l,d.emit=l,d.binding=function(t){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(t){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},{}],62:[function(e,i,r){(function(t){!function(e){function n(t){throw new RangeError(R[t])}function s(t,e){for(var i=t.length,r=[];i--;)r[i]=e(t[i]);return r}function o(t,e){var i=t.split("@"),r="";return i.length>1&&(r=i[0]+"@",t=i[1]),r+s((t=t.replace(M,".")).split("."),e).join(".")}function a(t){for(var e,i,r=[],n=0,s=t.length;n<s;)(e=t.charCodeAt(n++))>=55296&&e<=56319&&n<s?56320==(64512&(i=t.charCodeAt(n++)))?r.push(((1023&e)<<10)+(1023&i)+65536):(r.push(e),n--):r.push(e);return r}function h(t){return s(t,(function(t){var e="";return t>65535&&(e+=N((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+N(t)})).join("")}function l(t){return t-48<10?t-22:t-65<26?t-65:t-97<26?t-97:_}function c(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function u(t,e,i){var r=0;for(t=i?I(t/w):t>>1,t+=I(t/e);t>P*T>>1;r+=_)t=I(t/P);return I(r+(P+1)*t/(t+E))}function d(t){var e,i,r,s,o,a,c,d,p,f,g=[],v=t.length,m=0,y=C,E=A;for((i=t.lastIndexOf(S))<0&&(i=0),r=0;r<i;++r)t.charCodeAt(r)>=128&&n("not-basic"),g.push(t.charCodeAt(r));for(s=i>0?i+1:0;s<v;){for(o=m,a=1,c=_;s>=v&&n("invalid-input"),((d=l(t.charCodeAt(s++)))>=_||d>I((x-m)/a))&&n("overflow"),m+=d*a,!(d<(p=c<=E?b:c>=E+T?T:c-E));c+=_)a>I(x/(f=_-p))&&n("overflow"),a*=f;E=u(m-o,e=g.length+1,0==o),I(m/e)>x-y&&n("overflow"),y+=I(m/e),m%=e,g.splice(m++,0,y)}return h(g)}function p(t){var e,i,r,s,o,h,l,d,p,f,g,v,m,y,E,w=[];for(v=(t=a(t)).length,e=C,i=0,o=A,h=0;h<v;++h)(g=t[h])<128&&w.push(N(g));for(r=s=w.length,s&&w.push(S);r<v;){for(l=x,h=0;h<v;++h)(g=t[h])>=e&&g<l&&(l=g);for(l-e>I((x-i)/(m=r+1))&&n("overflow"),i+=(l-e)*m,e=l,h=0;h<v;++h)if((g=t[h])<e&&++i>x&&n("overflow"),g==e){for(d=i,p=_;!(d<(f=p<=o?b:p>=o+T?T:p-o));p+=_)E=d-f,y=_-f,w.push(N(c(f+E%y,0))),d=I(E/y);w.push(N(c(d,0))),o=u(i,m,r==s),i=0,++r}++i,++e}return w.join("")}var f="object"==typeof r&&r&&!r.nodeType&&r,g="object"==typeof i&&i&&!i.nodeType&&i,v="object"==typeof t&&t;v.global!==v&&v.window!==v&&v.self!==v||(e=v);var m,y,x=2147483647,_=36,b=1,T=26,E=38,w=700,A=72,C=128,S="-",O=/^xn--/,D=/[^\x20-\x7E]/,M=/[\x2E\u3002\uFF0E\uFF61]/g,R={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},P=_-b,I=Math.floor,N=String.fromCharCode;if(m={version:"1.4.1",ucs2:{decode:a,encode:h},decode:d,encode:p,toASCII:function(t){return o(t,(function(t){return D.test(t)?"xn--"+p(t):t}))},toUnicode:function(t){return o(t,(function(t){return O.test(t)?d(t.slice(4).toLowerCase()):t}))}},f&&g)if(i.exports==f)g.exports=m;else for(y in m)m.hasOwnProperty(y)&&(f[y]=m[y]);else e.punycode=m}(this)}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],63:[function(t,e,i){function r(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.exports=function(t,e,i,s){e=e||"&",i=i||"=";var o={};if("string"!=typeof t||0===t.length)return o;var a=/\+/g;t=t.split(e);var h=1e3;s&&"number"==typeof s.maxKeys&&(h=s.maxKeys);var l=t.length;h>0&&l>h&&(l=h);for(var c=0;c<l;++c){var u,d,p,f,g=t[c].replace(a,"%20"),v=g.indexOf(i);v>=0?(u=g.substr(0,v),d=g.substr(v+1)):(u=g,d=""),p=decodeURIComponent(u),f=decodeURIComponent(d),r(o,p)?n(o[p])?o[p].push(f):o[p]=[o[p],f]:o[p]=f}return o};var n=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},{}],64:[function(t,e,i){function r(t,e){if(t.map)return t.map(e);for(var i=[],r=0;r<t.length;r++)i.push(e(t[r],r));return i}var n=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};e.exports=function(t,e,i,a){return e=e||"&",i=i||"=",null===t&&(t=void 0),"object"==typeof t?r(o(t),(function(o){var a=encodeURIComponent(n(o))+i;return s(t[o])?r(t[o],(function(t){return a+encodeURIComponent(n(t))})).join(e):a+encodeURIComponent(n(t[o]))})).join(e):a?encodeURIComponent(n(a))+i+encodeURIComponent(n(t)):""};var s=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},o=Object.keys||function(t){var e=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.push(i);return e}},{}],65:[function(t,e,i){i.decode=i.parse=t("./decode"),i.encode=i.stringify=t("./encode")},{"./decode":63,"./encode":64}],66:[function(t,e,i){function r(t,e){h.call(this),e=e||l,this.baseUrl=t||"",this.progress=0,this.loading=!1,this._progressChunk=0,this._beforeMiddleware=[],this._afterMiddleware=[],this._boundLoadResource=this._loadResource.bind(this),this._buffer=[],this._numToLoad=0,this._queue=n(this._boundLoadResource,e),this.resources={}}var n=t("async/queue"),s=t("async/eachSeries"),o=t("url"),a=t("./Resource"),h=t("eventemitter3"),l=10;r.prototype=Object.create(h.prototype),r.prototype.constructor=r,e.exports=r,r.prototype.add=r.prototype.enqueue=function(t,e,i,r){if(Array.isArray(t)){for(var n=0;n<t.length;++n)this.add(t[n]);return this}if("object"==typeof t&&(r=e||t.callback||t.onComplete,i=t,e=t.url,t=t.name||t.key||t.url),"string"!=typeof e&&(r=i,i=e,e=t),"string"!=typeof e)throw new Error("No url passed to add resource to loader.");if("function"==typeof i&&(r=i,i=null),this.resources[t])throw new Error('Resource with name "'+t+'" already exists.');return e=this._prepareUrl(e),this.resources[t]=new a(t,e,i),"function"==typeof r&&this.resources[t].once("afterMiddleware",r),this._numToLoad++,this._queue.started?(this._queue.push(this.resources[t]),this._progressChunk=(100-this.progress)/(this._queue.length()+this._queue.running())):(this._buffer.push(this.resources[t]),this._progressChunk=100/this._buffer.length),this},r.prototype.before=r.prototype.pre=function(t){return this._beforeMiddleware.push(t),this},r.prototype.after=r.prototype.use=function(t){return this._afterMiddleware.push(t),this},r.prototype.reset=function(){for(var t in this.progress=0,this.loading=!1,this._progressChunk=0,this._buffer.length=0,this._numToLoad=0,this._queue.kill(),this._queue.started=!1,this.resources){var e=this.resources[t];e.off("complete",this._onLoad,this),e.isLoading&&e.abort()}return this.resources={},this},r.prototype.load=function(t){if("function"==typeof t&&this.once("complete",t),this._queue.started)return this;this.emit("start",this),this.loading=!0;for(var e=0;e<this._buffer.length;++e)this._queue.push(this._buffer[e]);return this._buffer.length=0,this},r.prototype._prepareUrl=function(t){var e=o.parse(t);return e.protocol||!e.pathname||0===e.pathname.indexOf("//")?t:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&"/"!==t.charAt(0)?this.baseUrl+"/"+t:this.baseUrl+t},r.prototype._loadResource=function(t,e){var i=this;t._dequeue=e,s(this._beforeMiddleware,(function(e,r){e.call(i,t,(function(){r(t.isComplete?{}:null)}))}),(function(){t.isComplete?i._onLoad(t):(t.once("complete",i._onLoad,i),t.load())}))},r.prototype._onComplete=function(){this.loading=!1,this.emit("complete",this,this.resources)},r.prototype._onLoad=function(t){var e=this;s(this._afterMiddleware,(function(i,r){i.call(e,t,r)}),(function(){t.emit("afterMiddleware",t),e._numToLoad--,e.progress+=e._progressChunk,e.emit("progress",e,t),t.error?e.emit("error",t.error,e,t):e.emit("load",e,t),0===e._numToLoad&&(e.progress=100,e._onComplete())})),t._dequeue()},r.LOAD_TYPE=a.LOAD_TYPE,r.XHR_RESPONSE_TYPE=a.XHR_RESPONSE_TYPE},{"./Resource":67,"async/eachSeries":18,"async/queue":29,eventemitter3:32,url:72}],67:[function(t,e,i){function r(t,e,i){if(o.call(this),i=i||{},"string"!=typeof t||"string"!=typeof e)throw new Error("Both name and url are required for constructing a resource.");this.name=t,this.url=e,this.isDataUrl=0===this.url.indexOf("data:"),this.data=null,this.crossOrigin=!0===i.crossOrigin?"anonymous":i.crossOrigin,this.loadType=i.loadType||this._determineLoadType(),this.xhrType=i.xhrType,this.metadata=i.metadata||{},this.error=null,this.xhr=null,this.isJson=!1,this.isXml=!1,this.isImage=!1,this.isAudio=!1,this.isVideo=!1,this.isComplete=!1,this.isLoading=!1,this._dequeue=null,this._boundComplete=this.complete.bind(this),this._boundOnError=this._onError.bind(this),this._boundOnProgress=this._onProgress.bind(this),this._boundXhrOnError=this._xhrOnError.bind(this),this._boundXhrOnAbort=this._xhrOnAbort.bind(this),this._boundXhrOnLoad=this._xhrOnLoad.bind(this),this._boundXdrOnTimeout=this._xdrOnTimeout.bind(this)}function n(t){return t.toString().replace("object ","")}function s(t,e,i){e&&0===e.indexOf(".")&&(e=e.substring(1)),e&&(t[e]=i)}var o=t("eventemitter3"),a=t("url"),h=!(!window.XDomainRequest||"withCredentials"in new XMLHttpRequest),l=null;r.prototype=Object.create(o.prototype),r.prototype.constructor=r,e.exports=r,r.prototype.complete=function(){if(this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError,!1),this.data.removeEventListener("load",this._boundComplete,!1),this.data.removeEventListener("progress",this._boundOnProgress,!1),this.data.removeEventListener("canplaythrough",this._boundComplete,!1)),this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError,!1),this.xhr.removeEventListener("abort",this._boundXhrOnAbort,!1),this.xhr.removeEventListener("progress",this._boundOnProgress,!1),this.xhr.removeEventListener("load",this._boundXhrOnLoad,!1)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null)),this.isComplete)throw new Error("Complete called again for an already completed resource.");this.isComplete=!0,this.isLoading=!1,this.emit("complete",this)},r.prototype.abort=function(t){if(!this.error){if(this.error=new Error(t),this.xhr)this.xhr.abort();else if(this.xdr)this.xdr.abort();else if(this.data)if(void 0!==this.data.src)this.data.src="";else for(;this.data.firstChild;)this.data.removeChild(this.data.firstChild);this.complete()}},r.prototype.load=function(t){if(!this.isLoading)if(this.isComplete){if(t){var e=this;setTimeout((function(){t(e)}),1)}}else switch(t&&this.once("complete",t),this.isLoading=!0,this.emit("start",this),!1!==this.crossOrigin&&"string"==typeof this.crossOrigin||(this.crossOrigin=this._determineCrossOrigin(this.url)),this.loadType){case r.LOAD_TYPE.IMAGE:this._loadElement("image");break;case r.LOAD_TYPE.AUDIO:this._loadSourceElement("audio");break;case r.LOAD_TYPE.VIDEO:this._loadSourceElement("video");break;case r.LOAD_TYPE.XHR:default:h&&this.crossOrigin?this._loadXdr():this._loadXhr()}},r.prototype._loadElement=function(t){this.metadata.loadElement?this.data=this.metadata.loadElement:"image"===t&&void 0!==window.Image?this.data=new Image:this.data=document.createElement(t),this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),this.metadata.skipSource||(this.data.src=this.url);var e="is"+t[0].toUpperCase()+t.substring(1);!1===this[e]&&(this[e]=!0),this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1)},r.prototype._loadSourceElement=function(t){if(this.metadata.loadElement?this.data=this.metadata.loadElement:"audio"===t&&void 0!==window.Audio?this.data=new Audio:this.data=document.createElement(t),null!==this.data){if(!this.metadata.skipSource)if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var e=0;e<this.url.length;++e)this.data.appendChild(this._createSource(t,this.url[e]));else this.data.appendChild(this._createSource(t,this.url));this["is"+t[0].toUpperCase()+t.substring(1)]=!0,this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.data.addEventListener("canplaythrough",this._boundComplete,!1),this.data.load()}else this.abort("Unsupported element "+t)},r.prototype._loadXhr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var t=this.xhr=new XMLHttpRequest;t.open("GET",this.url,!0),this.xhrType===r.XHR_RESPONSE_TYPE.JSON||this.xhrType===r.XHR_RESPONSE_TYPE.DOCUMENT?t.responseType=r.XHR_RESPONSE_TYPE.TEXT:t.responseType=this.xhrType,t.addEventListener("error",this._boundXhrOnError,!1),t.addEventListener("abort",this._boundXhrOnAbort,!1),t.addEventListener("progress",this._boundOnProgress,!1),t.addEventListener("load",this._boundXhrOnLoad,!1),t.send()},r.prototype._loadXdr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var t=this.xhr=new XDomainRequest;t.timeout=5e3,t.onerror=this._boundXhrOnError,t.ontimeout=this._boundXdrOnTimeout,t.onprogress=this._boundOnProgress,t.onload=this._boundXhrOnLoad,t.open("GET",this.url,!0),setTimeout((function(){t.send()}),0)},r.prototype._createSource=function(t,e,i){i||(i=t+"/"+e.substr(e.lastIndexOf(".")+1));var r=document.createElement("source");return r.src=e,r.type=i,r},r.prototype._onError=function(t){this.abort("Failed to load element using "+t.target.nodeName)},r.prototype._onProgress=function(t){t&&t.lengthComputable&&this.emit("progress",this,t.loaded/t.total)},r.prototype._xhrOnError=function(){var t=this.xhr;this.abort(n(t)+" Request failed. Status: "+t.status+', text: "'+t.statusText+'"')},r.prototype._xhrOnAbort=function(){this.abort(n(this.xhr)+" Request was aborted by the user.")},r.prototype._xdrOnTimeout=function(){this.abort(n(this.xhr)+" Request timed out.")},r.prototype._xhrOnLoad=function(){var t=this.xhr,e=void 0===t.status?t.status:200;if(200===e||204===e||0===e&&t.responseText.length>0){if(this.xhrType===r.XHR_RESPONSE_TYPE.TEXT)this.data=t.responseText;else if(this.xhrType===r.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(t.responseText),this.isJson=!0}catch(t){return void this.abort("Error trying to parse loaded json:",t)}else if(this.xhrType===r.XHR_RESPONSE_TYPE.DOCUMENT)try{if(window.DOMParser){var i=new DOMParser;this.data=i.parseFromString(t.responseText,"text/xml")}else{var n=document.createElement("div");n.innerHTML=t.responseText,this.data=n}this.isXml=!0}catch(t){return void this.abort("Error trying to parse loaded xml:",t)}else this.data=t.response||t.responseText;this.complete()}else this.abort("["+t.status+"]"+t.statusText+":"+t.responseURL)},r.prototype._determineCrossOrigin=function(t,e){if(0===t.indexOf("data:"))return"";e=e||window.location,l||(l=document.createElement("a")),l.href=t;var i=!(t=a.parse(l.href)).port&&""===e.port||t.port===e.port;return t.hostname===e.hostname&&i&&t.protocol===e.protocol?"":"anonymous"},r.prototype._determineXhrType=function(){return r._xhrTypeMap[this._getExtension()]||r.XHR_RESPONSE_TYPE.TEXT},r.prototype._determineLoadType=function(){return r._loadTypeMap[this._getExtension()]||r.LOAD_TYPE.XHR},r.prototype._getExtension=function(){var t=this.url,e="";if(this.isDataUrl){var i=t.indexOf("/");e=t.substring(i+1,t.indexOf(";",i))}else{var r=t.indexOf("?");-1!==r&&(t=t.substring(0,r)),e=t.substring(t.lastIndexOf(".")+1)}return e.toLowerCase()},r.prototype._getMimeFromXhrType=function(t){switch(t){case r.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case r.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case r.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case r.XHR_RESPONSE_TYPE.JSON:return"application/json";case r.XHR_RESPONSE_TYPE.DEFAULT:case r.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}},r.LOAD_TYPE={XHR:1,IMAGE:2,AUDIO:3,VIDEO:4},r.XHR_RESPONSE_TYPE={DEFAULT:"text",BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"},r._loadTypeMap={gif:r.LOAD_TYPE.IMAGE,png:r.LOAD_TYPE.IMAGE,bmp:r.LOAD_TYPE.IMAGE,jpg:r.LOAD_TYPE.IMAGE,jpeg:r.LOAD_TYPE.IMAGE,tif:r.LOAD_TYPE.IMAGE,tiff:r.LOAD_TYPE.IMAGE,webp:r.LOAD_TYPE.IMAGE,tga:r.LOAD_TYPE.IMAGE,"svg+xml":r.LOAD_TYPE.IMAGE},r._xhrTypeMap={xhtml:r.XHR_RESPONSE_TYPE.DOCUMENT,html:r.XHR_RESPONSE_TYPE.DOCUMENT,htm:r.XHR_RESPONSE_TYPE.DOCUMENT,xml:r.XHR_RESPONSE_TYPE.DOCUMENT,tmx:r.XHR_RESPONSE_TYPE.DOCUMENT,tsx:r.XHR_RESPONSE_TYPE.DOCUMENT,svg:r.XHR_RESPONSE_TYPE.DOCUMENT,gif:r.XHR_RESPONSE_TYPE.BLOB,png:r.XHR_RESPONSE_TYPE.BLOB,bmp:r.XHR_RESPONSE_TYPE.BLOB,jpg:r.XHR_RESPONSE_TYPE.BLOB,jpeg:r.XHR_RESPONSE_TYPE.BLOB,tif:r.XHR_RESPONSE_TYPE.BLOB,tiff:r.XHR_RESPONSE_TYPE.BLOB,webp:r.XHR_RESPONSE_TYPE.BLOB,tga:r.XHR_RESPONSE_TYPE.BLOB,json:r.XHR_RESPONSE_TYPE.JSON,text:r.XHR_RESPONSE_TYPE.TEXT,txt:r.XHR_RESPONSE_TYPE.TEXT},r.setExtensionLoadType=function(t,e){s(r._loadTypeMap,t,e)},r.setExtensionXhrType=function(t,e){s(r._xhrTypeMap,t,e)}},{eventemitter3:32,url:72}],68:[function(t,e,i){e.exports={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encodeBinary:function(t){for(var e,i="",r=new Array(4),n=0,s=0;n<t.length;){for(e=new Array(3),s=0;s<e.length;s++)n<t.length?e[s]=255&t.charCodeAt(n++):e[s]=0;switch(r[0]=e[0]>>2,r[1]=(3&e[0])<<4|e[1]>>4,r[2]=(15&e[1])<<2|e[2]>>6,r[3]=63&e[2],n-(t.length-1)){case 2:r[3]=64,r[2]=64;break;case 1:r[3]=64}for(s=0;s<r.length;s++)i+=this._keyStr.charAt(r[s])}return i}}},{}],69:[function(t,e,i){e.exports=t("./Loader"),e.exports.Resource=t("./Resource"),e.exports.middleware={caching:{memory:t("./middlewares/caching/memory")},parsing:{blob:t("./middlewares/parsing/blob")}}},{"./Loader":66,"./Resource":67,"./middlewares/caching/memory":70,"./middlewares/parsing/blob":71}],70:[function(t,e,i){var r={};e.exports=function(){return function(t,e){r[t.url]?(t.data=r[t.url],t.complete()):t.once("complete",(function(){r[this.url]=this.data})),e()}}},{}],71:[function(t,e,i){var r=t("../../Resource"),n=t("../../b64"),s=window.URL||window.webkitURL;e.exports=function(){return function(t,e){if(t.data){if(t.xhr&&t.xhrType===r.XHR_RESPONSE_TYPE.BLOB)if(window.Blob&&"string"!=typeof t.data){if(0===t.data.type.indexOf("image")){var i=s.createObjectURL(t.data);return t.blob=t.data,t.data=new Image,t.data.src=i,t.isImage=!0,void(t.data.onload=function(){s.revokeObjectURL(i),t.data.onload=null,e()})}}else{var o=t.xhr.getResponseHeader("content-type");if(o&&0===o.indexOf("image"))return t.data=new Image,t.data.src="data:"+o+";base64,"+n.encodeBinary(t.xhr.responseText),t.isImage=!0,void(t.data.onload=function(){t.data.onload=null,e()})}e()}else e()}}},{"../../Resource":67,"../../b64":68}],72:[function(t,e,i){function r(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function n(t,e,i){if(t&&o.isObject(t)&&t instanceof r)return t;var n=new r;return n.parse(t,e,i),n}var s=t("punycode"),o=t("./util");i.parse=n,i.resolve=function(t,e){return n(t,!1,!0).resolve(e)},i.resolveObject=function(t,e){return t?n(t,!1,!0).resolveObject(e):e},i.format=function(t){return o.isString(t)&&(t=n(t)),t instanceof r?t.format():r.prototype.format.call(t)},i.Url=r;var a=/^([a-z0-9.+-]+:)/i,h=/:[0-9]*$/,l=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),u=["'"].concat(c),d=["%","/","?",";","#"].concat(u),p=["/","?","#"],f=/^[+a-z0-9A-Z_-]{0,63}$/,g=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,v={javascript:!0,"javascript:":!0},m={javascript:!0,"javascript:":!0},y={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},x=t("querystring");r.prototype.parse=function(t,e,i){if(!o.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var r=t.indexOf("?"),n=-1!==r&&r<t.indexOf("#")?"?":"#",h=t.split(n);h[0]=h[0].replace(/\\/g,"/");var c=t=h.join(n);if(c=c.trim(),!i&&1===t.split("#").length){var _=l.exec(c);if(_)return this.path=c,this.href=c,this.pathname=_[1],_[2]?(this.search=_[2],this.query=e?x.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var b=a.exec(c);if(b){var T=(b=b[0]).toLowerCase();this.protocol=T,c=c.substr(b.length)}if(i||b||c.match(/^\/\/[^@\/]+@[^@\/]+/)){var E="//"===c.substr(0,2);!E||b&&m[b]||(c=c.substr(2),this.slashes=!0)}if(!m[b]&&(E||b&&!y[b])){for(var w=-1,A=0;A<p.length;A++){-1!==(O=c.indexOf(p[A]))&&(-1===w||O<w)&&(w=O)}var C,S;-1!==(S=-1===w?c.lastIndexOf("@"):c.lastIndexOf("@",w))&&(C=c.slice(0,S),c=c.slice(S+1),this.auth=decodeURIComponent(C)),w=-1;for(A=0;A<d.length;A++){var O;-1!==(O=c.indexOf(d[A]))&&(-1===w||O<w)&&(w=O)}-1===w&&(w=c.length),this.host=c.slice(0,w),c=c.slice(w),this.parseHost(),this.hostname=this.hostname||"";var D="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!D)for(var M=this.hostname.split(/\./),R=(A=0,M.length);A<R;A++){var P=M[A];if(P&&!P.match(f)){for(var I="",N=0,L=P.length;N<L;N++)I+=P.charCodeAt(N)>127?"x":P[N];if(!I.match(f)){var k=M.slice(0,A),F=M.slice(A+1),B=P.match(g);B&&(k.push(B[1]),F.unshift(B[2])),F.length&&(c="/"+F.join(".")+c),this.hostname=k.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),D||(this.hostname=s.toASCII(this.hostname));var U=this.port?":"+this.port:"",V=this.hostname||"";this.host=V+U,this.href+=this.host,D&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==c[0]&&(c="/"+c))}if(!v[T])for(A=0,R=u.length;A<R;A++){var j=u[A];if(-1!==c.indexOf(j)){var H=encodeURIComponent(j);H===j&&(H=escape(j)),c=c.split(j).join(H)}}var W=c.indexOf("#");-1!==W&&(this.hash=c.substr(W),c=c.slice(0,W));var K=c.indexOf("?");if(-1!==K?(this.search=c.substr(K),this.query=c.substr(K+1),e&&(this.query=x.parse(this.query)),c=c.slice(0,K)):e&&(this.search="",this.query={}),c&&(this.pathname=c),y[T]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){U=this.pathname||"";var G=this.search||"";this.path=U+G}return this.href=this.format(),this},r.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",i=this.pathname||"",r=this.hash||"",n=!1,s="";this.host?n=t+this.host:this.hostname&&(n=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&o.isObject(this.query)&&Object.keys(this.query).length&&(s=x.stringify(this.query));var a=this.search||s&&"?"+s||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||y[e])&&!1!==n?(n="//"+(n||""),i&&"/"!==i.charAt(0)&&(i="/"+i)):n||(n=""),r&&"#"!==r.charAt(0)&&(r="#"+r),a&&"?"!==a.charAt(0)&&(a="?"+a),e+n+(i=i.replace(/[?#]/g,(function(t){return encodeURIComponent(t)})))+(a=a.replace("#","%23"))+r},r.prototype.resolve=function(t){return this.resolveObject(n(t,!1,!0)).format()},r.prototype.resolveObject=function(t){if(o.isString(t)){var e=new r;e.parse(t,!1,!0),t=e}for(var i=new r,n=Object.keys(this),s=0;s<n.length;s++){var a=n[s];i[a]=this[a]}if(i.hash=t.hash,""===t.href)return i.href=i.format(),i;if(t.slashes&&!t.protocol){for(var h=Object.keys(t),l=0;l<h.length;l++){var c=h[l];"protocol"!==c&&(i[c]=t[c])}return y[i.protocol]&&i.hostname&&!i.pathname&&(i.path=i.pathname="/"),i.href=i.format(),i}if(t.protocol&&t.protocol!==i.protocol){if(!y[t.protocol]){for(var u=Object.keys(t),d=0;d<u.length;d++){var p=u[d];i[p]=t[p]}return i.href=i.format(),i}if(i.protocol=t.protocol,t.host||m[t.protocol])i.pathname=t.pathname;else{for(var f=(t.pathname||"").split("/");f.length&&!(t.host=f.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==f[0]&&f.unshift(""),f.length<2&&f.unshift(""),i.pathname=f.join("/")}if(i.search=t.search,i.query=t.query,i.host=t.host||"",i.auth=t.auth,i.hostname=t.hostname||t.host,i.port=t.port,i.pathname||i.search){var g=i.pathname||"",v=i.search||"";i.path=g+v}return i.slashes=i.slashes||t.slashes,i.href=i.format(),i}var x=i.pathname&&"/"===i.pathname.charAt(0),_=t.host||t.pathname&&"/"===t.pathname.charAt(0),b=_||x||i.host&&t.pathname,T=b,E=i.pathname&&i.pathname.split("/")||[],w=(f=t.pathname&&t.pathname.split("/")||[],i.protocol&&!y[i.protocol]);if(w&&(i.hostname="",i.port=null,i.host&&(""===E[0]?E[0]=i.host:E.unshift(i.host)),i.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===f[0]?f[0]=t.host:f.unshift(t.host)),t.host=null),b=b&&(""===f[0]||""===E[0])),_)i.host=t.host||""===t.host?t.host:i.host,i.hostname=t.hostname||""===t.hostname?t.hostname:i.hostname,i.search=t.search,i.query=t.query,E=f;else if(f.length)E||(E=[]),E.pop(),E=E.concat(f),i.search=t.search,i.query=t.query;else if(!o.isNullOrUndefined(t.search)){if(w)i.hostname=i.host=E.shift(),(D=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=D.shift(),i.host=i.hostname=D.shift());return i.search=t.search,i.query=t.query,o.isNull(i.pathname)&&o.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i}if(!E.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var A=E.slice(-1)[0],C=(i.host||t.host||E.length>1)&&("."===A||".."===A)||""===A,S=0,O=E.length;O>=0;O--)"."===(A=E[O])?E.splice(O,1):".."===A?(E.splice(O,1),S++):S&&(E.splice(O,1),S--);if(!b&&!T)for(;S--;S)E.unshift("..");!b||""===E[0]||E[0]&&"/"===E[0].charAt(0)||E.unshift(""),C&&"/"!==E.join("/").substr(-1)&&E.push("");var D,M=""===E[0]||E[0]&&"/"===E[0].charAt(0);w&&(i.hostname=i.host=M?"":E.length?E.shift():"",(D=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=D.shift(),i.host=i.hostname=D.shift()));return(b=b||i.host&&E.length)&&!M&&E.unshift(""),E.length?i.pathname=E.join("/"):(i.pathname=null,i.path=null),o.isNull(i.pathname)&&o.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=t.auth||i.auth,i.slashes=i.slashes||t.slashes,i.href=i.format(),i},r.prototype.parseHost=function(){var t=this.host,e=h.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}},{"./util":73,punycode:62,querystring:65}],73:[function(t,e,i){e.exports={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}}},{}],74:[function(t,e,i){function r(t){!s.tablet&&!s.phone||navigator.isCocoonJS||this.createTouchHook();var e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.position="absolute",e.style.top=0,e.style.left=0,e.style.zIndex=2,this.div=e,this.pool=[],this.renderId=0,this.debug=!1,this.renderer=t,this.children=[],this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this.isActive=!1,this.isMobileAccessabillity=!1,window.addEventListener("keydown",this._onKeyDown,!1)}var n=t("../core"),s=t("ismobilejs");Object.assign(n.DisplayObject.prototype,t("./accessibleTarget")),r.prototype.constructor=r,e.exports=r,r.prototype.createTouchHook=function(){var t=document.createElement("button");t.style.width="1px",t.style.height="1px",t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.style.zIndex=2,t.style.backgroundColor="#FF0000",t.title="HOOK DIV",t.addEventListener("focus",function(){this.isMobileAccessabillity=!0,this.activate(),document.body.removeChild(t)}.bind(this)),document.body.appendChild(t)},r.prototype.activate=function(){this.isActive||(this.isActive=!0,window.document.addEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode&&this.renderer.view.parentNode.appendChild(this.div))},r.prototype.deactivate=function(){this.isActive&&!this.isMobileAccessabillity&&(this.isActive=!1,window.document.removeEventListener("mousemove",this._onMouseMove),window.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode&&this.div.parentNode.removeChild(this.div))},r.prototype.updateAccessibleObjects=function(t){if(t.visible){t.accessible&&t.interactive&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);for(var e=t.children,i=e.length-1;i>=0;i--)this.updateAccessibleObjects(e[i])}},r.prototype.update=function(){if(this.renderer.renderingToScreen){this.updateAccessibleObjects(this.renderer._lastObjectRendered);var t=this.renderer.view.getBoundingClientRect(),e=t.width/this.renderer.width,i=t.height/this.renderer.height,r=this.div;r.style.left=t.left+"px",r.style.top=t.top+"px",r.style.width=this.renderer.width+"px",r.style.height=this.renderer.height+"px";for(var s=0;s<this.children.length;s++){var o=this.children[s];if(o.renderId!==this.renderId)o._accessibleActive=!1,n.utils.removeItems(this.children,s,1),this.div.removeChild(o._accessibleDiv),this.pool.push(o._accessibleDiv),o._accessibleDiv=null,s--,0===this.children.length&&this.deactivate();else{r=o._accessibleDiv;var a=o.hitArea,h=o.worldTransform;o.hitArea?(r.style.left=(h.tx+a.x*h.a)*e+"px",r.style.top=(h.ty+a.y*h.d)*i+"px",r.style.width=a.width*h.a*e+"px",r.style.height=a.height*h.d*i+"px"):(a=o.getBounds(),this.capHitArea(a),r.style.left=a.x*e+"px",r.style.top=a.y*i+"px",r.style.width=a.width*e+"px",r.style.height=a.height*i+"px")}}this.renderId++}},r.prototype.capHitArea=function(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0),t.x+t.width>this.renderer.width&&(t.width=this.renderer.width-t.x),t.y+t.height>this.renderer.height&&(t.height=this.renderer.height-t.y)},r.prototype.addChild=function(t){var e=this.pool.pop();e||((e=document.createElement("button")).style.width="100px",e.style.height="100px",e.style.backgroundColor=this.debug?"rgba(255,0,0,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=2,e.style.borderStyle="none",e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),t.accessibleTitle?e.title=t.accessibleTitle:t.accessibleTitle||t.accessibleHint||(e.title="displayObject "+this.tabIndex),t.accessibleHint&&e.setAttribute("aria-label",t.accessibleHint),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex},r.prototype._onClick=function(t){var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"click",e.eventData)},r.prototype._onFocus=function(t){var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"mouseover",e.eventData)},r.prototype._onFocusOut=function(t){var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"mouseout",e.eventData)},r.prototype._onKeyDown=function(t){9===t.keyCode&&this.activate()},r.prototype._onMouseMove=function(){this.deactivate()},r.prototype.destroy=function(){this.div=null;for(var t=0;t<this.children.length;t++)this.children[t].div=null;window.document.removeEventListener("mousemove",this._onMouseMove),window.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null},n.WebGLRenderer.registerPlugin("accessibility",r),n.CanvasRenderer.registerPlugin("accessibility",r)},{"../core":97,"./accessibleTarget":75,ismobilejs:33}],75:[function(t,e,i){e.exports={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:!1}},{}],76:[function(t,e,i){e.exports={accessibleTarget:t("./accessibleTarget"),AccessibilityManager:t("./AccessibilityManager")}},{"./AccessibilityManager":74,"./accessibleTarget":75}],77:[function(t,e,i){function r(t){if(t instanceof Array){if("precision"!==t[0].substring(0,9)){var e=t.slice(0);return e.unshift("precision "+s.PRECISION.DEFAULT+" float;"),e}}else if("precision"!==t.substring(0,9))return"precision "+s.PRECISION.DEFAULT+" float;\n"+t;return t}var n=t("pixi-gl-core").GLShader,s=t("./const"),o=function(t,e,i,s){n.call(this,t,r(e),r(i),s)};(o.prototype=Object.create(n.prototype)).constructor=o,e.exports=o},{"./const":78,"pixi-gl-core":7}],78:[function(t,e,i){var r={VERSION:"4.0.2",PI_2:2*Math.PI,RAD_TO_DEG:180/Math.PI,DEG_TO_RAD:Math.PI/180,TARGET_FPMS:.06,RENDERER_TYPE:{UNKNOWN:0,WEBGL:1,CANVAS:2},BLEND_MODES:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},DRAW_MODES:{POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},SCALE_MODES:{DEFAULT:0,LINEAR:0,NEAREST:1},WRAP_MODES:{DEFAULT:0,CLAMP:0,REPEAT:1,MIRRORED_REPEAT:2},GC_MODES:{DEFAULT:0,AUTO:0,MANUAL:1},MIPMAP_TEXTURES:!0,RETINA_PREFIX:/@(.+)x/,RESOLUTION:1,FILTER_RESOLUTION:1,DEFAULT_RENDER_OPTIONS:{view:null,resolution:1,antialias:!1,forceFXAA:!1,autoResize:!1,transparent:!1,backgroundColor:0,clearBeforeRender:!0,preserveDrawingBuffer:!1,roundPixels:!1},SHAPES:{POLY:0,RECT:1,CIRC:2,ELIP:3,RREC:4},PRECISION:{DEFAULT:"mediump",LOW:"lowp",MEDIUM:"mediump",HIGH:"highp"},TRANSFORM_MODE:{DEFAULT:0,STATIC:0,DYNAMIC:1},TEXT_GRADIENT:{LINEAR_VERTICAL:0,LINEAR_HORIZONTAL:1},SPRITE_BATCH_SIZE:4096,SPRITE_MAX_TEXTURES:t("./utils/maxRecommendedTextures")(32)};e.exports=r},{"./utils/maxRecommendedTextures":152}],79:[function(t,e,i){function r(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null}var n=t("../math").Rectangle;r.prototype.constructor=r,e.exports=r,r.prototype.isEmpty=function(){return this.minX>this.maxX||this.minY>this.maxY},r.prototype.clear=function(){this.updateID++,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0},r.prototype.getRectangle=function(t){return this.minX>this.maxX||this.minY>this.maxY?n.EMPTY:((t=t||new n(0,0,1,1)).x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)},r.prototype.addPoint=function(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)},r.prototype.addQuad=function(t){var e=this.minX,i=this.minY,r=this.maxX,n=this.maxY,s=t[0],o=t[1];e=s<e?s:e,i=o<i?o:i,r=s>r?s:r,n=o>n?o:n,e=(s=t[2])<e?s:e,i=(o=t[3])<i?o:i,r=s>r?s:r,n=o>n?o:n,e=(s=t[4])<e?s:e,i=(o=t[5])<i?o:i,r=s>r?s:r,n=o>n?o:n,e=(s=t[6])<e?s:e,i=(o=t[7])<i?o:i,r=s>r?s:r,n=o>n?o:n,this.minX=e,this.minY=i,this.maxX=r,this.maxY=n},r.prototype.addFrame=function(t,e,i,r,n){var s=t.worldTransform,o=s.a,a=s.b,h=s.c,l=s.d,c=s.tx,u=s.ty,d=this.minX,p=this.minY,f=this.maxX,g=this.maxY,v=o*e+h*i+c,m=a*e+l*i+u;d=v<d?v:d,p=m<p?m:p,f=v>f?v:f,g=m>g?m:g,d=(v=o*r+h*i+c)<d?v:d,p=(m=a*r+l*i+u)<p?m:p,f=v>f?v:f,g=m>g?m:g,d=(v=o*e+h*n+c)<d?v:d,p=(m=a*e+l*n+u)<p?m:p,f=v>f?v:f,g=m>g?m:g,d=(v=o*r+h*n+c)<d?v:d,p=(m=a*r+l*n+u)<p?m:p,f=v>f?v:f,g=m>g?m:g,this.minX=d,this.minY=p,this.maxX=f,this.maxY=g},r.prototype.addVertices=function(t,e,i,r){for(var n=t.worldTransform,s=n.a,o=n.b,a=n.c,h=n.d,l=n.tx,c=n.ty,u=this.minX,d=this.minY,p=this.maxX,f=this.maxY,g=i;g<r;g+=2){var v=e[g],m=e[g+1],y=s*v+a*m+l,x=h*m+o*v+c;u=y<u?y:u,d=x<d?x:d,p=y>p?y:p,f=x>f?x:f}this.minX=u,this.minY=d,this.maxX=p,this.maxY=f},r.prototype.addBounds=function(t){var e=this.minX,i=this.minY,r=this.maxX,n=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<i?t.minY:i,this.maxX=t.maxX>r?t.maxX:r,this.maxY=t.maxY>n?t.maxY:n}},{"../math":102}],80:[function(t,e,i){function r(){s.call(this),this.children=[]}var n=t("../utils"),s=t("./DisplayObject");r.prototype=Object.create(s.prototype),r.prototype.constructor=r,e.exports=r,Object.defineProperties(r.prototype,{width:{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(t){var e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t}},height:{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(t){var e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t}}}),r.prototype.onChildrenChange=function(){},r.prototype.addChild=function(t){var e=arguments.length;if(e>1)for(var i=0;i<e;i++)this.addChild(arguments[i]);else t.parent&&t.parent.removeChild(t),t.parent=this,this.transform._parentID=-1,this.children.push(t),this.onChildrenChange(this.children.length-1),t.emit("added",this);return t},r.prototype.addChildAt=function(t,e){if(e>=0&&e<=this.children.length)return t.parent&&t.parent.removeChild(t),t.parent=this,this.children.splice(e,0,t),this.onChildrenChange(e),t.emit("added",this),t;throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length)},r.prototype.swapChildren=function(t,e){if(t!==e){var i=this.getChildIndex(t),r=this.getChildIndex(e);if(i<0||r<0)throw new Error("swapChildren: Both the supplied DisplayObjects must be children of the caller.");this.children[i]=e,this.children[r]=t,this.onChildrenChange(i<r?i:r)}},r.prototype.getChildIndex=function(t){var e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e},r.prototype.setChildIndex=function(t,e){if(e<0||e>=this.children.length)throw new Error("The supplied index is out of bounds");var i=this.getChildIndex(t);n.removeItems(this.children,i,1),this.children.splice(e,0,t),this.onChildrenChange(e)},r.prototype.getChildAt=function(t){if(t<0||t>=this.children.length)throw new Error("getChildAt: Supplied index "+t+" does not exist in the child list, or the supplied DisplayObject is not a child of the caller");return this.children[t]},r.prototype.removeChild=function(t){var e=arguments.length;if(e>1)for(var i=0;i<e;i++)this.removeChild(arguments[i]);else{var r=this.children.indexOf(t);if(-1===r)return;t.parent=null,n.removeItems(this.children,r,1),this.onChildrenChange(r),t.emit("removed",this)}return t},r.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return e.parent=null,n.removeItems(this.children,t,1),this.onChildrenChange(t),e.emit("removed",this),e},r.prototype.removeChildren=function(t,e){var i,r,n=t||0,s="number"==typeof e?e:this.children.length,o=s-n;if(o>0&&o<=s){for(i=this.children.splice(n,o),r=0;r<i.length;++r)i[r].parent=null;for(this.onChildrenChange(t),r=0;r<i.length;++r)i[r].emit("removed",this);return i}if(0===o&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},r.prototype.updateTransform=function(){if(this._boundsID++,this.visible){this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var t=0,e=this.children.length;t<e;++t)this.children[t].updateTransform()}},r.prototype.containerUpdateTransform=r.prototype.updateTransform,r.prototype.calculateBounds=function(){if(this._bounds.clear(),this.visible){this._calculateBounds();for(var t=0;t<this.children.length;t++){var e=this.children[t];e.calculateBounds(),this._bounds.addBounds(e._bounds)}this._boundsID=this._lastBoundsID}},r.prototype._calculateBounds=function(){},r.prototype.renderWebGL=function(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this._filters)this.renderAdvancedWebGL(t);else{this._renderWebGL(t);for(var e=0,i=this.children.length;e<i;++e)this.children[e].renderWebGL(t)}},r.prototype.renderAdvancedWebGL=function(t){t.currentRenderer.flush();var e,i,r=this._filters,n=this._mask;if(r){for(this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0,e=0;e<r.length;e++)r[e].enabled&&this._enabledFilters.push(r[e]);this._enabledFilters.length&&t.filterManager.pushFilter(this,this._enabledFilters)}for(n&&t.maskManager.pushMask(this,this._mask),t.currentRenderer.start(),this._renderWebGL(t),e=0,i=this.children.length;e<i;e++)this.children[e].renderWebGL(t);t.currentRenderer.flush(),n&&t.maskManager.popMask(this,this._mask),r&&this._enabledFilters&&this._enabledFilters.length&&t.filterManager.popFilter(),t.currentRenderer.start()},r.prototype._renderWebGL=function(t){},r.prototype._renderCanvas=function(t){},r.prototype.renderCanvas=function(t){if(this.visible&&!(this.alpha<=0)&&this.renderable){this._mask&&t.maskManager.pushMask(this._mask),this._renderCanvas(t);for(var e=0,i=this.children.length;e<i;++e)this.children[e].renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},r.prototype.destroy=function(t){s.prototype.destroy.call(this);var e="boolean"==typeof t?t:t&&t.children,i=this.children;if(this.children=null,e)for(var r=i.length-1;r>=0;r--){var n=i[r];n.parent=null,n.destroy(t)}}},{"../utils":151,"./DisplayObject":81}],81:[function(t,e,i){function r(){n.call(this);var t=s.TRANSFORM_MODE.DEFAULT===s.TRANSFORM_MODE.STATIC?o:a;this.transform=new t,this.alpha=1,this.visible=!0,this.renderable=!0,this.parent=null,this.worldAlpha=1,this.filterArea=null,this._filters=null,this._enabledFilters=null,this._bounds=new h,this._boundsID=0,this._lastBoundsID=-1,this._boundsRect=null,this._localBoundsRect=null,this._mask=null}var n=t("eventemitter3"),s=t("../const"),o=t("./TransformStatic"),a=t("./Transform"),h=t("./Bounds"),l=t("../math"),c=new r;r.prototype=Object.create(n.prototype),r.prototype.constructor=r,e.exports=r,Object.defineProperties(r.prototype,{x:{get:function(){return this.position.x},set:function(t){this.transform.position.x=t}},y:{get:function(){return this.position.y},set:function(t){this.transform.position.y=t}},worldTransform:{get:function(){return this.transform.worldTransform}},localTransform:{get:function(){return this.transform.localTransform}},position:{get:function(){return this.transform.position},set:function(t){this.transform.position.copy(t)}},scale:{get:function(){return this.transform.scale},set:function(t){this.transform.scale.copy(t)}},pivot:{get:function(){return this.transform.pivot},set:function(t){this.transform.pivot.copy(t)}},skew:{get:function(){return this.transform.skew},set:function(t){this.transform.skew.copy(t)}},rotation:{get:function(){return this.transform.rotation},set:function(t){this.transform.rotation=t}},worldVisible:{get:function(){var t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}},mask:{get:function(){return this._mask},set:function(t){this._mask&&(this._mask.renderable=!0),this._mask=t,this._mask&&(this._mask.renderable=!1)}},filters:{get:function(){return this._filters&&this._filters.slice()},set:function(t){this._filters=t&&t.slice()}}}),r.prototype.updateTransform=function(){this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha,this._bounds.updateID++},r.prototype.displayObjectUpdateTransform=r.prototype.updateTransform,r.prototype._recursivePostUpdateTransform=function(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(c.transform)},r.prototype.getBounds=function(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=c,this.parent.transform._worldID++,this.updateTransform(),this.parent=null)),this._boundsID!==this._lastBoundsID&&this.calculateBounds(),e||(this._boundsRect||(this._boundsRect=new l.Rectangle),e=this._boundsRect),this._bounds.getRectangle(e)},r.prototype.getLocalBounds=function(t){var e=this.transform,i=this.parent;this.parent=null,this.transform=c.transform,t||(this._localBoundsRect||(this._localBoundsRect=new l.Rectangle),t=this._localBoundsRect);var r=this.getBounds(!1,t);return this.parent=i,this.transform=e,r},r.prototype.toGlobal=function(t,e,i){return i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=c,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)},r.prototype.toLocal=function(t,e,i,r){return e&&(t=e.toGlobal(t,i,r)),r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=c,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,i)},r.prototype.renderWebGL=function(t){},r.prototype.renderCanvas=function(t){},r.prototype.setParent=function(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t},r.prototype.setTransform=function(t,e,i,r,n,s,o,a,h){return this.position.x=t||0,this.position.y=e||0,this.scale.x=i||1,this.scale.y=r||1,this.rotation=n||0,this.skew.x=s||0,this.skew.y=o||0,this.pivot.x=a||0,this.pivot.y=h||0,this},r.prototype.destroy=function(){this.removeAllListeners(),this.parent&&this.parent.removeChild(this),this.transform=null,this.parent=null,this._bounds=null,this._currentBounds=null,this._mask=null,this.filterArea=null,this.interactive=!1,this.interactiveChildren=!1}},{"../const":78,"../math":102,"./Bounds":79,"./Transform":82,"./TransformStatic":84,eventemitter3:32}],82:[function(t,e,i){function r(){s.call(this),this.position=new n.Point(0,0),this.scale=new n.Point(1,1),this.skew=new n.ObservablePoint(this.updateSkew,this,0,0),this.pivot=new n.Point(0,0),this._rotation=0,this._sr=Math.sin(0),this._cr=Math.cos(0),this._cy=Math.cos(0),this._sy=Math.sin(0),this._nsx=Math.sin(0),this._cx=Math.cos(0)}var n=t("../math"),s=t("./TransformBase");r.prototype=Object.create(s.prototype),r.prototype.constructor=r,r.prototype.updateSkew=function(){this._cy=Math.cos(this.skew.y),this._sy=Math.sin(this.skew.y),this._nsx=Math.sin(this.skew.x),this._cx=Math.cos(this.skew.x)},r.prototype.updateLocalTransform=function(){var t,e,i,r,n=this.localTransform;t=this._cr*this.scale.x,e=this._sr*this.scale.x,i=-this._sr*this.scale.y,r=this._cr*this.scale.y,n.a=this._cy*t+this._sy*i,n.b=this._cy*e+this._sy*r,n.c=this._nsx*t+this._cx*i,n.d=this._nsx*e+this._cx*r},r.prototype.updateTransform=function(t){var e,i,r,n,s=t.worldTransform,o=this.worldTransform,a=this.localTransform;e=this._cr*this.scale.x,i=this._sr*this.scale.x,r=-this._sr*this.scale.y,n=this._cr*this.scale.y,a.a=this._cy*e+this._sy*r,a.b=this._cy*i+this._sy*n,a.c=this._nsx*e+this._cx*r,a.d=this._nsx*i+this._cx*n,a.tx=this.position.x-(this.pivot.x*a.a+this.pivot.y*a.c),a.ty=this.position.y-(this.pivot.x*a.b+this.pivot.y*a.d),o.a=a.a*s.a+a.b*s.c,o.b=a.a*s.b+a.b*s.d,o.c=a.c*s.a+a.d*s.c,o.d=a.c*s.b+a.d*s.d,o.tx=a.tx*s.a+a.ty*s.c+s.tx,o.ty=a.tx*s.b+a.ty*s.d+s.ty,this._worldID++},r.prototype.setFromMatrix=function(t){t.decompose(this)},Object.defineProperties(r.prototype,{rotation:{get:function(){return this._rotation},set:function(t){this._rotation=t,this._sr=Math.sin(t),this._cr=Math.cos(t)}}}),e.exports=r},{"../math":102,"./TransformBase":83}],83:[function(t,e,i){function r(){this.worldTransform=new n.Matrix,this.localTransform=new n.Matrix,this._worldID=0}var n=t("../math");r.prototype.constructor=r,r.prototype.updateLocalTransform=function(){},r.prototype.updateTransform=function(t){var e=t.worldTransform,i=this.worldTransform,r=this.localTransform;i.a=r.a*e.a+r.b*e.c,i.b=r.a*e.b+r.b*e.d,i.c=r.c*e.a+r.d*e.c,i.d=r.c*e.b+r.d*e.d,i.tx=r.tx*e.a+r.ty*e.c+e.tx,i.ty=r.tx*e.b+r.ty*e.d+e.ty,this._worldID++},r.prototype.updateWorldTransform=r.prototype.updateTransform,r.IDENTITY=new r,e.exports=r},{"../math":102}],84:[function(t,e,i){function r(){s.call(this),this.position=new n.ObservablePoint(this.onChange,this,0,0),this.scale=new n.ObservablePoint(this.onChange,this,1,1),this.pivot=new n.ObservablePoint(this.onChange,this,0,0),this.skew=new n.ObservablePoint(this.updateSkew,this,0,0),this._rotation=0,this._sr=Math.sin(0),this._cr=Math.cos(0),this._cy=Math.cos(0),this._sy=Math.sin(0),this._nsx=Math.sin(0),this._cx=Math.cos(0),this._localID=0,this._currentLocalID=0}var n=t("../math"),s=t("./TransformBase");r.prototype=Object.create(s.prototype),r.prototype.constructor=r,r.prototype.onChange=function(){this._localID++},r.prototype.updateSkew=function(){this._cy=Math.cos(this.skew._y),this._sy=Math.sin(this.skew._y),this._nsx=Math.sin(this.skew._x),this._cx=Math.cos(this.skew._x),this._localID++},r.prototype.updateLocalTransform=function(){var t,e,i,r,n=this.localTransform;this._localID!==this._currentLocalID&&(t=this._cr*this.scale._x,e=this._sr*this.scale._x,i=-this._sr*this.scale._y,r=this._cr*this.scale._y,n.a=this._cy*t+this._sy*i,n.b=this._cy*e+this._sy*r,n.c=this._nsx*t+this._cx*i,n.d=this._nsx*e+this._cx*r,n.tx=this.position._x-(this.pivot._x*n.a+this.pivot._y*n.c),n.ty=this.position._y-(this.pivot._x*n.b+this.pivot._y*n.d),this._currentLocalID=this._localID,this._parentID=-1)},r.prototype.updateTransform=function(t){var e,i,r,n,s=t.worldTransform,o=this.worldTransform,a=this.localTransform;this._localID!==this._currentLocalID&&(e=this._cr*this.scale._x,i=this._sr*this.scale._x,r=-this._sr*this.scale._y,n=this._cr*this.scale._y,a.a=this._cy*e+this._sy*r,a.b=this._cy*i+this._sy*n,a.c=this._nsx*e+this._cx*r,a.d=this._nsx*i+this._cx*n,a.tx=this.position._x-(this.pivot._x*a.a+this.pivot._y*a.c),a.ty=this.position._y-(this.pivot._x*a.b+this.pivot._y*a.d),this._currentLocalID=this._localID,this._parentID=-1);this._parentID!==t._worldID&&(o.a=a.a*s.a+a.b*s.c,o.b=a.a*s.b+a.b*s.d,o.c=a.c*s.a+a.d*s.c,o.d=a.c*s.b+a.d*s.d,o.tx=a.tx*s.a+a.ty*s.c+s.tx,o.ty=a.tx*s.b+a.ty*s.d+s.ty,this._parentID=t._worldID,this._worldID++)},r.prototype.setFromMatrix=function(t){t.decompose(this),this._localID++},Object.defineProperties(r.prototype,{rotation:{get:function(){return this._rotation},set:function(t){this._rotation=t,this._sr=Math.sin(t),this._cr=Math.cos(t),this._localID++}}}),e.exports=r},{"../math":102,"./TransformBase":83}],85:[function(t,e,i){function r(){s.call(this),this.fillAlpha=1,this.lineWidth=0,this.lineColor=0,this.graphicsData=[],this.tint=16777215,this._prevTint=16777215,this.blendMode=u.BLEND_MODES.NORMAL,this.currentPath=null,this._webGL={},this.isMask=!1,this.boundsPadding=0,this._localBounds=new p,this.dirty=0,this.fastRectDirty=-1,this.clearDirty=0,this.boundsDirty=-1,this.cachedSpriteDirty=!1,this._spriteRect=null,this._fastRect=!1}var n,s=t("../display/Container"),o=t("../textures/RenderTexture"),a=t("../textures/Texture"),h=t("./GraphicsData"),l=t("../sprites/Sprite"),c=t("../math"),u=t("../const"),d=t("../utils"),p=t("../display/Bounds"),f=t("./utils/bezierCurveTo"),g=t("../renderers/canvas/CanvasRenderer"),v=new c.Matrix,m=new c.Point,y=new Float32Array(4),x=new Float32Array(4);r._SPRITE_TEXTURE=null,r.prototype=Object.create(s.prototype),r.prototype.constructor=r,e.exports=r,r.prototype.clone=function(){var t=new r;t.renderable=this.renderable,t.fillAlpha=this.fillAlpha,t.lineWidth=this.lineWidth,t.lineColor=this.lineColor,t.tint=this.tint,t.blendMode=this.blendMode,t.isMask=this.isMask,t.boundsPadding=this.boundsPadding,t.dirty=0,t.cachedSpriteDirty=this.cachedSpriteDirty;for(var e=0;e<this.graphicsData.length;++e)t.graphicsData.push(this.graphicsData[e].clone());return t.currentPath=t.graphicsData[t.graphicsData.length-1],t.updateLocalBounds(),t},r.prototype.lineStyle=function(t,e,i){if(this.lineWidth=t||0,this.lineColor=e||0,this.lineAlpha=void 0===i?1:i,this.currentPath)if(this.currentPath.shape.points.length){var r=new c.Polygon(this.currentPath.shape.points.slice(-2));r.closed=!1,this.drawShape(r)}else this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha;return this},r.prototype.moveTo=function(t,e){var i=new c.Polygon([t,e]);return i.closed=!1,this.drawShape(i),this},r.prototype.lineTo=function(t,e){return this.currentPath.shape.points.push(t,e),this.dirty++,this},r.prototype.quadraticCurveTo=function(t,e,i,r){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var n,s,o=this.currentPath.shape.points;0===o.length&&this.moveTo(0,0);for(var a=o[o.length-2],h=o[o.length-1],l=0,c=1;c<=20;++c)n=a+(t-a)*(l=c/20),s=h+(e-h)*l,o.push(n+(t+(i-t)*l-n)*l,s+(e+(r-e)*l-s)*l);return this.dirty++,this},r.prototype.bezierCurveTo=function(t,e,i,r,n,s){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var o=this.currentPath.shape.points,a=o[o.length-2],h=o[o.length-1];return o.length-=2,f(a,h,t,e,i,r,n,s,o),this.dirty++,this},r.prototype.arcTo=function(t,e,i,r,n){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(t,e):this.moveTo(t,e);var s=this.currentPath.shape.points,o=s[s.length-2],a=s[s.length-1]-e,h=o-t,l=r-e,c=i-t,u=Math.abs(a*c-h*l);if(u<1e-8||0===n)s[s.length-2]===t&&s[s.length-1]===e||s.push(t,e);else{var d=a*a+h*h,p=l*l+c*c,f=a*l+h*c,g=n*Math.sqrt(d)/u,v=n*Math.sqrt(p)/u,m=g*f/d,y=v*f/p,x=g*c+v*h,_=g*l+v*a,b=h*(v+m),T=a*(v+m),E=c*(g+y),w=l*(g+y),A=Math.atan2(T-_,b-x),C=Math.atan2(w-_,E-x);this.arc(x+t,_+e,n,A,C,h*l>c*a)}return this.dirty++,this},r.prototype.arc=function(t,e,i,r,n,s){if(r===n)return this;!(s=s||!1)&&n<=r?n+=2*Math.PI:s&&r<=n&&(r+=2*Math.PI);var o=s?-1*(r-n):n-r,a=40*Math.ceil(Math.abs(o)/(2*Math.PI));if(0===o)return this;var h=t+Math.cos(r)*i,l=e+Math.sin(r)*i;this.currentPath?this.currentPath.shape.points.push(h,l):this.moveTo(h,l);for(var c=this.currentPath.shape.points,u=o/(2*a),d=2*u,p=Math.cos(u),f=Math.sin(u),g=a-1,v=g%1/g,m=0;m<=g;m++){var y=u+r+d*(m+v*m),x=Math.cos(y),_=-Math.sin(y);c.push((p*x+f*_)*i+t,(p*-_+f*x)*i+e)}return this.dirty++,this},r.prototype.beginFill=function(t,e){return this.filling=!0,this.fillColor=t||0,this.fillAlpha=void 0===e?1:e,this.currentPath&&this.currentPath.shape.points.length<=2&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha),this},r.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},r.prototype.drawRect=function(t,e,i,r){return this.drawShape(new c.Rectangle(t,e,i,r)),this},r.prototype.drawRoundedRect=function(t,e,i,r,n){return this.drawShape(new c.RoundedRectangle(t,e,i,r,n)),this},r.prototype.drawCircle=function(t,e,i){return this.drawShape(new c.Circle(t,e,i)),this},r.prototype.drawEllipse=function(t,e,i,r){return this.drawShape(new c.Ellipse(t,e,i,r)),this},r.prototype.drawPolygon=function(t){var e=t,i=!0;if(e instanceof c.Polygon&&(i=e.closed,e=e.points),!Array.isArray(e)){e=new Array(arguments.length);for(var r=0;r<e.length;++r)e[r]=arguments[r]}var n=new c.Polygon(e);return n.closed=i,this.drawShape(n),this},r.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty++,this.clearDirty++,this.graphicsData=[],this},r.prototype.isFastRect=function(){return 1===this.graphicsData.length&&this.graphicsData[0].shape.type===u.SHAPES.RECT&&!this.graphicsData[0].lineWidth},r.prototype._renderWebGL=function(t){this.dirty!==this.fastRectDirty&&(this.fastRectDirty=this.dirty,this._fastRect=this.isFastRect()),this._fastRect?this._renderSpriteRect(t):(t.setObjectRenderer(t.plugins.graphics),t.plugins.graphics.render(this))},r.prototype._renderSpriteRect=function(t){var e=this.graphicsData[0].shape;if(!this._spriteRect){if(!r._SPRITE_TEXTURE){var i=document.createElement("canvas");i.width=10,i.height=10;var n=i.getContext("2d");n.fillStyle="white",n.fillRect(0,0,10,10),r._SPRITE_TEXTURE=a.fromCanvas(i)}this._spriteRect=new l(r._SPRITE_TEXTURE)}if(16777215===this.tint)this._spriteRect.tint=this.graphicsData[0].fillColor;else{var s=y,o=x;d.hex2rgb(this.graphicsData[0].fillColor,s),d.hex2rgb(this.tint,o),s[0]*=o[0],s[1]*=o[1],s[2]*=o[2],this._spriteRect.tint=d.rgb2hex(s)}this._spriteRect.alpha=this.graphicsData[0].fillAlpha,this._spriteRect.worldAlpha=this.worldAlpha*this._spriteRect.alpha,r._SPRITE_TEXTURE._frame.width=e.width,r._SPRITE_TEXTURE._frame.height=e.height,this._spriteRect.transform.worldTransform=this.transform.worldTransform,this._spriteRect.anchor.set(-e.x/e.width,-e.y/e.height),this._spriteRect.onAnchorUpdate(),this._spriteRect._renderWebGL(t)},r.prototype._renderCanvas=function(t){!0!==this.isMask&&t.plugins.graphics.render(this)},r.prototype._calculateBounds=function(){if(this.renderable){this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.updateLocalBounds(),this.dirty++,this.cachedSpriteDirty=!0);var t=this._localBounds;this._bounds.addFrame(this.transform,t.minX,t.minY,t.maxX,t.maxY)}},r.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,m);for(var e=this.graphicsData,i=0;i<e.length;i++){var r=e[i];if(r.fill&&r.shape&&r.shape.contains(m.x,m.y))return!0}return!1},r.prototype.updateLocalBounds=function(){var t=1/0,e=-1/0,i=1/0,r=-1/0;if(this.graphicsData.length)for(var n,s,o,a,h,l,c=0;c<this.graphicsData.length;c++){var d=this.graphicsData[c],p=d.type,f=d.lineWidth;if(n=d.shape,p===u.SHAPES.RECT||p===u.SHAPES.RREC)o=n.x-f/2,a=n.y-f/2,t=o<t?o:t,e=o+(h=n.width+f)>e?o+h:e,i=a<i?a:i,r=a+(l=n.height+f)>r?a+l:r;else if(p===u.SHAPES.CIRC)o=n.x,a=n.y,t=o-(h=n.radius+f/2)<t?o-h:t,e=o+h>e?o+h:e,i=a-(l=n.radius+f/2)<i?a-l:i,r=a+l>r?a+l:r;else if(p===u.SHAPES.ELIP)o=n.x,a=n.y,t=o-(h=n.width+f/2)<t?o-h:t,e=o+h>e?o+h:e,i=a-(l=n.height+f/2)<i?a-l:i,r=a+l>r?a+l:r;else{s=n.points;for(var g=0;g<s.length;g+=2)t=(o=s[g])-f<t?o-f:t,e=o+f>e?o+f:e,i=(a=s[g+1])-f<i?a-f:i,r=a+f>r?a+f:r}}else t=0,e=0,i=0,r=0;var v=this.boundsPadding;this._localBounds.minX=t-v,this._localBounds.maxX=e+2*v,this._localBounds.minY=i-v,this._localBounds.maxY=r+2*v},r.prototype.drawShape=function(t){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop(),this.currentPath=null;var e=new h(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,t);return this.graphicsData.push(e),e.type===u.SHAPES.POLY&&(e.shape.closed=e.shape.closed||this.filling,this.currentPath=e),this.dirty++,e},r.prototype.generateCanvasTexture=function(t,e){e=e||1;var i=this.getLocalBounds(),r=new o.create(i.width*e,i.height*e);n||(n=new g),v.tx=-i.x,v.ty=-i.y,n.render(this,r,!1,v);var s=a.fromCanvas(r.baseTexture._canvasRenderTarget.canvas,t);return s.baseTexture.resolution=e,s},r.prototype.closePath=function(){var t=this.currentPath;return t&&t.shape&&t.shape.close(),this},r.prototype.addHole=function(){var t=this.graphicsData.pop();return this.currentPath=this.graphicsData[this.graphicsData.length-1],this.currentPath.addHole(t.shape),this.currentPath=null,this},r.prototype.destroy=function(){s.prototype.destroy.apply(this,arguments);for(var t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();for(var e in this._webgl)for(var i=0;i<this._webgl[e].data.length;++i)this._webgl[e].data[i].destroy();this._spriteRect&&this._spriteRect.destroy(),this.graphicsData=null,this.currentPath=null,this._webgl=null,this._localBounds=null}},{"../const":78,"../display/Bounds":79,"../display/Container":80,"../math":102,"../renderers/canvas/CanvasRenderer":109,"../sprites/Sprite":133,"../textures/RenderTexture":143,"../textures/Texture":144,"../utils":151,"./GraphicsData":86,"./utils/bezierCurveTo":88}],86:[function(t,e,i){function r(t,e,i,r,n,s,o){this.lineWidth=t,this.lineColor=e,this.lineAlpha=i,this._lineTint=e,this.fillColor=r,this.fillAlpha=n,this._fillTint=r,this.fill=s,this.holes=[],this.shape=o,this.type=o.type}r.prototype.constructor=r,e.exports=r,r.prototype.clone=function(){return new r(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},r.prototype.addHole=function(t){this.holes.push(t)},r.prototype.destroy=function(){this.shape=null,this.holes=null}},{}],87:[function(t,e,i){function r(t){this.renderer=t}var n=t("../../renderers/canvas/CanvasRenderer"),s=t("../../const");r.prototype.constructor=r,e.exports=r,n.registerPlugin("graphics",r),r.prototype.render=function(t){var e=this.renderer,i=e.context,r=t.worldAlpha,n=t.transform.worldTransform,o=e.resolution;this._prevTint!==this.tint&&(this.dirty=!0),i.setTransform(n.a*o,n.b*o,n.c*o,n.d*o,n.tx*o,n.ty*o),t.dirty&&(this.updateGraphicsTint(t),t.dirty=!1),e.setBlendMode(t.blendMode);for(var a=0;a<t.graphicsData.length;a++){var h=t.graphicsData[a],l=h.shape,c=h._fillTint,u=h._lineTint;if(i.lineWidth=h.lineWidth,h.type===s.SHAPES.POLY){i.beginPath(),this.renderPolygon(l.points,l.closed,i);for(var d=0;d<h.holes.length;d++){var p=h.holes[d];this.renderPolygon(p.points,!0,i)}h.fill&&(i.globalAlpha=h.fillAlpha*r,i.fillStyle="#"+("00000"+(0|c).toString(16)).substr(-6),i.fill()),h.lineWidth&&(i.globalAlpha=h.lineAlpha*r,i.strokeStyle="#"+("00000"+(0|u).toString(16)).substr(-6),i.stroke())}else if(h.type===s.SHAPES.RECT)(h.fillColor||0===h.fillColor)&&(i.globalAlpha=h.fillAlpha*r,i.fillStyle="#"+("00000"+(0|c).toString(16)).substr(-6),i.fillRect(l.x,l.y,l.width,l.height)),h.lineWidth&&(i.globalAlpha=h.lineAlpha*r,i.strokeStyle="#"+("00000"+(0|u).toString(16)).substr(-6),i.strokeRect(l.x,l.y,l.width,l.height));else if(h.type===s.SHAPES.CIRC)i.beginPath(),i.arc(l.x,l.y,l.radius,0,2*Math.PI),i.closePath(),h.fill&&(i.globalAlpha=h.fillAlpha*r,i.fillStyle="#"+("00000"+(0|c).toString(16)).substr(-6),i.fill()),h.lineWidth&&(i.globalAlpha=h.lineAlpha*r,i.strokeStyle="#"+("00000"+(0|u).toString(16)).substr(-6),i.stroke());else if(h.type===s.SHAPES.ELIP){var f=2*l.width,g=2*l.height,v=l.x-f/2,m=l.y-g/2;i.beginPath();var y=.5522848,x=f/2*y,_=g/2*y,b=v+f,T=m+g,E=v+f/2,w=m+g/2;i.moveTo(v,w),i.bezierCurveTo(v,w-_,E-x,m,E,m),i.bezierCurveTo(E+x,m,b,w-_,b,w),i.bezierCurveTo(b,w+_,E+x,T,E,T),i.bezierCurveTo(E-x,T,v,w+_,v,w),i.closePath(),h.fill&&(i.globalAlpha=h.fillAlpha*r,i.fillStyle="#"+("00000"+(0|c).toString(16)).substr(-6),i.fill()),h.lineWidth&&(i.globalAlpha=h.lineAlpha*r,i.strokeStyle="#"+("00000"+(0|u).toString(16)).substr(-6),i.stroke())}else if(h.type===s.SHAPES.RREC){var A=l.x,C=l.y,S=l.width,O=l.height,D=l.radius,M=Math.min(S,O)/2|0;D=D>M?M:D,i.beginPath(),i.moveTo(A,C+D),i.lineTo(A,C+O-D),i.quadraticCurveTo(A,C+O,A+D,C+O),i.lineTo(A+S-D,C+O),i.quadraticCurveTo(A+S,C+O,A+S,C+O-D),i.lineTo(A+S,C+D),i.quadraticCurveTo(A+S,C,A+S-D,C),i.lineTo(A+D,C),i.quadraticCurveTo(A,C,A,C+D),i.closePath(),(h.fillColor||0===h.fillColor)&&(i.globalAlpha=h.fillAlpha*r,i.fillStyle="#"+("00000"+(0|c).toString(16)).substr(-6),i.fill()),h.lineWidth&&(i.globalAlpha=h.lineAlpha*r,i.strokeStyle="#"+("00000"+(0|u).toString(16)).substr(-6),i.stroke())}}},r.prototype.updateGraphicsTint=function(t){t._prevTint=t.tint;for(var e=(t.tint>>16&255)/255,i=(t.tint>>8&255)/255,r=(255&t.tint)/255,n=0;n<t.graphicsData.length;n++){var s=t.graphicsData[n],o=0|s.fillColor,a=0|s.lineColor;s._fillTint=((o>>16&255)/255*e*255<<16)+((o>>8&255)/255*i*255<<8)+(255&o)/255*r*255,s._lineTint=((a>>16&255)/255*e*255<<16)+((a>>8&255)/255*i*255<<8)+(255&a)/255*r*255}},r.prototype.renderPolygon=function(t,e,i){i.moveTo(t[0],t[1]);for(var r=1;r<t.length/2;r++)i.lineTo(t[2*r],t[2*r+1]);e&&i.closePath()},r.prototype.destroy=function(){this.renderer=null}},{"../../const":78,"../../renderers/canvas/CanvasRenderer":109}],88:[function(t,e,i){e.exports=function(t,e,i,r,n,s,o,a,h){var l,c,u,d,p;(h=h||[]).push(t,e);for(var f=0,g=1;g<=20;++g)u=(c=(l=1-(f=g/20))*l)*l,p=(d=f*f)*f,h.push(u*t+3*c*f*i+3*l*d*n+p*o,u*e+3*c*f*r+3*l*d*s+p*a);return h}},{}],89:[function(t,e,i){function r(t){o.call(this,t),this.graphicsDataPool=[],this.primitiveShader=null,this.gl=t.gl,this.CONTEXT_UID=0}var n=t("../../utils"),s=t("../../const"),o=t("../../renderers/webgl/utils/ObjectRenderer"),a=t("../../renderers/webgl/WebGLRenderer"),h=t("./WebGLGraphicsData"),l=t("./shaders/PrimitiveShader"),c=t("./utils/buildPoly"),u=t("./utils/buildRectangle"),d=t("./utils/buildRoundedRectangle"),p=t("./utils/buildCircle");r.prototype=Object.create(o.prototype),r.prototype.constructor=r,e.exports=r,a.registerPlugin("graphics",r),r.prototype.onContextChange=function(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.primitiveShader=new l(this.gl)},r.prototype.destroy=function(){o.prototype.destroy.call(this);for(var t=0;t<this.graphicsDataPool.length;++t)this.graphicsDataPool[t].destroy();this.graphicsDataPool=null},r.prototype.render=function(t){var e,i=this.renderer,r=i.gl,s=t._webGL[this.CONTEXT_UID];s&&t.dirty===s.dirty||(this.updateGraphics(t),s=t._webGL[this.CONTEXT_UID]);var o=this.primitiveShader;i.bindShader(o),i.state.setBlendMode(t.blendMode);for(var a=0,h=s.data.length;a<h;a++){var l=(e=s.data[a]).shader;i.bindShader(l),l.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),l.uniforms.tint=n.hex2rgb(t.tint),l.uniforms.alpha=t.worldAlpha,e.vao.bind().draw(r.TRIANGLE_STRIP,e.indices.length).unbind()}},r.prototype.updateGraphics=function(t){var e,i,r=this.renderer.gl,n=t._webGL[this.CONTEXT_UID];if(n||(n=t._webGL[this.CONTEXT_UID]={lastIndex:0,data:[],gl:r,clearDirty:-1,dirty:-1}),n.dirty=t.dirty,t.clearDirty!==n.clearDirty){for(n.clearDirty=t.clearDirty,e=0;e<n.data.length;e++){var o=n.data[e];this.graphicsDataPool.push(o)}n.data=[],n.lastIndex=0}for(e=n.lastIndex;e<t.graphicsData.length;e++){var a=t.graphicsData[e];i=this.getWebGLData(n,0),a.type===s.SHAPES.POLY&&c(a,i),a.type===s.SHAPES.RECT?u(a,i):a.type===s.SHAPES.CIRC||a.type===s.SHAPES.ELIP?p(a,i):a.type===s.SHAPES.RREC&&d(a,i),n.lastIndex++}for(e=0;e<n.data.length;e++)(i=n.data[e]).dirty&&i.upload()},r.prototype.getWebGLData=function(t,e){var i=t.data[t.data.length-1];return(!i||i.points.length>32e4)&&((i=this.graphicsDataPool.pop()||new h(this.renderer.gl,this.primitiveShader,this.renderer.state.attribsState)).reset(e),t.data.push(i)),i.dirty=!0,i}},{"../../const":78,"../../renderers/webgl/WebGLRenderer":116,"../../renderers/webgl/utils/ObjectRenderer":126,"../../utils":151,"./WebGLGraphicsData":90,"./shaders/PrimitiveShader":91,"./utils/buildCircle":92,"./utils/buildPoly":94,"./utils/buildRectangle":95,"./utils/buildRoundedRectangle":96}],90:[function(t,e,i){function r(t,e,i){this.gl=t,this.color=[0,0,0],this.points=[],this.indices=[],this.buffer=n.GLBuffer.createVertexBuffer(t),this.indexBuffer=n.GLBuffer.createIndexBuffer(t),this.dirty=!0,this.glPoints=null,this.glIndices=null,this.shader=e,this.vao=new n.VertexArrayObject(t,i).addIndex(this.indexBuffer).addAttribute(this.buffer,e.attributes.aVertexPosition,t.FLOAT,!1,24,0).addAttribute(this.buffer,e.attributes.aColor,t.FLOAT,!1,24,8)}var n=t("pixi-gl-core");r.prototype.constructor=r,e.exports=r,r.prototype.reset=function(){this.points.length=0,this.indices.length=0},r.prototype.upload=function(){this.glPoints=new Float32Array(this.points),this.buffer.upload(this.glPoints),this.glIndices=new Uint16Array(this.indices),this.indexBuffer.upload(this.glIndices),this.dirty=!1},r.prototype.destroy=function(){this.color=null,this.points=null,this.indices=null,this.vao.destroy(),this.buffer.destroy(),this.indexBuffer.destroy(),this.gl=null,this.buffer=null,this.indexBuffer=null,this.glPoints=null,this.glIndices=null}},{"pixi-gl-core":7}],91:[function(t,e,i){function r(t){n.call(this,t,["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform mat3 projectionMatrix;","uniform float alpha;","uniform vec3 tint;","varying vec4 vColor;","void main(void){","   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"].join("\n"),["varying vec4 vColor;","void main(void){","   gl_FragColor = vColor;","}"].join("\n"))}var n=t("../../../Shader");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,e.exports=r},{"../../../Shader":77}],92:[function(t,e,i){var r=t("./buildLine"),n=t("../../../const"),s=t("../../../utils");e.exports=function(t,e){var i,o,a=t.shape,h=a.x,l=a.y;t.type===n.SHAPES.CIRC?(i=a.radius,o=a.radius):(i=a.width,o=a.height);var c=Math.floor(30*Math.sqrt(a.radius))||Math.floor(15*Math.sqrt(a.width+a.height)),u=2*Math.PI/c,d=0;if(t.fill){var p=s.hex2rgb(t.fillColor),f=t.fillAlpha,g=p[0]*f,v=p[1]*f,m=p[2]*f,y=e.points,x=e.indices,_=y.length/6;for(x.push(_),d=0;d<c+1;d++)y.push(h,l,g,v,m,f),y.push(h+Math.sin(u*d)*i,l+Math.cos(u*d)*o,g,v,m,f),x.push(_++,_++);x.push(_-1)}if(t.lineWidth){var b=t.points;for(t.points=[],d=0;d<c+1;d++)t.points.push(h+Math.sin(u*d)*i,l+Math.cos(u*d)*o);r(t,e),t.points=b}}},{"../../../const":78,"../../../utils":151,"./buildLine":93}],93:[function(t,e,i){var r=t("../../../math"),n=t("../../../utils");e.exports=function(t,e){var i=0,s=t.points;if(0!==s.length){var o=new r.Point(s[0],s[1]),a=new r.Point(s[s.length-2],s[s.length-1]);if(o.x===a.x&&o.y===a.y){(s=s.slice()).pop(),s.pop();var h=(a=new r.Point(s[s.length-2],s[s.length-1])).x+.5*(o.x-a.x),l=a.y+.5*(o.y-a.y);s.unshift(h,l),s.push(h,l)}var c,u,d,p,f,g,v,m,y,x,_,b,T,E,w,A,C,S,O,D,M,R,P=e.points,I=e.indices,N=s.length/2,L=s.length,k=P.length/6,F=t.lineWidth/2,B=n.hex2rgb(t.lineColor),U=t.lineAlpha,V=B[0]*U,j=B[1]*U,H=B[2]*U;for(d=s[0],p=s[1],f=s[2],y=-(p-(g=s[3])),x=d-f,y/=R=Math.sqrt(y*y+x*x),x/=R,y*=F,x*=F,P.push(d-y,p-x,V,j,H,U),P.push(d+y,p+x,V,j,H,U),i=1;i<N-1;i++)d=s[2*(i-1)],p=s[2*(i-1)+1],f=s[2*i],g=s[2*i+1],v=s[2*(i+1)],m=s[2*(i+1)+1],y=-(p-g),x=d-f,y/=R=Math.sqrt(y*y+x*x),x/=R,y*=F,x*=F,_=-(g-m),b=f-v,_/=R=Math.sqrt(_*_+b*b),b/=R,C=(-y+d)*(-x+g)-(-y+f)*(-x+p),D=(-(_*=F)+v)*(-(b*=F)+g)-(-_+f)*(-b+m),M=(w=-x+p-(-x+g))*(O=-_+f-(-_+v))-(S=-b+m-(-b+g))*(A=-y+f-(-y+d)),Math.abs(M)<.1?(M+=10.1,P.push(f-y,g-x,V,j,H,U),P.push(f+y,g+x,V,j,H,U)):((c=(A*D-O*C)/M)-f)*(c-f)+((u=(S*C-w*D)/M)-g)*(u-g)>19600?(T=y-_,E=x-b,T/=R=Math.sqrt(T*T+E*E),E/=R,T*=F,E*=F,P.push(f-T,g-E),P.push(V,j,H,U),P.push(f+T,g+E),P.push(V,j,H,U),P.push(f-T,g-E),P.push(V,j,H,U),L++):(P.push(c,u),P.push(V,j,H,U),P.push(f-(c-f),g-(u-g)),P.push(V,j,H,U));for(d=s[2*(N-2)],p=s[2*(N-2)+1],f=s[2*(N-1)],y=-(p-(g=s[2*(N-1)+1])),x=d-f,y/=R=Math.sqrt(y*y+x*x),x/=R,y*=F,x*=F,P.push(f-y,g-x),P.push(V,j,H,U),P.push(f+y,g+x),P.push(V,j,H,U),I.push(k),i=0;i<L;i++)I.push(k++);I.push(k-1)}}},{"../../../math":102,"../../../utils":151}],94:[function(t,e,i){var r=t("./buildLine"),n=t("../../../utils"),s=t("earcut");e.exports=function(t,e){t.points=t.shape.points.slice();var i=t.points;if(t.fill&&i.length>=6){for(var o=[],a=t.holes,h=0;h<a.length;h++){var l=a[h];o.push(i.length/2),i=i.concat(l.points)}var c=e.points,u=e.indices,d=i.length/2,p=n.hex2rgb(t.fillColor),f=t.fillAlpha,g=p[0]*f,v=p[1]*f,m=p[2]*f,y=s(i,o,2);if(!y)return;var x=c.length/6;for(h=0;h<y.length;h+=3)u.push(y[h]+x),u.push(y[h]+x),u.push(y[h+1]+x),u.push(y[h+2]+x),u.push(y[h+2]+x);for(h=0;h<d;h++)c.push(i[2*h],i[2*h+1],g,v,m,f)}t.lineWidth>0&&r(t,e)}},{"../../../utils":151,"./buildLine":93,earcut:31}],95:[function(t,e,i){var r=t("./buildLine"),n=t("../../../utils");e.exports=function(t,e){var i=t.shape,s=i.x,o=i.y,a=i.width,h=i.height;if(t.fill){var l=n.hex2rgb(t.fillColor),c=t.fillAlpha,u=l[0]*c,d=l[1]*c,p=l[2]*c,f=e.points,g=e.indices,v=f.length/6;f.push(s,o),f.push(u,d,p,c),f.push(s+a,o),f.push(u,d,p,c),f.push(s,o+h),f.push(u,d,p,c),f.push(s+a,o+h),f.push(u,d,p,c),g.push(v,v,v+1,v+2,v+3,v+3)}if(t.lineWidth){var m=t.points;t.points=[s,o,s+a,o,s+a,o+h,s,o+h,s,o],r(t,e),t.points=m}}},{"../../../utils":151,"./buildLine":93}],96:[function(t,e,i){var r=t("earcut"),n=t("./buildLine"),s=t("../../../utils"),o=function(t,e,i,r,n,s,o){function a(t,e,i){return t+(e-t)*i}for(var h,l,c,u,d,p,f=o||[],g=0,v=0;v<=20;v++)h=a(t,i,g=v/20),l=a(e,r,g),c=a(i,n,g),u=a(r,s,g),d=a(h,c,g),p=a(l,u,g),f.push(d,p);return f};e.exports=function(t,e){var i=t.shape,a=i.x,h=i.y,l=i.width,c=i.height,u=i.radius,d=[];if(d.push(a,h+u),o(a,h+c-u,a,h+c,a+u,h+c,d),o(a+l-u,h+c,a+l,h+c,a+l,h+c-u,d),o(a+l,h+u,a+l,h,a+l-u,h,d),o(a+u,h,a,h,a,h+u+1e-10,d),t.fill){var p=s.hex2rgb(t.fillColor),f=t.fillAlpha,g=p[0]*f,v=p[1]*f,m=p[2]*f,y=e.points,x=e.indices,_=y.length/6,b=r(d,null,2),T=0;for(T=0;T<b.length;T+=3)x.push(b[T]+_),x.push(b[T]+_),x.push(b[T+1]+_),x.push(b[T+2]+_),x.push(b[T+2]+_);for(T=0;T<d.length;T++)y.push(d[T],d[++T],g,v,m,f)}if(t.lineWidth){var E=t.points;t.points=d,n(t,e),t.points=E}}},{"../../../utils":151,"./buildLine":93,earcut:31}],97:[function(t,e,i){var r=e.exports=Object.assign(t("./const"),t("./math"),{utils:t("./utils"),ticker:t("./ticker"),DisplayObject:t("./display/DisplayObject"),Container:t("./display/Container"),Transform:t("./display/Transform"),TransformStatic:t("./display/TransformStatic"),TransformBase:t("./display/TransformBase"),Sprite:t("./sprites/Sprite"),CanvasSpriteRenderer:t("./sprites/canvas/CanvasSpriteRenderer"),CanvasTinter:t("./sprites/canvas/CanvasTinter"),SpriteRenderer:t("./sprites/webgl/SpriteRenderer"),Text:t("./text/Text"),TextStyle:t("./text/TextStyle"),Graphics:t("./graphics/Graphics"),GraphicsData:t("./graphics/GraphicsData"),GraphicsRenderer:t("./graphics/webgl/GraphicsRenderer"),CanvasGraphicsRenderer:t("./graphics/canvas/CanvasGraphicsRenderer"),Texture:t("./textures/Texture"),BaseTexture:t("./textures/BaseTexture"),RenderTexture:t("./textures/RenderTexture"),BaseRenderTexture:t("./textures/BaseRenderTexture"),VideoBaseTexture:t("./textures/VideoBaseTexture"),TextureUvs:t("./textures/TextureUvs"),CanvasRenderer:t("./renderers/canvas/CanvasRenderer"),CanvasRenderTarget:t("./renderers/canvas/utils/CanvasRenderTarget"),Shader:t("./Shader"),WebGLRenderer:t("./renderers/webgl/WebGLRenderer"),WebGLManager:t("./renderers/webgl/managers/WebGLManager"),ObjectRenderer:t("./renderers/webgl/utils/ObjectRenderer"),RenderTarget:t("./renderers/webgl/utils/RenderTarget"),Quad:t("./renderers/webgl/utils/Quad"),SpriteMaskFilter:t("./renderers/webgl/filters/spriteMask/SpriteMaskFilter"),Filter:t("./renderers/webgl/filters/Filter"),glCore:t("pixi-gl-core"),autoDetectRenderer:function(t,e,i,n){return t=t||800,e=e||600,!n&&r.utils.isWebGLSupported()?new r.WebGLRenderer(t,e,i):new r.CanvasRenderer(t,e,i)}})},{"./Shader":77,"./const":78,"./display/Container":80,"./display/DisplayObject":81,"./display/Transform":82,"./display/TransformBase":83,"./display/TransformStatic":84,"./graphics/Graphics":85,"./graphics/GraphicsData":86,"./graphics/canvas/CanvasGraphicsRenderer":87,"./graphics/webgl/GraphicsRenderer":89,"./math":102,"./renderers/canvas/CanvasRenderer":109,"./renderers/canvas/utils/CanvasRenderTarget":111,"./renderers/webgl/WebGLRenderer":116,"./renderers/webgl/filters/Filter":118,"./renderers/webgl/filters/spriteMask/SpriteMaskFilter":121,"./renderers/webgl/managers/WebGLManager":125,"./renderers/webgl/utils/ObjectRenderer":126,"./renderers/webgl/utils/Quad":127,"./renderers/webgl/utils/RenderTarget":128,"./sprites/Sprite":133,"./sprites/canvas/CanvasSpriteRenderer":134,"./sprites/canvas/CanvasTinter":135,"./sprites/webgl/SpriteRenderer":137,"./text/Text":139,"./text/TextStyle":140,"./textures/BaseRenderTexture":141,"./textures/BaseTexture":142,"./textures/RenderTexture":143,"./textures/Texture":144,"./textures/TextureUvs":145,"./textures/VideoBaseTexture":146,"./ticker":148,"./utils":151,"pixi-gl-core":7}],98:[function(t,e,i){function r(t){return t<0?-1:t>0?1:0}var n=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],s=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],o=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],a=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],h=[],l=t("./Matrix"),c=[];!function(){for(var t=0;t<16;t++){var e=[];c.push(e);for(var i=0;i<16;i++)for(var u=r(n[t]*n[i]+o[t]*s[i]),d=r(s[t]*n[i]+a[t]*s[i]),p=r(n[t]*o[i]+o[t]*a[i]),f=r(s[t]*o[i]+a[t]*a[i]),g=0;g<16;g++)if(n[g]===u&&s[g]===d&&o[g]===p&&a[g]===f){e.push(g);break}}for(t=0;t<16;t++){var v=new l;v.set(n[t],s[t],o[t],a[t],0,0),h.push(v)}}();var u={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MIRROR_HORIZONTAL:12,uX:function(t){return n[t]},uY:function(t){return s[t]},vX:function(t){return o[t]},vY:function(t){return a[t]},inv:function(t){return 8&t?15&t:7&-t},add:function(t,e){return c[t][e]},sub:function(t,e){return c[t][u.inv(e)]},rotate180:function(t){return 4^t},isSwapWidthHeight:function(t){return 2==(3&t)},byDirection:function(t,e){return 2*Math.abs(t)<=Math.abs(e)?e>=0?u.S:u.N:2*Math.abs(e)<=Math.abs(t)?t>0?u.E:u.W:e>0?t>0?u.SE:u.SW:t>0?u.NE:u.NW},matrixAppendRotationInv:function(t,e,i,r){var n=h[u.inv(e)];i=i||0,r=r||0,n.tx=i,n.ty=r,t.append(n)}};e.exports=u},{"./Matrix":99}],99:[function(t,e,i){function r(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this.array=null}var n=t("./Point");r.prototype.constructor=r,e.exports=r,r.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},r.prototype.set=function(t,e,i,r,n,s){return this.a=t,this.b=e,this.c=i,this.d=r,this.tx=n,this.ty=s,this},r.prototype.toArray=function(t,e){this.array||(this.array=new Float32Array(9));var i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i},r.prototype.apply=function(t,e){e=e||new n;var i=t.x,r=t.y;return e.x=this.a*i+this.c*r+this.tx,e.y=this.b*i+this.d*r+this.ty,e},r.prototype.applyInverse=function(t,e){e=e||new n;var i=1/(this.a*this.d+this.c*-this.b),r=t.x,s=t.y;return e.x=this.d*i*r+-this.c*i*s+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*s+-this.b*i*r+(-this.ty*this.a+this.tx*this.b)*i,e},r.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},r.prototype.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},r.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),r=this.a,n=this.c,s=this.tx;return this.a=r*e-this.b*i,this.b=r*i+this.b*e,this.c=n*e-this.d*i,this.d=n*i+this.d*e,this.tx=s*e-this.ty*i,this.ty=s*i+this.ty*e,this},r.prototype.append=function(t){var e=this.a,i=this.b,r=this.c,n=this.d;return this.a=t.a*e+t.b*r,this.b=t.a*i+t.b*n,this.c=t.c*e+t.d*r,this.d=t.c*i+t.d*n,this.tx=t.tx*e+t.ty*r+this.tx,this.ty=t.tx*i+t.ty*n+this.ty,this},r.prototype.setTransform=function(t,e,i,r,n,s,o,a,h){var l,c,u,d,p,f,g,v,m,y;return p=Math.sin(o),f=Math.cos(o),g=Math.cos(h),v=Math.sin(h),m=-Math.sin(a),y=Math.cos(a),l=f*n,c=p*n,u=-p*s,d=f*s,this.a=g*l+v*u,this.b=g*c+v*d,this.c=m*l+y*u,this.d=m*c+y*d,this.tx=t+(i*l+r*u),this.ty=e+(i*c+r*d),this},r.prototype.prepend=function(t){var e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){var i=this.a,r=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=r*t.a+this.d*t.c,this.d=r*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this},r.prototype.decompose=function(t){var e=this.a,i=this.b,r=this.c,n=this.d,s=Math.atan2(-r,n),o=Math.atan2(i,e);return Math.abs(1-s/o)<1e-5?(t.rotation=o,e<0&&n>=0&&(t.rotation+=t.rotation<=0?Math.PI:-Math.PI),t.skew.x=t.skew.y=0):(t.skew.x=s,t.skew.y=o),t.scale.x=Math.sqrt(e*e+i*i),t.scale.y=Math.sqrt(r*r+n*n),t.position.x=this.tx,t.position.y=this.ty,t},r.prototype.invert=function(){var t=this.a,e=this.b,i=this.c,r=this.d,n=this.tx,s=t*r-e*i;return this.a=r/s,this.b=-e/s,this.c=-i/s,this.d=t/s,this.tx=(i*this.ty-r*n)/s,this.ty=-(t*this.ty-e*n)/s,this},r.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},r.prototype.clone=function(){var t=new r;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},r.prototype.copy=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},r.IDENTITY=new r,r.TEMP_MATRIX=new r},{"./Point":101}],100:[function(t,e,i){function r(t,e,i,r){this._x=i||0,this._y=r||0,this.cb=t,this.scope=e}r.prototype.constructor=r,e.exports=r,Object.defineProperties(r.prototype,{x:{get:function(){return this._x},set:function(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}},y:{get:function(){return this._y},set:function(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}}),r.prototype.set=function(t,e){var i=t||0,r=e||(0!==e?i:0);this._x===i&&this._y===r||(this._x=i,this._y=r,this.cb.call(this.scope))},r.prototype.copy=function(t){this._x===t.x&&this._y===t.y||(this._x=t.x,this._y=t.y,this.cb.call(this.scope))}},{}],101:[function(t,e,i){function r(t,e){this.x=t||0,this.y=e||0}r.prototype.constructor=r,e.exports=r,r.prototype.clone=function(){return new r(this.x,this.y)},r.prototype.copy=function(t){this.set(t.x,t.y)},r.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},r.prototype.set=function(t,e){this.x=t||0,this.y=e||(0!==e?this.x:0)}},{}],102:[function(t,e,i){e.exports={Point:t("./Point"),ObservablePoint:t("./ObservablePoint"),Matrix:t("./Matrix"),GroupD8:t("./GroupD8"),Circle:t("./shapes/Circle"),Ellipse:t("./shapes/Ellipse"),Polygon:t("./shapes/Polygon"),Rectangle:t("./shapes/Rectangle"),RoundedRectangle:t("./shapes/RoundedRectangle")}},{"./GroupD8":98,"./Matrix":99,"./ObservablePoint":100,"./Point":101,"./shapes/Circle":103,"./shapes/Ellipse":104,"./shapes/Polygon":105,"./shapes/Rectangle":106,"./shapes/RoundedRectangle":107}],103:[function(t,e,i){function r(t,e,i){this.x=t||0,this.y=e||0,this.radius=i||0,this.type=s.SHAPES.CIRC}var n=t("./Rectangle"),s=t("../../const");r.prototype.constructor=r,e.exports=r,r.prototype.clone=function(){return new r(this.x,this.y,this.radius)},r.prototype.contains=function(t,e){if(this.radius<=0)return!1;var i=this.x-t,r=this.y-e;return(i*=i)+(r*=r)<=this.radius*this.radius},r.prototype.getBounds=function(){return new n(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}},{"../../const":78,"./Rectangle":106}],104:[function(t,e,i){function r(t,e,i,r){this.x=t||0,this.y=e||0,this.width=i||0,this.height=r||0,this.type=s.SHAPES.ELIP}var n=t("./Rectangle"),s=t("../../const");r.prototype.constructor=r,e.exports=r,r.prototype.clone=function(){return new r(this.x,this.y,this.width,this.height)},r.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var i=(t-this.x)/this.width,r=(e-this.y)/this.height;return(i*=i)+(r*=r)<=1},r.prototype.getBounds=function(){return new n(this.x-this.width,this.y-this.height,this.width,this.height)}},{"../../const":78,"./Rectangle":106}],105:[function(t,e,i){function r(t){var e=t;if(!Array.isArray(e)){e=new Array(arguments.length);for(var i=0;i<e.length;++i)e[i]=arguments[i]}if(e[0]instanceof n){for(var r=[],o=0,a=e.length;o<a;o++)r.push(e[o].x,e[o].y);e=r}this.closed=!0,this.points=e,this.type=s.SHAPES.POLY}var n=t("../Point"),s=t("../../const");r.prototype.constructor=r,e.exports=r,r.prototype.clone=function(){return new r(this.points.slice())},r.prototype.close=function(){var t=this.points;t[0]===t[t.length-2]&&t[1]===t[t.length-1]||t.push(t[0],t[1])},r.prototype.contains=function(t,e){for(var i=!1,r=this.points.length/2,n=0,s=r-1;n<r;s=n++){var o=this.points[2*n],a=this.points[2*n+1],h=this.points[2*s],l=this.points[2*s+1];a>e!=l>e&&t<(h-o)*(e-a)/(l-a)+o&&(i=!i)}return i}},{"../../const":78,"../Point":101}],106:[function(t,e,i){function r(t,e,i,r){this.x=t||0,this.y=e||0,this.width=i||0,this.height=r||0,this.type=n.SHAPES.RECT}var n=t("../../const");r.prototype.constructor=r,e.exports=r,Object.defineProperties(r.prototype,{left:{get:function(){return this.x}},right:{get:function(){return this.x+this.width}},top:{get:function(){return this.y}},bottom:{get:function(){return this.y+this.height}}}),r.EMPTY=new r(0,0,0,0),r.prototype.clone=function(){return new r(this.x,this.y,this.width,this.height)},r.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},r.prototype.contains=function(t,e){return!(this.width<=0||this.height<=0)&&t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height},r.prototype.pad=function(t,e){t=t||0,e=e||(0!==e?t:0),this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e},r.prototype.fit=function(t){this.x<t.x&&(this.width+=this.x,this.width<0&&(this.width=0),this.x=t.x),this.y<t.y&&(this.height+=this.y,this.height<0&&(this.height=0),this.y=t.y),this.x+this.width>t.x+t.width&&(this.width=t.width-this.x,this.width<0&&(this.width=0)),this.y+this.height>t.y+t.height&&(this.height=t.height-this.y,this.height<0&&(this.height=0))},r.prototype.enlarge=function(t){if(t!==r.EMPTY){var e=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),s=Math.max(this.y+this.height,t.y+t.height);this.x=e,this.width=i-e,this.y=n,this.height=s-n}}},{"../../const":78}],107:[function(t,e,i){function r(t,e,i,r,s){this.x=t||0,this.y=e||0,this.width=i||0,this.height=r||0,this.radius=s||20,this.type=n.SHAPES.RREC}var n=t("../../const");r.prototype.constructor=r,e.exports=r,r.prototype.clone=function(){return new r(this.x,this.y,this.width,this.height,this.radius)},r.prototype.contains=function(t,e){return!(this.width<=0||this.height<=0)&&t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height}},{"../../const":78}],108:[function(t,e,i){function r(t,e,i,r){if(l.call(this),n.sayHello(t),r)for(var s in o.DEFAULT_RENDER_OPTIONS)void 0===r[s]&&(r[s]=o.DEFAULT_RENDER_OPTIONS[s]);else r=o.DEFAULT_RENDER_OPTIONS;this.type=o.RENDERER_TYPE.UNKNOWN,this.width=e||800,this.height=i||600,this.view=r.view||document.createElement("canvas"),this.resolution=r.resolution,this.transparent=r.transparent,this.autoResize=r.autoResize||!1,this.blendModes=null,this.preserveDrawingBuffer=r.preserveDrawingBuffer,this.clearBeforeRender=r.clearBeforeRender,this.roundPixels=r.roundPixels,this._backgroundColor=0,this._backgroundColorRgba=[0,0,0,0],this._backgroundColorString="#000000",this.backgroundColor=r.backgroundColor||this._backgroundColor,this._tempDisplayObjectParent=new a,this._lastObjectRendered=this._tempDisplayObjectParent}var n=t("../utils"),s=t("../math"),o=t("../const"),a=t("../display/Container"),h=t("../textures/RenderTexture"),l=t("eventemitter3"),c=new s.Matrix;r.prototype=Object.create(l.prototype),r.prototype.constructor=r,e.exports=r,Object.defineProperties(r.prototype,{backgroundColor:{get:function(){return this._backgroundColor},set:function(t){this._backgroundColor=t,this._backgroundColorString=n.hex2string(t),n.hex2rgb(t,this._backgroundColorRgba)}}}),r.prototype.resize=function(t,e){this.width=t*this.resolution,this.height=e*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px")},r.prototype.generateTexture=function(t,e,i){var r=t.getLocalBounds(),n=h.create(0|r.width,0|r.height,e,i);return c.tx=-r.x,c.ty=-r.y,this.render(t,n,!1,c,!0),n},r.prototype.destroy=function(t){t&&this.view.parentNode&&this.view.parentNode.removeChild(this.view),this.type=o.RENDERER_TYPE.UNKNOWN,this.width=0,this.height=0,this.view=null,this.resolution=0,this.transparent=!1,this.autoResize=!1,this.blendModes=null,this.preserveDrawingBuffer=!1,this.clearBeforeRender=!1,this.roundPixels=!1,this._backgroundColor=0,this._backgroundColorRgba=null,this._backgroundColorString=null,this.backgroundColor=0,this._tempDisplayObjectParent=null,this._lastObjectRendered=null}},{"../const":78,"../display/Container":80,"../math":102,"../textures/RenderTexture":143,"../utils":151,eventemitter3:32}],109:[function(t,e,i){function r(t,e,i){i=i||{},n.call(this,"Canvas",t,e,i),this.type=l.RENDERER_TYPE.CANVAS,this.rootContext=this.view.getContext("2d",{alpha:this.transparent}),this.rootResolution=this.resolution,this.refresh=!0,this.maskManager=new s(this),this.smoothProperty="imageSmoothingEnabled",this.rootContext.imageSmoothingEnabled||(this.rootContext.webkitImageSmoothingEnabled?this.smoothProperty="webkitImageSmoothingEnabled":this.rootContext.mozImageSmoothingEnabled?this.smoothProperty="mozImageSmoothingEnabled":this.rootContext.oImageSmoothingEnabled?this.smoothProperty="oImageSmoothingEnabled":this.rootContext.msImageSmoothingEnabled&&(this.smoothProperty="msImageSmoothingEnabled")),this.initPlugins(),this.blendModes=a(),this._activeBlendMode=null,this.context=null,this.renderingToScreen=!1,this.resize(t,e)}var n=t("../SystemRenderer"),s=t("./utils/CanvasMaskManager"),o=t("./utils/CanvasRenderTarget"),a=t("./utils/mapCanvasBlendModesToPixi"),h=t("../../utils"),l=t("../../const");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,e.exports=r,h.pluginTarget.mixin(r),r.prototype.render=function(t,e,i,r,n){if(this.view){this.renderingToScreen=!e,this.emit("prerender"),e?((e=e.baseTexture||e)._canvasRenderTarget||(e._canvasRenderTarget=new o(e.width,e.height,e.resolution),e.source=e._canvasRenderTarget.canvas,e.valid=!0),this.context=e._canvasRenderTarget.context,this.resolution=e._canvasRenderTarget.resolution):(this.context=this.rootContext,this.resolution=this.rootResolution);var s=this.context;if(e||(this._lastObjectRendered=t),!n){var a=t.parent,h=this._tempDisplayObjectParent.transform.worldTransform;r?r.copy(h):h.identity(),t.parent=this._tempDisplayObjectParent,t.updateTransform(),t.parent=a}s.setTransform(1,0,0,1,0,0),s.globalAlpha=1,s.globalCompositeOperation=this.blendModes[l.BLEND_MODES.NORMAL],navigator.isCocoonJS&&this.view.screencanvas&&(s.fillStyle="black",s.clear()),(void 0!==i?i:this.clearBeforeRender)&&this.renderingToScreen&&(this.transparent?s.clearRect(0,0,this.width,this.height):(s.fillStyle=this._backgroundColorString,s.fillRect(0,0,this.width,this.height)));var c=this.context;this.context=s,t.renderCanvas(this),this.context=c,this.emit("postrender")}},r.prototype.setBlendMode=function(t){this._activeBlendMode!==t&&(this.context.globalCompositeOperation=this.blendModes[t])},r.prototype.destroy=function(t){this.destroyPlugins(),n.prototype.destroy.call(this,t),this.context=null,this.refresh=!0,this.maskManager.destroy(),this.maskManager=null,this.smoothProperty=null},r.prototype.resize=function(t,e){n.prototype.resize.call(this,t,e),this.smoothProperty&&(this.rootContext[this.smoothProperty]=l.SCALE_MODES.DEFAULT===l.SCALE_MODES.LINEAR)}},{"../../const":78,"../../utils":151,"../SystemRenderer":108,"./utils/CanvasMaskManager":110,"./utils/CanvasRenderTarget":111,"./utils/mapCanvasBlendModesToPixi":113}],110:[function(t,e,i){function r(t){this.renderer=t}var n=t("../../../const");r.prototype.constructor=r,e.exports=r,r.prototype.pushMask=function(t){var e=this.renderer;e.context.save();var i=t.alpha,r=t.transform.worldTransform,n=e.resolution;e.context.setTransform(r.a*n,r.b*n,r.c*n,r.d*n,r.tx*n,r.ty*n),t._texture||(this.renderGraphicsShape(t),e.context.clip()),t.worldAlpha=i},r.prototype.renderGraphicsShape=function(t){var e=this.renderer.context,i=t.graphicsData.length;if(0!==i){e.beginPath();for(var r=0;r<i;r++){var s=t.graphicsData[r],o=s.shape;if(s.type===n.SHAPES.POLY){var a=o.points;e.moveTo(a[0],a[1]);for(var h=1;h<a.length/2;h++)e.lineTo(a[2*h],a[2*h+1]);a[0]===a[a.length-2]&&a[1]===a[a.length-1]&&e.closePath()}else if(s.type===n.SHAPES.RECT)e.rect(o.x,o.y,o.width,o.height),e.closePath();else if(s.type===n.SHAPES.CIRC)e.arc(o.x,o.y,o.radius,0,2*Math.PI),e.closePath();else if(s.type===n.SHAPES.ELIP){var l=2*o.width,c=2*o.height,u=o.x-l/2,d=o.y-c/2,p=.5522848,f=l/2*p,g=c/2*p,v=u+l,m=d+c,y=u+l/2,x=d+c/2;e.moveTo(u,x),e.bezierCurveTo(u,x-g,y-f,d,y,d),e.bezierCurveTo(y+f,d,v,x-g,v,x),e.bezierCurveTo(v,x+g,y+f,m,y,m),e.bezierCurveTo(y-f,m,u,x+g,u,x),e.closePath()}else if(s.type===n.SHAPES.RREC){var _=o.x,b=o.y,T=o.width,E=o.height,w=o.radius,A=Math.min(T,E)/2|0;w=w>A?A:w,e.moveTo(_,b+w),e.lineTo(_,b+E-w),e.quadraticCurveTo(_,b+E,_+w,b+E),e.lineTo(_+T-w,b+E),e.quadraticCurveTo(_+T,b+E,_+T,b+E-w),e.lineTo(_+T,b+w),e.quadraticCurveTo(_+T,b,_+T-w,b),e.lineTo(_+w,b),e.quadraticCurveTo(_,b,_,b+w),e.closePath()}}}},r.prototype.popMask=function(t){t.context.restore()},r.prototype.destroy=function(){}},{"../../../const":78}],111:[function(t,e,i){function r(t,e,i){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=i||n.RESOLUTION,this.resize(t,e)}var n=t("../../../const");r.prototype.constructor=r,e.exports=r,Object.defineProperties(r.prototype,{width:{get:function(){return this.canvas.width},set:function(t){this.canvas.width=t}},height:{get:function(){return this.canvas.height},set:function(t){this.canvas.height=t}}}),r.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},r.prototype.resize=function(t,e){this.canvas.width=t*this.resolution,this.canvas.height=e*this.resolution},r.prototype.destroy=function(){this.context=null,this.canvas=null}},{"../../../const":78}],112:[function(t,e,i){var r=function(t){var e=document.createElement("canvas");e.width=6,e.height=1;var i=e.getContext("2d");return i.fillStyle=t,i.fillRect(0,0,6,1),e};e.exports=function(){if("undefined"==typeof document)return!1;var t=r("#ff00ff"),e=r("#ffff00"),i=document.createElement("canvas");i.width=6,i.height=1;var n=i.getContext("2d");n.globalCompositeOperation="multiply",n.drawImage(t,0,0),n.drawImage(e,2,0);var s=n.getImageData(2,0,1,1);if(!s)return!1;var o=s.data;return 255===o[0]&&0===o[1]&&0===o[2]}},{}],113:[function(t,e,i){var r=t("../../../const"),n=t("./canUseNewCanvasBlendModes");e.exports=function(t){return t=t||[],n()?(t[r.BLEND_MODES.NORMAL]="source-over",t[r.BLEND_MODES.ADD]="lighter",t[r.BLEND_MODES.MULTIPLY]="multiply",t[r.BLEND_MODES.SCREEN]="screen",t[r.BLEND_MODES.OVERLAY]="overlay",t[r.BLEND_MODES.DARKEN]="darken",t[r.BLEND_MODES.LIGHTEN]="lighten",t[r.BLEND_MODES.COLOR_DODGE]="color-dodge",t[r.BLEND_MODES.COLOR_BURN]="color-burn",t[r.BLEND_MODES.HARD_LIGHT]="hard-light",t[r.BLEND_MODES.SOFT_LIGHT]="soft-light",t[r.BLEND_MODES.DIFFERENCE]="difference",t[r.BLEND_MODES.EXCLUSION]="exclusion",t[r.BLEND_MODES.HUE]="hue",t[r.BLEND_MODES.SATURATION]="saturate",t[r.BLEND_MODES.COLOR]="color",t[r.BLEND_MODES.LUMINOSITY]="luminosity"):(t[r.BLEND_MODES.NORMAL]="source-over",t[r.BLEND_MODES.ADD]="lighter",t[r.BLEND_MODES.MULTIPLY]="source-over",t[r.BLEND_MODES.SCREEN]="source-over",t[r.BLEND_MODES.OVERLAY]="source-over",t[r.BLEND_MODES.DARKEN]="source-over",t[r.BLEND_MODES.LIGHTEN]="source-over",t[r.BLEND_MODES.COLOR_DODGE]="source-over",t[r.BLEND_MODES.COLOR_BURN]="source-over",t[r.BLEND_MODES.HARD_LIGHT]="source-over",t[r.BLEND_MODES.SOFT_LIGHT]="source-over",t[r.BLEND_MODES.DIFFERENCE]="source-over",t[r.BLEND_MODES.EXCLUSION]="source-over",t[r.BLEND_MODES.HUE]="source-over",t[r.BLEND_MODES.SATURATION]="source-over",t[r.BLEND_MODES.COLOR]="source-over",t[r.BLEND_MODES.LUMINOSITY]="source-over"),t}},{"../../../const":78,"./canUseNewCanvasBlendModes":112}],114:[function(t,e,i){function r(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=3600,this.checkCountMax=600,this.mode=n.GC_MODES.DEFAULT}var n=t("../../const");r.prototype.constructor=r,e.exports=r,r.prototype.update=function(){this.count++,this.mode!==n.GC_MODES.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run()))},r.prototype.run=function(){var t,e,i=this.renderer.textureManager,r=i._managedTextures,n=!1;for(t=0;t<r.length;t++){var s=r[t];!s._glRenderTargets&&this.count-s.touched>this.maxIdle&&(i.destroyTexture(s,!0),r[t]=null,n=!0)}if(n){for(e=0,t=0;t<r.length;t++)null!==r[t]&&(r[e++]=r[t]);r.length=e}},r.prototype.unload=function(t){var e=this.renderer.textureManager;t._texture&&e.destroyTexture(t._texture,!0);for(var i=t.children.length-1;i>=0;i--)this.unload(t.children[i])}},{"../../const":78}],115:[function(t,e,i){var r=t("pixi-gl-core").GLTexture,n=t("../../const"),s=t("./utils/RenderTarget"),o=t("../../utils"),a=function(t){this.renderer=t,this.gl=t.gl,this._managedTextures=[]};a.prototype.bindTexture=function(){},a.prototype.getTexture=function(){},a.prototype.updateTexture=function(t){var e=!!(t=t.baseTexture||t)._glRenderTargets;if(t.hasLoaded){var i=t._glTextures[this.renderer.CONTEXT_UID];if(i)e?t._glRenderTargets[this.renderer.CONTEXT_UID].resize(t.width,t.height):i.upload(t.source);else{if(e){var o=new s(this.gl,t.width,t.height,t.scaleMode,t.resolution);o.resize(t.width,t.height),t._glRenderTargets[this.renderer.CONTEXT_UID]=o,i=o.texture}else(i=new r(this.gl)).premultiplyAlpha=!0,i.upload(t.source);t._glTextures[this.renderer.CONTEXT_UID]=i,t.on("update",this.updateTexture,this),t.on("dispose",this.destroyTexture,this),this._managedTextures.push(t),t.isPowerOfTwo?(t.mipmap&&i.enableMipmap(),t.wrapMode===n.WRAP_MODES.CLAMP?i.enableWrapClamp():t.wrapMode===n.WRAP_MODES.REPEAT?i.enableWrapRepeat():i.enableWrapMirrorRepeat()):i.enableWrapClamp(),t.scaleMode===n.SCALE_MODES.NEAREST?i.enableNearestScaling():i.enableLinearScaling()}return i}},a.prototype.destroyTexture=function(t,e){if((t=t.baseTexture||t).hasLoaded&&t._glTextures[this.renderer.CONTEXT_UID]&&(t._glTextures[this.renderer.CONTEXT_UID].destroy(),t.off("update",this.updateTexture,this),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.renderer.CONTEXT_UID],!e)){var i=this._managedTextures.indexOf(t);-1!==i&&o.removeItems(this._managedTextures,i,1)}},a.prototype.removeAll=function(){for(var t=0;t<this._managedTextures.length;++t){var e=this._managedTextures[t];e._glTextures[this.renderer.CONTEXT_UID]&&delete e._glTextures[this.renderer.CONTEXT_UID]}},a.prototype.destroy=function(){for(var t=0;t<this._managedTextures.length;++t){var e=this._managedTextures[t];this.destroyTexture(e,!0),e.off("update",this.updateTexture,this),e.off("dispose",this.destroyTexture,this)}this._managedTextures=null},e.exports=a},{"../../const":78,"../../utils":151,"./utils/RenderTarget":128,"pixi-gl-core":7}],116:[function(t,e,i){function r(t,e,i){i=i||{},n.call(this,"WebGL",t,e,i),this.type=y.RENDERER_TYPE.WEBGL,this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this),this.view.addEventListener("webglcontextlost",this.handleContextLost,!1),this.view.addEventListener("webglcontextrestored",this.handleContextRestored,!1),this._contextOptions={alpha:this.transparent,antialias:i.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:i.preserveDrawingBuffer},this._backgroundColorRgba[3]=this.transparent?0:1,this.maskManager=new s(this),this.stencilManager=new o(this),this.emptyRenderer=new l(this),this.currentRenderer=this.emptyRenderer,this.initPlugins(),i.context&&g(i.context),this.gl=i.context||p(this.view,this._contextOptions),this.CONTEXT_UID=x++,this.state=new d(this.gl),this.renderingToScreen=!0,this._initContext(),this.filterManager=new a(this),this.drawModes=f(this.gl),this._activeShader=null,this._activeRenderTarget=null,this._activeTextureLocation=999,this._activeTexture=null,this.setBlendMode(0)}var n=t("../SystemRenderer"),s=t("./managers/MaskManager"),o=t("./managers/StencilManager"),a=t("./managers/FilterManager"),h=t("./utils/RenderTarget"),l=t("./utils/ObjectRenderer"),c=t("./TextureManager"),u=t("./TextureGarbageCollector"),d=t("./WebGLState"),p=t("pixi-gl-core").createContext,f=t("./utils/mapWebGLDrawModesToPixi"),g=t("./utils/validateContext"),v=t("../../utils"),m=t("pixi-gl-core"),y=t("../../const"),x=0;r.prototype=Object.create(n.prototype),r.prototype.constructor=r,e.exports=r,v.pluginTarget.mixin(r),r.prototype._initContext=function(){var t=this.gl;this.textureManager=new c(this),this.textureGC=new u(this),this.state.resetToDefault(),this.rootRenderTarget=new h(t,this.width,this.height,null,this.resolution,!0),this.rootRenderTarget.clearColor=this._backgroundColorRgba,this.bindRenderTarget(this.rootRenderTarget),this.emit("context",t),this.resize(this.width,this.height)},r.prototype.render=function(t,e,i,r,n){if(this.renderingToScreen=!e,this.emit("prerender"),this.gl&&!this.gl.isContextLost()){if(e||(this._lastObjectRendered=t),!n){var s=t.parent;t.parent=this._tempDisplayObjectParent,t.updateTransform(),t.parent=s}this.bindRenderTexture(e,r),this.currentRenderer.start(),(void 0!==i?i:this.clearBeforeRender)&&this._activeRenderTarget.clear(),t.renderWebGL(this),this.currentRenderer.flush(),this.textureGC.update(),this.emit("postrender")}},r.prototype.setObjectRenderer=function(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())},r.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},r.prototype.resize=function(t,e){n.prototype.resize.call(this,t,e),this.rootRenderTarget.resize(t,e),this._activeRenderTarget===this.rootRenderTarget&&(this.rootRenderTarget.activate(),this._activeShader&&(this._activeShader.uniforms.projectionMatrix=this.rootRenderTarget.projectionMatrix.toArray(!0)))},r.prototype.setBlendMode=function(t){this.state.setBlendMode(t)},r.prototype.clear=function(t){this._activeRenderTarget.clear(t)},r.prototype.setTransform=function(t){this._activeRenderTarget.transform=t},r.prototype.bindRenderTexture=function(t,e){var i;if(t){var r=t.baseTexture,n=this.gl;r._glRenderTargets[this.CONTEXT_UID]?(this._activeTextureLocation=r._id,n.activeTexture(n.TEXTURE0+r._id),n.bindTexture(n.TEXTURE_2D,null)):(this.textureManager.updateTexture(r),n.bindTexture(n.TEXTURE_2D,null)),(i=r._glRenderTargets[this.CONTEXT_UID]).setFrame(t.frame)}else i=this.rootRenderTarget;return i.transform=e,this.bindRenderTarget(i),this},r.prototype.bindRenderTarget=function(t){return t!==this._activeRenderTarget&&(this._activeRenderTarget=t,t.activate(),this._activeShader&&(this._activeShader.uniforms.projectionMatrix=t.projectionMatrix.toArray(!0)),this.stencilManager.setMaskStack(t.stencilMaskStack)),this},r.prototype.bindShader=function(t){return this._activeShader!==t&&(this._activeShader=t,t.bind(),t.uniforms.projectionMatrix=this._activeRenderTarget.projectionMatrix.toArray(!0)),this},r.prototype.bindTexture=function(t,e){t=t.baseTexture||t;var i=this.gl;return e=e||0,this._activeTextureLocation!==e&&(this._activeTextureLocation=e,i.activeTexture(i.TEXTURE0+e)),this._activeTexture=t,t._glTextures[this.CONTEXT_UID]?(t.touched=this.textureGC.count,t._glTextures[this.CONTEXT_UID].bind()):this.textureManager.updateTexture(t),this},r.prototype.createVao=function(){return new m.VertexArrayObject(this.gl,this.state.attribState)},r.prototype.reset=function(){return this.setObjectRenderer(this.emptyRenderer),this._activeShader=null,this._activeRenderTarget=this.rootRenderTarget,this._activeTextureLocation=999,this._activeTexture=null,this.rootRenderTarget.activate(),this.state.resetToDefault(),this},r.prototype.handleContextLost=function(t){t.preventDefault()},r.prototype.handleContextRestored=function(){this._initContext(),this.textureManager.removeAll()},r.prototype.destroy=function(t){this.destroyPlugins(),this.view.removeEventListener("webglcontextlost",this.handleContextLost),this.view.removeEventListener("webglcontextrestored",this.handleContextRestored),this.textureManager.destroy(),n.prototype.destroy.call(this,t),this.uid=0,this.maskManager.destroy(),this.stencilManager.destroy(),this.filterManager.destroy(),this.maskManager=null,this.filterManager=null,this.textureManager=null,this.currentRenderer=null,this.handleContextLost=null,this.handleContextRestored=null,this._contextOptions=null,this.gl.useProgram(null),this.gl.getExtension("WEBGL_lose_context")&&this.gl.getExtension("WEBGL_lose_context").loseContext(),this.gl=null}},{"../../const":78,"../../utils":151,"../SystemRenderer":108,"./TextureGarbageCollector":114,"./TextureManager":115,"./WebGLState":117,"./managers/FilterManager":122,"./managers/MaskManager":123,"./managers/StencilManager":124,"./utils/ObjectRenderer":126,"./utils/RenderTarget":128,"./utils/mapWebGLDrawModesToPixi":131,"./utils/validateContext":132,"pixi-gl-core":7}],117:[function(t,e,i){function r(t){this.activeState=new Uint8Array(16),this.defaultState=new Uint8Array(16),this.defaultState[0]=1,this.stackIndex=0,this.stack=[],this.gl=t,this.maxAttribs=t.getParameter(t.MAX_VERTEX_ATTRIBS),this.attribState={tempAttribState:new Array(this.maxAttribs),attribState:new Array(this.maxAttribs)},this.blendModes=n(t),this.nativeVaoExtension=t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object")}var n=t("./utils/mapWebGLBlendModesToPixi");r.prototype.push=function(){var t=this.stack[++this.stackIndex];t||(t=this.stack[this.stackIndex]=new Uint8Array(16));for(var e=0;e<this.activeState.length;e++)this.activeState[e]=t[e]};r.prototype.pop=function(){var t=this.stack[--this.stackIndex];this.setState(t)},r.prototype.setState=function(t){this.setBlend(t[0]),this.setDepthTest(t[1]),this.setFrontFace(t[2]),this.setCullFace(t[3]),this.setBlendMode(t[4])},r.prototype.setBlend=function(t){if(!(this.activeState[0]===t|0)){this.activeState[0]=0|t;var e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND)}},r.prototype.setBlendMode=function(t){t!==this.activeState[4]&&(this.activeState[4]=t,this.gl.blendFunc(this.blendModes[t][0],this.blendModes[t][1]))},r.prototype.setDepthTest=function(t){if(!(this.activeState[1]===t|0)){this.activeState[1]=0|t;var e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST)}},r.prototype.setCullFace=function(t){if(!(this.activeState[3]===t|0)){this.activeState[3]=0|t;var e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE)}},r.prototype.setFrontFace=function(t){if(!(this.activeState[2]===t|0)){this.activeState[2]=0|t;var e=this.gl;t?e.frontFace(e.CW):e.frontFace(e.CCW)}},r.prototype.resetAttributes=function(){var t;for(t=0;t<this.attribState.tempAttribState.length;t++)this.attribState.tempAttribState[t]=0;for(t=0;t<this.attribState.attribState.length;t++)this.attribState.attribState[t]=0;var e=this.gl;for(t=1;t<this.maxAttribs;t++)e.disableVertexAttribArray(t)},r.prototype.resetToDefault=function(){this.nativeVaoExtension&&this.nativeVaoExtension.bindVertexArrayOES(null),this.resetAttributes();for(var t=0;t<this.activeState.length;t++)this.activeState[t]=32;var e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),this.setState(this.defaultState)},e.exports=r},{"./utils/mapWebGLBlendModesToPixi":130}],118:[function(t,e,i){function r(t,e,i){for(var h in this.vertexSrc=t||r.defaultVertexSrc,this.fragmentSrc=e||r.defaultFragmentSrc,this.blendMode=o.BLEND_MODES.NORMAL,this.uniformData=i||n(this.vertexSrc,this.fragmentSrc,"projectionMatrix|uSampler"),this.uniforms={},this.uniformData)this.uniforms[h]=this.uniformData[h].value;this.glShaders=[],a[this.vertexSrc+this.fragmentSrc]||(a[this.vertexSrc+this.fragmentSrc]=s.uid()),this.glShaderKey=a[this.vertexSrc+this.fragmentSrc],this.padding=4,this.resolution=1,this.enabled=!0}var n=t("./extractUniformsFromSrc"),s=t("../../../utils"),o=t("../../../const"),a={};e.exports=r,r.prototype.apply=function(t,e,i,r){t.applyFilter(this,e,i,r)},r.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 projectionMatrix;","uniform mat3 filterMatrix;","varying vec2 vTextureCoord;","varying vec2 vFilterCoord;","void main(void){","   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vFilterCoord = ( filterMatrix * vec3( aTextureCoord, 1.0)  ).xy;","   vTextureCoord = aTextureCoord ;","}"].join("\n"),r.defaultFragmentSrc=["varying vec2 vTextureCoord;","varying vec2 vFilterCoord;","uniform sampler2D uSampler;","uniform sampler2D filterSampler;","void main(void){","   vec4 masky = texture2D(filterSampler, vFilterCoord);","   vec4 sample = texture2D(uSampler, vTextureCoord);","   vec4 color;","   if(mod(vFilterCoord.x, 1.0) > 0.5)","   {","     color = vec4(1.0, 0.0, 0.0, 1.0);","   }","   else","   {","     color = vec4(0.0, 1.0, 0.0, 1.0);","   }","   gl_FragColor = mix(sample, masky, 0.5);","   gl_FragColor *= sample.a;","}"].join("\n")},{"../../../const":78,"../../../utils":151,"./extractUniformsFromSrc":119}],119:[function(t,e,i){function r(t){for(var e,i=new RegExp("^(projectionMatrix|uSampler|filterArea)$"),r={},s=t.replace(/\s+/g," ").split(/\s*;\s*/),o=0;o<s.length;o++){var a=s[o].trim();if(a.indexOf("uniform")>-1){var h=a.split(" "),l=h[1],c=h[2],u=1;c.indexOf("[")>-1&&(e=c.split(/\[|\]/),c=e[0],u*=Number(e[1])),c.match(i)||(r[c]={value:n(l,u),name:c,type:l})}}return r}var n=t("pixi-gl-core").shader.defaultValue;e.exports=function(t,e,i){var n=r(t),s=r(e);return Object.assign(n,s)}},{"pixi-gl-core":7}],120:[function(t,e,i){var r=t("../../../math");e.exports={calculateScreenSpaceMatrix:function(t,e,i){var r=t.identity();return r.translate(e.x/i.width,e.y/i.height),r.scale(i.width,i.height),r},calculateNormalizedScreenSpaceMatrix:function(t,e,i){var r=t.identity();r.translate(e.x/i.width,e.y/i.height);var n=i.width/e.width,s=i.height/e.height;return r.scale(n,s),r},calculateSpriteMatrix:function(t,e,i,n){var s=n.worldTransform.copy(r.Matrix.TEMP_MATRIX),o=n._texture.baseTexture,a=t.identity(),h=i.height/i.width;a.translate(e.x/i.width,e.y/i.height),a.scale(1,h);var l=i.width/o.width,c=i.height/o.height;return s.tx/=o.width*l,s.ty/=o.width*l,s.invert(),a.prepend(s),a.scale(1,1/h),a.scale(l,c),a.translate(n.anchor.x,n.anchor.y),a}}},{"../../../math":102}],121:[function(t,e,i){function r(t){var e=new s.Matrix;n.call(this,"#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n","#define GLSLIFY 1\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float alpha;\nuniform sampler2D mask;\n\nvoid main(void)\n{\n    // check clip! this will stop the mask bleeding out from the edges\n    vec2 text = abs( vMaskCoord - 0.5 );\n    text = step(0.5, text);\n    float clip = 1.0 - max(text.y, text.x);\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    original *= (masky.r * masky.a * alpha * clip);\n    gl_FragColor = original;\n}\n"),t.renderable=!1,this.maskSprite=t,this.maskMatrix=e}var n=t("../Filter"),s=t("../../../../math");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,e.exports=r,r.prototype.apply=function(t,e,i){var r=this.maskSprite;this.uniforms.mask=r._texture,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,r),this.uniforms.alpha=r.worldAlpha,t.applyFilter(this,e,i)}},{"../../../../math":102,"../Filter":118}],122:[function(t,e,i){function r(t){n.call(this,t),this.gl=this.renderer.gl,this.quad=new o(this.gl,t.state.attribState),this.shaderCache={},this.pool={},this.filterData=null}var n=t("./WebGLManager"),s=t("../utils/RenderTarget"),o=t("../utils/Quad"),a=t("../../../math"),h=t("../../../Shader"),l=t("../filters/filterTransforms"),c=t("bit-twiddle"),u=function(){this.renderTarget=null,this.sourceFrame=new a.Rectangle,this.destinationFrame=new a.Rectangle,this.filters=[],this.target=null,this.resolution=1};r.prototype=Object.create(n.prototype),r.prototype.constructor=r,e.exports=r,r.prototype.pushFilter=function(t,e){var i=this.renderer,r=this.filterData;if(!r){r=this.renderer._activeRenderTarget.filterStack;var n=new u;n.sourceFrame=n.destinationFrame=this.renderer._activeRenderTarget.size,n.renderTarget=i._activeRenderTarget,this.renderer._activeRenderTarget.filterData=r={index:0,stack:[n]},this.filterData=r}var s=r.stack[++r.index];s||(s=r.stack[r.index]=new u);var o=e[0].resolution,a=e[0].padding,h=t.filterArea||t.getBounds(!0),l=s.sourceFrame,c=s.destinationFrame;l.x=(h.x*o|0)/o,l.y=(h.y*o|0)/o,l.width=(h.width*o|0)/o,l.height=(h.height*o|0)/o,r.stack[0].renderTarget.transform||l.fit(r.stack[0].destinationFrame),l.pad(a),c.width=l.width,c.height=l.height;var d=this.getPotRenderTarget(i.gl,l.width,l.height,o);s.target=t,s.filters=e,s.resolution=o,s.renderTarget=d,d.setFrame(c,l),i.bindRenderTarget(d),i.clear()},r.prototype.popFilter=function(){var t=this.filterData,e=t.stack[t.index-1],i=t.stack[t.index];this.quad.map(i.renderTarget.size,i.sourceFrame).upload();var r=i.filters;if(1===r.length)r[0].apply(this,i.renderTarget,e.renderTarget,!1),this.freePotRenderTarget(i.renderTarget);else{var n=i.renderTarget,s=this.getPotRenderTarget(this.renderer.gl,i.sourceFrame.width,i.sourceFrame.height,1);s.setFrame(i.destinationFrame,i.sourceFrame);for(var o=0;o<r.length-1;o++){r[o].apply(this,n,s,!0);var a=n;n=s,s=a}r[o].apply(this,n,e.renderTarget,!1),this.freePotRenderTarget(n),this.freePotRenderTarget(s)}t.index--,0===t.index&&(this.filterData=null)},r.prototype.applyFilter=function(t,e,i,r){var n=this.renderer,s=t.glShaders[n.CONTEXT_UID];if(s||(t.glShaderKey?(s=this.shaderCache[t.glShaderKey])||(s=t.glShaders[n.CONTEXT_UID]=this.shaderCache[t.glShaderKey]=new h(this.gl,t.vertexSrc,t.fragmentSrc)):s=t.glShaders[n.CONTEXT_UID]=new h(this.gl,t.vertexSrc,t.fragmentSrc),this.quad.initVao(s)),n.bindRenderTarget(i),r){var o=n.gl;o.disable(o.SCISSOR_TEST),n.clear(),o.enable(o.SCISSOR_TEST)}i===n.maskManager.scissorRenderTarget&&n.maskManager.pushScissorMask(null,n.maskManager.scissorData),n.bindShader(s),this.syncUniforms(s,t),e.texture.bind(0),n._activeTextureLocation=0,n.state.setBlendMode(t.blendMode),this.quad.draw()},r.prototype.syncUniforms=function(t,e){var i,r,n=e.uniformData,s=e.uniforms,o=1;if(t.uniforms.data.filterArea){i=this.filterData.stack[this.filterData.index];var a=t.uniforms.filterArea;a[0]=i.renderTarget.size.width,a[1]=i.renderTarget.size.height,a[2]=i.sourceFrame.x,a[3]=i.sourceFrame.y,t.uniforms.filterArea=a}if(t.uniforms.data.filterClamp){i=this.filterData.stack[this.filterData.index];var h=t.uniforms.filterClamp;h[0]=.5/i.renderTarget.size.width,h[1]=.5/i.renderTarget.size.height,h[2]=(i.sourceFrame.width-.5)/i.renderTarget.size.width,h[3]=(i.sourceFrame.height-.5)/i.renderTarget.size.height,t.uniforms.filterClamp=h}for(var l in n)if("sampler2D"===n[l].type){if(t.uniforms[l]=o,s[l].baseTexture)this.renderer.bindTexture(s[l].baseTexture,o);else{var c=this.renderer.gl;this.renderer._activeTextureLocation=c.TEXTURE0+o,c.activeTexture(c.TEXTURE0+o),s[l].texture.bind()}o++}else"mat3"===n[l].type?void 0!==s[l].a?t.uniforms[l]=s[l].toArray(!0):t.uniforms[l]=s[l]:"vec2"===n[l].type?void 0!==s[l].x?((r=t.uniforms[l]||new Float32Array(2))[0]=s[l].x,r[1]=s[l].y,t.uniforms[l]=r):t.uniforms[l]=s[l]:"float"===n[l].type?t.uniforms.data[l].value!==n[l]&&(t.uniforms[l]=s[l]):t.uniforms[l]=s[l]},r.prototype.getRenderTarget=function(t,e){var i=this.filterData.stack[this.filterData.index],r=this.getPotRenderTarget(this.renderer.gl,i.sourceFrame.width,i.sourceFrame.height,e||i.resolution);return r.setFrame(i.destinationFrame,i.sourceFrame),r},r.prototype.returnRenderTarget=function(t){return this.freePotRenderTarget(t)},r.prototype.calculateScreenSpaceMatrix=function(t){var e=this.filterData.stack[this.filterData.index];return l.calculateScreenSpaceMatrix(t,e.sourceFrame,e.renderTarget.size)},r.prototype.calculateNormalizedScreenSpaceMatrix=function(t){var e=this.filterData.stack[this.filterData.index];return l.calculateNormalizedScreenSpaceMatrix(t,e.sourceFrame,e.renderTarget.size,e.destinationFrame)},r.prototype.calculateSpriteMatrix=function(t,e){var i=this.filterData.stack[this.filterData.index];return l.calculateSpriteMatrix(t,i.sourceFrame,i.renderTarget.size,e)},r.prototype.destroy=function(){this.shaderCache=[],this.emptyPool()},r.prototype.getPotRenderTarget=function(t,e,i,r){var n=(65535&(e=c.nextPow2(e*r)))<<16|65535&(i=c.nextPow2(i*r));this.pool[n]||(this.pool[n]=[]);var o=this.pool[n].pop()||new s(t,e,i,null,1);return o.resolution=r,o.defaultFrame.width=o.size.width=e/r,o.defaultFrame.height=o.size.height=i/r,o},r.prototype.emptyPool=function(){for(var t in this.pool){var e=this.pool[t];if(e)for(var i=0;i<e.length;i++)e[i].destroy(!0)}this.pool={}},r.prototype.freePotRenderTarget=function(t){var e=(65535&t.size.width*t.resolution)<<16|65535&t.size.height*t.resolution;this.pool[e].push(t)}},{"../../../Shader":77,"../../../math":102,"../filters/filterTransforms":120,"../utils/Quad":127,"../utils/RenderTarget":128,"./WebGLManager":125,"bit-twiddle":30}],123:[function(t,e,i){function r(t){n.call(this,t),this.scissor=!1,this.scissorData=null,this.scissorRenderTarget=null,this.enableScissor=!0,this.alphaMaskPool=[],this.alphaMaskIndex=0}var n=t("./WebGLManager"),s=t("../filters/spriteMask/SpriteMaskFilter");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,e.exports=r,r.prototype.pushMask=function(t,e){if(e.texture)this.pushSpriteMask(t,e);else if(this.enableScissor&&!this.scissor&&!this.renderer.stencilManager.stencilMaskStack.length&&e.isFastRect()){var i=e.worldTransform,r=Math.atan2(i.b,i.a);(r=Math.round(r*(180/Math.PI)))%90?this.pushStencilMask(e):this.pushScissorMask(t,e)}else this.pushStencilMask(e)},r.prototype.popMask=function(t,e){e.texture?this.popSpriteMask(t,e):this.enableScissor&&!this.renderer.stencilManager.stencilMaskStack.length?this.popScissorMask(t,e):this.popStencilMask(t,e)},r.prototype.pushSpriteMask=function(t,e){var i=this.alphaMaskPool[this.alphaMaskIndex];i||(i=this.alphaMaskPool[this.alphaMaskIndex]=[new s(e)]),i[0].resolution=this.renderer.resolution,i[0].maskSprite=e,t.filterArea=e.getBounds(!0),this.renderer.filterManager.pushFilter(t,i),this.alphaMaskIndex++},r.prototype.popSpriteMask=function(){this.renderer.filterManager.popFilter(),this.alphaMaskIndex--},r.prototype.pushStencilMask=function(t){this.renderer.currentRenderer.stop(),this.renderer.stencilManager.pushStencil(t)},r.prototype.popStencilMask=function(){this.renderer.currentRenderer.stop(),this.renderer.stencilManager.popStencil()},r.prototype.pushScissorMask=function(t,e){e.renderable=!0;var i=this.renderer._activeRenderTarget,r=e.getBounds();r.fit(i.size),e.renderable=!1,this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST);var n=this.renderer.resolution;this.renderer.gl.scissor(r.x*n,(i.root?i.size.height-r.y-r.height:r.y)*n,r.width*n,r.height*n),this.scissorRenderTarget=i,this.scissorData=e,this.scissor=!0},r.prototype.popScissorMask=function(){this.scissorRenderTarget=null,this.scissorData=null,this.scissor=!1;var t=this.renderer.gl;t.disable(t.SCISSOR_TEST)}},{"../filters/spriteMask/SpriteMaskFilter":121,"./WebGLManager":125}],124:[function(t,e,i){function r(t){n.call(this,t),this.stencilMaskStack=null}var n=t("./WebGLManager");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,e.exports=r,r.prototype.setMaskStack=function(t){this.stencilMaskStack=t;var e=this.renderer.gl;0===t.length?e.disable(e.STENCIL_TEST):e.enable(e.STENCIL_TEST)},r.prototype.pushStencil=function(t){this.renderer.setObjectRenderer(this.renderer.plugins.graphics),this.renderer._activeRenderTarget.attachStencilBuffer();var e=this.renderer.gl,i=this.stencilMaskStack;0===i.length&&(e.enable(e.STENCIL_TEST),e.clear(e.STENCIL_BUFFER_BIT),e.stencilFunc(e.ALWAYS,1,1)),i.push(t),e.colorMask(!1,!1,!1,!1),e.stencilOp(e.KEEP,e.KEEP,e.INCR),this.renderer.plugins.graphics.render(t),e.colorMask(!0,!0,!0,!0),e.stencilFunc(e.NOTEQUAL,0,i.length),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)},r.prototype.popStencil=function(){this.renderer.setObjectRenderer(this.renderer.plugins.graphics);var t=this.renderer.gl,e=this.stencilMaskStack,i=e.pop();0===e.length?t.disable(t.STENCIL_TEST):(t.colorMask(!1,!1,!1,!1),t.stencilOp(t.KEEP,t.KEEP,t.DECR),this.renderer.plugins.graphics.render(i),t.colorMask(!0,!0,!0,!0),t.stencilFunc(t.NOTEQUAL,0,e.length),t.stencilOp(t.KEEP,t.KEEP,t.KEEP))},r.prototype.destroy=function(){n.prototype.destroy.call(this),this.stencilMaskStack.stencilStack=null}},{"./WebGLManager":125}],125:[function(t,e,i){function r(t){this.renderer=t,this.renderer.on("context",this.onContextChange,this)}r.prototype.constructor=r,e.exports=r,r.prototype.onContextChange=function(){},r.prototype.destroy=function(){this.renderer.off("context",this.onContextChange,this),this.renderer=null}},{}],126:[function(t,e,i){function r(t){n.call(this,t)}var n=t("../managers/WebGLManager");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,e.exports=r,r.prototype.start=function(){},r.prototype.stop=function(){this.flush()},r.prototype.flush=function(){},r.prototype.render=function(t){}},{"../managers/WebGLManager":125}],127:[function(t,e,i){function r(t,e){this.gl=t,this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.interleaved=new Float32Array(16);for(var i=0;i<4;i++)this.interleaved[4*i]=this.vertices[2*i],this.interleaved[4*i+1]=this.vertices[2*i+1],this.interleaved[4*i+2]=this.uvs[2*i],this.interleaved[4*i+3]=this.uvs[2*i+1];this.indices=s(1),this.vertexBuffer=n.GLBuffer.createVertexBuffer(t,this.interleaved,t.STATIC_DRAW),this.indexBuffer=n.GLBuffer.createIndexBuffer(t,this.indices,t.STATIC_DRAW),this.vao=new n.VertexArrayObject(t,e)}var n=t("pixi-gl-core"),s=t("../../../utils/createIndicesForQuads");r.prototype.constructor=r,r.prototype.initVao=function(t){this.vao.clear().addIndex(this.indexBuffer).addAttribute(this.vertexBuffer,t.attributes.aVertexPosition,this.gl.FLOAT,!1,16,0).addAttribute(this.vertexBuffer,t.attributes.aTextureCoord,this.gl.FLOAT,!1,16,8)},r.prototype.map=function(t,e){var i=0,r=0;return this.uvs[0]=i,this.uvs[1]=r,this.uvs[2]=i+e.width/t.width,this.uvs[3]=r,this.uvs[4]=i+e.width/t.width,this.uvs[5]=r+e.height/t.height,this.uvs[6]=i,this.uvs[7]=r+e.height/t.height,i=e.x,r=e.y,this.vertices[0]=i,this.vertices[1]=r,this.vertices[2]=i+e.width,this.vertices[3]=r,this.vertices[4]=i+e.width,this.vertices[5]=r+e.height,this.vertices[6]=i,this.vertices[7]=r+e.height,this},r.prototype.draw=function(){return this.vao.bind().draw(this.gl.TRIANGLES,6,0).unbind(),this},r.prototype.upload=function(){for(var t=0;t<4;t++)this.interleaved[4*t]=this.vertices[2*t],this.interleaved[4*t+1]=this.vertices[2*t+1],this.interleaved[4*t+2]=this.uvs[2*t],this.interleaved[4*t+3]=this.uvs[2*t+1];return this.vertexBuffer.upload(this.interleaved),this},r.prototype.destroy=function(){var t=this.gl;t.deleteBuffer(this.vertexBuffer),t.deleteBuffer(this.indexBuffer)},e.exports=r},{"../../../utils/createIndicesForQuads":149,"pixi-gl-core":7}],128:[function(t,e,i){var r=t("../../../math"),n=t("../../../const"),s=t("pixi-gl-core").GLFramebuffer,o=function(t,e,i,o,a,h){this.gl=t,this.frameBuffer=null,this.texture=null,this.clearColor=[0,0,0,0],this.size=new r.Rectangle(0,0,1,1),this.resolution=a||n.RESOLUTION,this.projectionMatrix=new r.Matrix,this.transform=null,this.frame=null,this.defaultFrame=new r.Rectangle,this.destinationFrame=null,this.sourceFrame=null,this.stencilBuffer=null,this.stencilMaskStack=[],this.filterData=null,this.scaleMode=o||n.SCALE_MODES.DEFAULT,this.root=h,this.root?(this.frameBuffer=new s(t,100,100),this.frameBuffer.framebuffer=null):(this.frameBuffer=s.createRGBA(t,100,100),this.scaleMode===n.SCALE_MODES.NEAREST?this.frameBuffer.texture.enableNearestScaling():this.frameBuffer.texture.enableLinearScaling(),this.texture=this.frameBuffer.texture),this.setFrame(),this.resize(e,i)};o.prototype.constructor=o,e.exports=o,o.prototype.clear=function(t){var e=t||this.clearColor;this.frameBuffer.clear(e[0],e[1],e[2],e[3])},o.prototype.attachStencilBuffer=function(){this.root||this.frameBuffer.enableStencil()},o.prototype.setFrame=function(t,e){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t},o.prototype.activate=function(){var t=this.gl;this.frameBuffer.bind(),this.calculateProjection(this.destinationFrame,this.sourceFrame),this.transform&&this.projectionMatrix.append(this.transform),this.destinationFrame!==this.sourceFrame?(t.enable(t.SCISSOR_TEST),t.scissor(0|this.destinationFrame.x,0|this.destinationFrame.y,this.destinationFrame.width*this.resolution|0,this.destinationFrame.height*this.resolution|0)):t.disable(t.SCISSOR_TEST),t.viewport(0|this.destinationFrame.x,0|this.destinationFrame.y,this.destinationFrame.width*this.resolution|0,this.destinationFrame.height*this.resolution|0)},o.prototype.calculateProjection=function(t,e){var i=this.projectionMatrix;e=e||t,i.identity(),this.root?(i.a=1/t.width*2,i.d=-1/t.height*2,i.tx=-1-e.x*i.a,i.ty=1-e.y*i.d):(i.a=1/t.width*2,i.d=1/t.height*2,i.tx=-1-e.x*i.a,i.ty=-1-e.y*i.d)},o.prototype.resize=function(t,e){if(t|=0,e|=0,this.size.width!==t||this.size.height!==e){this.size.width=t,this.size.height=e,this.defaultFrame.width=t,this.defaultFrame.height=e,this.frameBuffer.resize(t*this.resolution,e*this.resolution);var i=this.frame||this.size;this.calculateProjection(i)}},o.prototype.destroy=function(){this.frameBuffer.destroy(),this.frameBuffer=null,this.texture=null}},{"../../../const":78,"../../../math":102,"pixi-gl-core":7}],129:[function(t,e,i){function r(t){for(var e="",i=0;i<t;i++)i>0&&(e+="\nelse "),i<t-1&&(e+="if(test == "+i+".0){}");return e}var n=t("pixi-gl-core"),s=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");e.exports=function(t,e){var i=!e;if(i){var o=document.createElement("canvas");o.width=1,o.height=1,e=n.createContext(o)}for(var a=e.createShader(e.FRAGMENT_SHADER);;){var h=s.replace(/%forloop%/gi,r(t));if(e.shaderSource(a,h),e.compileShader(a),e.getShaderParameter(a,e.COMPILE_STATUS))break;t=t/2|0}return i&&e.getExtension("WEBGL_lose_context")&&e.getExtension("WEBGL_lose_context").loseContext(),t}},{"pixi-gl-core":7}],130:[function(t,e,i){var r=t("../../../const");e.exports=function(t,e){return(e=e||[])[r.BLEND_MODES.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.BLEND_MODES.ADD]=[t.ONE,t.DST_ALPHA],e[r.BLEND_MODES.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA],e[r.BLEND_MODES.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR],e[r.BLEND_MODES.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.BLEND_MODES.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.BLEND_MODES.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.BLEND_MODES.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.BLEND_MODES.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.BLEND_MODES.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.BLEND_MODES.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.BLEND_MODES.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.BLEND_MODES.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.BLEND_MODES.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.BLEND_MODES.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.BLEND_MODES.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[r.BLEND_MODES.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e}},{"../../../const":78}],131:[function(t,e,i){var r=t("../../../const");e.exports=function(t,e){(e=e||{})[r.DRAW_MODES.POINTS]=t.POINTS,e[r.DRAW_MODES.LINES]=t.LINES,e[r.DRAW_MODES.LINE_LOOP]=t.LINE_LOOP,e[r.DRAW_MODES.LINE_STRIP]=t.LINE_STRIP,e[r.DRAW_MODES.TRIANGLES]=t.TRIANGLES,e[r.DRAW_MODES.TRIANGLE_STRIP]=t.TRIANGLE_STRIP,e[r.DRAW_MODES.TRIANGLE_FAN]=t.TRIANGLE_FAN}},{"../../../const":78}],132:[function(t,e,i){e.exports=function(t){t.getContextAttributes().stencil||console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly")}},{}],133:[function(t,e,i){function r(t){o.call(this),this.anchor=new n.ObservablePoint(this.onAnchorUpdate,this),this._texture=null,this._width=0,this._height=0,this._tint=null,this._tintRGB=null,this.tint=16777215,this.blendMode=h.BLEND_MODES.NORMAL,this.shader=null,this.cachedTint=16777215,this.texture=t||s.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1}var n=t("../math"),s=t("../textures/Texture"),o=t("../display/Container"),a=t("../utils"),h=t("../const"),l=new n.Point;r.prototype=Object.create(o.prototype),r.prototype.constructor=r,e.exports=r,Object.defineProperties(r.prototype,{width:{get:function(){return Math.abs(this.scale.x)*this.texture.orig.width},set:function(t){var e=a.sign(this.scale.x)||1;this.scale.x=e*t/this.texture.orig.width,this._width=t}},height:{get:function(){return Math.abs(this.scale.y)*this.texture.orig.height},set:function(t){var e=a.sign(this.scale.y)||1;this.scale.y=e*t/this.texture.orig.height,this._height=t}},tint:{get:function(){return this._tint},set:function(t){this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16)}},texture:{get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture=t,this.cachedTint=16777215,this._textureID=-1,t&&(t.baseTexture.hasLoaded?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}}),r.prototype._onTextureUpdate=function(){this._textureID=-1,this._width&&(this.scale.x=a.sign(this.scale.x)*this._width/this.texture.orig.width),this._height&&(this.scale.y=a.sign(this.scale.y)*this._height/this.texture.orig.height)},r.prototype.onAnchorUpdate=function(){this._transformID=-1},r.prototype.calculateVertices=function(){if(this._transformID!==this.transform._worldID||this._textureID!==this._texture._updateID){this._transformID=this.transform._worldID,this._textureID=this._texture._updateID;var t,e,i,r,n=this._texture,s=this.transform.worldTransform,o=s.a,a=s.b,h=s.c,l=s.d,c=s.tx,u=s.ty,d=this.vertexData,p=n.trim,f=n.orig;p?(t=(e=p.x-this.anchor._x*f.width)+p.width,i=(r=p.y-this.anchor._y*f.height)+p.height):(t=f.width*(1-this.anchor._x),e=f.width*-this.anchor._x,i=f.height*(1-this.anchor._y),r=f.height*-this.anchor._y),d[0]=o*e+h*r+c,d[1]=l*r+a*e+u,d[2]=o*t+h*r+c,d[3]=l*r+a*t+u,d[4]=o*t+h*i+c,d[5]=l*i+a*t+u,d[6]=o*e+h*i+c,d[7]=l*i+a*e+u}},r.prototype.calculateTrimmedVertices=function(){this.vertexTrimmedData||(this.vertexTrimmedData=new Float32Array(8));var t,e,i,r,n=this._texture,s=this.vertexTrimmedData,o=n.orig,a=this.transform.worldTransform,h=a.a,l=a.b,c=a.c,u=a.d,d=a.tx,p=a.ty;t=o.width*(1-this.anchor._x),e=o.width*-this.anchor._x,i=o.height*(1-this.anchor._y),r=o.height*-this.anchor._y,s[0]=h*e+c*r+d,s[1]=u*r+l*e+p,s[2]=h*t+c*r+d,s[3]=u*r+l*t+p,s[4]=h*t+c*i+d,s[5]=u*i+l*t+p,s[6]=h*e+c*i+d,s[7]=u*i+l*e+p},r.prototype._renderWebGL=function(t){this.calculateVertices(),t.setObjectRenderer(t.plugins.sprite),t.plugins.sprite.render(this)},r.prototype._renderCanvas=function(t){t.plugins.sprite.render(this)},r.prototype._calculateBounds=function(){var t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))},r.prototype.getLocalBounds=function(t){return 0===this.children.length?(this._bounds.minX=-this._texture.orig.width*this.anchor._x,this._bounds.minY=-this._texture.orig.height*this.anchor._y,this._bounds.maxX=this._texture.orig.width,this._bounds.maxY=this._texture.orig.height,t||(this._localBoundsRect||(this._localBoundsRect=new n.Rectangle),t=this._localBoundsRect),this._bounds.getRectangle(t)):o.prototype.getLocalBounds.call(this,t)},r.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,l);var e,i=this._texture.orig.width,r=this._texture.orig.height,n=-i*this.anchor.x;return l.x>n&&l.x<n+i&&(e=-r*this.anchor.y,l.y>e&&l.y<e+r)},r.prototype.destroy=function(t){if(o.prototype.destroy.call(this,t),this.anchor=null,"boolean"==typeof t?t:t&&t.texture){var e="boolean"==typeof t?t:t&&t.baseTexture;this._texture.destroy(!!e)}this._texture=null,this.shader=null},r.from=function(t){return new r(s.from(t))},r.fromFrame=function(t){var e=a.TextureCache[t];if(!e)throw new Error('The frameId "'+t+'" does not exist in the texture cache');return new r(e)},r.fromImage=function(t,e,i){return new r(s.fromImage(t,e,i))}},{"../const":78,"../display/Container":80,"../math":102,"../textures/Texture":144,"../utils":151}],134:[function(t,e,i){function r(t){this.renderer=t}var n=t("../../renderers/canvas/CanvasRenderer"),s=t("../../const"),o=t("../../math"),a=new o.Matrix,h=t("./CanvasTinter");r.prototype.constructor=r,e.exports=r,n.registerPlugin("sprite",r),r.prototype.render=function(t){var e,i,r=t._texture,n=this.renderer,l=t.transform.worldTransform,c=r._frame.width,u=r._frame.height;if(!(r.orig.width<=0||r.orig.height<=0)&&r.baseTexture.source&&(n.setBlendMode(t.blendMode),r.valid)){n.context.globalAlpha=t.worldAlpha;var d=r.baseTexture.scaleMode===s.SCALE_MODES.LINEAR;n.smoothProperty&&n.context[n.smoothProperty]!==d&&(n.context[n.smoothProperty]=d),r.trim?(e=r.trim.width/2+r.trim.x-t.anchor.x*r.orig.width,i=r.trim.height/2+r.trim.y-t.anchor.y*r.orig.height):(e=(.5-t.anchor.x)*r.orig.width,i=(.5-t.anchor.y)*r.orig.height),r.rotate&&(l.copy(a),l=a,o.GroupD8.matrixAppendRotationInv(l,r.rotate,e,i),e=0,i=0),e-=c/2,i-=u/2,n.roundPixels?(n.context.setTransform(l.a,l.b,l.c,l.d,l.tx*n.resolution|0,l.ty*n.resolution|0),e|=0,i|=0):n.context.setTransform(l.a,l.b,l.c,l.d,l.tx*n.resolution,l.ty*n.resolution);var p=r.baseTexture.resolution;16777215!==t.tint?(t.cachedTint!==t.tint&&(t.cachedTint=t.tint,t.tintedTexture=h.getTintedTexture(t,t.tint)),n.context.drawImage(t.tintedTexture,0,0,c*p,u*p,e*n.resolution,i*n.resolution,c*n.resolution,u*n.resolution)):n.context.drawImage(r.baseTexture.source,r._frame.x*p,r._frame.y*p,c*p,u*p,e*n.resolution,i*n.resolution,c*n.resolution,u*n.resolution)}},r.prototype.destroy=function(){this.renderer=null}},{"../../const":78,"../../math":102,"../../renderers/canvas/CanvasRenderer":109,"./CanvasTinter":135}],135:[function(t,e,i){var r=t("../../utils"),n=t("../../renderers/canvas/utils/canUseNewCanvasBlendModes"),s=e.exports={getTintedTexture:function(t,e){var i=t.texture,r="#"+("00000"+(0|(e=s.roundColor(e))).toString(16)).substr(-6);if(i.tintCache=i.tintCache||{},i.tintCache[r])return i.tintCache[r];var n=s.canvas||document.createElement("canvas");if(s.tintMethod(i,e,n),s.convertTintToImage){var o=new Image;o.src=n.toDataURL(),i.tintCache[r]=o}else i.tintCache[r]=n,s.canvas=null;return n},tintWithMultiply:function(t,e,i){var r=i.getContext("2d"),n=t._frame.clone(),s=t.baseTexture.resolution;n.x*=s,n.y*=s,n.width*=s,n.height*=s,i.width=n.width,i.height=n.height,r.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),r.fillRect(0,0,n.width,n.height),r.globalCompositeOperation="multiply",r.drawImage(t.baseTexture.source,n.x,n.y,n.width,n.height,0,0,n.width,n.height),r.globalCompositeOperation="destination-atop",r.drawImage(t.baseTexture.source,n.x,n.y,n.width,n.height,0,0,n.width,n.height)},tintWithOverlay:function(t,e,i){var r=i.getContext("2d"),n=t._frame.clone(),s=t.baseTexture.resolution;n.x*=s,n.y*=s,n.width*=s,n.height*=s,i.width=n.width,i.height=n.height,r.globalCompositeOperation="copy",r.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),r.fillRect(0,0,n.width,n.height),r.globalCompositeOperation="destination-atop",r.drawImage(t.baseTexture.source,n.x,n.y,n.width,n.height,0,0,n.width,n.height)},tintWithPerPixel:function(t,e,i){var n=i.getContext("2d"),s=t._frame.clone(),o=t.baseTexture.resolution;s.x*=o,s.y*=o,s.width*=o,s.height*=o,i.width=s.width,i.height=s.height,n.globalCompositeOperation="copy",n.drawImage(t.baseTexture.source,s.x,s.y,s.width,s.height,0,0,s.width,s.height);for(var a=r.hex2rgb(e),h=a[0],l=a[1],c=a[2],u=n.getImageData(0,0,s.width,s.height),d=u.data,p=0;p<d.length;p+=4)d[p+0]*=h,d[p+1]*=l,d[p+2]*=c;n.putImageData(u,0,0)},roundColor:function(t){var e=s.cacheStepsPerColorChannel,i=r.hex2rgb(t);return i[0]=Math.min(255,i[0]/e*e),i[1]=Math.min(255,i[1]/e*e),i[2]=Math.min(255,i[2]/e*e),r.rgb2hex(i)},cacheStepsPerColorChannel:8,convertTintToImage:!1,canUseMultiply:n(),tintMethod:0};s.tintMethod=s.canUseMultiply?s.tintWithMultiply:s.tintWithPerPixel},{"../../renderers/canvas/utils/canUseNewCanvasBlendModes":112,"../../utils":151}],136:[function(t,e,i){var r=function(t){this.vertices=new ArrayBuffer(t),this.float32View=new Float32Array(this.vertices),this.uint32View=new Uint32Array(this.vertices)};e.exports=r,r.prototype.destroy=function(){this.vertices=null,this.positions=null,this.uvs=null,this.colors=null}},{}],137:[function(t,e,i){function r(t){n.call(this,t),this.vertSize=5,this.vertByteSize=4*this.vertSize,this.size=c.SPRITE_BATCH_SIZE,this.buffers=[];for(var e=1;e<=d.nextPow2(this.size);e*=2){var i=4*e*this.vertByteSize;this.buffers.push(new l(i))}this.indices=o(this.size),this.shaders=null,this.currentIndex=0,p=0,this.groups=[];for(var r=0;r<this.size;r++)this.groups[r]={textures:[],textureCount:0,ids:[],size:0,start:0,blend:0};this.sprites=[],this.vertexBuffers=[],this.vaos=[],this.vaoMax=2,this.vertexCount=0,this.renderer.on("prerender",this.onPrerender,this)}var n=t("../../renderers/webgl/utils/ObjectRenderer"),s=t("../../renderers/webgl/WebGLRenderer"),o=t("../../utils/createIndicesForQuads"),a=t("./generateMultiTextureShader"),h=t("../../renderers/webgl/utils/checkMaxIfStatmentsInShader"),l=t("./BatchBuffer"),c=t("../../const"),u=t("pixi-gl-core"),d=t("bit-twiddle"),p=0;r.prototype=Object.create(n.prototype),r.prototype.constructor=r,e.exports=r,s.registerPlugin("sprite",r),r.prototype.onContextChange=function(){var t=this.renderer.gl;this.MAX_TEXTURES=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),c.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=h(this.MAX_TEXTURES,t),this.shaders=new Array(this.MAX_TEXTURES),this.shaders[0]=a(t,1),this.shaders[1]=a(t,2),this.indexBuffer=u.GLBuffer.createIndexBuffer(t,this.indices,t.STATIC_DRAW);for(var e=this.shaders[1],i=0;i<this.vaoMax;i++)this.vertexBuffers[i]=u.GLBuffer.createVertexBuffer(t,null,t.STREAM_DRAW),this.vaos[i]=this.renderer.createVao().addIndex(this.indexBuffer).addAttribute(this.vertexBuffers[i],e.attributes.aVertexPosition,t.FLOAT,!1,this.vertByteSize,0).addAttribute(this.vertexBuffers[i],e.attributes.aTextureCoord,t.UNSIGNED_SHORT,!0,this.vertByteSize,8).addAttribute(this.vertexBuffers[i],e.attributes.aColor,t.UNSIGNED_BYTE,!0,this.vertByteSize,12).addAttribute(this.vertexBuffers[i],e.attributes.aTextureId,t.FLOAT,!1,this.vertByteSize,16);this.vao=this.vaos[0],this.currentBlendMode=99999},r.prototype.onPrerender=function(){this.vertexCount=0},r.prototype.render=function(t){this.currentIndex>=this.size&&this.flush(),t.texture._uvs&&(this.sprites[this.currentIndex++]=t)},r.prototype.flush=function(){if(0!==this.currentIndex){var t,e,i,r,n,s,o,h=this.renderer.gl,l=d.nextPow2(this.currentIndex),c=d.log2(l),f=this.buffers[c],g=this.sprites,v=this.groups,m=f.float32View,y=f.uint32View,x=0,_=1,b=0,T=v[0],E=g[0].blendMode;T.textureCount=0,T.start=0,T.blend=E,p++;for(var w=0;w<this.currentIndex;w++){var A=g[w];if(t=A._texture.baseTexture,E!==A.blendMode&&(E=A.blendMode,e=null,b=this.MAX_TEXTURES,p++),e!==t&&(e=t,t._enabled!==p&&(b===this.MAX_TEXTURES&&(p++,b=0,T.size=w-T.start,(T=v[_++]).textureCount=0,T.blend=E,T.start=w),t._enabled=p,t._id=b,T.textures[T.textureCount++]=t,b++)),i=A.vertexData,r=A._tintRGB+(255*A.worldAlpha<<24),n=A._texture._uvs.uvsUint32,s=t._id,this.renderer.roundPixels){var C=this.renderer.resolution;m[x]=(i[0]*C|0)/C,m[x+1]=(i[1]*C|0)/C,m[x+5]=(i[2]*C|0)/C,m[x+6]=(i[3]*C|0)/C,m[x+10]=(i[4]*C|0)/C,m[x+11]=(i[5]*C|0)/C,m[x+15]=(i[6]*C|0)/C,m[x+16]=(i[7]*C|0)/C}else m[x]=i[0],m[x+1]=i[1],m[x+5]=i[2],m[x+6]=i[3],m[x+10]=i[4],m[x+11]=i[5],m[x+15]=i[6],m[x+16]=i[7];y[x+2]=n[0],y[x+7]=n[1],y[x+12]=n[2],y[x+17]=n[3],y[x+3]=y[x+8]=y[x+13]=y[x+18]=r,m[x+4]=m[x+9]=m[x+14]=m[x+19]=s,x+=20}for(T.size=w-T.start,this.vertexCount++,this.vaoMax<=this.vertexCount&&(this.vaoMax++,o=this.shaders[1],this.vertexBuffers[this.vertexCount]=u.GLBuffer.createVertexBuffer(h,null,h.STREAM_DRAW),this.vaos[this.vertexCount]=this.renderer.createVao().addIndex(this.indexBuffer).addAttribute(this.vertexBuffers[this.vertexCount],o.attributes.aVertexPosition,h.FLOAT,!1,this.vertByteSize,0).addAttribute(this.vertexBuffers[this.vertexCount],o.attributes.aTextureCoord,h.UNSIGNED_SHORT,!0,this.vertByteSize,8).addAttribute(this.vertexBuffers[this.vertexCount],o.attributes.aColor,h.UNSIGNED_BYTE,!0,this.vertByteSize,12).addAttribute(this.vertexBuffers[this.vertexCount],o.attributes.aTextureId,h.FLOAT,!1,this.vertByteSize,16)),this.vertexBuffers[this.vertexCount].upload(f.vertices,0),this.vao=this.vaos[this.vertexCount].bind(),w=0;w<_;w++){var S=v[w],O=S.textureCount;(o=this.shaders[O-1])||(o=this.shaders[O-1]=a(h,O)),this.renderer.bindShader(o);for(var D=0;D<O;D++)this.renderer.bindTexture(S.textures[D],D);this.renderer.state.setBlendMode(S.blend),h.drawElements(h.TRIANGLES,6*S.size,h.UNSIGNED_SHORT,6*S.start*2)}this.currentIndex=0}},r.prototype.start=function(){},r.prototype.stop=function(){this.flush(),this.vao.unbind()},r.prototype.destroy=function(){for(var t=0;t<this.vaoMax;t++)this.vertexBuffers[t].destroy(),this.vaos[t].destroy();for(this.indexBuffer.destroy(),this.renderer.off("prerender",this.onPrerender,this),n.prototype.destroy.call(this),t=0;t<this.shaders.length;t++)this.shaders[t]&&this.shaders[t].destroy();for(this.vertexBuffers=null,this.vaos=null,this.indexBuffer=null,this.indices=null,this.sprites=null,t=0;t<this.buffers.length;t++)this.buffers[t].destroy()}},{"../../const":78,"../../renderers/webgl/WebGLRenderer":116,"../../renderers/webgl/utils/ObjectRenderer":126,"../../renderers/webgl/utils/checkMaxIfStatmentsInShader":129,"../../utils/createIndicesForQuads":149,"./BatchBuffer":136,"./generateMultiTextureShader":138,"bit-twiddle":30,"pixi-gl-core":7}],138:[function(t,e,i){var r=t("../../Shader"),n=["varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureId;","uniform sampler2D uSamplers[%count%];","void main(void){","vec4 color;","float textureId = floor(vTextureId+0.5);","%forloop%","gl_FragColor = color * vColor;","}"].join("\n");e.exports=function(t,e){var i=n;i=(i=i.replace(/%count%/gi,e)).replace(/%forloop%/gi,function(t){var e="";e+="\n",e+="\n";for(var i=0;i<t;i++)i>0&&(e+="\nelse "),i<t-1&&(e+="if(textureId == "+i+".0)"),e+="\n{",e+="\n\tcolor = texture2D(uSamplers["+i+"], vTextureCoord);",e+="\n}";return e+="\n",e+"\n"}(e));for(var s=new r(t,"#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n   vTextureId = aTextureId;\n   vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n",i,{aVertexPosition:3,aColor:2,aTextureCoord:1,aTextureId:0}),o=[],a=0;a<e;a++)o[a]=a;return s.bind(),s.uniforms.uSamplers=o,s}},{"../../Shader":77}],139:[function(t,e,i){function r(t,e){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=h.RESOLUTION,this._text=null,this._style=null,this._styleListener=null,this._font="";var i=s.fromCanvas(this.canvas);i.orig=new o.Rectangle,i.trim=new o.Rectangle,n.call(this,i),this.text=t,this.style=e,this.localStyleID=-1}var n=t("../sprites/Sprite"),s=t("../textures/Texture"),o=t("../math"),a=t("../utils"),h=t("../const"),l=t("./TextStyle"),c={texture:!0,children:!1,baseTexture:!0};r.prototype=Object.create(n.prototype),r.prototype.constructor=r,e.exports=r,r.fontPropertiesCache={},r.fontPropertiesCanvas=document.createElement("canvas"),r.fontPropertiesContext=r.fontPropertiesCanvas.getContext("2d"),Object.defineProperties(r.prototype,{width:{get:function(){return this.updateText(!0),Math.abs(this.scale.x)*this.texture.orig.width},set:function(t){this.updateText(!0);var e=a.sign(this.scale.x)||1;this.scale.x=e*t/this.texture.orig.width,this._width=t}},height:{get:function(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height},set:function(t){this.updateText(!0);var e=a.sign(this.scale.y)||1;this.scale.y=e*t/this.texture.orig.height,this._height=t}},style:{get:function(){return this._style},set:function(t){t=t||{},this._style=t instanceof l?t:new l(t),this.localStyleID=-1,this.dirty=!0}},text:{get:function(){return this._text},set:function(t){t=(t=t||" ").toString(),this._text!==t&&(this._text=t,this.dirty=!0)}}}),r.prototype.updateText=function(t){var e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),this.dirty||!t){var i="number"==typeof e.fontSize?e.fontSize+"px":e.fontSize;this._font=e.fontStyle+" "+e.fontVariant+" "+e.fontWeight+" "+i+" "+e.fontFamily,this.context.font=this._font;var r,n=(e.wordWrap?this.wordWrap(this._text):this._text).split(/(?:\r\n|\r|\n)/),s=new Array(n.length),o=0,a=this.determineFontProperties(this._font);for(r=0;r<n.length;r++){var h=this.context.measureText(n[r]).width+(n[r].length-1)*e.letterSpacing;s[r]=h,o=Math.max(o,h)}var l=o+e.strokeThickness;e.dropShadow&&(l+=e.dropShadowDistance),l+=2*e.padding,this.canvas.width=Math.ceil((l+this.context.lineWidth)*this.resolution);var c,u,d=this.style.lineHeight||a.fontSize+e.strokeThickness,p=Math.max(d,a.fontSize+e.strokeThickness)+(n.length-1)*d;if(e.dropShadow&&(p+=e.dropShadowDistance),this.canvas.height=Math.ceil((p+2*this._style.padding)*this.resolution),this.context.scale(this.resolution,this.resolution),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.font=this._font,this.context.strokeStyle=e.stroke,this.context.lineWidth=e.strokeThickness,this.context.textBaseline=e.textBaseline,this.context.lineJoin=e.lineJoin,this.context.miterLimit=e.miterLimit,e.dropShadow){e.dropShadowBlur>0?(this.context.shadowColor=e.dropShadowColor,this.context.shadowBlur=e.dropShadowBlur):this.context.fillStyle=e.dropShadowColor;var f=Math.cos(e.dropShadowAngle)*e.dropShadowDistance,g=Math.sin(e.dropShadowAngle)*e.dropShadowDistance;for(r=0;r<n.length;r++)c=e.strokeThickness/2,u=e.strokeThickness/2+r*d+a.ascent,"right"===e.align?c+=o-s[r]:"center"===e.align&&(c+=(o-s[r])/2),e.fill&&(this.drawLetterSpacing(n[r],c+f+e.padding,u+g+e.padding),e.stroke&&e.strokeThickness&&(this.context.strokeStyle=e.dropShadowColor,this.drawLetterSpacing(n[r],c+f+e.padding,u+g+e.padding,!0),this.context.strokeStyle=e.stroke))}for(this.context.fillStyle=this._generateFillStyle(e,n),r=0;r<n.length;r++)c=e.strokeThickness/2,u=e.strokeThickness/2+r*d+a.ascent,"right"===e.align?c+=o-s[r]:"center"===e.align&&(c+=(o-s[r])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(n[r],c+e.padding,u+e.padding,!0),e.fill&&this.drawLetterSpacing(n[r],c+e.padding,u+e.padding);this.updateTexture()}},r.prototype.drawLetterSpacing=function(t,e,i,r){var n=this._style.letterSpacing;if(0!==n)for(var s,o=String.prototype.split.call(t,""),a=0,h=e;a<t.length;)s=o[a++],r?this.context.strokeText(s,h,i):this.context.fillText(s,h,i),h+=this.context.measureText(s).width+n;else r?this.context.strokeText(t,e,i):this.context.fillText(t,e,i)},r.prototype.updateTexture=function(){var t=this._texture,e=this._style;t.baseTexture.hasLoaded=!0,t.baseTexture.resolution=this.resolution,t.baseTexture.realWidth=this.canvas.width,t.baseTexture.realHeight=this.canvas.height,t.baseTexture.width=this.canvas.width/this.resolution,t.baseTexture.height=this.canvas.height/this.resolution,t.trim.width=t._frame.width=this.canvas.width/this.resolution,t.trim.height=t._frame.height=this.canvas.height/this.resolution,t.trim.x=-e.padding,t.trim.y=-e.padding,t.orig.width=t._frame.width-2*e.padding,t.orig.height=t._frame.height-2*e.padding,this._onTextureUpdate(),t.baseTexture.emit("update",t.baseTexture),this.dirty=!1},r.prototype.renderWebGL=function(t){this.resolution!==t.resolution&&(this.resolution=t.resolution,this.dirty=!0),this.updateText(!0),n.prototype.renderWebGL.call(this,t)},r.prototype._renderCanvas=function(t){this.resolution!==t.resolution&&(this.resolution=t.resolution,this.dirty=!0),this.updateText(!0),n.prototype._renderCanvas.call(this,t)},r.prototype.determineFontProperties=function(t){var e=r.fontPropertiesCache[t];if(!e){e={};var i=r.fontPropertiesCanvas,n=r.fontPropertiesContext;n.font=t;var s=Math.ceil(n.measureText("|Mq").width),o=Math.ceil(n.measureText("M").width),a=2*o;o=1.4*o|0,i.width=s,i.height=a,n.fillStyle="#f00",n.fillRect(0,0,s,a),n.font=t,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText("|Mq",0,o);var h,l,c=n.getImageData(0,0,s,a).data,u=c.length,d=4*s,p=0,f=!1;for(h=0;h<o;h++){for(l=0;l<d;l+=4)if(255!==c[p+l]){f=!0;break}if(f)break;p+=d}for(e.ascent=o-h,p=u-d,f=!1,h=a;h>o;h--){for(l=0;l<d;l+=4)if(255!==c[p+l]){f=!0;break}if(f)break;p-=d}e.descent=h-o,e.fontSize=e.ascent+e.descent,r.fontPropertiesCache[t]=e}return e},r.prototype.wordWrap=function(t){for(var e="",i=t.split("\n"),r=this._style.wordWrapWidth,n=0;n<i.length;n++){for(var s=r,o=i[n].split(" "),a=0;a<o.length;a++){var h=this.context.measureText(o[a]).width;if(this._style.breakWords&&h>r)for(var l=o[a].split(""),c=0;c<l.length;c++){var u=this.context.measureText(l[c]).width;u>s?(e+="\n"+l[c],s=r-u):(0===c&&(e+=" "),e+=l[c],s-=u)}else{var d=h+this.context.measureText(" ").width;0===a||d>s?(a>0&&(e+="\n"),e+=o[a],s=r-h):(s-=d,e+=" "+o[a])}}n<i.length-1&&(e+="\n")}return e},r.prototype._calculateBounds=function(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)},r.prototype._onStyleChange=function(){this.dirty=!0},r.prototype._generateFillStyle=function(t,e){if(Array.isArray(t.fill)){if(navigator.isCocoonJS)return t.fill[0];var i,r,n,s,o,a=this.canvas.width/this.resolution,l=this.canvas.height/this.resolution;if(t.fillGradientType===h.TEXT_GRADIENT.LINEAR_VERTICAL)for(r=this.context.createLinearGradient(a/2,0,a/2,l),n=(t.fill.length+1)*e.length,s=0,i=0;i<e.length;i++){s+=1;for(var c=0;c<t.fill.length;c++)o=s/n,r.addColorStop(o,t.fill[c]),s++}else for(r=this.context.createLinearGradient(0,l/2,a,l/2),n=t.fill.length+1,s=1,i=0;i<t.fill.length;i++)o=s/n,r.addColorStop(o,t.fill[i]),s++;return r}return t.fill},r.prototype.destroy=function(t){"boolean"==typeof t&&(t={children:t}),t=Object.assign({},c,t),n.prototype.destroy.call(this,t),this.context=null,this.canvas=null,this._style=null}},{"../const":78,"../math":102,"../sprites/Sprite":133,"../textures/Texture":144,"../utils":151,"./TextStyle":140}],140:[function(t,e,i){function r(t){this.styleID=0,Object.assign(this,this._defaults,t)}function n(t){if("number"==typeof t)return o.hex2string(t);if(Array.isArray(t))for(var e=0;e<t.length;++e)"number"==typeof t[e]&&(t[e]=o.hex2string(t[e]));return t}var s=t("../const"),o=t("../utils");r.prototype.constructor=r,e.exports=r,r.prototype._defaults={align:"left",breakWords:!1,dropShadow:!1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"#000000",dropShadowDistance:5,fill:"black",fillGradientType:s.TEXT_GRADIENT.LINEAR_VERTICAL,fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",wordWrap:!1,wordWrapWidth:100},r.prototype.clone=function(){var t={};for(var e in this._defaults)t[e]=this[e];return new r(t)},r.prototype.reset=function(){Object.assign(this,this._defaults)},Object.defineProperties(r.prototype,{align:{get:function(){return this._align},set:function(t){this._align!==t&&(this._align=t,this.styleID++)}},breakWords:{get:function(){return this._breakWords},set:function(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}},dropShadow:{get:function(){return this._dropShadow},set:function(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}},dropShadowAngle:{get:function(){return this._dropShadowAngle},set:function(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}},dropShadowBlur:{get:function(){return this._dropShadowBlur},set:function(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}},dropShadowColor:{get:function(){return this._dropShadowColor},set:function(t){var e=n(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}},dropShadowDistance:{get:function(){return this._dropShadowDistance},set:function(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}},fill:{get:function(){return this._fill},set:function(t){var e=n(t);this._fill!==e&&(this._fill=e,this.styleID++)}},fillGradientType:{get:function(){return this._fillGradientType},set:function(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}},fontFamily:{get:function(){return this._fontFamily},set:function(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}},fontSize:{get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}},fontStyle:{get:function(){return this._fontStyle},set:function(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}},fontVariant:{get:function(){return this._fontVariant},set:function(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}},fontWeight:{get:function(){return this._fontWeight},set:function(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}},letterSpacing:{get:function(){return this._letterSpacing},set:function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}},lineHeight:{get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}},lineJoin:{get:function(){return this._lineJoin},set:function(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}},miterLimit:{get:function(){return this._miterLimit},set:function(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}},padding:{get:function(){return this._padding},set:function(t){this._padding!==t&&(this._padding=t,this.styleID++)}},stroke:{get:function(){return this._stroke},set:function(t){var e=n(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}},strokeThickness:{get:function(){return this._strokeThickness},set:function(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}},textBaseline:{get:function(){return this._textBaseline},set:function(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}},wordWrap:{get:function(){return this._wordWrap},set:function(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}},wordWrapWidth:{get:function(){return this._wordWrapWidth},set:function(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}}})},{"../const":78,"../utils":151}],141:[function(t,e,i){function r(t,e,i,r){n.call(this,null,i),this.resolution=r||s.RESOLUTION,this.width=t||100,this.height=e||100,this.realWidth=this.width*this.resolution,this.realHeight=this.height*this.resolution,this.scaleMode=i||s.SCALE_MODES.DEFAULT,this.hasLoaded=!0,this._glRenderTargets=[],this._canvasRenderTarget=null,this.valid=!1}var n=t("./BaseTexture"),s=t("../const");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,e.exports=r,r.prototype.resize=function(t,e){t===this.width&&e===this.height||(this.valid=t>0&&e>0,this.width=t,this.height=e,this.realWidth=this.width*this.resolution,this.realHeight=this.height*this.resolution,this.valid&&this.emit("update",this))},r.prototype.destroy=function(){n.prototype.destroy.call(this,!0),this.renderer=null}},{"../const":78,"./BaseTexture":142}],142:[function(t,e,i){function r(t,e,i){o.call(this),this.uid=n.uid(),this.touched=0,this.resolution=i||s.RESOLUTION,this.width=100,this.height=100,this.realWidth=100,this.realHeight=100,this.scaleMode=e||s.SCALE_MODES.DEFAULT,this.hasLoaded=!1,this.isLoading=!1,this.source=null,this.premultipliedAlpha=!0,this.imageUrl=null,this.isPowerOfTwo=!1,this.mipmap=s.MIPMAP_TEXTURES,this.wrapMode=s.WRAP_MODES.DEFAULT,this._glTextures=[],this._enabled=0,this._id=0,t&&this.loadSource(t)}var n=t("../utils"),s=t("../const"),o=t("eventemitter3"),a=t("../utils/determineCrossOrigin"),h=t("bit-twiddle");r.prototype=Object.create(o.prototype),r.prototype.constructor=r,e.exports=r,r.prototype.update=function(){this.realWidth=this.source.naturalWidth||this.source.videoWidth||this.source.width,this.realHeight=this.source.naturalHeight||this.source.videoHeight||this.source.height,this.width=this.realWidth/this.resolution,this.height=this.realHeight/this.resolution,this.isPowerOfTwo=h.isPow2(this.realWidth)&&h.isPow2(this.realHeight),this.emit("update",this)},r.prototype.loadSource=function(t){var e=this.isLoading;if(this.hasLoaded=!1,this.isLoading=!1,e&&this.source&&(this.source.onload=null,this.source.onerror=null),this.source=t,(this.source.complete||this.source.getContext)&&this.source.width&&this.source.height)this._sourceLoaded();else if(!t.getContext){this.isLoading=!0;var i=this;t.onload=function(){t.onload=null,t.onerror=null,i.isLoading&&(i.isLoading=!1,i._sourceLoaded(),i.emit("loaded",i))},t.onerror=function(){t.onload=null,t.onerror=null,i.isLoading&&(i.isLoading=!1,i.emit("error",i))},t.complete&&t.src&&(this.isLoading=!1,t.onload=null,t.onerror=null,t.width&&t.height?(this._sourceLoaded(),e&&this.emit("loaded",this)):e&&this.emit("error",this))}},r.prototype._sourceLoaded=function(){this.hasLoaded=!0,this.update()},r.prototype.destroy=function(){this.imageUrl?(delete n.BaseTextureCache[this.imageUrl],delete n.TextureCache[this.imageUrl],this.imageUrl=null,navigator.isCocoonJS||(this.source.src="")):this.source&&this.source._pixiId&&delete n.BaseTextureCache[this.source._pixiId],this.source=null,this.dispose()},r.prototype.dispose=function(){this.emit("dispose",this)},r.prototype.updateSourceImage=function(t){this.source.src=t,this.loadSource(this.source)},r.fromImage=function(t,e,i){var s=n.BaseTextureCache[t];if(!s){var o=new Image;void 0===e&&0!==t.indexOf("data:")&&(o.crossOrigin=a(t)),(s=new r(o,i)).imageUrl=t,o.src=t,n.BaseTextureCache[t]=s,s.resolution=n.getResolutionOfUrl(t)}return s},r.fromCanvas=function(t,e){t._pixiId||(t._pixiId="canvas_"+n.uid());var i=n.BaseTextureCache[t._pixiId];return i||(i=new r(t,e),n.BaseTextureCache[t._pixiId]=i),i}},{"../const":78,"../utils":151,"../utils/determineCrossOrigin":150,"bit-twiddle":30,eventemitter3:32}],143:[function(t,e,i){function r(t,e){if(this.legacyRenderer=null,!(t instanceof n)){var i=arguments[1],r=arguments[2],o=arguments[3]||0,a=arguments[4]||1;console.warn("v4 RenderTexture now expects a new BaseRenderTexture. Please use RenderTexture.create("+i+", "+r+")"),this.legacyRenderer=arguments[0],e=null,t=new n(i,r,o,a)}s.call(this,t,e),this.valid=!0,this._updateUvs()}var n=t("./BaseRenderTexture"),s=t("./Texture");r.prototype=Object.create(s.prototype),r.prototype.constructor=r,e.exports=r,r.prototype.resize=function(t,e,i){this.valid=t>0&&e>0,this._frame.width=this.orig.width=t,this._frame.height=this.orig.height=e,i||this.baseTexture.resize(t,e),this._updateUvs()},r.create=function(t,e,i,s){return new r(new n(t,e,i,s))}},{"./BaseRenderTexture":141,"./Texture":144}],144:[function(t,e,i){function r(t,e,i,n,s){if(a.call(this),this.noFrame=!1,e||(this.noFrame=!0,e=new h.Rectangle(0,0,1,1)),t instanceof r&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=n,this.valid=!1,this.requiresUpdate=!1,this._uvs=null,this.orig=i||e,this._rotate=+(s||0),!0===s)this._rotate=2;else if(this._rotate%2!=0)throw"attempt to use diamond-shaped UVs. If you are sure, set rotation manually";t.hasLoaded?(this.noFrame&&(e=new h.Rectangle(0,0,t.width,t.height),t.on("update",this.onBaseTextureUpdated,this)),this.frame=e):t.once("loaded",this.onBaseTextureLoaded,this),this._updateID=0}var n=t("./BaseTexture"),s=t("./VideoBaseTexture"),o=t("./TextureUvs"),a=t("eventemitter3"),h=t("../math"),l=t("../utils");r.prototype=Object.create(a.prototype),r.prototype.constructor=r,e.exports=r,Object.defineProperties(r.prototype,{frame:{get:function(){return this._frame},set:function(t){if(this._frame=t,this.noFrame=!1,t.x+t.width>this.baseTexture.width||t.y+t.height>this.baseTexture.height)throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.valid=t&&t.width&&t.height&&this.baseTexture.hasLoaded,this.trim||this.rotate||(this.orig=t),this.valid&&this._updateUvs()}},rotate:{get:function(){return this._rotate},set:function(t){this._rotate=t,this.valid&&this._updateUvs()}},width:{get:function(){return this.orig?this.orig.width:0}},height:{get:function(){return this.orig?this.orig.height:0}}}),r.prototype.update=function(){this.baseTexture.update()},r.prototype.onBaseTextureLoaded=function(t){this._updateID++,this.noFrame?this.frame=new h.Rectangle(0,0,t.width,t.height):this.frame=this._frame,this.baseTexture.on("update",this.onBaseTextureUpdated,this),this.emit("update",this)},r.prototype.onBaseTextureUpdated=function(t){this._updateID++,this._frame.width=t.width,this._frame.height=t.height,this.emit("update",this)},r.prototype.destroy=function(t){this.baseTexture&&(t&&(l.TextureCache[this.baseTexture.imageUrl]&&delete l.TextureCache[this.baseTexture.imageUrl],this.baseTexture.destroy()),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture.off("loaded",this.onBaseTextureLoaded,this),this.baseTexture=null),this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,this.off("dispose",this.dispose,this),this.off("update",this.update,this)},r.prototype.clone=function(){return new r(this.baseTexture,this.frame,this.orig,this.trim,this.rotate)},r.prototype._updateUvs=function(){this._uvs||(this._uvs=new o),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},r.fromImage=function(t,e,i){var s=l.TextureCache[t];return s||(s=new r(n.fromImage(t,e,i)),l.TextureCache[t]=s),s},r.fromFrame=function(t){var e=l.TextureCache[t];if(!e)throw new Error('The frameId "'+t+'" does not exist in the texture cache');return e},r.fromCanvas=function(t,e){return new r(n.fromCanvas(t,e))},r.fromVideo=function(t,e){return"string"==typeof t?r.fromVideoUrl(t,e):new r(s.fromVideo(t,e))},r.fromVideoUrl=function(t,e){return new r(s.fromUrl(t,e))},r.from=function(t){if("string"==typeof t){var e=l.TextureCache[t];return e||(null!==t.match(/\.(mp4|webm|ogg|h264|avi|mov)$/)?r.fromVideoUrl(t):r.fromImage(t))}return t instanceof HTMLCanvasElement?r.fromCanvas(t):t instanceof HTMLVideoElement?r.fromVideo(t):t instanceof n?new r(n):t},r.addTextureToCache=function(t,e){l.TextureCache[e]=t},r.removeTextureFromCache=function(t){var e=l.TextureCache[t];return delete l.TextureCache[t],delete l.BaseTextureCache[t],e},r.EMPTY=new r(new n),r.EMPTY.destroy=function(){},r.EMPTY.on=function(){},r.EMPTY.once=function(){},r.EMPTY.emit=function(){}},{"../math":102,"../utils":151,"./BaseTexture":142,"./TextureUvs":145,"./VideoBaseTexture":146,eventemitter3:32}],145:[function(t,e,i){function r(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsUint32=new Uint32Array(4)}e.exports=r;var n=t("../math/GroupD8");r.prototype.set=function(t,e,i){var r=e.width,s=e.height;if(i){var o=t.width/2/r,a=t.height/2/s,h=t.x/r+o,l=t.y/s+a;i=n.add(i,n.NW),this.x0=h+o*n.uX(i),this.y0=l+a*n.uY(i),i=n.add(i,2),this.x1=h+o*n.uX(i),this.y1=l+a*n.uY(i),i=n.add(i,2),this.x2=h+o*n.uX(i),this.y2=l+a*n.uY(i),i=n.add(i,2),this.x3=h+o*n.uX(i),this.y3=l+a*n.uY(i)}else this.x0=t.x/r,this.y0=t.y/s,this.x1=(t.x+t.width)/r,this.y1=t.y/s,this.x2=(t.x+t.width)/r,this.y2=(t.y+t.height)/s,this.x3=t.x/r,this.y3=(t.y+t.height)/s;this.uvsUint32[0]=(65535*this.y0&65535)<<16|65535*this.x0&65535,this.uvsUint32[1]=(65535*this.y1&65535)<<16|65535*this.x1&65535,this.uvsUint32[2]=(65535*this.y2&65535)<<16|65535*this.x2&65535,this.uvsUint32[3]=(65535*this.y3&65535)<<16|65535*this.x3&65535}},{"../math/GroupD8":98}],146:[function(t,e,i){function r(t,e){if(!t)throw new Error("No video source element specified.");(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),s.call(this,t,e),this.autoUpdate=!1,this._onUpdate=this._onUpdate.bind(this),this._onCanPlay=this._onCanPlay.bind(this),t.complete||(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("play",this._onPlayStart.bind(this)),t.addEventListener("pause",this._onPlayStop.bind(this))),this.__loaded=!1}function n(t,e){e||(e="video/"+t.substr(t.lastIndexOf(".")+1));var i=document.createElement("source");return i.src=t,i.type=e,i}var s=t("./BaseTexture"),o=t("../utils");r.prototype=Object.create(s.prototype),r.prototype.constructor=r,e.exports=r,r.prototype._onUpdate=function(){this.autoUpdate&&(window.requestAnimationFrame(this._onUpdate),this.update())},r.prototype._onPlayStart=function(){this.hasLoaded||this._onCanPlay(),this.autoUpdate||(window.requestAnimationFrame(this._onUpdate),this.autoUpdate=!0)},r.prototype._onPlayStop=function(){this.autoUpdate=!1},r.prototype._onCanPlay=function(){this.hasLoaded=!0,this.source&&(this.source.removeEventListener("canplay",this._onCanPlay),this.source.removeEventListener("canplaythrough",this._onCanPlay),this.width=this.source.videoWidth,this.height=this.source.videoHeight,this.source.play(),this.__loaded||(this.__loaded=!0,this.emit("loaded",this)))},r.prototype.destroy=function(){this.source&&this.source._pixiId&&(delete o.BaseTextureCache[this.source._pixiId],delete this.source._pixiId),s.prototype.destroy.call(this)},r.fromVideo=function(t,e){t._pixiId||(t._pixiId="video_"+o.uid());var i=o.BaseTextureCache[t._pixiId];return i||(i=new r(t,e),o.BaseTextureCache[t._pixiId]=i),i},r.fromUrl=function(t,e){var i=document.createElement("video");if(Array.isArray(t))for(var s=0;s<t.length;++s)i.appendChild(n(t[s].src||t[s],t[s].mime));else i.appendChild(n(t.src||t,t.mime));return i.load(),i.play(),r.fromVideo(i,e)},r.fromUrls=r.fromUrl},{"../utils":151,"./BaseTexture":142}],147:[function(t,e,i){function r(){var t=this;this._tick=function(e){t._requestId=null,t.started&&(t.update(e),t.started&&null===t._requestId&&t._emitter.listeners(o,!0)&&(t._requestId=requestAnimationFrame(t._tick)))},this._emitter=new s,this._requestId=null,this._maxElapsedMS=100,this.autoStart=!1,this.deltaTime=1,this.elapsedMS=1/n.TARGET_FPMS,this.lastTime=0,this.speed=1,this.started=!1}var n=t("../const"),s=t("eventemitter3"),o="tick";Object.defineProperties(r.prototype,{FPS:{get:function(){return 1e3/this.elapsedMS}},minFPS:{get:function(){return 1e3/this._maxElapsedMS},set:function(t){var e=Math.min(Math.max(0,t)/1e3,n.TARGET_FPMS);this._maxElapsedMS=1/e}}}),r.prototype._requestIfNeeded=function(){null===this._requestId&&this._emitter.listeners(o,!0)&&(this.lastTime=performance.now(),this._requestId=requestAnimationFrame(this._tick))},r.prototype._cancelIfNeeded=function(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)},r.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},r.prototype.add=function(t,e){return this._emitter.on(o,t,e),this._startIfPossible(),this},r.prototype.addOnce=function(t,e){return this._emitter.once(o,t,e),this._startIfPossible(),this},r.prototype.remove=function(t,e){return this._emitter.off(o,t,e),this._emitter.listeners(o,!0)||this._cancelIfNeeded(),this},r.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},r.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},r.prototype.update=function(t){var e;(t=t||performance.now())>this.lastTime?((e=this.elapsedMS=t-this.lastTime)>this._maxElapsedMS&&(e=this._maxElapsedMS),this.deltaTime=e*n.TARGET_FPMS*this.speed,this._emitter.emit(o,this.deltaTime)):this.deltaTime=this.elapsedMS=0,this.lastTime=t},e.exports=r},{"../const":78,eventemitter3:32}],148:[function(t,e,i){var r=t("./Ticker"),n=new r;n.autoStart=!0,e.exports={shared:n,Ticker:r}},{"./Ticker":147}],149:[function(t,e,i){e.exports=function(t){for(var e=6*t,i=new Uint16Array(e),r=0,n=0;r<e;r+=6,n+=4)i[r+0]=n+0,i[r+1]=n+1,i[r+2]=n+2,i[r+3]=n+0,i[r+4]=n+2,i[r+5]=n+3;return i}},{}],150:[function(t,e,i){var r,n=t("url");e.exports=function(t,e){if(0===t.indexOf("data:"))return"";e=e||window.location,r||(r=document.createElement("a")),r.href=t;var i=!(t=n.parse(r.href)).port&&""===e.port||t.port===e.port;return t.hostname===e.hostname&&i&&t.protocol===e.protocol?"":"anonymous"}},{url:72}],151:[function(t,e,i){var r=t("../const"),n=e.exports={_uid:0,_saidHello:!1,EventEmitter:t("eventemitter3"),pluginTarget:t("./pluginTarget"),uid:function(){return++n._uid},hex2rgb:function(t,e){return(e=e||[])[0]=(t>>16&255)/255,e[1]=(t>>8&255)/255,e[2]=(255&t)/255,e},hex2string:function(t){return t=t.toString(16),"#"+(t="000000".substr(0,6-t.length)+t)},rgb2hex:function(t){return(255*t[0]<<16)+(255*t[1]<<8)+255*t[2]},getResolutionOfUrl:function(t){var e=r.RETINA_PREFIX.exec(t);return e?parseFloat(e[1]):1},sayHello:function(t){if(!n._saidHello){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var e=["\n %c %c %c Pixi.js "+r.VERSION+" -  "+t+"   %c  %c  http://www.pixijs.com/  %c %c %c%c \n\n","background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];window.console.log.apply(console,e)}else window.console&&window.console.log("Pixi.js "+r.VERSION+" - "+t+" - http://www.pixijs.com/");n._saidHello=!0}},isWebGLSupported:function(){var t={stencil:!0,failIfMajorPerformanceCaveat:!0};try{if(!window.WebGLRenderingContext)return!1;var e=document.createElement("canvas"),i=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),r=!(!i||!i.getContextAttributes().stencil);if(i){var n=i.getExtension("WEBGL_lose_context");n&&n.loseContext()}return i=null,r}catch(t){return!1}},sign:function(t){return t?t<0?-1:1:0},removeItems:function(t,e,i){var r=t.length;if(!(e>=r||0===i)){for(var n=e,s=r-(i=e+i>r?r-e:i);n<s;++n)t[n]=t[n+i];t.length=s}},TextureCache:{},BaseTextureCache:{}}},{"../const":78,"./pluginTarget":153,eventemitter3:32}],152:[function(t,e,i){var r=t("ismobilejs");e.exports=function(t){return r.tablet||r.phone?2:t}},{ismobilejs:33}],153:[function(t,e,i){e.exports={mixin:function(t){!function(t){t.__plugins={},t.registerPlugin=function(e,i){t.__plugins[e]=i},t.prototype.initPlugins=function(){for(var e in this.plugins=this.plugins||{},t.__plugins)this.plugins[e]=new t.__plugins[e](this)},t.prototype.destroyPlugins=function(){for(var t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null;this.plugins=null}}(t)}}},{}],154:[function(t,e,i){var r=t("./core"),n=t("./mesh"),s=t("./particles"),o=t("./extras"),a=t("./filters");r.SpriteBatch=function(){throw new ReferenceError("SpriteBatch does not exist any more, please use the new ParticleContainer instead.")},r.AssetLoader=function(){throw new ReferenceError("The loader system was overhauled in pixi v3, please see the new PIXI.loaders.Loader class.")},Object.defineProperties(r,{Stage:{get:function(){return r.Container}},DisplayObjectContainer:{get:function(){return r.Container}},Strip:{get:function(){return n.Mesh}},Rope:{get:function(){return n.Rope}},ParticleContainer:{get:function(){return s.ParticleContainer}},MovieClip:{get:function(){return o.MovieClip}},TilingSprite:{get:function(){return o.TilingSprite}},BitmapText:{get:function(){return o.BitmapText}},blendModes:{get:function(){return r.BLEND_MODES}},scaleModes:{get:function(){return r.SCALE_MODES}},BaseTextureCache:{get:function(){return r.utils.BaseTextureCache}},TextureCache:{get:function(){return r.utils.TextureCache}},math:{get:function(){return r}},AbstractFilter:{get:function(){return r.Filter}},TransformManual:{get:function(){return r.TransformBase}}}),r.DisplayObject.prototype.generateTexture=function(t,e,i){return t.generateTexture(this,e,i)},r.Graphics.prototype.generateTexture=function(t,e){return this.generateCanvasTexture(t,e)},r.RenderTexture.prototype.render=function(t,e,i,r){this.legacyRenderer.render(t,this,i,e,!r)},r.RenderTexture.prototype.getImage=function(t){return this.legacyRenderer.extract.image(t)},r.RenderTexture.prototype.getBase64=function(t){return this.legacyRenderer.extract.base64(t)},r.RenderTexture.prototype.getCanvas=function(t){return this.legacyRenderer.extract.canvas(t)},r.RenderTexture.prototype.getPixels=function(t){return this.legacyRenderer.pixels(t)},r.Sprite.prototype.setTexture=function(t){this.texture=t},o.BitmapText.prototype.setText=function(t){this.text=t},r.Text.prototype.setText=function(t){this.text=t},r.Text.prototype.setStyle=function(t){this.style=t},Object.defineProperties(r.TextStyle.prototype,{font:{get:function(){var t="number"==typeof this._fontSize?this._fontSize+"px":this._fontSize;return this._fontStyle+" "+this._fontVariant+" "+this._fontWeight+" "+t+" "+this._fontFamily},set:function(t){t.indexOf("italic")>1?this._fontStyle="italic":t.indexOf("oblique")>-1?this._fontStyle="oblique":this._fontStyle="normal",t.indexOf("small-caps")>-1?this._fontVariant="small-caps":this._fontVariant="normal";var e,i=t.split(" "),r=-1;for(this._fontSize=26,e=0;e<i.length;++e)if(i[e].match(/(px|pt|em|%)/)){r=e,this._fontSize=i[e];break}for(this._fontWeight="normal",e=0;e<r;++e)if(i[e].match(/(bold|bolder|lighter|100|200|300|400|500|600|700|800|900)/)){this._fontWeight=i[e];break}if(r>-1&&r<i.length-1){for(this._fontFamily="",e=r+1;e<i.length;++e)this._fontFamily+=i[e]+" ";this._fontFamily=this._fontFamily.slice(0,-1)}else this._fontFamily="Arial";this.styleID++}}}),r.Texture.prototype.setFrame=function(t){this.frame=t},Object.defineProperties(a,{AbstractFilter:{get:function(){return r.AbstractFilter}},SpriteMaskFilter:{get:function(){return r.SpriteMaskFilter}}}),r.utils.uuid=function(){return r.utils.uid()},r.utils.canUseNewCanvasBlendModes=function(){return r.CanvasTinter.canUseMultiply}},{"./core":97,"./extras":164,"./filters":175,"./mesh":191,"./particles":194}],155:[function(t,e,i){function r(t){this.renderer=t,t.extract=this}var n=t("../../core"),s=new n.Rectangle;r.prototype.constructor=r,e.exports=r,r.prototype.image=function(t){var e=new Image;return e.src=this.base64(t),e},r.prototype.base64=function(t){return this.canvas(t).toDataURL()},r.prototype.canvas=function(t){var e,i,r,o,a=this.renderer;t&&(o=t instanceof n.RenderTexture?t:a.generateTexture(t)),o?(e=o.baseTexture._canvasRenderTarget.context,i=o.baseTexture._canvasRenderTarget.resolution,r=o.frame):(e=a.rootContext,i=a.rootResolution,(r=s).width=this.renderer.width,r.height=this.renderer.height);var h=r.width*i,l=r.height*i,c=new n.CanvasRenderTarget(h,l),u=e.getImageData(r.x*i,r.y*i,h,l);return c.context.putImageData(u,0,0),c.canvas},r.prototype.pixels=function(t){var e,i,r,o,a=this.renderer;return t&&(o=t instanceof n.RenderTexture?t:a.generateTexture(t)),o?(e=o.baseTexture._canvasRenderTarget.context,i=o.baseTexture._canvasRenderTarget.resolution,r=o.frame):(e=a.rootContext,i=a.rootResolution,(r=s).width=a.width,r.height=a.height),e.getImageData(0,0,r.width*i,r.height*i).data},r.prototype.destroy=function(){this.renderer.extract=null,this.renderer=null},n.CanvasRenderer.registerPlugin("extract",r)},{"../../core":97}],156:[function(t,e,i){e.exports={webGL:t("./webgl/WebGLExtract"),canvas:t("./canvas/CanvasExtract")}},{"./canvas/CanvasExtract":155,"./webgl/WebGLExtract":157}],157:[function(t,e,i){function r(t){this.renderer=t,t.extract=this}var n=t("../../core"),s=new n.Rectangle;r.prototype.constructor=r,e.exports=r,r.prototype.image=function(t){var e=new Image;return e.src=this.base64(t),e},r.prototype.base64=function(t){return this.canvas(t).toDataURL()},r.prototype.canvas=function(t){var e,i,r,o,a=this.renderer,h=!1;t&&(o=t instanceof n.RenderTexture?t:this.renderer.generateTexture(t)),o?(i=(e=o.baseTexture._glRenderTargets[this.renderer.CONTEXT_UID]).resolution,r=o.frame,h=!1):(i=(e=this.renderer.rootRenderTarget).resolution,h=!0,(r=s).width=e.size.width,r.height=e.size.height);var l=r.width*i,c=r.height*i,u=new n.CanvasRenderTarget(l,c);if(e){a.bindRenderTarget(e);var d=new Uint8Array(4*l*c),p=a.gl;p.readPixels(r.x*i,r.y*i,l,c,p.RGBA,p.UNSIGNED_BYTE,d);var f=u.context.getImageData(0,0,l,c);f.data.set(d),u.context.putImageData(f,0,0),h&&(u.context.scale(1,-1),u.context.drawImage(u.canvas,0,-c))}return u.canvas},r.prototype.pixels=function(t){var e,i,r,o,a=this.renderer;t&&(o=t instanceof n.RenderTexture?t:this.renderer.generateTexture(t)),o?(i=(e=o.baseTexture._glRenderTargets[this.renderer.CONTEXT_UID]).resolution,r=o.frame):(i=(e=this.renderer.rootRenderTarget).resolution,(r=s).width=e.size.width,r.height=e.size.height);var h=r.width*i,l=r.height*i,c=new Uint8Array(4*h*l);if(e){a.bindRenderTarget(e);var u=a.gl;u.readPixels(r.x*i,r.y*i,h,l,u.RGBA,u.UNSIGNED_BYTE,c)}return c},r.prototype.destroy=function(){this.renderer.extract=null,this.renderer=null},n.WebGLRenderer.registerPlugin("extract",r)},{"../../core":97}],158:[function(t,e,i){function r(t,e){n.Container.call(this),e=e||{},this.textWidth=0,this.textHeight=0,this._glyphs=[],this._font={tint:void 0!==e.tint?e.tint:16777215,align:e.align||"left",name:null,size:0},this.font=e.font,this._text=t,this.maxWidth=0,this.maxLineHeight=0,this._anchor=new s(this.makeDirty,this,0,0),this.dirty=!1,this.updateText()}var n=t("../core"),s=t("../core/math/ObservablePoint");r.prototype=Object.create(n.Container.prototype),r.prototype.constructor=r,e.exports=r,Object.defineProperties(r.prototype,{tint:{get:function(){return this._font.tint},set:function(t){this._font.tint="number"==typeof t&&t>=0?t:16777215,this.dirty=!0}},align:{get:function(){return this._font.align},set:function(t){this._font.align=t||"left",this.dirty=!0}},anchor:{get:function(){return this._anchor},set:function(t){"number"==typeof t?this._anchor.set(t):this._anchor.copy(t)}},font:{get:function(){return this._font},set:function(t){t&&("string"==typeof t?(t=t.split(" "),this._font.name=1===t.length?t[0]:t.slice(1).join(" "),this._font.size=t.length>=2?parseInt(t[0],10):r.fonts[this._font.name].size):(this._font.name=t.name,this._font.size="number"==typeof t.size?t.size:parseInt(t.size,10)),this.dirty=!0)}},text:{get:function(){return this._text},set:function(t){t=t.toString()||" ",this._text!==t&&(this._text=t,this.dirty=!0)}}}),r.prototype.updateText=function(){for(var t=r.fonts[this._font.name],e=new n.Point,i=null,s=[],o=0,a=0,h=[],l=0,c=this._font.size/t.size,u=-1,d=0,p=0,f=0;f<this.text.length;f++){var g=this.text.charCodeAt(f);if(/(\s)/.test(this.text.charAt(f))&&(u=f,d=o),/(?:\r\n|\r|\n)/.test(this.text.charAt(f)))h.push(o),a=Math.max(a,o),l++,e.x=0,e.y+=t.lineHeight,i=null;else if(-1!==u&&this.maxWidth>0&&e.x*c>this.maxWidth)n.utils.removeItems(s,u,f-u),f=u,u=-1,h.push(d),a=Math.max(a,d),l++,e.x=0,e.y+=t.lineHeight,i=null;else{var v=t.chars[g];v&&(i&&v.kerning[i]&&(e.x+=v.kerning[i]),s.push({texture:v.texture,line:l,charCode:g,position:new n.Point(e.x+v.xOffset,e.y+v.yOffset)}),o=e.x+(v.texture.width+v.xOffset),e.x+=v.xAdvance,p=Math.max(p,v.yOffset+v.texture.height),i=g)}}h.push(o),a=Math.max(a,o);var m=[];for(f=0;f<=l;f++){var y=0;"right"===this._font.align?y=a-h[f]:"center"===this._font.align&&(y=(a-h[f])/2),m.push(y)}var x=s.length,_=this.tint;for(f=0;f<x;f++){var b=this._glyphs[f];b?b.texture=s[f].texture:(b=new n.Sprite(s[f].texture),this._glyphs.push(b)),b.position.x=(s[f].position.x+m[s[f].line])*c,b.position.y=s[f].position.y*c,b.scale.x=b.scale.y=c,b.tint=_,b.parent||this.addChild(b)}for(f=x;f<this._glyphs.length;++f)this.removeChild(this._glyphs[f]);if(this.textWidth=a*c,this.textHeight=(e.y+t.lineHeight)*c,0!==this.anchor.x||0!==this.anchor.y)for(f=0;f<x;f++)this._glyphs[f].x-=this.textWidth*this.anchor.x,this._glyphs[f].y-=this.textHeight*this.anchor.y;this.maxLineHeight=p*c},r.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},r.prototype.getLocalBounds=function(){return this.validate(),n.Container.prototype.getLocalBounds.call(this)},r.prototype.validate=function(){this.dirty&&(this.updateText(),this.dirty=!1)},r.prototype.makeDirty=function(){this.dirty=!0},r.fonts={}},{"../core":97,"../core/math/ObservablePoint":100}],159:[function(t,e,i){function r(t){n.Sprite.call(this,t[0]instanceof n.Texture?t[0]:t[0].texture),this._textures=null,this._durations=null,this.textures=t,this.animationSpeed=1,this.loop=!0,this.onComplete=null,this._currentTime=0,this.playing=!1}var n=t("../core");r.prototype=Object.create(n.Sprite.prototype),r.prototype.constructor=r,e.exports=r,Object.defineProperties(r.prototype,{totalFrames:{get:function(){return this._textures.length}},textures:{get:function(){return this._textures},set:function(t){if(t[0]instanceof n.Texture)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(var e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}}},currentFrame:{get:function(){var t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t}}}),r.prototype.stop=function(){this.playing&&(this.playing=!1,n.ticker.shared.remove(this.update,this))},r.prototype.play=function(){this.playing||(this.playing=!0,n.ticker.shared.add(this.update,this))},r.prototype.gotoAndStop=function(t){this.stop(),this._currentTime=t,this._texture=this._textures[this.currentFrame],this._textureID=-1},r.prototype.gotoAndPlay=function(t){this._currentTime=t,this.play()},r.prototype.update=function(t){var e=this.animationSpeed*t;if(null!==this._durations){var i=this._currentTime%1*this._durations[this.currentFrame];for(i+=e/60*1e3;i<0;)this._currentTime--,i+=this._durations[this.currentFrame];var r=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);i>=this._durations[this.currentFrame];)i-=this._durations[this.currentFrame]*r,this._currentTime+=r;this._currentTime+=i/this._durations[this.currentFrame]}else this._currentTime+=e;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):(this._texture=this._textures[this.currentFrame],this._textureID=-1)},r.prototype.destroy=function(){this.stop(),n.Sprite.prototype.destroy.call(this)},r.fromFrames=function(t){for(var e=[],i=0;i<t.length;++i)e.push(n.Texture.fromFrame(t[i]));return new r(e)},r.fromImages=function(t){for(var e=[],i=0;i<t.length;++i)e.push(n.Texture.fromImage(t[i]));return new r(e)}},{"../core":97}],160:[function(t,e,i){function r(t,e,i){n.Sprite.call(this,t),this.tileScale=new n.Point(1,1),this.tilePosition=new n.Point(0,0),this._width=e||100,this._height=i||100,this._uvs=new n.TextureUvs,this._canvasPattern=null,this._glDatas=[]}var n=t("../core"),s=new n.Point,o=t("../core/textures/Texture"),a=t("../core/sprites/canvas/CanvasTinter"),h=t("./webgl/TilingShader"),l=new Float32Array(4);r.prototype=Object.create(n.Sprite.prototype),r.prototype.constructor=r,e.exports=r,Object.defineProperties(r.prototype,{width:{get:function(){return this._width},set:function(t){this._width=t}},height:{get:function(){return this._height},set:function(t){this._height=t}}}),r.prototype._onTextureUpdate=function(){},r.prototype._renderWebGL=function(t){var e=this._texture;if(e&&e._uvs){t.flush();var i=t.gl,r=this._glDatas[t.CONTEXT_UID];r||(r={shader:new h(i),quad:new n.Quad(i)},this._glDatas[t.CONTEXT_UID]=r,r.quad.initVao(r.shader));var s=r.quad.vertices;s[0]=s[6]=this._width*-this.anchor.x,s[1]=s[3]=this._height*-this.anchor.y,s[2]=s[4]=this._width*(1-this.anchor.x),s[5]=s[7]=this._height*(1-this.anchor.y),r.quad.upload(),t.bindShader(r.shader);var o=e._uvs,a=e._frame.width,c=e._frame.height,u=e.baseTexture.width,d=e.baseTexture.height,p=r.shader.uniforms.uPixelSize;p[0]=1/u,p[1]=1/d,r.shader.uniforms.uPixelSize=p;var f=r.shader.uniforms.uFrame;f[0]=o.x0,f[1]=o.y0,f[2]=o.x1-o.x0,f[3]=o.y2-o.y0,r.shader.uniforms.uFrame=f;var g=r.shader.uniforms.uTransform;g[0]=this.tilePosition.x%(a*this.tileScale.x)/this._width,g[1]=this.tilePosition.y%(c*this.tileScale.y)/this._height,g[2]=u/this._width*this.tileScale.x,g[3]=d/this._height*this.tileScale.y,r.shader.uniforms.uTransform=g,r.shader.uniforms.translationMatrix=this.worldTransform.toArray(!0);var v=l;n.utils.hex2rgb(this.tint,v),v[3]=this.worldAlpha,r.shader.uniforms.uColor=v,t.bindTexture(this._texture,0),t.state.setBlendMode(this.blendMode),r.quad.draw()}},r.prototype._renderCanvas=function(t){var e=this._texture;if(e.baseTexture.hasLoaded){var i=t.context,r=this.worldTransform,s=t.resolution,o=e.baseTexture,h=this.tilePosition.x/this.tileScale.x%e._frame.width,l=this.tilePosition.y/this.tileScale.y%e._frame.height;if(!this._canvasPattern){var c=new n.CanvasRenderTarget(e._frame.width,e._frame.height);16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=a.getTintedTexture(this,this.tint)),c.context.drawImage(this.tintedTexture,0,0)):c.context.drawImage(o.source,-e._frame.x,-e._frame.y),this._canvasPattern=c.context.createPattern(c.canvas,"repeat")}i.globalAlpha=this.worldAlpha,i.setTransform(r.a*s,r.b*s,r.c*s,r.d*s,r.tx*s,r.ty*s),i.scale(this.tileScale.x,this.tileScale.y),i.translate(h+this.anchor.x*-this._width,l+this.anchor.y*-this._height);var u=t.blendModes[this.blendMode];u!==t.context.globalCompositeOperation&&(i.globalCompositeOperation=u),i.fillStyle=this._canvasPattern,i.fillRect(-h,-l,this._width/this.tileScale.x,this._height/this.tileScale.y)}},r.prototype.getBounds=function(){var t,e,i,r,n=this._width,s=this._height,o=n*(1-this.anchor.x),a=n*-this.anchor.x,h=s*(1-this.anchor.y),l=s*-this.anchor.y,c=this.worldTransform,u=c.a,d=c.b,p=c.c,f=c.d,g=c.tx,v=c.ty,m=u*a+p*l+g,y=f*l+d*a+v,x=u*o+p*l+g,_=f*l+d*o+v,b=u*o+p*h+g,T=f*h+d*o+v,E=u*a+p*h+g,w=f*h+d*a+v;t=E<(t=b<(t=x<(t=m)?x:t)?b:t)?E:t,i=w<(i=T<(i=_<(i=y)?_:i)?T:i)?w:i,e=E>(e=b>(e=x>(e=m)?x:e)?b:e)?E:e,r=w>(r=T>(r=_>(r=y)?_:r)?T:r)?w:r;var A=this._bounds;return A.x=t,A.width=e-t,A.y=i,A.height=r-i,this._currentBounds=A,A},r.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,s);var e,i=this._width,r=this._height,n=-i*this.anchor.x;return s.x>n&&s.x<n+i&&(e=-r*this.anchor.y,s.y>e&&s.y<e+r)},r.prototype.destroy=function(){n.Sprite.prototype.destroy.call(this),this.tileScale=null,this._tileScaleOffset=null,this.tilePosition=null,this._uvs=null},r.from=function(t,e,i){return new r(o.from(t),e,i)},r.fromFrame=function(t,e,i){var s=n.utils.TextureCache[t];if(!s)throw new Error('The frameId "'+t+'" does not exist in the texture cache '+this);return new r(s,e,i)},r.fromImage=function(t,e,i,s,o){return new r(n.Texture.fromImage(t,s,o),e,i)}},{"../core":97,"../core/sprites/canvas/CanvasTinter":135,"../core/textures/Texture":144,"./webgl/TilingShader":165}],161:[function(t,e,i){var r=t("../core"),n=r.DisplayObject,s=new r.Matrix;n.prototype._cacheAsBitmap=!1,n.prototype._cacheData=!1;var o=function(){this.originalRenderWebGL=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalHitTest=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.sprite=null};Object.defineProperties(n.prototype,{cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(t){var e;this._cacheAsBitmap!==t&&(this._cacheAsBitmap=t,t?(this._cacheData||(this._cacheData=new o),(e=this._cacheData).originalRenderWebGL=this.renderWebGL,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this._calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.renderWebGL=this._renderCachedWebGL,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):((e=this._cacheData).sprite&&this._destroyCachedDisplayObject(),this.renderWebGL=e.originalRenderWebGL,this.renderCanvas=e.originalRenderCanvas,this._calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea))}}}),n.prototype._renderCachedWebGL=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite._transformID=-1,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderWebGL(t))},n.prototype._initCachedDisplayObject=function(t){if(!this._cacheData||!this._cacheData.sprite){var e=this.alpha;this.alpha=1,t.currentRenderer.flush();var i=this.getLocalBounds().clone();if(this._filters){var n=this._filters[0].padding;i.pad(n)}var o=t._activeRenderTarget,a=t.filterManager.filterStack,h=r.RenderTexture.create(0|i.width,0|i.height),l=s;l.tx=-i.x,l.ty=-i.y,this.transform.worldTransform.identity(),this.renderWebGL=this._cacheData.originalRenderWebGL,t.render(this,h,!0,l,!0),t.bindRenderTarget(o),t.filterManager.filterStack=a,this.renderWebGL=this._renderCachedWebGL,this.updateTransform=this.displayObjectUpdateTransform,this._mask=null,this.filterArea=null;var c=new r.Sprite(h);c.transform.worldTransform=this.transform.worldTransform,c.anchor.x=-i.x/i.width,c.anchor.y=-i.y/i.height,c.alpha=e,c._bounds=this._bounds,this._calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._cacheData.sprite=c,this.transform._parentID=-1,this.updateTransform(),this.containsPoint=c.containsPoint.bind(c)}},n.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite.renderCanvas(t))},n.prototype._initCachedDisplayObjectCanvas=function(t){if(!this._cacheData||!this._cacheData.sprite){var e=this.getLocalBounds(),i=this.alpha;this.alpha=1;var n=t.context,o=new r.RenderTexture.create(0|e.width,0|e.height),a=s;this.transform.worldTransform.copy(a),a.invert(),a.tx-=e.x,a.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,o,!0,a,!1),t.context=n,this.renderCanvas=this._renderCachedCanvas,this._calculateBounds=this._calculateCachedBounds,this._mask=null,this.filterArea=null;var h=new r.Sprite(o);h.transform.worldTransform=this.transform.worldTransform,h.anchor.x=-e.x/e.width,h.anchor.y=-e.y/e.height,h._bounds=this._bounds,h.alpha=i,this.updateTransform(),this.updateTransform=this.displayObjectUpdateTransform,this._cacheData.sprite=h,this.containsPoint=h.containsPoint.bind(h)}},n.prototype._calculateCachedBounds=function(){return this._cacheData.sprite._calculateBounds()},n.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds()},n.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null},n.prototype._cacheAsBitmapDestroy=function(){this.cacheAsBitmap=!1,this.destroy()}},{"../core":97}],162:[function(t,e,i){var r=t("../core");r.DisplayObject.prototype.name=null,r.Container.prototype.getChildByName=function(t){for(var e=0;e<this.children.length;e++)if(this.children[e].name===t)return this.children[e];return null}},{"../core":97}],163:[function(t,e,i){var r=t("../core");r.DisplayObject.prototype.getGlobalPosition=function(t){return t=t||new r.Point,this.parent?(this.displayObjectUpdateTransform(),t.x=this.worldTransform.tx,t.y=this.worldTransform.ty):(t.x=this.position.x,t.y=this.position.y),t}},{"../core":97}],164:[function(t,e,i){t("./cacheAsBitmap"),t("./getChildByName"),t("./getGlobalPosition"),e.exports={MovieClip:t("./MovieClip"),TilingSprite:t("./TilingSprite"),BitmapText:t("./BitmapText")}},{"./BitmapText":158,"./MovieClip":159,"./TilingSprite":160,"./cacheAsBitmap":161,"./getChildByName":162,"./getGlobalPosition":163}],165:[function(t,e,i){function r(t){n.call(this,t,"#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\n\nuniform vec4 uFrame;\nuniform vec4 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vec2 coord = aTextureCoord;\n    coord -= uTransform.xy;\n    coord /= uTransform.zw;\n    vTextureCoord = coord;\n}\n","#define GLSLIFY 1\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform vec4 uFrame;\nuniform vec2 uPixelSize;\n\nvoid main(void)\n{\n\n   \tvec2 coord = mod(vTextureCoord, uFrame.zw);\n   \tcoord = clamp(coord, uPixelSize, uFrame.zw - uPixelSize);\n   \tcoord += uFrame.xy;\n\n   \tvec4 sample = texture2D(uSampler, coord);\n  \tvec4 color = vec4(uColor.rgb * uColor.a, uColor.a);\n\n   \tgl_FragColor = sample * color ;\n}\n")}var n=t("../../core/Shader");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,e.exports=r},{"../../core/Shader":77}],166:[function(t,e,i){function r(t,e,i){n.Filter.call(this),this.blurXFilter=new s,this.blurYFilter=new o,this.resolution=1,this.padding=0,this.resolution=i||1,this.quality=e||4,this.blur=t||8}var n=t("../../core"),s=t("./BlurXFilter"),o=t("./BlurYFilter");r.prototype=Object.create(n.Filter.prototype),r.prototype.constructor=r,e.exports=r,r.prototype.apply=function(t,e,i){var r=t.getRenderTarget(!0);this.blurXFilter.apply(t,e,r,!0),this.blurYFilter.apply(t,r,i,!1),t.returnRenderTarget(r)},Object.defineProperties(r.prototype,{blur:{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.padding=2*Math.max(Math.abs(this.blurYFilter.strength),Math.abs(this.blurYFilter.strength))}},quality:{get:function(){return this.blurXFilter.quality},set:function(t){this.blurXFilter.quality=this.blurYFilter.quality=t}},blurX:{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=t,this.padding=2*Math.max(Math.abs(this.blurYFilter.strength),Math.abs(this.blurYFilter.strength))}},blurY:{get:function(){return this.blurYFilter.blur},set:function(t){this.blurYFilter.blur=t,this.padding=2*Math.max(Math.abs(this.blurYFilter.strength),Math.abs(this.blurYFilter.strength))}}})},{"../../core":97,"./BlurXFilter":167,"./BlurYFilter":168}],167:[function(t,e,i){function r(t,e,i){var r=s(5,!0),a=o(5);n.Filter.call(this,r,a),this.resolution=i||1,this._quality=0,this.quality=e||4,this.strength=t||8,this.firstRun=!0}var n=t("../../core"),s=t("./generateBlurVertSource"),o=t("./generateBlurFragSource"),a=t("./getMaxBlurKernelSize");r.prototype=Object.create(n.Filter.prototype),r.prototype.constructor=r,e.exports=r,r.prototype.apply=function(t,e,i,r){if(this.firstRun){var n=t.renderer.gl,h=a(n);this.vertexSrc=s(h,!0),this.fragmentSrc=o(h),this.firstRun=!1}if(this.uniforms.strength=1/i.size.width*(i.size.width/e.size.width),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)t.applyFilter(this,e,i,r);else{for(var l=t.getRenderTarget(!0),c=e,u=l,d=0;d<this.passes-1;d++){t.applyFilter(this,c,u,!0);var p=u;u=c,c=p}t.applyFilter(this,c,i,r),t.returnRenderTarget(l)}},Object.defineProperties(r.prototype,{blur:{get:function(){return this.strength},set:function(t){this.padding=2*Math.abs(t),this.strength=t}},quality:{get:function(){return this._quality},set:function(t){this._quality=t,this.passes=t}}})},{"../../core":97,"./generateBlurFragSource":169,"./generateBlurVertSource":170,"./getMaxBlurKernelSize":171}],168:[function(t,e,i){function r(t,e,i){var r=s(5,!1),a=o(5);n.Filter.call(this,r,a),this.resolution=i||1,this._quality=0,this.quality=e||4,this.strength=t||8,this.firstRun=!0}var n=t("../../core"),s=t("./generateBlurVertSource"),o=t("./generateBlurFragSource"),a=t("./getMaxBlurKernelSize");r.prototype=Object.create(n.Filter.prototype),r.prototype.constructor=r,e.exports=r,r.prototype.apply=function(t,e,i,r){if(this.firstRun){var n=t.renderer.gl,h=a(n);this.vertexSrc=s(h,!1),this.fragmentSrc=o(h),this.firstRun=!1}if(this.uniforms.strength=1/i.size.height*(i.size.height/e.size.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)t.applyFilter(this,e,i,r);else{for(var l=t.getRenderTarget(!0),c=e,u=l,d=0;d<this.passes-1;d++){t.applyFilter(this,c,u,!0);var p=u;u=c,c=p}t.applyFilter(this,c,i,r),t.returnRenderTarget(l)}},Object.defineProperties(r.prototype,{blur:{get:function(){return this.strength},set:function(t){this.padding=2*Math.abs(t),this.strength=t}},quality:{get:function(){return this._quality},set:function(t){this._quality=t,this.passes=t}}})},{"../../core":97,"./generateBlurFragSource":169,"./generateBlurVertSource":170,"./getMaxBlurKernelSize":171}],169:[function(t,e,i){var r={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},n=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","\tgl_FragColor = vec4(0.0);","\t%blur%","}"].join("\n");e.exports=function(t){for(var e,i=r[t],s=i.length,o=n,a="",h=0;h<t;h++){var l="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",h);e=h,h>=s&&(e=t-h-1),a+=l=l.replace("%value%",i[e]),a+="\n"}return(o=o.replace("%blur%",a)).replace("%size%",t)}},{}],170:[function(t,e,i){var r=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform float strength;","uniform mat3 projectionMatrix;","varying vec2 vBlurTexCoords[%size%];","void main(void)","{","gl_Position = vec4((projectionMatrix * vec3((aVertexPosition), 1.0)).xy, 0.0, 1.0);","%blur%","}"].join("\n");e.exports=function(t,e){var i,n=Math.ceil(t/2),s=r,o="";i=e?"vBlurTexCoords[%index%] = aTextureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] = aTextureCoord + vec2(0.0, %sampleIndex% * strength);";for(var a=0;a<t;a++){var h=i.replace("%index%",a);a,a>=n&&t-a-1,o+=h=h.replace("%sampleIndex%",a-(n-1)+".0"),o+="\n"}return(s=s.replace("%blur%",o)).replace("%size%",t)}},{}],171:[function(t,e,i){e.exports=function(t){for(var e=t.getParameter(t.MAX_VARYING_VECTORS),i=15;i>e;)i-=2;return i}},{}],172:[function(t,e,i){function r(){n.Filter.call(this,"#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\n\nvoid main(void)\n{\n\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    gl_FragColor.r = (m[0] * c.r);\n        gl_FragColor.r += (m[1] * c.g);\n        gl_FragColor.r += (m[2] * c.b);\n        gl_FragColor.r += (m[3] * c.a);\n        gl_FragColor.r += m[4] * c.a;\n\n    gl_FragColor.g = (m[5] * c.r);\n        gl_FragColor.g += (m[6] * c.g);\n        gl_FragColor.g += (m[7] * c.b);\n        gl_FragColor.g += (m[8] * c.a);\n        gl_FragColor.g += m[9] * c.a;\n\n     gl_FragColor.b = (m[10] * c.r);\n        gl_FragColor.b += (m[11] * c.g);\n        gl_FragColor.b += (m[12] * c.b);\n        gl_FragColor.b += (m[13] * c.a);\n        gl_FragColor.b += m[14] * c.a;\n\n     gl_FragColor.a = (m[15] * c.r);\n        gl_FragColor.a += (m[16] * c.g);\n        gl_FragColor.a += (m[17] * c.b);\n        gl_FragColor.a += (m[18] * c.a);\n        gl_FragColor.a += m[19] * c.a;\n\n//    gl_FragColor = vec4(m[0]);\n}\n"),this.uniforms.m=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]}var n=t("../../core");r.prototype=Object.create(n.Filter.prototype),r.prototype.constructor=r,e.exports=r,r.prototype._loadMatrix=function(t,e){var i=t;(e=!!e)&&(this._multiply(i,this.uniforms.m,t),i=this._colorMatrix(i)),this.uniforms.m=i},r.prototype._multiply=function(t,e,i){return t[0]=e[0]*i[0]+e[1]*i[5]+e[2]*i[10]+e[3]*i[15],t[1]=e[0]*i[1]+e[1]*i[6]+e[2]*i[11]+e[3]*i[16],t[2]=e[0]*i[2]+e[1]*i[7]+e[2]*i[12]+e[3]*i[17],t[3]=e[0]*i[3]+e[1]*i[8]+e[2]*i[13]+e[3]*i[18],t[4]=e[0]*i[4]+e[1]*i[9]+e[2]*i[14]+e[3]*i[19],t[5]=e[5]*i[0]+e[6]*i[5]+e[7]*i[10]+e[8]*i[15],t[6]=e[5]*i[1]+e[6]*i[6]+e[7]*i[11]+e[8]*i[16],t[7]=e[5]*i[2]+e[6]*i[7]+e[7]*i[12]+e[8]*i[17],t[8]=e[5]*i[3]+e[6]*i[8]+e[7]*i[13]+e[8]*i[18],t[9]=e[5]*i[4]+e[6]*i[9]+e[7]*i[14]+e[8]*i[19],t[10]=e[10]*i[0]+e[11]*i[5]+e[12]*i[10]+e[13]*i[15],t[11]=e[10]*i[1]+e[11]*i[6]+e[12]*i[11]+e[13]*i[16],t[12]=e[10]*i[2]+e[11]*i[7]+e[12]*i[12]+e[13]*i[17],t[13]=e[10]*i[3]+e[11]*i[8]+e[12]*i[13]+e[13]*i[18],t[14]=e[10]*i[4]+e[11]*i[9]+e[12]*i[14]+e[13]*i[19],t[15]=e[15]*i[0]+e[16]*i[5]+e[17]*i[10]+e[18]*i[15],t[16]=e[15]*i[1]+e[16]*i[6]+e[17]*i[11]+e[18]*i[16],t[17]=e[15]*i[2]+e[16]*i[7]+e[17]*i[12]+e[18]*i[17],t[18]=e[15]*i[3]+e[16]*i[8]+e[17]*i[13]+e[18]*i[18],t[19]=e[15]*i[4]+e[16]*i[9]+e[17]*i[14]+e[18]*i[19],t},r.prototype._colorMatrix=function(t){var e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e},r.prototype.brightness=function(t,e){var i=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)},r.prototype.greyscale=function(t,e){var i=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)},r.prototype.grayscale=r.prototype.greyscale,r.prototype.blackAndWhite=function(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)},r.prototype.hue=function(t,e){t=(t||0)/180*Math.PI;var i=Math.cos(t),r=Math.sin(t),n=1/3,s=(0,Math.sqrt)(n),o=[i+(1-i)*n,n*(1-i)-s*r,n*(1-i)+s*r,0,0,n*(1-i)+s*r,i+n*(1-i),n*(1-i)-s*r,0,0,n*(1-i)-s*r,n*(1-i)+s*r,i+n*(1-i),0,0,0,0,0,1,0];this._loadMatrix(o,e)},r.prototype.contrast=function(t,e){var i=(t||0)+1,r=-128*(i-1),n=[i,0,0,0,r,0,i,0,0,r,0,0,i,0,r,0,0,0,1,0];this._loadMatrix(n,e)},r.prototype.saturate=function(t,e){var i=2*(t||0)/3+1,r=-.5*(i-1),n=[i,r,r,0,0,r,i,r,0,0,r,r,i,0,0,0,0,0,1,0];this._loadMatrix(n,e)},r.prototype.desaturate=function(){this.saturate(-1)},r.prototype.negative=function(t){this._loadMatrix([0,1,1,0,0,1,0,1,0,0,1,1,0,0,0,0,0,0,1,0],t)},r.prototype.sepia=function(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)},r.prototype.technicolor=function(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)},r.prototype.polaroid=function(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)},r.prototype.toBGR=function(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)},r.prototype.kodachrome=function(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)},r.prototype.browni=function(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)},r.prototype.vintage=function(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)},r.prototype.colorTone=function(t,e,i,r,n){var s=((i=i||16770432)>>16&255)/255,o=(i>>8&255)/255,a=(255&i)/255,h=((r=r||3375104)>>16&255)/255,l=(r>>8&255)/255,c=(255&r)/255,u=[.3,.59,.11,0,0,s,o,a,t=t||.2,0,h,l,c,e=e||.15,0,s-h,o-l,a-c,0,0];this._loadMatrix(u,n)},r.prototype.night=function(t,e){var i=[-2*(t=t||.1),-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0];this._loadMatrix(i,e)},r.prototype.predator=function(t,e){var i=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(i,e)},r.prototype.lsd=function(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)},r.prototype.reset=function(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)},Object.defineProperties(r.prototype,{matrix:{get:function(){return this.uniforms.m},set:function(t){this.uniforms.m=t}}})},{"../../core":97}],173:[function(t,e,i){function r(t,e){var i=new n.Matrix;t.renderable=!1,n.Filter.call(this,"#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nvoid main(void)\n{\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vFilterCoord = ( filterMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n   vTextureCoord = aTextureCoord;\n}","#define GLSLIFY 1\nvarying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\n\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform vec4 filterClamp;\n\nvoid main(void)\n{\n   vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n   map -= 0.5;\n   map.xy *= scale;\n\n   gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), filterClamp.xy, filterClamp.zw));\n}\n"),this.maskSprite=t,this.maskMatrix=i,this.uniforms.mapSampler=t.texture,this.uniforms.filterMatrix=i.toArray(!0),this.uniforms.scale={x:1,y:1},null!=e||(e=20),this.scale=new n.Point(e,e)}var n=t("../../core");r.prototype=Object.create(n.Filter.prototype),r.prototype.constructor=r,e.exports=r,r.prototype.apply=function(t,e,i){var r=1/i.destinationFrame.width*(i.size.width/e.size.width);this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x*r,this.uniforms.scale.y=this.scale.y*r,t.applyFilter(this,e,i)},Object.defineProperties(r.prototype,{map:{get:function(){return this.uniforms.mapSampler},set:function(t){this.uniforms.mapSampler=t}}})},{"../../core":97}],174:[function(t,e,i){function r(){n.Filter.call(this,"#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nuniform vec4 filterArea;\n\nvarying vec2 vTextureCoord;\n\nvec2 mapCoord( vec2 coord )\n{\n    coord *= filterArea.xy;\n    coord += filterArea.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord )\n{\n    coord -= filterArea.zw;\n    coord /= filterArea.xy;\n\n    return coord;\n}\n\nvoid texcoords(vec2 fragCoord, vec2 resolution,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    vec2 inverseVP = 1.0 / resolution.xy;\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n   vTextureCoord = aTextureCoord;\n\n   vec2 fragCoord = vTextureCoord * filterArea.xy;\n\n   texcoords(fragCoord, filterArea.xy, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}",'#define GLSLIFY 1\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec4 filterArea;\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n \n --\n \n From:\n https://github.com/mitsuhiko/webgl-meincraft\n \n Copyright (c) 2011 by Armin Ronacher.\n \n Some rights reserved.\n \n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n \n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n \n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n \n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n \n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    mediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n    \n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n    \n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n    \n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n    \n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n    \n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n  \tvec2 fragCoord = vTextureCoord * filterArea.xy;\n\n  \tvec4 color;\n\n    color = fxaa(uSampler, fragCoord, filterArea.xy, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n  \tgl_FragColor = color;\n}\n')}var n=t("../../core");r.prototype=Object.create(n.Filter.prototype),r.prototype.constructor=r,e.exports=r},{"../../core":97}],175:[function(t,e,i){e.exports={FXAAFilter:t("./fxaa/FXAAFilter"),NoiseFilter:t("./noise/NoiseFilter"),DisplacementFilter:t("./displacement/DisplacementFilter"),BlurFilter:t("./blur/BlurFilter"),BlurXFilter:t("./blur/BlurXFilter"),BlurYFilter:t("./blur/BlurYFilter"),ColorMatrixFilter:t("./colormatrix/ColorMatrixFilter"),VoidFilter:t("./void/VoidFilter")}},{"./blur/BlurFilter":166,"./blur/BlurXFilter":167,"./blur/BlurYFilter":168,"./colormatrix/ColorMatrixFilter":172,"./displacement/DisplacementFilter":173,"./fxaa/FXAAFilter":174,"./noise/NoiseFilter":176,"./void/VoidFilter":177}],176:[function(t,e,i){function r(){n.Filter.call(this,"#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","precision highp float;\n#define GLSLIFY 1\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float noise;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n\n    float diff = (rand(gl_FragCoord.xy) - 0.5) * noise;\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    gl_FragColor = color;\n}\n"),this.noise=.5}var n=t("../../core");r.prototype=Object.create(n.Filter.prototype),r.prototype.constructor=r,e.exports=r,Object.defineProperties(r.prototype,{noise:{get:function(){return this.uniforms.noise},set:function(t){this.uniforms.noise=t}}})},{"../../core":97}],177:[function(t,e,i){function r(){n.Filter.call(this,"#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","#define GLSLIFY 1\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"),this.glShaderKey="void"}var n=t("../../core");r.prototype=Object.create(n.Filter.prototype),r.prototype.constructor=r,e.exports=r},{"../../core":97}],178:[function(t,e,i){function r(){this.global=new n.Point,this.target=null,this.originalEvent=null}var n=t("../core");r.prototype.constructor=r,e.exports=r,r.prototype.getLocalPosition=function(t,e,i){return t.worldTransform.applyInverse(i||this.global,e)}},{"../core":97}],179:[function(t,e,i){function r(t,e){o.call(this),e=e||{},this.renderer=t,this.autoPreventDefault=void 0===e.autoPreventDefault||e.autoPreventDefault,this.interactionFrequency=e.interactionFrequency||10,this.mouse=new s,this.mouse.global.set(-999999),this.eventData={stopped:!1,target:null,type:null,data:this.mouse,stopPropagation:function(){this.stopped=!0}},this.interactiveDataPool=[],this.interactionDOMElement=null,this.moveWhenInside=!1,this.eventsAdded=!1,this.onMouseUp=this.onMouseUp.bind(this),this.processMouseUp=this.processMouseUp.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.processMouseDown=this.processMouseDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.processMouseMove=this.processMouseMove.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.processMouseOverOut=this.processMouseOverOut.bind(this),this.onMouseOver=this.onMouseOver.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.processTouchStart=this.processTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.processTouchEnd=this.processTouchEnd.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.processTouchMove=this.processTouchMove.bind(this),this.defaultCursorStyle="inherit",this.currentCursorStyle="inherit",this._tempPoint=new n.Point,this.resolution=1,this.setTargetElement(this.renderer.view,this.renderer.resolution)}var n=t("../core"),s=t("./InteractionData"),o=t("eventemitter3");Object.assign(n.DisplayObject.prototype,t("./interactiveTarget")),r.prototype=Object.create(o.prototype),r.prototype.constructor=r,e.exports=r,r.prototype.setTargetElement=function(t,e){this.removeEvents(),this.interactionDOMElement=t,this.resolution=e||1,this.addEvents()},r.prototype.addEvents=function(){this.interactionDOMElement&&(n.ticker.shared.add(this.update,this),window.navigator.msPointerEnabled&&(this.interactionDOMElement.style["-ms-content-zooming"]="none",this.interactionDOMElement.style["-ms-touch-action"]="none"),window.document.addEventListener("mousemove",this.onMouseMove,!0),this.interactionDOMElement.addEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.addEventListener("mouseout",this.onMouseOut,!0),this.interactionDOMElement.addEventListener("mouseover",this.onMouseOver,!0),this.interactionDOMElement.addEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.addEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.addEventListener("touchmove",this.onTouchMove,!0),window.addEventListener("mouseup",this.onMouseUp,!0),this.eventsAdded=!0)},r.prototype.removeEvents=function(){this.interactionDOMElement&&(n.ticker.shared.remove(this.update),window.navigator.msPointerEnabled&&(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]=""),window.document.removeEventListener("mousemove",this.onMouseMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onMouseOut,!0),this.interactionDOMElement.removeEventListener("mouseover",this.onMouseOver,!0),this.interactionDOMElement.removeEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.removeEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onTouchMove,!0),this.interactionDOMElement=null,window.removeEventListener("mouseup",this.onMouseUp,!0),this.eventsAdded=!1)},r.prototype.update=function(t){if(this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.interactionDOMElement)){if(this.didMove)return void(this.didMove=!1);this.cursor=this.defaultCursorStyle,this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseOverOut,!0),this.currentCursorStyle!==this.cursor&&(this.currentCursorStyle=this.cursor,this.interactionDOMElement.style.cursor=this.cursor)}},r.prototype.dispatchEvent=function(t,e,i){i.stopped||(i.target=t,i.type=e,t.emit(e,i),t[e]&&t[e](i))},r.prototype.mapPositionToPoint=function(t,e,i){var r;r=this.interactionDOMElement.parentElement?this.interactionDOMElement.getBoundingClientRect():{x:0,y:0,width:0,height:0},t.x=(e-r.left)*(this.interactionDOMElement.width/r.width)/this.resolution,t.y=(i-r.top)*(this.interactionDOMElement.height/r.height)/this.resolution},r.prototype.processInteractive=function(t,e,i,r,n){if(!e||!e.visible)return!1;var s=!1,o=n=e.interactive||n;if(e.hitArea&&(o=!1),r&&e._mask&&(e._mask.containsPoint(t)||(r=!1)),r&&e.filterArea&&(e.filterArea.contains(t.x,t.y)||(r=!1)),e.interactiveChildren)for(var a=e.children,h=a.length-1;h>=0;h--){var l=a[h];if(this.processInteractive(t,l,i,r,o)){if(!l.parent)continue;s=!0,o=!1,r=!1}}return n&&(r&&!s&&(e.hitArea?(e.worldTransform.applyInverse(t,this._tempPoint),s=e.hitArea.contains(this._tempPoint.x,this._tempPoint.y)):e.containsPoint&&(s=e.containsPoint(t))),e.interactive&&i(e,s)),s},r.prototype.onMouseDown=function(t){this.mouse.originalEvent=t,this.eventData.data=this.mouse,this.eventData.stopped=!1,this.mapPositionToPoint(this.mouse.global,t.clientX,t.clientY),this.autoPreventDefault&&this.mouse.originalEvent.preventDefault(),this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseDown,!0);var e=2===t.button||3===t.which;this.emit(e?"rightdown":"mousedown",this.eventData)},r.prototype.processMouseDown=function(t,e){var i=this.mouse.originalEvent,r=2===i.button||3===i.which;e&&(t[r?"_isRightDown":"_isLeftDown"]=!0,this.dispatchEvent(t,r?"rightdown":"mousedown",this.eventData))},r.prototype.onMouseUp=function(t){this.mouse.originalEvent=t,this.eventData.data=this.mouse,this.eventData.stopped=!1,this.mapPositionToPoint(this.mouse.global,t.clientX,t.clientY),this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseUp,!0);var e=2===t.button||3===t.which;this.emit(e?"rightup":"mouseup",this.eventData)},r.prototype.processMouseUp=function(t,e){var i=this.mouse.originalEvent,r=2===i.button||3===i.which,n=r?"_isRightDown":"_isLeftDown";e?(this.dispatchEvent(t,r?"rightup":"mouseup",this.eventData),t[n]&&(t[n]=!1,this.dispatchEvent(t,r?"rightclick":"click",this.eventData))):t[n]&&(t[n]=!1,this.dispatchEvent(t,r?"rightupoutside":"mouseupoutside",this.eventData))},r.prototype.onMouseMove=function(t){this.mouse.originalEvent=t,this.eventData.data=this.mouse,this.eventData.stopped=!1,this.mapPositionToPoint(this.mouse.global,t.clientX,t.clientY),this.didMove=!0,this.cursor=this.defaultCursorStyle,this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseMove,!0),this.emit("mousemove",this.eventData),this.currentCursorStyle!==this.cursor&&(this.currentCursorStyle=this.cursor,this.interactionDOMElement.style.cursor=this.cursor)},r.prototype.processMouseMove=function(t,e){this.processMouseOverOut(t,e),this.moveWhenInside&&!e||this.dispatchEvent(t,"mousemove",this.eventData)},r.prototype.onMouseOut=function(t){this.mouse.originalEvent=t,this.eventData.data=this.mouse,this.eventData.stopped=!1,this.mapPositionToPoint(this.mouse.global,t.clientX,t.clientY),this.interactionDOMElement.style.cursor=this.defaultCursorStyle,this.mapPositionToPoint(this.mouse.global,t.clientX,t.clientY),this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseOverOut,!1),this.emit("mouseout",this.eventData)},r.prototype.processMouseOverOut=function(t,e){e?(t._over||(t._over=!0,this.dispatchEvent(t,"mouseover",this.eventData)),t.buttonMode&&(this.cursor=t.defaultCursor)):t._over&&(t._over=!1,this.dispatchEvent(t,"mouseout",this.eventData))},r.prototype.onMouseOver=function(t){this.mouse.originalEvent=t,this.eventData.data=this.mouse,this.eventData.stopped=!1,this.emit("mouseover",this.eventData)},r.prototype.onTouchStart=function(t){this.autoPreventDefault&&t.preventDefault();for(var e=t.changedTouches,i=e.length,r=0;r<i;r++){var n=e[r],s=this.getTouchData(n);s.originalEvent=t,this.eventData.data=s,this.eventData.stopped=!1,this.processInteractive(s.global,this.renderer._lastObjectRendered,this.processTouchStart,!0),this.emit("touchstart",this.eventData),this.returnTouchData(s)}},r.prototype.processTouchStart=function(t,e){e&&(t._touchDown=!0,this.dispatchEvent(t,"touchstart",this.eventData))},r.prototype.onTouchEnd=function(t){this.autoPreventDefault&&t.preventDefault();for(var e=t.changedTouches,i=e.length,r=0;r<i;r++){var n=e[r],s=this.getTouchData(n);s.originalEvent=t,this.eventData.data=s,this.eventData.stopped=!1,this.processInteractive(s.global,this.renderer._lastObjectRendered,this.processTouchEnd,!0),this.emit("touchend",this.eventData),this.returnTouchData(s)}},r.prototype.processTouchEnd=function(t,e){e?(this.dispatchEvent(t,"touchend",this.eventData),t._touchDown&&(t._touchDown=!1,this.dispatchEvent(t,"tap",this.eventData))):t._touchDown&&(t._touchDown=!1,this.dispatchEvent(t,"touchendoutside",this.eventData))},r.prototype.onTouchMove=function(t){this.autoPreventDefault&&t.preventDefault();for(var e=t.changedTouches,i=e.length,r=0;r<i;r++){var n=e[r],s=this.getTouchData(n);s.originalEvent=t,this.eventData.data=s,this.eventData.stopped=!1,this.processInteractive(s.global,this.renderer._lastObjectRendered,this.processTouchMove,this.moveWhenInside),this.emit("touchmove",this.eventData),this.returnTouchData(s)}},r.prototype.processTouchMove=function(t,e){this.moveWhenInside&&!e||this.dispatchEvent(t,"touchmove",this.eventData)},r.prototype.getTouchData=function(t){var e=this.interactiveDataPool.pop();return e||(e=new s),e.identifier=t.identifier,this.mapPositionToPoint(e.global,t.clientX,t.clientY),navigator.isCocoonJS&&(e.global.x=e.global.x/this.resolution,e.global.y=e.global.y/this.resolution),t.globalX=e.global.x,t.globalY=e.global.y,e},r.prototype.returnTouchData=function(t){this.interactiveDataPool.push(t)},r.prototype.destroy=function(){this.removeEvents(),this.removeAllListeners(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactiveDataPool=null,this.interactionDOMElement=null,this.onMouseUp=null,this.processMouseUp=null,this.onMouseDown=null,this.processMouseDown=null,this.onMouseMove=null,this.processMouseMove=null,this.onMouseOut=null,this.processMouseOverOut=null,this.onMouseOver=null,this.onTouchStart=null,this.processTouchStart=null,this.onTouchEnd=null,this.processTouchEnd=null,this.onTouchMove=null,this.processTouchMove=null,this._tempPoint=null},n.WebGLRenderer.registerPlugin("interaction",r),n.CanvasRenderer.registerPlugin("interaction",r)},{"../core":97,"./InteractionData":178,"./interactiveTarget":181,eventemitter3:32}],180:[function(t,e,i){e.exports={InteractionData:t("./InteractionData"),InteractionManager:t("./InteractionManager"),interactiveTarget:t("./interactiveTarget")}},{"./InteractionData":178,"./InteractionManager":179,"./interactiveTarget":181}],181:[function(t,e,i){e.exports={interactive:!1,interactiveChildren:!0,hitArea:null,buttonMode:!1,defaultCursor:"pointer",_over:!1,_isLeftDown:!1,_isRightDown:!1,_touchDown:!1}},{}],182:[function(t,e,i){function r(t,e){var i={},r=t.data.getElementsByTagName("info")[0],n=t.data.getElementsByTagName("common")[0];i.font=r.getAttribute("face"),i.size=parseInt(r.getAttribute("size"),10),i.lineHeight=parseInt(n.getAttribute("lineHeight"),10),i.chars={};for(var a=t.data.getElementsByTagName("char"),h=0;h<a.length;h++){var l=parseInt(a[h].getAttribute("id"),10),c=new s.Rectangle(parseInt(a[h].getAttribute("x"),10)+e.frame.x,parseInt(a[h].getAttribute("y"),10)+e.frame.y,parseInt(a[h].getAttribute("width"),10),parseInt(a[h].getAttribute("height"),10));i.chars[l]={xOffset:parseInt(a[h].getAttribute("xoffset"),10),yOffset:parseInt(a[h].getAttribute("yoffset"),10),xAdvance:parseInt(a[h].getAttribute("xadvance"),10),kerning:{},texture:new s.Texture(e.baseTexture,c)}}var u=t.data.getElementsByTagName("kerning");for(h=0;h<u.length;h++){var d=parseInt(u[h].getAttribute("first"),10),p=parseInt(u[h].getAttribute("second"),10),f=parseInt(u[h].getAttribute("amount"),10);i.chars[p]&&(i.chars[p].kerning[d]=f)}t.bitmapFont=i,o.BitmapText.fonts[i.font]=i}var n=t("resource-loader").Resource,s=t("../core"),o=t("../extras"),a=t("path");e.exports=function(){return function(t,e){if(!t.data||!t.isXml)return e();if(0===t.data.getElementsByTagName("page").length||0===t.data.getElementsByTagName("info").length||null===t.data.getElementsByTagName("info")[0].getAttribute("face"))return e();var i=t.isDataUrl?"":a.dirname(t.url);t.isDataUrl&&("."===i&&(i=""),this.baseUrl&&i&&("/"===this.baseUrl.charAt(this.baseUrl.length-1)&&(i+="/"),i=i.replace(this.baseUrl,""))),i&&"/"!==i.charAt(i.length-1)&&(i+="/");var o=i+t.data.getElementsByTagName("page")[0].getAttribute("file");if(s.utils.TextureCache[o])r(t,s.utils.TextureCache[o]),e();else{var h={crossOrigin:t.crossOrigin,loadType:n.LOAD_TYPE.IMAGE,metadata:t.metadata.imageMetadata};this.add(t.name+"_image",o,h,(function(i){r(t,i.texture),e()}))}}}},{"../core":97,"../extras":164,path:60,"resource-loader":69}],183:[function(t,e,i){e.exports={Loader:t("./loader"),bitmapFontParser:t("./bitmapFontParser"),spritesheetParser:t("./spritesheetParser"),textureParser:t("./textureParser"),Resource:t("resource-loader").Resource}},{"./bitmapFontParser":182,"./loader":184,"./spritesheetParser":185,"./textureParser":186,"resource-loader":69}],184:[function(t,e,i){function r(t,e){n.call(this,t,e);for(var i=0;i<r._pixiMiddleware.length;++i)this.use(r._pixiMiddleware[i]())}var n=t("resource-loader"),s=t("./textureParser"),o=t("./spritesheetParser"),a=t("./bitmapFontParser");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,e.exports=r,r._pixiMiddleware=[n.middleware.parsing.blob,s,o,a],r.addPixiMiddleware=function(t){r._pixiMiddleware.push(t)};var h=n.Resource;h.setExtensionXhrType("fnt",h.XHR_RESPONSE_TYPE.DOCUMENT)},{"./bitmapFontParser":182,"./spritesheetParser":185,"./textureParser":186,"resource-loader":69}],185:[function(t,e,i){var r=t("resource-loader").Resource,n=t("path"),s=t("../core"),o=1e3;e.exports=function(){return function(t,e){var i,a=t.name+"_image";if(!t.data||!t.isJson||!t.data.frames||this.resources[a])return e();var h={crossOrigin:t.crossOrigin,loadType:r.LOAD_TYPE.IMAGE,metadata:t.metadata.imageMetadata};i=t.isDataUrl?t.data.meta.image:n.dirname(t.url.replace(this.baseUrl,""))+"/"+t.data.meta.image,this.add(a,i,h,(function(i){function r(e,r){for(var o=e;o-e<r&&o<a.length;){var l=a[o],c=n[l].frame;if(c){var u,d=null,p=new s.Rectangle(0,0,n[l].sourceSize.w/h,n[l].sourceSize.h/h);u=n[l].rotated?new s.Rectangle(c.x/h,c.y/h,c.h/h,c.w/h):new s.Rectangle(c.x/h,c.y/h,c.w/h,c.h/h),n[l].trimmed&&(d=new s.Rectangle(n[l].spriteSourceSize.x/h,n[l].spriteSourceSize.y/h,n[l].spriteSourceSize.w/h,n[l].spriteSourceSize.h/h)),t.textures[l]=new s.Texture(i.texture.baseTexture,u,p,d,n[l].rotated?2:0),s.utils.TextureCache[l]=t.textures[l]}o++}}t.textures={};var n=t.data.frames,a=Object.keys(n),h=s.utils.getResolutionOfUrl(t.url),l=0;a.length<=o?(r(0,o),e()):function t(){!function(t){r(l*o,o),l++,setTimeout(t,0)}((function(){l*o<a.length?t():e()}))}()}))}}},{"../core":97,path:60,"resource-loader":69}],186:[function(t,e,i){var r=t("../core");e.exports=function(){return function(t,e){if(t.data&&t.isImage){var i=new r.BaseTexture(t.data,null,r.utils.getResolutionOfUrl(t.url));i.imageUrl=t.url,t.texture=new r.Texture(i),r.utils.BaseTextureCache[t.url]=i,r.utils.TextureCache[t.url]=t.texture}e()}}},{"../core":97}],187:[function(t,e,i){function r(t,e,i,s,o){n.Container.call(this),this._texture=null,this.uvs=i||new Float32Array([0,0,1,0,1,1,0,1]),this.vertices=e||new Float32Array([0,0,100,0,100,100,0,100]),this.indices=s||new Uint16Array([0,1,3,2]),this.dirty=0,this.indexDirty=0,this.blendMode=n.BLEND_MODES.NORMAL,this.canvasPadding=0,this.drawMode=o||r.DRAW_MODES.TRIANGLE_MESH,this.texture=t,this.shader=null,this.tintRgb=new Float32Array([1,1,1]),this._glDatas=[]}var n=t("../core"),s=t("pixi-gl-core"),o=t("./webgl/MeshShader"),a=new n.Point,h=new n.Polygon;r.prototype=Object.create(n.Container.prototype),r.prototype.constructor=r,e.exports=r,Object.defineProperties(r.prototype,{texture:{get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture=t,t&&(t.baseTexture.hasLoaded?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}},tint:{get:function(){return n.utils.rgb2hex(this.tintRgb)},set:function(t){this.tintRgb=n.utils.hex2rgb(t,this.tintRgb)}}}),r.prototype._renderWebGL=function(t){t.flush();var e=t.gl,i=this._glDatas[t.CONTEXT_UID];i||((i={shader:new o(e),vertexBuffer:s.GLBuffer.createVertexBuffer(e,this.vertices,e.STREAM_DRAW),uvBuffer:s.GLBuffer.createVertexBuffer(e,this.uvs,e.STREAM_DRAW),indexBuffer:s.GLBuffer.createIndexBuffer(e,this.indices,e.STATIC_DRAW),vao:new s.VertexArrayObject(e),dirty:this.dirty,indexDirty:this.indexDirty}).vao=new s.VertexArrayObject(e).addIndex(i.indexBuffer).addAttribute(i.vertexBuffer,i.shader.attributes.aVertexPosition,e.FLOAT,!1,8,0).addAttribute(i.uvBuffer,i.shader.attributes.aTextureCoord,e.FLOAT,!1,8,0),this._glDatas[t.CONTEXT_UID]=i),this.dirty!==i.dirty&&(i.dirty=this.dirty,i.uvBuffer.upload()),this.indexDirty!==i.indexDirty&&(i.indexDirty=this.indexDirty,i.indexBuffer.upload()),i.vertexBuffer.upload(),t.bindShader(i.shader),t.bindTexture(this._texture,0),t.state.setBlendMode(this.blendMode),i.shader.uniforms.translationMatrix=this.worldTransform.toArray(!0),i.shader.uniforms.alpha=this.worldAlpha,i.shader.uniforms.tint=this.tintRgb;var n=this.drawMode===r.DRAW_MODES.TRIANGLE_MESH?e.TRIANGLE_STRIP:e.TRIANGLES;i.vao.bind().draw(n,this.indices.length).unbind()},r.prototype._renderCanvas=function(t){var e=t.context,i=this.worldTransform,n=t.resolution;t.roundPixels?e.setTransform(i.a*n,i.b*n,i.c*n,i.d*n,i.tx*n|0,i.ty*n|0):e.setTransform(i.a*n,i.b*n,i.c*n,i.d*n,i.tx*n,i.ty*n),this.drawMode===r.DRAW_MODES.TRIANGLE_MESH?this._renderCanvasTriangleMesh(e):this._renderCanvasTriangles(e)},r.prototype._renderCanvasTriangleMesh=function(t){for(var e=this.vertices,i=this.uvs,r=e.length/2,n=0;n<r-2;n++){var s=2*n;this._renderCanvasDrawTriangle(t,e,i,s,s+2,s+4)}},r.prototype._renderCanvasTriangles=function(t){for(var e=this.vertices,i=this.uvs,r=this.indices,n=r.length,s=0;s<n;s+=3){var o=2*r[s],a=2*r[s+1],h=2*r[s+2];this._renderCanvasDrawTriangle(t,e,i,o,a,h)}},r.prototype._renderCanvasDrawTriangle=function(t,e,i,r,n,s){var o=this._texture.baseTexture,a=o.source,h=o.width,l=o.height,c=e[r],u=e[n],d=e[s],p=e[r+1],f=e[n+1],g=e[s+1],v=i[r]*o.width,m=i[n]*o.width,y=i[s]*o.width,x=i[r+1]*o.height,_=i[n+1]*o.height,b=i[s+1]*o.height;if(this.canvasPadding>0){var T=this.canvasPadding/this.worldTransform.a,E=this.canvasPadding/this.worldTransform.d,w=(c+u+d)/3,A=(p+f+g)/3,C=c-w,S=p-A,O=Math.sqrt(C*C+S*S);c=w+C/O*(O+T),p=A+S/O*(O+E),S=f-A,u=w+(C=u-w)/(O=Math.sqrt(C*C+S*S))*(O+T),f=A+S/O*(O+E),S=g-A,d=w+(C=d-w)/(O=Math.sqrt(C*C+S*S))*(O+T),g=A+S/O*(O+E)}t.save(),t.beginPath(),t.moveTo(c,p),t.lineTo(u,f),t.lineTo(d,g),t.closePath(),t.clip();var D=v*_+x*y+m*b-_*y-x*m-v*b,M=c*_+x*d+u*b-_*d-x*u-c*b,R=v*u+c*y+m*d-u*y-c*m-v*d,P=v*_*d+x*u*y+c*m*b-c*_*y-x*m*d-v*u*b,I=p*_+x*g+f*b-_*g-x*f-p*b,N=v*f+p*y+m*g-f*y-p*m-v*g,L=v*_*g+x*f*y+p*m*b-p*_*y-x*m*g-v*f*b;t.transform(M/D,I/D,R/D,N/D,P/D,L/D),t.drawImage(a,0,0,h*o.resolution,l*o.resolution,0,0,h,l),t.restore()},r.prototype.renderMeshFlat=function(t){var e=this.context,i=t.vertices,r=i.length/2;e.beginPath();for(var n=1;n<r-2;n++){var s=2*n,o=i[s],a=i[s+2],h=i[s+4],l=i[s+1],c=i[s+3],u=i[s+5];e.moveTo(o,l),e.lineTo(a,c),e.lineTo(h,u)}e.fillStyle="#FF0000",e.fill(),e.closePath()},r.prototype._onTextureUpdate=function(){},r.prototype._calculateBounds=function(){this._bounds.addVertices(this.transform,this.vertices,0,this.vertices.length)},r.prototype.containsPoint=function(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,a);for(var e=this.vertices,i=h.points,n=this.indices,s=this.indices.length,o=this.drawMode===r.DRAW_MODES.TRIANGLES?3:1,l=0;l+2<s;l+=o){var c=2*n[l],u=2*n[l+1],d=2*n[l+2];if(i[0]=e[c],i[1]=e[c+1],i[2]=e[u],i[3]=e[u+1],i[4]=e[d],i[5]=e[d+1],h.contains(a.x,a.y))return!0}return!1},r.DRAW_MODES={TRIANGLE_MESH:0,TRIANGLES:1}},{"../core":97,"./webgl/MeshShader":192,"pixi-gl-core":7}],188:[function(t,e,i){function r(t,e,i,r,o){s.call(this,t,4,4);var a=this.uvs;a[6]=a[14]=a[22]=a[30]=1,a[25]=a[27]=a[29]=a[31]=1,this._origWidth=t.width,this._origHeight=t.height,this._uvw=1/this._origWidth,this._uvh=1/this._origHeight,this.width=t.width,this.height=t.height,a[2]=a[10]=a[18]=a[26]=this._uvw*e,a[4]=a[12]=a[20]=a[28]=1-this._uvw*r,a[9]=a[11]=a[13]=a[15]=this._uvh*i,a[17]=a[19]=a[21]=a[23]=1-this._uvh*o,this.leftWidth=void 0!==e?e:n,this.rightWidth=void 0!==r?r:n,this.topHeight=void 0!==i?i:n,this.bottomHeight=void 0!==o?o:n}var n=10,s=t("./Plane");r.prototype=Object.create(s.prototype),r.prototype.constructor=r,e.exports=r,Object.defineProperties(r.prototype,{width:{get:function(){return this._width},set:function(t){this._width=t,this.updateVerticalVertices()}},height:{get:function(){return this._height},set:function(t){this._height=t,this.updateHorizontalVertices()}},leftWidth:{get:function(){return this._leftWidth},set:function(t){this._leftWidth=t;var e=this.uvs,i=this.vertices;e[2]=e[10]=e[18]=e[26]=this._uvw*t,i[2]=i[10]=i[18]=i[26]=t,this.dirty=!0}},rightWidth:{get:function(){return this._rightWidth},set:function(t){this._rightWidth=t;var e=this.uvs,i=this.vertices;e[4]=e[12]=e[20]=e[28]=1-this._uvw*t,i[4]=i[12]=i[20]=i[28]=this._width-t,this.dirty=!0}},topHeight:{get:function(){return this._topHeight},set:function(t){this._topHeight=t;var e=this.uvs,i=this.vertices;e[9]=e[11]=e[13]=e[15]=this._uvh*t,i[9]=i[11]=i[13]=i[15]=t,this.dirty=!0}},bottomHeight:{get:function(){return this._bottomHeight},set:function(t){this._bottomHeight=t;var e=this.uvs,i=this.vertices;e[17]=e[19]=e[21]=e[23]=1-this._uvh*t,i[17]=i[19]=i[21]=i[23]=this._height-t,this.dirty=!0}}}),r.prototype.updateHorizontalVertices=function(){var t=this.vertices;t[9]=t[11]=t[13]=t[15]=this._topHeight,t[17]=t[19]=t[21]=t[23]=this._height-this._bottomHeight,t[25]=t[27]=t[29]=t[31]=this._height},r.prototype.updateVerticalVertices=function(){var t=this.vertices;t[2]=t[10]=t[18]=t[26]=this._leftWidth,t[4]=t[12]=t[20]=t[28]=this._width-this._rightWidth,t[6]=t[14]=t[22]=t[30]=this._width},r.prototype._renderCanvas=function(t){var e=t.context;e.globalAlpha=this.worldAlpha;var i=this.worldTransform,r=t.resolution;t.roundPixels?e.setTransform(i.a*r,i.b*r,i.c*r,i.d*r,i.tx*r|0,i.ty*r|0):e.setTransform(i.a*r,i.b*r,i.c*r,i.d*r,i.tx*r,i.ty*r);var n=this._texture.baseTexture,s=n.source,o=n.width,a=n.height;this.drawSegment(e,s,o,a,0,1,10,11),this.drawSegment(e,s,o,a,2,3,12,13),this.drawSegment(e,s,o,a,4,5,14,15),this.drawSegment(e,s,o,a,8,9,18,19),this.drawSegment(e,s,o,a,10,11,20,21),this.drawSegment(e,s,o,a,12,13,22,23),this.drawSegment(e,s,o,a,16,17,26,27),this.drawSegment(e,s,o,a,18,19,28,29),this.drawSegment(e,s,o,a,20,21,30,31)},r.prototype.drawSegment=function(t,e,i,r,n,s,o,a){var h=this.uvs,l=this.vertices,c=(h[o]-h[n])*i,u=(h[a]-h[s])*r,d=l[o]-l[n],p=l[a]-l[s];c<1&&(c=1),u<1&&(u=1),d<1&&(d=1),p<1&&(p=1),t.drawImage(e,h[n]*i,h[s]*r,c,u,l[n],l[s],d,p)}},{"./Plane":189}],189:[function(t,e,i){function r(t,e,i){n.call(this,t),this._ready=!0,this.verticesX=e||10,this.verticesY=i||10,this.drawMode=n.DRAW_MODES.TRIANGLES,this.refresh()}var n=t("./Mesh");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,e.exports=r,r.prototype.refresh=function(){var t=this.verticesX*this.verticesY,e=[],i=[],r=[],n=this.texture,s=this.verticesX-1,o=this.verticesY-1,a=0,h=n.width/s,l=n.height/o;for(a=0;a<t;a++){var c=a%this.verticesX,u=a/this.verticesX|0;e.push(c*h,u*l),i.push(n._uvs.x0+(n._uvs.x1-n._uvs.x0)*(c/(this.verticesX-1)),n._uvs.y0+(n._uvs.y3-n._uvs.y0)*(u/(this.verticesY-1)))}var d=s*o;for(a=0;a<d;a++){var p=a%s,f=a/s|0,g=f*this.verticesX+p,v=f*this.verticesX+p+1,m=(f+1)*this.verticesX+p,y=(f+1)*this.verticesX+p+1;r.push(g,v,m),r.push(v,y,m)}this.vertices=new Float32Array(e),this.uvs=new Float32Array(i),this.colors=new Float32Array([]),this.indices=new Uint16Array(r),this.indexDirty=!0},r.prototype._onTextureUpdate=function(){n.prototype._onTextureUpdate.call(this),this._ready&&this.refresh()}},{"./Mesh":187}],190:[function(t,e,i){function r(t,e){n.call(this,t),this.points=e,this.vertices=new Float32Array(4*e.length),this.uvs=new Float32Array(4*e.length),this.colors=new Float32Array(2*e.length),this.indices=new Uint16Array(2*e.length),this._ready=!0,this.refresh()}var n=t("./Mesh"),s=t("../core");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,e.exports=r,r.prototype.refresh=function(){var t=this.points;if(!(t.length<1)&&this._texture._uvs){var e=this.uvs,i=this.indices,r=this.colors,n=this._texture._uvs,o=new s.Point(n.x0,n.y0),a=new s.Point(n.x2-n.x0,n.y2-n.y0);e[0]=0+o.x,e[1]=0+o.y,e[2]=0+o.x,e[3]=1*a.y+o.y,r[0]=1,r[1]=1,i[0]=0,i[1]=1;for(var h,l,c=t.length,u=1;u<c;u++)t[u],l=u/(c-1),e[h=4*u]=l*a.x+o.x,e[h+1]=0+o.y,e[h+2]=l*a.x+o.x,e[h+3]=1*a.y+o.y,r[h=2*u]=1,r[h+1]=1,i[h=2*u]=h,i[h+1]=h+1;this.dirty=!0,this.indexDirty=!0}},r.prototype._onTextureUpdate=function(){n.prototype._onTextureUpdate.call(this),this._ready&&this.refresh()},r.prototype.updateTransform=function(){var t=this.points;if(!(t.length<1)){for(var e,i,r,n,s,o=t[0],a=0,h=0,l=this.vertices,c=t.length,u=0;u<c;u++)i=t[u],r=4*u,h=-((e=u<t.length-1?t[u+1]:i).x-o.x),a=e.y-o.y,10*(1-u/(c-1))>1&&1,a/=n=Math.sqrt(a*a+h*h),h/=n,a*=s=this._texture.height/2,h*=s,l[r]=i.x+a,l[r+1]=i.y+h,l[r+2]=i.x-a,l[r+3]=i.y-h,o=i;this.containerUpdateTransform()}}},{"../core":97,"./Mesh":187}],191:[function(t,e,i){e.exports={Mesh:t("./Mesh"),Plane:t("./Plane"),NineSlicePlane:t("./NineSlicePlane"),Rope:t("./Rope"),MeshShader:t("./webgl/MeshShader")}},{"./Mesh":187,"./NineSlicePlane":188,"./Plane":189,"./Rope":190,"./webgl/MeshShader":192}],192:[function(t,e,i){function r(t){n.call(this,t,["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform mat3 projectionMatrix;","varying vec2 vTextureCoord;","void main(void){","   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"].join("\n"),["varying vec2 vTextureCoord;","uniform float alpha;","uniform vec3 tint;","uniform sampler2D uSampler;","void main(void){","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vec4(tint * alpha, alpha);","}"].join("\n"))}var n=t("../../core/Shader");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,e.exports=r},{"../../core/Shader":77}],193:[function(t,e,i){function r(t,e,i){n.Container.call(this);(i=i||15e3)>16384&&(i=16384),i>(t=t||15e3)&&(i=t),this._properties=[!1,!0,!1,!1,!1],this._maxSize=t,this._batchSize=i,this._glBuffers=[],this._bufferToUpdate=0,this.interactiveChildren=!1,this.blendMode=n.BLEND_MODES.NORMAL,this.roundPixels=!0,this.baseTexture=null,this.setProperties(e)}var n=t("../core");r.prototype=Object.create(n.Container.prototype),r.prototype.constructor=r,e.exports=r,r.prototype.setProperties=function(t){t&&(this._properties[0]="scale"in t?!!t.scale:this._properties[0],this._properties[1]="position"in t?!!t.position:this._properties[1],this._properties[2]="rotation"in t?!!t.rotation:this._properties[2],this._properties[3]="uvs"in t?!!t.uvs:this._properties[3],this._properties[4]="alpha"in t?!!t.alpha:this._properties[4])},r.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},r.prototype.renderWebGL=function(t){this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable&&(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.hasLoaded||this.baseTexture.once("update",(function(){this.onChildrenChange(0)}),this)),t.setObjectRenderer(t.plugins.particle),t.plugins.particle.render(this))},r.prototype.onChildrenChange=function(t){var e=Math.floor(t/this._batchSize);e<this._bufferToUpdate&&(this._bufferToUpdate=e)},r.prototype.renderCanvas=function(t){if(this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable){var e=t.context,i=this.worldTransform,r=!0,n=0,s=0,o=0,a=0,h=t.blendModes[this.blendMode];h!==e.globalCompositeOperation&&(e.globalCompositeOperation=h),e.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();for(var l=0;l<this.children.length;++l){var c=this.children[l];if(c.visible){var u=c.texture.frame;if(e.globalAlpha=this.worldAlpha*c.alpha,c.rotation%(2*Math.PI)==0)r&&(e.setTransform(i.a,i.b,i.c,i.d,i.tx*t.resolution,i.ty*t.resolution),r=!1),n=c.anchor.x*(-u.width*c.scale.x)+c.position.x+.5,s=c.anchor.y*(-u.height*c.scale.y)+c.position.y+.5,o=u.width*c.scale.x,a=u.height*c.scale.y;else{r||(r=!0),c.displayObjectUpdateTransform();var d=c.worldTransform;t.roundPixels?e.setTransform(d.a,d.b,d.c,d.d,d.tx*t.resolution|0,d.ty*t.resolution|0):e.setTransform(d.a,d.b,d.c,d.d,d.tx*t.resolution,d.ty*t.resolution),n=c.anchor.x*-u.width+.5,s=c.anchor.y*-u.height+.5,o=u.width,a=u.height}var p=c.texture.baseTexture.resolution;e.drawImage(c.texture.baseTexture.source,u.x*p,u.y*p,u.width*p,u.height*p,n*p,s*p,o*p,a*p)}}}},r.prototype.destroy=function(){if(n.Container.prototype.destroy.apply(this,arguments),this._buffers)for(var t=0;t<this._buffers.length;++t)this._buffers[t].destroy();this._properties=null,this._buffers=null}},{"../core":97}],194:[function(t,e,i){e.exports={ParticleContainer:t("./ParticleContainer"),ParticleRenderer:t("./webgl/ParticleRenderer")}},{"./ParticleContainer":193,"./webgl/ParticleRenderer":196}],195:[function(t,e,i){function r(t,e,i,r){this.gl=t,this.vertSize=2,this.vertByteSize=4*this.vertSize,this.size=r,this.dynamicProperties=[],this.staticProperties=[];for(var n=0;n<e.length;n++){var s=e[n];s={attribute:s.attribute,size:s.size,uploadFunction:s.uploadFunction,offset:s.offset},i[n]?this.dynamicProperties.push(s):this.staticProperties.push(s)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.initBuffers()}var n=t("pixi-gl-core"),s=t("../../core/utils/createIndicesForQuads");r.prototype.constructor=r,e.exports=r,r.prototype.initBuffers=function(){var t,e,i=this.gl,r=0;for(this.indices=s(this.size),this.indexBuffer=n.GLBuffer.createIndexBuffer(i,this.indices,i.STATIC_DRAW),this.dynamicStride=0,t=0;t<this.dynamicProperties.length;t++)(e=this.dynamicProperties[t]).offset=r,r+=e.size,this.dynamicStride+=e.size;this.dynamicData=new Float32Array(this.size*this.dynamicStride*4),this.dynamicBuffer=n.GLBuffer.createVertexBuffer(i,this.dynamicData,i.STREAM_DRAW);var o=0;for(this.staticStride=0,t=0;t<this.staticProperties.length;t++)(e=this.staticProperties[t]).offset=o,o+=e.size,this.staticStride+=e.size;for(this.staticData=new Float32Array(this.size*this.staticStride*4),this.staticBuffer=n.GLBuffer.createVertexBuffer(i,this.staticData,i.STATIC_DRAW),this.vao=new n.VertexArrayObject(i).addIndex(this.indexBuffer),t=0;t<this.dynamicProperties.length;t++)e=this.dynamicProperties[t],this.vao.addAttribute(this.dynamicBuffer,e.attribute,i.FLOAT,!1,4*this.dynamicStride,4*e.offset);for(t=0;t<this.staticProperties.length;t++)e=this.staticProperties[t],this.vao.addAttribute(this.staticBuffer,e.attribute,i.FLOAT,!1,4*this.staticStride,4*e.offset)},r.prototype.uploadDynamic=function(t,e,i){for(var r=0;r<this.dynamicProperties.length;r++){var n=this.dynamicProperties[r];n.uploadFunction(t,e,i,this.dynamicData,this.dynamicStride,n.offset)}this.dynamicBuffer.upload()},r.prototype.uploadStatic=function(t,e,i){for(var r=0;r<this.staticProperties.length;r++){var n=this.staticProperties[r];n.uploadFunction(t,e,i,this.staticData,this.staticStride,n.offset)}this.staticBuffer.upload()},r.prototype.bind=function(){this.vao.bind()},r.prototype.destroy=function(){this.dynamicProperties=null,this.dynamicData=null,this.dynamicBuffer.destroy(),this.staticProperties=null,this.staticData=null,this.staticBuffer.destroy()}},{"../../core/utils/createIndicesForQuads":149,"pixi-gl-core":7}],196:[function(t,e,i){function r(t){n.ObjectRenderer.call(this,t),this.shader=null,this.indexBuffer=null,this.properties=null,this.tempMatrix=new n.Matrix,this.CONTEXT_UID=0}var n=t("../../core"),s=t("./ParticleShader"),o=t("./ParticleBuffer");r.prototype=Object.create(n.ObjectRenderer.prototype),r.prototype.constructor=r,e.exports=r,n.WebGLRenderer.registerPlugin("particle",r),r.prototype.onContextChange=function(){var t=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.shader=new s(t),this.properties=[{attribute:this.shader.attributes.aVertexPosition,size:2,uploadFunction:this.uploadVertices,offset:0},{attribute:this.shader.attributes.aPositionCoord,size:2,uploadFunction:this.uploadPosition,offset:0},{attribute:this.shader.attributes.aRotation,size:1,uploadFunction:this.uploadRotation,offset:0},{attribute:this.shader.attributes.aTextureCoord,size:2,uploadFunction:this.uploadUvs,offset:0},{attribute:this.shader.attributes.aColor,size:1,uploadFunction:this.uploadAlpha,offset:0}]},r.prototype.start=function(){this.renderer.bindShader(this.shader)},r.prototype.render=function(t){var e=t.children,i=e.length,r=t._maxSize,n=t._batchSize;if(0!==i){i>r&&(i=r);var s=t._glBuffers[this.renderer.CONTEXT_UID];s||(s=t._glBuffers[this.renderer.CONTEXT_UID]=this.generateBuffers(t)),this.renderer.setBlendMode(t.blendMode);var o=this.renderer.gl,a=t.worldTransform.copy(this.tempMatrix);a.prepend(this.renderer._activeRenderTarget.projectionMatrix),this.shader.uniforms.projectionMatrix=a.toArray(!0),this.shader.uniforms.uAlpha=t.worldAlpha;var h=e[0]._texture.baseTexture;this.renderer.bindTexture(h);for(var l=0,c=0;l<i;l+=n,c+=1){var u=i-l;u>n&&(u=n);var d=s[c];d.uploadDynamic(e,l,u),t._bufferToUpdate===c&&(d.uploadStatic(e,l,u),t._bufferToUpdate=c+1),d.vao.bind().draw(o.TRIANGLES,6*u).unbind()}}},r.prototype.generateBuffers=function(t){var e,i=this.renderer.gl,r=[],n=t._maxSize,s=t._batchSize,a=t._properties;for(e=0;e<n;e+=s)r.push(new o(i,this.properties,a,s));return r},r.prototype.uploadVertices=function(t,e,i,r,n,s){for(var o,a,h,l,c,u,d,p,f,g,v=0;v<i;v++)a=(o=t[e+v])._texture,c=o.scale.x,u=o.scale.y,h=a.trim,l=a.orig,h?(d=(p=h.x-o.anchor.x*l.width)+h.width,f=(g=h.y-o.anchor.y*l.height)+h.height):(d=l.width*(1-o.anchor.x),p=l.width*-o.anchor.x,f=l.height*(1-o.anchor.y),g=l.height*-o.anchor.y),r[s]=p*c,r[s+1]=g*u,r[s+n]=d*c,r[s+n+1]=g*u,r[s+2*n]=d*c,r[s+2*n+1]=f*u,r[s+3*n]=p*c,r[s+3*n+1]=f*u,s+=4*n},r.prototype.uploadPosition=function(t,e,i,r,n,s){for(var o=0;o<i;o++){var a=t[e+o].position;r[s]=a.x,r[s+1]=a.y,r[s+n]=a.x,r[s+n+1]=a.y,r[s+2*n]=a.x,r[s+2*n+1]=a.y,r[s+3*n]=a.x,r[s+3*n+1]=a.y,s+=4*n}},r.prototype.uploadRotation=function(t,e,i,r,n,s){for(var o=0;o<i;o++){var a=t[e+o].rotation;r[s]=a,r[s+n]=a,r[s+2*n]=a,r[s+3*n]=a,s+=4*n}},r.prototype.uploadUvs=function(t,e,i,r,n,s){for(var o=0;o<i;o++){var a=t[e+o]._texture._uvs;a?(r[s]=a.x0,r[s+1]=a.y0,r[s+n]=a.x1,r[s+n+1]=a.y1,r[s+2*n]=a.x2,r[s+2*n+1]=a.y2,r[s+3*n]=a.x3,r[s+3*n+1]=a.y3,s+=4*n):(r[s]=0,r[s+1]=0,r[s+n]=0,r[s+n+1]=0,r[s+2*n]=0,r[s+2*n+1]=0,r[s+3*n]=0,r[s+3*n+1]=0,s+=4*n)}},r.prototype.uploadAlpha=function(t,e,i,r,n,s){for(var o=0;o<i;o++){var a=t[e+o].alpha;r[s]=a,r[s+n]=a,r[s+2*n]=a,r[s+3*n]=a,s+=4*n}},r.prototype.destroy=function(){this.renderer.gl&&this.renderer.gl.deleteBuffer(this.indexBuffer),n.ObjectRenderer.prototype.destroy.apply(this,arguments),this.shader.destroy(),this.indices=null,this.tempMatrix=null}},{"../../core":97,"./ParticleBuffer":195,"./ParticleShader":197}],197:[function(t,e,i){function r(t){n.call(this,t,["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aColor;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","uniform mat3 projectionMatrix;","varying vec2 vTextureCoord;","varying float vColor;","void main(void){","   vec2 v = aVertexPosition;","   v.x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);","   v.y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);","   v = v + aPositionCoord;","   gl_Position = vec4((projectionMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"].join("\n"),["varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","uniform float uAlpha;","void main(void){","  vec4 color = texture2D(uSampler, vTextureCoord) * vColor * uAlpha;","  if (color.a == 0.0) discard;","  gl_FragColor = color;","}"].join("\n"))}var n=t("../../core/Shader");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,e.exports=r},{"../../core/Shader":77}],198:[function(t,e,i){Math.sign||(Math.sign=function(t){return 0===(t=+t)||isNaN(t)?t:t>0?1:-1})},{}],199:[function(t,e,i){Object.assign||(Object.assign=t("object-assign"))},{"object-assign":59}],200:[function(t,e,i){t("./Object.assign"),t("./requestAnimationFrame"),t("./Math.sign"),window.ArrayBuffer||(window.ArrayBuffer=Array),window.Float32Array||(window.Float32Array=Array),window.Uint32Array||(window.Uint32Array=Array),window.Uint16Array||(window.Uint16Array=Array)},{"./Math.sign":198,"./Object.assign":199,"./requestAnimationFrame":201}],201:[function(e,i,r){(function(t){if(Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),!t.performance||!t.performance.now){var e=Date.now();t.performance||(t.performance={}),t.performance.now=function(){return Date.now()-e}}for(var i=Date.now(),r=["ms","moz","webkit","o"],n=0;n<r.length&&!t.requestAnimationFrame;++n)t.requestAnimationFrame=t[r[n]+"RequestAnimationFrame"],t.cancelAnimationFrame=t[r[n]+"CancelAnimationFrame"]||t[r[n]+"CancelRequestAnimationFrame"];t.requestAnimationFrame||(t.requestAnimationFrame=function(t){if("function"!=typeof t)throw new TypeError(t+"is not a function");var e=Date.now(),r=16+i-e;return r<0&&(r=0),i=e,setTimeout((function(){i=Date.now(),t(performance.now())}),r)}),t.cancelAnimationFrame||(t.cancelAnimationFrame=function(t){clearTimeout(t)})}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],202:[function(t,e,i){function r(){}var n=t("../../core");r.prototype.constructor=r,e.exports=r,r.prototype.upload=function(t,e){"function"==typeof t&&(e=t,t=null),e()},r.prototype.register=function(){return this},r.prototype.add=function(){return this},r.prototype.destroy=function(){},n.CanvasRenderer.registerPlugin("prepare",r)},{"../../core":97}],203:[function(t,e,i){e.exports={webGL:t("./webgl/WebGLPrepare"),canvas:t("./canvas/CanvasPrepare")}},{"./canvas/CanvasPrepare":202,"./webgl/WebGLPrepare":204}],204:[function(t,e,i){function r(t){this.renderer=t,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.register(o,n).register(a,s)}function n(t,e){return e instanceof h.BaseTexture&&(t.textureManager.updateTexture(e),!0)}function s(t,e){return e instanceof h.Graphics&&(t.plugins.graphics.updateGraphics(e),!0)}function o(t,e){if(t instanceof h.BaseTexture)return-1===e.indexOf(t)&&e.push(t),!0;if(t._texture&&t._texture instanceof h.Texture){var i=t._texture.baseTexture;return-1===e.indexOf(i)&&e.push(i),!0}return!1}function a(t,e){return t instanceof h.Graphics&&(e.push(t),!0)}var h=t("../../core"),l=h.ticker.shared;r.UPLOADS_PER_FRAME=4,r.prototype.constructor=r,e.exports=r,r.prototype.upload=function(t,e){"function"==typeof t&&(e=t,t=null),t&&this.add(t),this.queue.length?(this.numLeft=r.UPLOADS_PER_FRAME,this.completes.push(e),this.ticking||(this.ticking=!0,l.add(this.tick,this))):e()},r.prototype.tick=function(){for(var t,e;this.queue.length&&this.numLeft>0;){var i=this.queue[0],n=!1;for(t=0,e=this.uploadHooks.length;t<e;t++)if(this.uploadHooks[t](this.renderer,i)){this.numLeft--,this.queue.shift(),n=!0;break}n||this.queue.shift()}if(this.queue.length)this.numLeft=r.UPLOADS_PER_FRAME;else{this.ticking=!1,l.remove(this.tick,this);var s=this.completes.slice(0);for(this.completes.length=0,t=0,e=s.length;t<e;t++)s[t]()}},r.prototype.register=function(t,e){return t&&this.addHooks.push(t),e&&this.uploadHooks.push(e),this},r.prototype.add=function(t){var e,i;for(e=0,i=this.addHooks.length;e<i&&!this.addHooks[e](t,this.queue);e++);if(t instanceof h.Container)for(e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this},r.prototype.destroy=function(){this.ticking&&l.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null},h.WebGLRenderer.registerPlugin("prepare",r)},{"../../core":97}],205:[function(e,i,r){(function(t){e("./polyfill");var r=i.exports=e("./core");r.extras=e("./extras"),r.filters=e("./filters"),r.interaction=e("./interaction"),r.loaders=e("./loaders"),r.mesh=e("./mesh"),r.particles=e("./particles"),r.accessibility=e("./accessibility"),r.extract=e("./extract"),r.prepare=e("./prepare"),r.loader=new r.loaders.Loader,Object.assign(r,e("./deprecation")),t.PIXI=r}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./accessibility":76,"./core":97,"./deprecation":154,"./extract":156,"./extras":164,"./filters":175,"./interaction":180,"./loaders":183,"./mesh":191,"./particles":194,"./polyfill":200,"./prepare":203}]},{},[205])(205)}));class X{static ASCII_SPACE=32;static ASCII_FULL=219;static CANVAS_ID="__yendor_canvas";static CANVAS_SELECTOR="#"+X.CANVAS_ID;constructor(t,e,i,r,n){this.fontUrl=r,this.rendererName=n,this.divSelector=i,this.loadComplete=!1,this.defaultBackgroundColor=S.toNumber(e),this.defaultForegroundColor=S.toNumber(t),this.stage=new q.Container}init(t){this.loadFont(this.fontUrl,this.rendererName,t)}render(t){if(this.loadComplete){for(let e=0;e<t.width;e++)for(let i=0;i<t.height;i++){let r=t.text[e][i];r>=0&&r<=255&&(this.foreCells[e][i].texture=this.chars[r]),this.foreCells[e][i].tint=S.toNumber(t.fore[e][i]),this.backCells[e][i].tint=S.toNumber(t.back[e][i])}this.renderer.render(this.stage)}}getPositionFromPixels(t,e,i){let r=i||new O;if(this.loadComplete){let i=t-this.topLeftPos.x,n=e-this.topLeftPos.y;r.x=Math.floor(i/this.charWidth),r.y=Math.floor(n/this.charHeight)}else r.x=-1,r.y=-1;return r}getPixelPositionFromCell(t,e,i){let r=i||new O;return this.loadComplete?(r.x=t*this.charWidth+this.topLeftPos.x,r.y=e*this.charHeight+this.topLeftPos.y):(r.x=-1,r.y=-1),r}loadFont(t,e,i){this.font=q.BaseTexture.fromImage(t,!1,q.SCALE_MODES.NEAREST),this.font.hasLoaded?this.onFontLoaded(e,i):(this.font.on("loaded",(()=>this.onFontLoaded(e,i))),this.font.on("error",(()=>this.onFontError(t))))}onFontError(t){console.log("FATAL: error while loading font "+t)}onFontLoaded(t,e){this.charWidth=this.font.width/16,this.charHeight=this.font.height/16,this.initCanvas(t,e),this.initCharacterMap(),this.initBackgroundCells(e),this.initForegroundCells(e),this.loadComplete=!0}initCanvas(t,e){let i=n(this.divSelector)[0],r=e.width*this.charWidth,s=e.height*this.charHeight;i.innerHTML="<canvas id='"+X.CANVAS_ID+"' width='"+r+"' height='"+s+"'></canvas>",this.canvas=n(X.CANVAS_SELECTOR)[0],this.topLeftPos=new O(n(X.CANVAS_SELECTOR).offset().left,n(X.CANVAS_SELECTOR).offset().top);let o={antialias:!1,clearBeforeRender:!1,preserveDrawingBuffer:!1,resolution:1,transparent:!1,view:this.canvas};this.renderer="pixi/webgl"===t?new q.WebGLRenderer(r,s,o):"pixi/canvas"===t?new q.CanvasRenderer(r,s,o):q.autoDetectRenderer(r,s,o),this.renderer.backgroundColor=this.defaultBackgroundColor}initCharacterMap(){this.chars=[];for(let t=0;t<16;t++)for(let e=0;e<16;e++){let i=new q.Rectangle(t*this.charWidth,e*this.charHeight,this.charWidth,this.charHeight);this.chars[t+16*e]=new q.Texture(this.font,i)}}initBackgroundCells(t){this.backCells=[];for(let e=0;e<t.width;e++){this.backCells[e]=[];for(let i=0;i<t.height;i++){let t=new q.Sprite(this.chars[X.ASCII_FULL]);t.position.x=e*this.charWidth,t.position.y=i*this.charHeight,t.width=this.charWidth,t.height=this.charHeight,t.tint=this.defaultBackgroundColor,this.backCells[e][i]=t,this.stage.addChild(t)}}}initForegroundCells(t){this.foreCells=[];for(let e=0;e<t.width;e++){this.foreCells[e]=[];for(let i=0;i<t.height;i++){let t=new q.Sprite(this.chars[X.ASCII_SPACE]);t.position.x=e*this.charWidth,t.position.y=i*this.charHeight,t.width=this.charWidth,t.height=this.charHeight,t.tint=this.defaultForegroundColor,this.foreCells[e][i]=t,this.stage.addChild(t)}}}}class Y{constructor(t){this.divSelector=t,this.div=n(t)[0],this.div.style.fontFamily="monospace",this.div.style.whiteSpace="pre",this.div.style.display="table"}init(t){this.computeCharSize(t)}render(t){this.div.innerHTML=this.getHTML(t)}getPositionFromPixels(t,e,i){let r=i||new O,s=n(this.divSelector).offset(),o=t-s.left,a=e-s.top;return r.x=Math.floor(o/this.charWidth),r.y=Math.floor(a/this.charHeight),r}getPixelPositionFromCell(t,e,i){let r=i||new O,s=n(this.divSelector).offset();return r.x=t*this.charWidth+s.left,r.y=e*this.charHeight+s.top,r}getHTML(t){let e="";for(let i=0;i<t.height;i++)e+="<div class='line'>"+this.getLineHTML(i,t)+"</div>";return e}computeCharSize(t){t.text[0][0]="@".charCodeAt(0),t.fore[0][0]=0,t.render();let e=this.div.id;this.div.id="__yendor_div";let i=n("#__yendor_div div.line span");this.charWidth=i.width(),this.charHeight=i.height(),console.log("Char size : "+this.charWidth+" x "+this.charHeight),this.div.id=e,t.text[0][0]=0,t.fore[0][0]=t.fore[0][1],t.render()}getChar(t,e,i){let r=i.text[t][e];return 0===r?" ":String.fromCharCode(r)}getLineHTML(t,e){let i=S.toWeb(e.fore[0][t]),r=S.toWeb(e.back[0][t]),n="<span style='color:"+i+";background-color:"+r+"'>"+this.getChar(0,t,e);for(let s=1;s<e.width;s++){let o=S.toWeb(e.fore[s][t]),a=S.toWeb(e.back[s][t]);o===i&&a===r||(i=o,r=a,n+="</span><span style='color:"+i+";background-color:"+r+"'>"),n+=this.getChar(s,t,e)}return n+="</span>",n}}let Q;var Z;(Z=Q||(Q={}))[Z.CONTINUE=0]="CONTINUE",Z[Z.STOP=1]="STOP";class $ extends D{splitPos=0;horiz=!0;level=0;constructor(t,e,i,r,n,s){super(t,e,i,r),this.level=n||0,this.parent=s}isLeaf(){return!this.leftChild}findNode(t,e){if(this.contains(t,e))return this.leftChild&&this.leftChild.contains(t,e)?this.leftChild.findNode(t,e):this.rightChild&&this.rightChild.contains(t,e)?this.rightChild.findNode(t,e):this}clear(){this.leftChild=void 0,this.rightChild=void 0,this.splitPos=0,this.horiz=!0}split(t,e){this.horiz=t,this.splitPos=e,t?(this.leftChild=new $(this.x,this.y,this.splitPos,this.h,this.level+1,this),this.rightChild=new $(this.x+this.splitPos,this.y,this.w-this.splitPos,this.h,this.level+1,this)):(this.leftChild=new $(this.x,this.y,this.w,this.splitPos,this.level+1,this),this.rightChild=new $(this.x,this.y+this.splitPos,this.w,this.h-this.splitPos,this.level+1,this))}splitRecursive(t,e,i,r){t||(t=B.default);let n=!1;if(i){if(this.w<2*i||this.h<2*i)return;this.w<2*i?n=!1:this.h<2*i&&(n=!0)}else i=0;n||(n=0!==t.getNumber(0,1));let s=n?t.getNumber(i,this.w-i):t.getNumber(i,this.h-i);this.split(n,s),e>1&&this.leftChild&&this.rightChild&&(this.leftChild.splitRecursive(t,e-1,i,r),this.rightChild.splitRecursive(t,e-1,i,r))}traversePreOrder(t,e){if(t(this,e)===Q.STOP)return Q.STOP;if(this.leftChild){if(this.leftChild.traversePreOrder(t,e)===Q.STOP)return Q.STOP;if(this.rightChild&&this.rightChild.traversePreOrder(t,e)===Q.STOP)return Q.STOP}return Q.CONTINUE}traverseInOrder(t,e){return this.leftChild&&this.leftChild.traverseInOrder(t,e)===Q.STOP||t(this,e)===Q.STOP?Q.STOP:this.rightChild?this.rightChild.traverseInOrder(t,e):Q.CONTINUE}traversePostOrder(t,e){if(this.leftChild){if(this.leftChild.traversePostOrder(t,e)===Q.STOP)return Q.STOP;if(this.rightChild&&this.rightChild.traversePostOrder(t,e)===Q.STOP)return Q.STOP}return t(this,e)}traverseLevelOrder(t,e){for(let i of this.buildLevelTraversalNodeArray())if(t(i,e)===Q.STOP)return Q.STOP;return Q.CONTINUE}traverseInvertedLevelOrder(t,e){let i=this.buildLevelTraversalNodeArray();for(let r=i.length-1;r>=0;r--){if(t(i[r],e)===Q.STOP)return Q.STOP}return Q.CONTINUE}buildLevelTraversalNodeArray(){let t=[],e=[];for(e.push(this);e.length>0;){let i=e.shift();i&&(t.push(i),i.leftChild&&(e.push(i.leftChild),i.rightChild&&e.push(i.rightChild)))}return t}}class J{constructor(t,e){this._width=t,this._height=e,this._transparent=[];for(let e=0;e<t;e++)this._transparent[e]=[];this.startAngle=[],this.endAngle=[]}get width(){return this._width}get height(){return this._height}isTransparent(t,e){return!!this._transparent[t]&&this._transparent[t][e]}setTransparent(t,e,i){this._transparent[t]&&(this._transparent[t][e]=i)}computeFov(t,e,i,r,n=!0){this.clearFov(t),t[e][i]=!0,this.computeQuadrantVertical(t,e,i,r,n,1,1),this.computeQuadrantHorizontal(t,e,i,r,n,1,1),this.computeQuadrantVertical(t,e,i,r,n,1,-1),this.computeQuadrantHorizontal(t,e,i,r,n,1,-1),this.computeQuadrantVertical(t,e,i,r,n,-1,1),this.computeQuadrantHorizontal(t,e,i,r,n,-1,1),this.computeQuadrantVertical(t,e,i,r,n,-1,-1),this.computeQuadrantHorizontal(t,e,i,r,n,-1,-1)}clearFov(t){for(let e=0;e<this.width;e++)for(let i=0;i<this.height;i++)t[e][i]=!1}computeQuadrantVertical(t,e,i,r,n,s,o){let a=i+o,h=!1,l=1,c=0,u=0,d=0;for(;!h&&a>=0&&a<this.height;){let i=1/l,p=.5*i,f=Math.floor((c+p)/i),g=Math.max(0,e-l),v=Math.min(this.width-1,e+l);h=!0;for(let r=e+f*s;r>=g&&r<=v;r+=s){let e=f*i,g=e-p,v=e+p,m=!0,y=!1;if(u>0&&!t[r][a]){let i=0;if(m&&!this.canSee(t,r,a-o)&&r-s>=0&&r-s<this.width&&!this.canSee(t,r-s,a-o))m=!1;else for(;m&&i<u;)this.startAngle[i]>v||this.endAngle[i]<g||(this.isTransparent(r,a)?e>this.startAngle[i]&&e<this.endAngle[i]&&(m=!1):g>=this.startAngle[i]&&v<=this.endAngle[i]?m=!1:(this.startAngle[i]=Math.min(this.startAngle[i],g),this.endAngle[i]=Math.max(this.endAngle[i],v),y=!0)),++i}m&&(t[r][a]=!0,h=!1,this.isTransparent(r,a)||(c>=g?(c=v,f===l&&(h=!0)):y||(this.startAngle[d]=g,this.endAngle[d]=v,d++),n||(t[r][a]=!1))),f++}l===r&&(h=!0),l++,u=d,a+=o,(a<0||a>=this.height)&&(h=!0)}}computeQuadrantHorizontal(t,e,i,r,n,s,o){let a=e+s,h=!1,l=1,c=0,u=0,d=0;for(;!h&&a>=0&&a<this.width;){let e=1/l,p=.5*e,f=Math.floor((c+p)/e),g=Math.max(0,i-l),v=Math.min(this.height-1,i+l);h=!0;for(let r=i+f*o;r>=g&&r<=v;r+=o){let i=f*e,g=i-p,v=i+p,m=!0,y=!1;if(u>0&&!t[a][r]){let e=0;if(m&&!this.canSee(t,a-s,r)&&r-o>=0&&r-o<this.height&&!this.canSee(t,a-s,r-o))m=!1;else for(;m&&e<u;)this.startAngle[e]>v||this.endAngle[e]<g||(this.isTransparent(a,r)?i>this.startAngle[e]&&i<this.endAngle[e]&&(m=!1):g>=this.startAngle[e]&&v<=this.endAngle[e]?m=!1:(this.startAngle[e]=Math.min(this.startAngle[e],g),this.endAngle[e]=Math.max(this.endAngle[e],v),y=!0)),++e}m&&(t[a][r]=!0,h=!1,this.isTransparent(a,r)||(c>=g?(c=v,f===l&&(h=!0)):y||(this.startAngle[d]=g,this.endAngle[d]=v,d++),n||(t[a][r]=!1))),f++}l===r&&(h=!0),l++,u=d,a+=s,(a<0||a>=this.width)&&(h=!0)}}canSee(t,e,i){return t[e][i]&&this.isTransparent(e,i)}}class tt{content=[];constructor(t){this.scoreFunction=t}push(t){this.content.push(t),this.bubbleUp(this.content.length-1)}pushAll(t){for(let e of t)this.push(e)}peek(t=0){return this.content.length>t?this.content[t]:void 0}clear(){this.content=[]}pop(){let t;if(this.content.length>0){t=this.content[0];let e=this.content.pop();this.content.length>0&&(this.content[0]=e,this.sinkDown(0))}return t}contains(t){for(let e of this.content)if(t.equals(e))return!0;return!1}remove(t){let e=this.content.indexOf(t);if(-1===e)return!1;let i=this.content.pop();return e!==this.content.length&&(this.content[e]=i,this.scoreFunction(i)<this.scoreFunction(t)?this.bubbleUp(e):this.sinkDown(e)),!0}size(){return this.content.length}isEmpty(){return 0===this.content.length}bubbleUp(t){let e=this.content[t];for(;t>0;){let i=Math.floor((t+1)/2)-1,r=this.content[i];if(!(this.scoreFunction(e)<=this.scoreFunction(r)))break;this.content[i]=e,this.content[t]=r,t=i}}sinkDown(t){let e=this.content.length,i=this.content[t],r=this.scoreFunction(i);for(;;){let n,s=2*(t+1),o=s-1,a=0;if(o<e){let t=this.content[o];a=this.scoreFunction(t),a<r&&(n=o)}if(s<e){let t=this.content[s];this.scoreFunction(t)<(void 0===n?r:a)&&(n=s)}if(void 0===n)break;this.content[t]=this.content[n],this.content[n]=i,t=n}}}class et{constructor(t,e,i,r,n=!0){this.walkCostFunction=i||function(t,e){return 1},this.heuristicFunction=r||(n?O.distance:O.taxiDistance),this.mapWidth=t,this.mapHeight=e,this.allowDiagonals=n}getPath(t,e){let i=[],r={},n={},s={},o=this,a=new tt((function(t){return s[o.pos2Offset(t)]})),h=this.pos2Offset(t);n[h]=0,s[h]=n[h]+this.heuristicFunction(t,e),this.maxSteps=10*s[h],a.push(new O(t.x,t.y));let l=this.maxSteps;for(;a.size()>0&&l>0;){l--;let t=a.pop();if(t.x===e.x&&t.y===e.y)return this.reconstructPath(r,t);i.push(t);let o=this.pos2Offset(t),h=t.getAdjacentCells(this.mapWidth,this.mapHeight,this.allowDiagonals);for(let l of h)if(!this.arrayContains(i,l)){let i=this.pos2Offset(l),h=this.walkCostFunction(t,l);if(h>0){let c=n[o]+h,u=a.contains(l);(!u||c<n[i])&&(r[i]=t,n[i]=c,s[i]=c+this.heuristicFunction(l,e),u||a.push(l))}}}0===l&&console.log("Could not find path from "+t.x+","+t.y+" to "+e.x+","+e.y+": max steps reached")}pos2Offset(t){return t.x+t.y*this.mapWidth}arrayContains(t,e){for(let i of t)if(i.equals(e))return!0;return!1}reconstructPath(t,e){let i=[e],r=this.pos2Offset(e);for(;t[r];)e=t[r],r=this.pos2Offset(e),t[r]&&i.push(e);return i}}class it extends class{fbm1D(t,e,i,r=2,n=.5){let s=this.get1D(t,e),o=1,a=1;for(let h=1;h<i;h++)e*=r,o*=n,a+=o,s+=this.get1D(t,e)*o;return s/a}fbm2D(t,e,i,r,n=2,s=.5){let o=this.get2D(t,e,i),a=1,h=1;for(let l=1;l<r;l++)i*=n,a*=s,h+=a,o+=this.get2D(t,e,i)*a;return o/h}fbm3D(t,e,i,r,n,s=2,o=.5){let a=this.get3D(t,e,i,r),h=1,l=1;for(let c=1;c<n;c++)r*=s,h*=o,l+=h,a+=this.get3D(t,e,i,r)*h;return a/l}}{static HASH_MASK=255;static GRADIENTS_1D=[1,-1];static GRADIENTS_1D_MASK=1;static INVERSE_MAX_FALLOF_1D=64/27;static GRADIENTS_2D=[[1,0],[-1,0],[0,1],[0,-1]];static GRADIENTS_2D_MASK=3;static SQUARE_TO_TRIANGLE=(3-Math.sqrt(3))/6;static TRIANGLE_TO_SQUARE=(Math.sqrt(3)-1)/2;static INVERSE_MAX_FALLOF_2D=2916*Math.sqrt(2)/125;static GRADIENTS_3D=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1],[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1],[1,1,1],[-1,1,1],[1,-1,1],[-1,-1,1],[1,1,-1],[-1,1,-1],[1,-1,-1],[-1,-1,-1]];static GRADIENTS_3D_MASK=31;static normalizedGradient3d=!1;static INVERSE_MAX_FALLOF_3D=8192*Math.sqrt(3)/375;static normalizeGradient3d(){it.normalizedGradient3d=!0;for(let t=0;t<=it.GRADIENTS_3D_MASK;++t){let e=it.GRADIENTS_3D[t][0],i=it.GRADIENTS_3D[t][1],r=it.GRADIENTS_3D[t][2],n=1/Math.sqrt(e*e+i*i+r*r);it.GRADIENTS_3D[t][0]*=n,it.GRADIENTS_3D[t][1]*=n,it.GRADIENTS_3D[t][2]*=n}}constructor(t){super(),it.normalizedGradient3d||it.normalizeGradient3d(),this.hash=this.computeHash(t)}get1D(t,e){t*=e;let i=Math.floor(t),r=this.grad1d(t,i);return r+=this.grad1d(t,i+1),r*it.INVERSE_MAX_FALLOF_1D}get2D(t,e,i){let r=((t*=i)+(e*=i))*it.TRIANGLE_TO_SQUARE,n=t+r,s=e+r,o=Math.floor(n),a=Math.floor(s),h=this.grad2d(t,e,o,a);return h+=this.grad2d(t,e,o+1,a+1),h+=n-o>=s-a?this.grad2d(t,e,o+1,a):this.grad2d(t,e,o,a+1),h*it.INVERSE_MAX_FALLOF_2D}get3D(t,e,i,r){let n=((t*=r)+(e*=r)+(i*=r))*(1/3),s=t+n,o=e+n,a=i+n,h=Math.floor(s),l=Math.floor(o),c=Math.floor(a),u=this.grad3d(t,e,i,h,l,c);u+=this.grad3d(t,e,i,h+1,l+1,c+1);let d=s-h,p=o-l,f=a-c;return d>=p?d>=f?(u+=this.grad3d(t,e,i,h+1,l,c),u+=p>=f?this.grad3d(t,e,i,h+1,l+1,c):this.grad3d(t,e,i,h+1,l,c+1)):(u+=this.grad3d(t,e,i,h,l,c+1),u+=this.grad3d(t,e,i,h+1,l,c+1)):p>=f?(u+=this.grad3d(t,e,i,h,l+1,c),u+=d>=f?this.grad3d(t,e,i,h+1,l+1,c):this.grad3d(t,e,i,h,l+1,c+1)):(u+=this.grad3d(t,e,i,h,l,c+1),u+=this.grad3d(t,e,i,h,l+1,c+1)),u*it.INVERSE_MAX_FALLOF_3D}computeHash(t){let e,i=[];for(e=0;e<=it.HASH_MASK;++e)i[e]=e;for(;--e;){let r=Math.floor(t.getNumber(0,it.HASH_MASK)),n=i[e];i[e]=i[r],i[r]=n}return i}grad1d(t,e){let i=t-e,r=1-i*i;r*=r*r;let n=this.hash[e&it.HASH_MASK];return r*(it.GRADIENTS_1D[n&it.GRADIENTS_1D_MASK]*i)}grad2d(t,e,i,r){let n=(i+r)*it.SQUARE_TO_TRIANGLE,s=t-i+n,o=e-r+n,a=.5-s*s-o*o;if(a>0){a*=a*a;let t=this.hash[this.hash[i&it.HASH_MASK]+r&it.HASH_MASK],e=it.GRADIENTS_2D[t&it.GRADIENTS_2D_MASK];return a*(e[0]*s+e[1]*o)}return 0}grad3d(t,e,i,r,n,s){let o=(r+n+s)*(1/6),a=t-r+o,h=e-n+o,l=i-s+o,c=.5-a*a-h*h-l*l;if(c>0){c*=c*c;let t=this.hash[this.hash[this.hash[r&it.HASH_MASK]+n&it.HASH_MASK]+s&it.HASH_MASK],e=it.GRADIENTS_3D[t&it.GRADIENTS_3D_MASK];return c*(e[0]*a+e[1]*h+e[2]*l)}return 0}}class rt{paused=!1;currentTime=0;constructor(){this.entities=new tt((t=>t.getNextActionTime()))}add(t){this.entities.contains(t)||(this.entities.push(t),t.getNextActionTime()<this.currentTime&&t.wait(this.currentTime-t.getNextActionTime()))}addAll(t){this.entities.pushAll(t)}contains(t){return this.entities.contains(t)}remove(t){t===this.currentEntity?this.currentEntity=void 0:this.entities.remove(t)}clear(){this.entities.clear()}pause(){this.paused=!0}resume(){this.paused=!1}isPaused(){return this.paused}run(){if(this.paused||this.entities.isEmpty())return;let t=this.entities.peek();if(!t)return;this.currentTime=t.getNextActionTime();let e,i=[];for(;!this.entities.isEmpty()&&t&&t.getNextActionTime()<=this.currentTime;){this.currentEntity=this.entities.pop();let r=this.currentEntity.getNextActionTime();this.currentEntity.update(),this.paused&&void 0===e?e=this.currentEntity:void 0!==this.currentEntity&&(this.paused||this.currentEntity.getNextActionTime()!==r||(console.log("WARNING : scheduler : entity didn't wait after update"),this.currentEntity.wait(1)),i.push(this.currentEntity)),this.currentEntity=void 0,t=this.entities.peek()}this.entities.pushAll(i),e&&this.entities.push(e)}}class nt{static registerClass(t){nt.classes[t.name]=t}static getClass(t){return nt.classes[t]}static classes={}}class st{static json2Object(t,e){if(!t)return;let i=JSON.parse(t);return i?st.loadFromData(i,e):void 0}static object2Json(t){if("string"==typeof t)return t;st.needsClassName(t)&&(t.className=t.constructor.name);try{let e=JSON.stringify(t,st.jsonReplacer);return console.log({json:JSON.parse(e)}),e}catch(e){return void console.log("Error while serializing "+t.className+" to JSON:"+e)}}static loadFromData(t,e){if(null!=t)return t instanceof Array?st.loadArrayFromData(t,e):"object"==typeof t?st.loadObjectFromData(t,e):t}static needsClassName(t){return t&&"object"==typeof t&&"Array"!==t.constructor.name}static jsonReplacer(t,e){if(0!==t.indexOf("__"))return st.needsClassName(e)&&(e.className=e.constructor.name),e}static loadArrayFromData(t,e){let i=e&&n.isArray(e)?e:[];for(let e=0,r=t.length;e<r;++e)i[e]=this.loadFromData(t[e]);return i}static loadObjectFromData(t,e){if(!e)if(t.className&&"Object"!==t.className){let i=nt.getClass(t.className);if(!i)return void console.log("Error reading from persistence : unknown class "+t.className);e=new i}else e={};if(e.load)e.load(t);else for(let i in t)if(t.hasOwnProperty(i))try{e[i]=this.loadFromData(t[i])}catch(r){console.log("ERROR loading field "+i+" with value "+t[i]+" on object "+e.constructor.name+" : "+r)}return e.postLoad&&e.postLoad(),e}}var ot={};!function(t,e){"object"==typeof ot?ot=e():t.Dexie=e()}(ot,(function(){var e="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function i(t,i){e=t,r=i}var r=function(){return!0},n=!new Error("").stack;function s(){if(n)try{throw s.arguments,new Error}catch(t){return t}return new Error}function o(t,e){var i=t.stack;return i?(e=e||0,0===i.indexOf(t.name)&&(e+=(t.name+t.message).split("\n").length),i.split("\n").slice(e).filter(r).map((function(t){return"\n"+t})).join("")):""}function a(){}function h(t){return t}function l(t,e){return null==t||t===h?e:function(i){return e(t(i))}}function c(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function u(t,e){return t===a?e:function(){var i=t.apply(this,arguments);void 0!==i&&(arguments[0]=i);var r=this.onsuccess,n=this.onerror;this.onsuccess=null,this.onerror=null;var s=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?c(r,this.onsuccess):r),n&&(this.onerror=this.onerror?c(n,this.onerror):n),void 0!==s?s:i}}function d(t,e){return t===a?e:function(){t.apply(this,arguments);var i=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),i&&(this.onsuccess=this.onsuccess?c(i,this.onsuccess):i),r&&(this.onerror=this.onerror?c(r,this.onerror):r)}}function p(t,e){return t===a?e:function(i){var r=t.apply(this,arguments);x(i,r);var n=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return n&&(this.onsuccess=this.onsuccess?c(n,this.onsuccess):n),s&&(this.onerror=this.onerror?c(s,this.onerror):s),void 0===r?void 0===o?void 0:o:x(r,o)}}function f(t,e){return t===a?e:function(){return!1!==e.apply(this,arguments)&&t.apply(this,arguments)}}function g(t,e){return t===a?e:function(){var i=t.apply(this,arguments);if(i&&"function"==typeof i.then){for(var r=this,n=arguments.length,s=new Array(n);n--;)s[n]=arguments[n];return i.then((function(){return e.apply(r,s)}))}return e.apply(this,arguments)}}var v=Object.keys,m=Array.isArray,y="undefined"!=typeof self?self:"undefined"!=typeof window?window:t;function x(t,e){return"object"!=typeof e||v(e).forEach((function(i){t[i]=e[i]})),t}var _=Object.getPrototypeOf,b={}.hasOwnProperty;function T(t,e){return b.call(t,e)}function E(t,e){"function"==typeof e&&(e=e(_(t))),v(e).forEach((function(i){w(t,i,e[i])}))}function w(t,e,i,r){Object.defineProperty(t,e,x(i&&T(i,"get")&&"function"==typeof i.get?{get:i.get,set:i.set,configurable:!0}:{value:i,configurable:!0,writable:!0},r))}function A(t){return{from:function(e){return t.prototype=Object.create(e.prototype),w(t.prototype,"constructor",t),{extend:E.bind(null,t.prototype)}}}}var C=Object.getOwnPropertyDescriptor;function S(t,e){var i;return C(t,e)||(i=_(t))&&S(i,e)}var O=[].slice;function D(t,e,i){return O.call(t,e,i)}function M(t,e){return e(t)}function R(t){var e=setTimeout(t,1e3);clearTimeout(e)}function P(t){if(!t)throw new rt.Internal("Assertion failed")}function I(t){y.setImmediate?setImmediate(t):setTimeout(t,0)}function N(t,e){return t.reduce((function(t,i,r){var n=e(i,r);return n&&(t[n[0]]=n[1]),t}),{})}function L(t,e){return function(){try{t.apply(this,arguments)}catch(t){e(t)}}}function k(t,e,i){try{t.apply(null,i)}catch(t){e&&e(t)}}function F(t,e){var i=bt.reject(t);return e?i.uncaught(e):i}function B(t,e){if(T(t,e))return t[e];if(!e)return t;if("string"!=typeof e){for(var i=[],r=0,n=e.length;r<n;++r){var s=B(t,e[r]);i.push(s)}return i}var o=e.indexOf(".");if(-1!==o){var a=t[e.substr(0,o)];return void 0===a?void 0:B(a,e.substr(o+1))}}function U(t,e,i){if(t&&void 0!==e&&(!("isFrozen"in Object)||!Object.isFrozen(t)))if("string"!=typeof e&&"length"in e){P("string"!=typeof i&&"length"in i);for(var r=0,n=e.length;r<n;++r)U(t,e[r],i[r])}else{var s=e.indexOf(".");if(-1!==s){var o=e.substr(0,s),a=e.substr(s+1);if(""===a)void 0===i?delete t[o]:t[o]=i;else{var h=t[o];h||(h=t[o]={}),U(h,a,i)}}else void 0===i?delete t[e]:t[e]=i}}function V(t){var e={};for(var i in t)T(t,i)&&(e[i]=t[i]);return e}function j(t){if(!t||"object"!=typeof t)return t;var e;if(m(t)){e=[];for(var i=0,r=t.length;i<r;++i)e.push(j(t[i]))}else if(t instanceof Date)(e=new Date).setTime(t.getTime());else for(var n in e=t.constructor?Object.create(t.constructor.prototype):{},t)T(t,n)&&(e[n]=j(t[n]));return e}function H(t,e,i,r){return i=i||{},r=r||"",v(t).forEach((function(n){if(T(e,n)){var s=t[n],o=e[n];"object"==typeof s&&"object"==typeof o&&s&&o&&s.constructor===o.constructor?H(s,o,i,r+n+"."):s!==o&&(i[r+n]=e[n])}else i[r+n]=void 0})),v(e).forEach((function(n){T(t,n)||(i[r+n]=e[n])})),i}var W="undefined"!=typeof Symbol&&Symbol.iterator,K=W?function(t){var e;return null!=t&&(e=t[W])&&e.apply(t)}:function(){return null},G={};function z(t){var e,i,r,n;if(1===arguments.length){if(m(t))return t.slice();if(this===G&&"string"==typeof t)return[t];if(n=K(t)){for(i=[];!(r=n.next()).done;)i.push(r.value);return i}if(null==t)return[t];if("number"==typeof(e=t.length)){for(i=new Array(e);e--;)i[e]=t[e];return i}return[t]}for(e=arguments.length,i=new Array(e);e--;)i[e]=arguments[e];return i}var q=[].concat;function X(t){return q.apply([],t)}var Y=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Q=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","IncompatiblePromise"].concat(Y),Z={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed"};function $(t,e){this._e=s(),this.name=t,this.message=e}function J(t,e,i,r){this._e=s(),this.failures=e,this.failedKeys=r,this.successCount=i}function tt(t,e){this._e=s(),this.name="BulkError",this.failures=e,this.message=function(t,e){return t+". Errors: "+e.map((function(t){return t.toString()})).filter((function(t,e,i){return i.indexOf(t)===e})).join("\n")}(t,e)}A($).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+o(this._e,2))}},toString:function(){return this.name+": "+this.message}}),A(J).from($),A(tt).from($);var et=Q.reduce((function(t,e){return t[e]=e+"Error",t}),{}),it=$,rt=Q.reduce((function(t,e){var i=e+"Error";function r(t,r){this._e=s(),this.name=i,t?"string"==typeof t?(this.message=t,this.inner=r||null):"object"==typeof t&&(this.message=t.name+" "+t.message,this.inner=t):(this.message=Z[e]||i,this.inner=null)}return A(r).from(it),t[e]=r,t}),{});rt.Syntax=SyntaxError,rt.Type=TypeError,rt.Range=RangeError;var nt=Y.reduce((function(t,e){return t[e+"Error"]=rt[e],t}),{});var st=Q.reduce((function(t,e){return-1===["Syntax","Type","Range"].indexOf(e)&&(t[e+"Error"]=rt[e]),t}),{});function ot(t){var e={},i=function(i,r){if(r){for(var n=arguments.length,s=new Array(n-1);--n;)s[n-1]=arguments[n];return e[i].subscribe.apply(null,s),t}if("string"==typeof i)return e[i]};i.addEventType=s;for(var r=1,n=arguments.length;r<n;++r)s(arguments[r]);return i;function s(t,r,n){if("object"==typeof t)return o(t);r||(r=f),n||(n=a);var s={subscribers:[],fire:n,subscribe:function(t){-1===s.subscribers.indexOf(t)&&(s.subscribers.push(t),s.fire=r(s.fire,t))},unsubscribe:function(t){s.subscribers=s.subscribers.filter((function(e){return e!==t})),s.fire=s.subscribers.reduce(r,n)}};return e[t]=i[t]=s,s}function o(t){v(t).forEach((function(e){var i=t[e];if(m(i))s(e,t[e][0],t[e][1]);else{if("asap"!==i)throw new rt.InvalidArgument("Invalid event config");var r=s(e,h,(function(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];r.subscribers.forEach((function(t){I((function(){t.apply(null,e)}))}))}))}}))}}st.ModifyError=J,st.DexieError=$,st.BulkError=tt;var at={},ht=!1,lt="undefined"==typeof setImmediate?function(){setTimeout(Mt,0)}:setImmediate.bind(null,Mt),ct=function(t,e){yt.push([t,e]),dt&&(lt(),dt=!1)},ut=!0,dt=!0,pt=[],ft=[],gt=null,vt=h,mt={global:!0,ref:0,unhandleds:[],onunhandled:Bt,finalize:function(){this.unhandleds.forEach((function(t){try{Bt(t[0],t[1])}catch(t){}}))}},yt=[],xt=0,_t=[];function bt(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=a,this._lib=!1;var i=this._PSD=mt;if(e&&(this._stackHolder=s(),this._prev=null,this._numPrev=0,Dt(this,gt)),"function"!=typeof t){if(t!==at)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&wt(this,this._value))}this._state=null,this._value=null,++i.ref,Et(this,t)}function Tt(t,e,i,r){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.resolve=i,this.reject=r,this.psd=mt}function Et(t,e){try{e((function(e){if(null===t._state){if(e===t)throw new TypeError("A promise cannot be resolved with itself.");var i=t._lib&&Rt();e&&"function"==typeof e.then?Et(t,(function(t,i){e instanceof bt?e._then(t,i):e.then(t,i)})):(t._state=!0,t._value=e,At(t)),i&&Pt()}}),wt.bind(null,t))}catch(e){wt(t,e)}}function wt(t,i){if(ft.push(i),null===t._state){var r=t._lib&&Rt();i=vt(i),t._state=!1,t._value=i,e&&null!==i&&"object"==typeof i&&!i._promise&&k((function(){var e=S(i,"stack");i._promise=t,w(i,"stack",{get:function(){return ht?e&&(e.get?e.get.apply(i):e.value):t.stack}})})),function(t){pt.some((function(e){return e._value===t._value}))||pt.push(t)}(t),At(t),r&&Pt()}}function At(t){var e=t._listeners;t._listeners=[];for(var i=0,r=e.length;i<r;++i)Ct(t,e[i]);var n=t._PSD;--n.ref||n.finalize(),0===xt&&(++xt,ct((function(){0==--xt&&It()}),[]))}function Ct(t,e){if(null!==t._state){var i=t._state?e.onFulfilled:e.onRejected;if(null===i)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++xt,ct(St,[i,t,e])}else t._listeners.push(e)}function St(t,e,i){var r=mt,n=i.psd;try{n!==r&&(mt=n),gt=e;var s,o=e._value;e._state?s=t(o):(ft.length&&(ft=[]),s=t(o),-1===ft.indexOf(o)&&function(t){var e=pt.length;for(;e;)if(pt[--e]._value===t._value)return void pt.splice(e,1)}(e)),i.resolve(s)}catch(t){i.reject(t)}finally{n!==r&&(mt=r),gt=null,0==--xt&&It(),--n.ref||n.finalize()}}function Ot(t,i,r){if(i.length===r)return i;var n="";if(!1===t._state){var s,a,h=t._value;null!=h?(s=h.name||"Error",a=h.message||h,n=o(h,0)):(s=h,a=""),i.push(s+(a?": "+a:"")+n)}return e&&((n=o(t._stackHolder,2))&&-1===i.indexOf(n)&&i.push(n),t._prev&&Ot(t._prev,i,r)),i}function Dt(t,e){var i=e?e._numPrev+1:0;i<100&&(t._prev=e,t._numPrev=i)}function Mt(){Rt()&&Pt()}function Rt(){var t=ut;return ut=!1,dt=!1,t}function Pt(){var t,e,i;do{for(;yt.length>0;)for(t=yt,yt=[],i=t.length,e=0;e<i;++e){var r=t[e];r[0].apply(null,r[1])}}while(yt.length>0);ut=!0,dt=!0}function It(){var t=pt;pt=[],t.forEach((function(t){t._PSD.onunhandled.call(null,t._value,t)}));for(var e=_t.slice(0),i=e.length;i;)e[--i]()}function Nt(t){return new bt(at,!1,t)}function Lt(t,e){var i=mt;return function(){var r=Rt(),n=mt;try{return n!==i&&(mt=i),t.apply(this,arguments)}catch(t){e&&e(t)}finally{n!==i&&(mt=n),r&&Pt()}}}function kt(t,e,i,r){var n=mt,s=Object.create(n);s.parent=n,s.ref=0,s.global=!1,++n.ref,s.finalize=function(){--this.parent.ref||this.parent.finalize()};var o=Ft(s,t,e,i,r);return 0===s.ref&&s.finalize(),o}function Ft(t,e,i,r,n){var s=mt;try{return t!==s&&(mt=t),e(i,r,n)}finally{t!==s&&(mt=s)}}function Bt(t,e){var i;try{i=e.onuncatched(t)}catch(t){}if(!1!==i)try{bt.on.error.fire(t,e)}catch(t){}}E(bt.prototype,{then:function(t,i){var r=this,n=new bt((function(e,n){Ct(r,new Tt(t,i,e,n))}));return e&&(!this._prev||null===this._state)&&Dt(n,this),n},_then:function(t,e){Ct(this,new Tt(null,null,t,e))},catch:function(t){if(1===arguments.length)return this.then(null,t);var e=arguments[0],i=arguments[1];return"function"==typeof e?this.then(null,(function(t){return t instanceof e?i(t):Nt(t)})):this.then(null,(function(t){return t&&t.name===e?i(t):Nt(t)}))},finally:function(t){return this.then((function(e){return t(),e}),(function(e){return t(),Nt(e)}))},uncaught:function(t){var e=this;return this.onuncatched=f(this.onuncatched,t),!1===this._state&&-1===pt.indexOf(this)&&pt.some((function(t,i,r){return t._value===e._value&&(r[i]=e)})),this},stack:{get:function(){if(this._stack)return this._stack;try{ht=!0;var t=Ot(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=t),t}finally{ht=!1}}}}),E(bt,{all:function(){var t=z.apply(null,arguments);return new bt((function(e,i){0===t.length&&e([]);var r=t.length;t.forEach((function(n,s){return bt.resolve(n).then((function(i){t[s]=i,--r||e(t)}),i)}))}))},resolve:function(t){return t&&"function"==typeof t.then?t:new bt(at,!0,t)},reject:Nt,race:function(){var t=z.apply(null,arguments);return new bt((function(e,i){t.map((function(t){return bt.resolve(t).then(e,i)}))}))},PSD:{get:function(){return mt},set:function(t){return mt=t}},newPSD:kt,usePSD:Ft,scheduler:{get:function(){return ct},set:function(t){ct=t}},rejectionMapper:{get:function(){return vt},set:function(t){vt=t}},follow:function(t){return new bt((function(e,i){return kt((function(e,i){var r=mt;r.unhandleds=[],r.onunhandled=i,r.finalize=c((function(){var t=this;!function(t){function e(){t(),_t.splice(_t.indexOf(e),1)}_t.push(e),++xt,ct((function(){0==--xt&&It()}),[])}((function(){0===t.unhandleds.length?e():i(t.unhandleds[0])}))}),r.finalize),t()}),e,i)}))},on:ot(null,{error:[f,function(t){console.warn("Unhandled rejection: "+(t.stack||t))}]})}),R((function(){ct=function(t,e){setTimeout((function(){t.apply(null,e)}),0)}}));var Ut="1.4.1",Vt=String.fromCharCode(65535),jt=function(){try{return IDBKeyRange.only([[]]),[[]]}catch(t){return Vt}}(),Ht="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Wt="String expected.",Kt=[],Gt="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),zt=Gt,qt=Gt,Xt=function(t){return!/(dexie\.js|dexie\.min\.js)/.test(t)};function Yt(t,i){var r,n,o,c=Yt.dependencies,f=x({addons:Yt.addons,autoOpen:!0,indexedDB:c.indexedDB,IDBKeyRange:c.IDBKeyRange},i),y=f.addons,_=f.autoOpen,b=f.indexedDB,C=f.IDBKeyRange,S=this._dbSchema={},O=[],I=[],W={},K=null,q=null,Y=!1,Q=!1,Z="readonly",$="readwrite",et=this,it=new bt((function(t){r=t})),nt=new bt((function(t,e){n=e})),st=!0,at=!!ue(b);function ht(t){this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null},this.stores({})}function lt(t,e,i){var r=et._createTransaction($,I,S);r.create(e),r._completion.catch(i);var n=r._reject.bind(r);kt((function(){mt.trans=r,0===t?(v(S).forEach((function(t){ct(e,t,S[t].primKey,S[t].indexes)})),bt.follow((function(){return et.on.populate.fire(r)})).catch(n)):function(t,e,i){var r=[],n=O.filter((function(e){return e._cfg.version===t}))[0];if(!n)throw new rt.Upgrade("Dexie specification of currently installed DB version is missing");S=et._dbSchema=n._cfg.dbschema;var s=!1;function o(){return r.length?bt.resolve(r.shift()(e.idbtrans)).then(o):bt.resolve()}return O.filter((function(e){return e._cfg.version>t})).forEach((function(t){r.push((function(){var r=S,n=t._cfg.dbschema;Ft(r,i),Ft(n,i),S=et._dbSchema=n;var o=function(t,e){var i={del:[],add:[],change:[]};for(var r in t)e[r]||i.del.push(r);for(r in e){var n=t[r],s=e[r];if(n){var o={name:r,def:s,recreate:!1,del:[],add:[],change:[]};if(n.primKey.src!==s.primKey.src)o.recreate=!0,i.change.push(o);else{var a=n.idxByName,h=s.idxByName;for(var l in a)h[l]||o.del.push(l);for(l in h){var c=a[l],u=h[l];c?c.src!==u.src&&o.change.push(u):o.add.push(u)}(o.del.length>0||o.add.length>0||o.change.length>0)&&i.change.push(o)}}else i.add.push([r,s])}return i}(r,n);if(o.add.forEach((function(t){ct(i,t[0],t[1].primKey,t[1].indexes)})),o.change.forEach((function(t){if(t.recreate)throw new rt.Upgrade("Not yet support for changing primary key");var e=i.objectStore(t.name);t.add.forEach((function(t){ut(e,t)})),t.change.forEach((function(t){e.deleteIndex(t.name),ut(e,t)})),t.del.forEach((function(t){e.deleteIndex(t)}))})),t._cfg.contentUpgrade)return s=!0,bt.follow((function(){t._cfg.contentUpgrade(e)}))})),r.push((function(e){s&&!zt&&function(t,e){for(var i=0;i<e.db.objectStoreNames.length;++i){var r=e.db.objectStoreNames[i];null==t[r]&&e.db.deleteObjectStore(r)}}(t._cfg.dbschema,e)}))})),o().then((function(){!function(t,e){v(t).forEach((function(i){e.db.objectStoreNames.contains(i)||ct(e,i,t[i].primKey,t[i].indexes)}))}(S,i)}))}(t,r,e).catch(n)}))}function ct(t,e,i,r){var n=t.db.createObjectStore(e,i.keyPath?{keyPath:i.keyPath,autoIncrement:i.auto}:{autoIncrement:i.auto});return r.forEach((function(t){ut(n,t)})),n}function ut(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function dt(t){return et.on.error.fire(t)}function pt(t,e,i){if(Q||mt.letThrough){var r=et._createTransaction(t,e,S);return r._promise(t,(function(t,e){kt((function(){mt.trans=r,i(t,e,r)}))})).then((function(t){return r._completion.then((function(){return t}))}))}if(!Y){if(!_)return F(new rt.DatabaseClosed,dt);et.open().catch(a)}return it.then((function(){return pt(t,e,i)}))}function ft(t,e,i){this.name=t,this.schema=e,this.hook=W[t]?W[t].hook:ot(null,{creating:[u,a],reading:[l,h],updating:[p,a],deleting:[d,a]}),this._collClass=i||Tt}function gt(t,e,i){ft.call(this,t,e,i||wt)}function vt(t,e,i){return(i?re:ie)((function(i){t.push(i),e&&e()}))}function yt(t,e,i,r,n){return new bt((function(s,o){var a=i.length,h=a-1;if(0===a)return s();if(r){var l,c=re(o),u=ee(null);k((function(){for(var r=0;r<a;++r){l={onsuccess:null,onerror:null};var o=i[r];n.call(l,o[0],o[1],e);var d=t.delete(o[0]);d._hookCtx=l,d.onerror=c,d.onsuccess=r===h?ee(s):u}}),(function(t){throw l.onerror&&l.onerror(t),t}))}else for(var d=0;d<a;++d){var p=t.delete(i[d]);p.onerror=Lt(ie(o)),d===h&&(p.onsuccess=Lt((function(){return s()})))}})).uncaught(dt)}function xt(t,e,i,r){var n=this;this.db=et,this.mode=t,this.storeNames=e,this.idbtrans=null,this.on=ot(this,"complete","error","abort"),this.parent=r||null,this.active=!0,this._tables=null,this._reculock=0,this._blockedFuncs=[],this._psd=null,this._dbschema=i,this._resolve=null,this._reject=null,this._completion=new bt((function(t,e){n._resolve=t,n._reject=e})).uncaught(dt),this._completion.then((function(){n.on.complete.fire()}),(function(t){return n.on.error.fire(t),n.parent?n.parent._reject(t):n.active&&n.idbtrans&&n.idbtrans.abort(),n.active=!1,F(t)}))}function _t(t,e,i){this._ctx={table:t,index:":id"===e?null:e,collClass:t._collClass,or:i}}function Tt(t,e){var i=null,r=null;if(e)try{i=e()}catch(t){r=t}var n=t._ctx,s=n.table;this._ctx={table:s,index:n.index,isPrimKey:!n.index||s.schema.primKey.keyPath&&n.index===s.schema.primKey.name,range:i,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:r,or:n.or,valueMapper:s.hook.reading.fire}}function Et(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function wt(){Tt.apply(this,arguments)}function At(t,e){return t._cfg.version-e._cfg.version}function Ct(t,e,i,r){e.forEach((function(e){var n=et._tableFactory(i,r[e]);t.forEach((function(t){e in t||(t[e]=n)}))}))}function St(t,e,i,r,n,s){var o=Lt(s?function(t,e,r){return i(s(t),e,r)}:i,n);t.onerror||(t.onerror=ie(n)),t.onsuccess=L(e?function(){var i=t.result;if(i){var s=function(){i.continue()};e(i,(function(t){s=t}),r,n)&&o(i.value,i,(function(t){s=t})),s()}else r()}:function(){var e=t.result;if(e){var i=function(){e.continue()};o(e.value,e,(function(t){i=t})),i()}else r()},n)}function Ot(t,e){return b.cmp(t,e)}function Dt(t,e){return Ot(t,e)>0?t:e}function Mt(t,e){return b.cmp(t,e)}function Rt(t,e){return b.cmp(e,t)}function Pt(t,e){return t<e?-1:t===e?0:1}function It(t,e){return t>e?-1:t===e?0:1}function Nt(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}function Ft(t,e){for(var i=e.db.objectStoreNames,r=0;r<i.length;++r){var n=i[r],s=e.objectStore(n);o="getAll"in s;for(var a=0;a<s.indexNames.length;++a){var h=s.indexNames[a],l=s.index(h).keyPath,c="string"==typeof l?l:"["+D(l).join("+")+"]";if(t[n]){var u=t[n].idxByName[c];u&&(u.name=h)}}}}function Bt(t){et.on("blocked").fire(t),Kt.filter((function(t){return t.name===et.name&&t!==et&&!t._vcFired})).map((function(e){return e.on("versionchange").fire(t)}))}this.version=function(t){if(K||Y)throw new rt.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);var e=O.filter((function(e){return e._cfg.version===t}))[0];return e||(e=new ht(t),O.push(e),O.sort(At),e)},x(ht.prototype,{stores:function(t){this._cfg.storesSource=this._cfg.storesSource?x(this._cfg.storesSource,t):t;var e={};O.forEach((function(t){x(e,t._cfg.storesSource)}));var i=this._cfg.dbschema={};return this._parseStoresSpec(e,i),S=et._dbSchema=i,[W,et,xt.prototype].forEach((function(t){for(var e in t)t[e]instanceof ft&&delete t[e]})),Ct([W,et,xt.prototype,this._cfg.tables],v(i),$,i),I=v(i),this},upgrade:function(t){var e=this;return Qt((function(){t(et._createTransaction($,v(e._cfg.dbschema),e._cfg.dbschema))})),this._cfg.contentUpgrade=t,this},_parseStoresSpec:function(t,e){v(t).forEach((function(i){if(null!==t[i]){var r={},n=function(t){var e=[];return t.split(",").forEach((function(t){var i=(t=t.trim()).replace(/([&*]|\+\+)/g,""),r=/^\[/.test(i)?i.match(/^\[(.*)\]$/)[1].split("+"):i;e.push(new ae(i,r||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),m(r),/\./.test(t)))})),e}(t[i]),s=n.shift();if(s.multi)throw new rt.Schema("Primary key cannot be multi-valued");s.keyPath&&U(r,s.keyPath,s.auto?0:s.keyPath),n.forEach((function(t){if(t.auto)throw new rt.Schema("Only primary key can be marked as autoIncrement (++)");if(!t.keyPath)throw new rt.Schema("Index must have a name and cannot be an empty string");U(r,t.keyPath,t.compound?t.keyPath.map((function(){return""})):"")})),e[i]=new he(i,s,n,r)}}))}}),this._allTables=W,this._tableFactory=function(t,e){return t===Z?new ft(e.name,e,Tt):new gt(e.name,e)},this._createTransaction=function(t,e,i,r){return new xt(t,e,i,r)},this._whenReady=function(t){return new bt(Zt||Q||mt.letThrough?t:function(e,i){if(!Y){if(!_)return void i(new rt.DatabaseClosed);et.open().catch(a)}it.then((function(){t(e,i)}))}).uncaught(dt)},this.verno=0,this.open=function(){if(Y||K)return it.then((function(){return q?F(q,dt):et}));e&&(nt._stackHolder=s()),Y=!0,q=null,Q=!1;var i=r,n=null;return bt.race([nt,new bt((function(e,i){if(R((function(){return e()})),O.length>0&&(st=!1),!b)throw new rt.MissingAPI("indexedDB API not found. If using IE10+, make sure to run your code on a server URL (not locally). If using old Safari versions, make sure to include indexedDB polyfill.");var r=st?b.open(t):b.open(t,Math.round(10*et.verno));if(!r)throw new rt.MissingAPI("IndexedDB API not available");r.onerror=Lt(ie(i)),r.onblocked=Lt(Bt),r.onupgradeneeded=Lt((function(e){if(n=r.transaction,st&&!et._allowEmptyDB){r.onerror=ne,n.abort(),r.result.close();var s=b.deleteDatabase(t);s.onsuccess=s.onerror=Lt((function(){i(new rt.NoSuchDatabase("Database "+t+" doesnt exist"))}))}else{n.onerror=Lt(ie(i)),lt((e.oldVersion>Math.pow(2,62)?0:e.oldVersion)/10,n,i)}}),i),r.onsuccess=Lt((function(){if(n=null,K=r.result,Kt.push(et),st)!function(){if(et.verno=K.version/10,et._dbSchema=S={},0===(I=D(K.objectStoreNames,0)).length)return;var t=K.transaction(ce(I),"readonly");I.forEach((function(e){for(var i=t.objectStore(e),r=i.keyPath,n=r&&"string"==typeof r&&-1!==r.indexOf("."),s=new ae(r,r||"",!1,!1,!!i.autoIncrement,r&&"string"!=typeof r,n),o=[],a=0;a<i.indexNames.length;++a){var h=i.index(i.indexNames[a]);n=(r=h.keyPath)&&"string"==typeof r&&-1!==r.indexOf(".");var l=new ae(h.name,r,!!h.unique,!!h.multiEntry,!1,r&&"string"!=typeof r,n);o.push(l)}S[e]=new he(e,s,o,{})})),Ct([W,xt.prototype],v(S),$,S)}();else if(K.objectStoreNames.length>0)try{Ft(S,K.transaction(ce(K.objectStoreNames),Z))}catch(t){}K.onversionchange=Lt((function(t){et._vcFired=!0,et.on("versionchange").fire(t)})),at||se((function(e){if(-1===e.indexOf(t))return e.push(t)})),e()}),i)}))]).then((function(){return Yt.vip(et.on.ready.fire)})).then((function(){return Y=!1,et})).catch((function(t){try{n&&n.abort()}catch(t){}return Y=!1,et.close(),F(q=t,dt)})).finally((function(){Q=!0,i()}))},this.close=function(){var t=Kt.indexOf(et);if(t>=0&&Kt.splice(t,1),K){try{K.close()}catch(t){}K=null}_=!1,q=new rt.DatabaseClosed,Y&&n(q),it=new bt((function(t){r=t})),nt=new bt((function(t,e){n=e}))},this.delete=function(){var e=arguments.length>0;return new bt((function(i,r){if(e)throw new rt.InvalidArgument("Arguments not allowed in db.delete()");function n(){et.close();var e=b.deleteDatabase(t);e.onsuccess=Lt((function(){at||se((function(e){var i=e.indexOf(t);if(i>=0)return e.splice(i,1)})),i()})),e.onerror=Lt(ie(r)),e.onblocked=Bt}Y?it.then(n):n()})).uncaught(dt)},this.backendDB=function(){return K},this.isOpen=function(){return null!==K},this.hasFailed=function(){return null!==q},this.dynamicallyOpened=function(){return st},this.name=t,w(this,"tables",{get:function(){return v(W).map((function(t){return W[t]}))}}),this.on=ot(this,"error","populate","blocked","versionchange",{ready:[g,a]}),this.on.ready.subscribe=M(this.on.ready.subscribe,(function(t){return function(e,i){Yt.vip((function(){t(e),i||t((function t(){et.on.ready.unsubscribe(e),et.on.ready.unsubscribe(t)}))}))}})),Qt((function(){et.on("populate").fire(et._createTransaction($,I,S)),et.on("error").fire(new Error)})),this.transaction=function(t,e,i){var r=arguments.length;if(r<2)throw new rt.InvalidArgument("Too few arguments");for(var n=new Array(r-1);--r;)n[r-1]=arguments[r];i=n.pop();var s=X(n),o=mt.trans;o&&o.db===et&&-1===t.indexOf("!")||(o=null);var a=-1!==t.indexOf("?");t=t.replace("!","").replace("?","");try{var h=s.map((function(t){var e=t instanceof ft?t.name:t;if("string"!=typeof e)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return e}));if("r"==t||t==Z)t=Z;else{if("rw"!=t&&t!=$)throw new rt.InvalidArgument("Invalid transaction mode: "+t);t=$}if(o){if(o.mode===Z&&t===$){if(!a)throw new rt.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");o=null}o&&h.forEach((function(t){if(!T(o.tables,t)){if(!a)throw new rt.SubTransaction("Table "+t+" not included in parent transaction.");o=null}}))}}catch(t){return o?o._promise(null,(function(e,i){i(t)})):F(t,dt)}return o?o._promise(t,l,"lock"):et._whenReady(l);function l(e){var r=mt;e(bt.resolve().then((function(){return kt((function(){mt.transless=mt.transless||r;var e=et._createTransaction(t,h,S,o);mt.trans=e,o?e.idbtrans=o.idbtrans:e.create();var n,s=h.map((function(t){return e.tables[t]}));return s.push(e),bt.follow((function(){if(n=i.apply(e,s))if("function"==typeof n.next&&"function"==typeof n.throw)n=oe(n);else if("function"==typeof n.then&&!T(n,"_PSD"))throw new rt.IncompatiblePromise("Incompatible Promise returned from transaction scope (read more at http://tinyurl.com/znyqjqc). Transaction scope: "+i.toString())})).uncaught(dt).then((function(){return o&&e._resolve(),e._completion})).then((function(){return n})).catch((function(t){return e._reject(t),F(t)}))}))})))}},this.table=function(t){if(Zt&&st)return new gt(t);if(!T(W,t))throw new rt.InvalidTable("Table "+t+" does not exist");return W[t]},E(ft.prototype,{_trans:function(t,e,i){var r=mt.trans;return r&&r.db===et?r._promise(t,e,i):pt(t,[this.name],e)},_idbstore:function(t,e,i){if(Zt)return new bt(e);var r=mt.trans,n=this.name;function s(t,i,r){e(t,i,r.idbtrans.objectStore(n),r)}return r&&r.db===et?r._promise(t,s,i):pt(t,[this.name],s)},get:function(t,e){var i=this;return this._idbstore(Z,(function(e,r,n){Zt&&e(i.schema.instanceTemplate);var s=n.get(t);s.onerror=ie(r),s.onsuccess=function(){e(i.hook.reading.fire(s.result))}})).then(e)},where:function(t){return new _t(this,t)},count:function(t){return this.toCollection().count(t)},offset:function(t){return this.toCollection().offset(t)},limit:function(t){return this.toCollection().limit(t)},reverse:function(){return this.toCollection().reverse()},filter:function(t){return this.toCollection().and(t)},each:function(t){return this.toCollection().each(t)},toArray:function(t){return this.toCollection().toArray(t)},orderBy:function(t){return new this._collClass(new _t(this,t))},toCollection:function(){return new this._collClass(new _t(this))},mapToClass:function(t,e){this.schema.mappedClass=t;var i=Object.create(t.prototype);e&&Jt(i,e),this.schema.instanceTemplate=i;var r=function(e){if(!e)return e;var i=Object.create(t.prototype);for(var r in e)T(e,r)&&(i[r]=e[r]);return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=r,this.hook("reading",r),t},defineClass:function(t){return this.mapToClass(Yt.defineClass(t),t)}}),A(gt).from(ft).extend({bulkDelete:function(t){return this.hook.deleting.fire===a?this._idbstore($,(function(e,i,r,n){e(yt(r,n,t,!1,a))})):this.where(":id").anyOf(t).delete().then((function(){}))},bulkPut:function(t,e){var i=this;return this._idbstore($,(function(r,n,s){if(!s.keyPath&&!i.schema.primKey.auto&&!e)throw new rt.InvalidArgument("bulkPut() with non-inbound keys requires keys array in second argument");if(s.keyPath&&e)throw new rt.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(e&&e.length!==t.length)throw new rt.InvalidArgument("Arguments objects and keys must have the same length");if(0===t.length)return r();var o,h,l=function(t){0===c.length?r(t):n(new tt(i.name+".bulkPut(): "+c.length+" of "+u+" operations failed",c))},c=[],u=t.length,d=i;if(i.hook.creating.fire===a&&i.hook.updating.fire===a){h=vt(c);for(var p=0,f=t.length;p<f;++p)(o=e?s.put(t[p],e[p]):s.put(t[p])).onerror=h;o.onerror=vt(c,l),o.onsuccess=te(l)}else{var g=e||s.keyPath&&t.map((function(t){return B(t,s.keyPath)})),v=g&&N(g,(function(e,i){return null!=e&&[e,t[i]]}));(g?d.where(":id").anyOf(g.filter((function(t){return null!=t}))).modify((function(){this.value=v[this.primKey],v[this.primKey]=null})).catch(J,(function(t){c=t.failures})).then((function(){for(var i=[],r=e&&[],n=g.length-1;n>=0;--n){var s=g[n];(null==s||v[s])&&(i.push(t[n]),e&&r.push(s),null!=s&&(v[s]=null))}return i.reverse(),e&&r.reverse(),d.bulkAdd(i,r)})).then((function(t){var e=g[g.length-1];return null!=e?e:t})):d.bulkAdd(t)).then(l).catch(tt,(function(t){c=c.concat(t.failures),l()})).catch(n)}}),"locked")},bulkAdd:function(t,e){var i=this,r=this.hook.creating.fire;return this._idbstore($,(function(n,s,o,h){if(!o.keyPath&&!i.schema.primKey.auto&&!e)throw new rt.InvalidArgument("bulkAdd() with non-inbound keys requires keys array in second argument");if(o.keyPath&&e)throw new rt.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(e&&e.length!==t.length)throw new rt.InvalidArgument("Arguments objects and keys must have the same length");if(0===t.length)return n();function l(t){0===p.length?n(t):s(new tt(i.name+".bulkAdd(): "+p.length+" of "+f+" operations failed",p))}var c,u,d,p=[],f=t.length;if(r!==a){var g,v=o.keyPath;u=vt(p,null,!0),d=ee(null),k((function(){for(var i=0,n=t.length;i<n;++i){g={onerror:null,onsuccess:null};var s=e&&e[i],a=t[i],l=e?s:v?B(a,v):void 0,p=r.call(g,l,a,h);null==l&&null!=p&&(v?U(a=j(a),v,p):s=p),(c=null!=s?o.add(a,s):o.add(a))._hookCtx=g,i<n-1&&(c.onerror=u,g.onsuccess&&(c.onsuccess=d))}}),(function(t){throw g.onerror&&g.onerror(t),t})),c.onerror=vt(p,l,!0),c.onsuccess=ee(l)}else{u=vt(p);for(var m=0,y=t.length;m<y;++m)(c=e?o.add(t[m],e[m]):o.add(t[m])).onerror=u;c.onerror=vt(p,l),c.onsuccess=te(l)}}))},add:function(t,e){var i=this.hook.creating.fire;return this._idbstore($,(function(r,n,s,o){var h={onsuccess:null,onerror:null};if(i!==a){var l=null!=e?e:s.keyPath?B(t,s.keyPath):void 0,c=i.call(h,l,t,o);null==l&&null!=c&&(s.keyPath?U(t,s.keyPath,c):e=c)}try{var u=null!=e?s.add(t,e):s.add(t);u._hookCtx=h,u.onerror=re(n),u.onsuccess=ee((function(e){var i=s.keyPath;i&&U(t,i,e),r(e)}))}catch(t){throw h.onerror&&h.onerror(t),t}}))},put:function(t,e){var i=this,r=this.hook.creating.fire,n=this.hook.updating.fire;return r!==a||n!==a?this._trans($,(function(r,n,s){var o=void 0!==e?e:i.schema.primKey.keyPath&&B(t,i.schema.primKey.keyPath);null==o?s.tables[i.name].add(t).then(r,n):(s._lock(),t=j(t),s.tables[i.name].where(":id").equals(o).modify((function(){this.value=t})).then((function(r){return 0===r?s.tables[i.name].add(t,e):o})).finally((function(){s._unlock()})).then(r,n))})):this._idbstore($,(function(i,r,n){var s=void 0!==e?n.put(t,e):n.put(t);s.onerror=ie(r),s.onsuccess=function(e){var r=n.keyPath;r&&U(t,r,e.target.result),i(s.result)}}))},delete:function(t){return this.hook.deleting.subscribers.length?this.where(":id").equals(t).delete():this._idbstore($,(function(e,i,r){var n=r.delete(t);n.onerror=ie(i),n.onsuccess=function(){e(n.result)}}))},clear:function(){return this.hook.deleting.subscribers.length?this.toCollection().delete():this._idbstore($,(function(t,e,i){var r=i.clear();r.onerror=ie(e),r.onsuccess=function(){t(r.result)}}))},update:function(t,e){if("object"!=typeof e||m(e))throw new rt.InvalidArgument("Modifications must be an object.");if("object"!=typeof t||m(t))return this.where(":id").equals(t).modify(e);v(e).forEach((function(i){U(t,i,e[i])}));var i=B(t,this.schema.primKey.keyPath);return void 0===i?F(new rt.InvalidArgument("Given object does not contain its primary key"),dt):this.where(":id").equals(i).modify(e)}}),E(xt.prototype,{_lock:function(){return P(!mt.global),++this._reculock,1!==this._reculock||mt.global||(mt.lockOwnerFor=this),this},_unlock:function(){if(P(!mt.global),0==--this._reculock)for(mt.global||(mt.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var t=this._blockedFuncs.shift();try{t()}catch(t){}}return this},_locked:function(){return this._reculock&&mt.lockOwnerFor!==this},create:function(t){var e=this;if(P(!this.idbtrans),!t&&!K)switch(q&&q.name){case"DatabaseClosedError":throw new rt.DatabaseClosed(q);case"MissingAPIError":throw new rt.MissingAPI(q.message,q);default:throw new rt.OpenFailed(q)}if(!this.active)throw new rt.TransactionInactive;return P(null===this._completion._state),(t=this.idbtrans=t||K.transaction(ce(this.storeNames),this.mode)).onerror=Lt((function(i){ne(i),e._reject(t.error)})),t.onabort=Lt((function(t){ne(t),e.active&&e._reject(new rt.Abort),e.active=!1,e.on("abort").fire(t)})),t.oncomplete=Lt((function(){e.active=!1,e._resolve()})),this},_promise:function(t,e,i){var r=this;return kt((function(){var n;return r._locked()?n=new bt((function(n,s){r._blockedFuncs.push((function(){r._promise(t,e,i).then(n,s)}))})):(n=r.active?new bt((function(n,s){if(t===$&&r.mode!==$)throw new rt.ReadOnly("Transaction is readonly");!r.idbtrans&&t&&r.create(),i&&r._lock(),e(n,s,r)})):F(new rt.TransactionInactive),r.active&&i&&n.finally((function(){r._unlock()}))),n._lib=!0,n.uncaught(dt)}))},abort:function(){this.active&&this._reject(new rt.Abort),this.active=!1},tables:{get:function(){return this._tables?this._tables:this._tables=N(this.storeNames,(function(t){return[t,W[t]]}))}},complete:function(t){return this.on("complete",t)},error:function(t){return this.on("error",t)},table:function(t){if(-1===this.storeNames.indexOf(t))throw new rt.InvalidTable("Table "+t+" not in transaction");return W[t]}}),E(_t.prototype,(function(){function t(t,e,i){var r=t instanceof _t?new t._ctx.collClass(t):t;return r._ctx.error=i?new i(e):new TypeError(e),r}function e(t){return new t._ctx.collClass(t,(function(){return C.only("")})).limit(0)}function i(t,e,i,r,n,s){for(var o=Math.min(t.length,r.length),a=-1,h=0;h<o;++h){var l=e[h];if(l!==r[h])return n(t[h],i[h])<0?t.substr(0,h)+i[h]+i.substr(h+1):n(t[h],r[h])<0?t.substr(0,h)+r[h]+i.substr(h+1):a>=0?t.substr(0,a)+e[a]+i.substr(a+1):null;n(t[h],l)<0&&(a=h)}return o<r.length&&"next"===s?t+i.substr(t.length):o<t.length&&"prev"===s?t.substr(0,i.length):a<0?null:t.substr(0,a)+r[a]+i.substr(a+1)}function r(e,r,n,s){var o,a,h,l,c,u,d,p=n.length;if(!n.every((function(t){return"string"==typeof t})))return t(e,Wt);function f(t){o=function(t){return"next"===t?function(t){return t.toUpperCase()}:function(t){return t.toLowerCase()}}(t),a=function(t){return"next"===t?function(t){return t.toLowerCase()}:function(t){return t.toUpperCase()}}(t),h="next"===t?Pt:It;var e=n.map((function(t){return{lower:a(t),upper:o(t)}})).sort((function(t,e){return h(t.lower,e.lower)}));l=e.map((function(t){return t.upper})),c=e.map((function(t){return t.lower})),u=t,d="next"===t?"":s}f("next");var g=new e._ctx.collClass(e,(function(){return C.bound(l[0],c[p-1]+s)}));g._ondirectionchange=function(t){f(t)};var v=0;return g._addAlgorithm((function(t,e,n){var s=t.key;if("string"!=typeof s)return!1;var o=a(s);if(r(o,c,v))return!0;for(var f=null,g=v;g<p;++g){var m=i(s,o,l[g],c[g],h,u);null===m&&null===f?v=g+1:(null===f||h(f,m)>0)&&(f=m)}return e(null!==f?function(){t.continue(f+d)}:n),!1})),g}return{between:function(i,r,n,s){n=!1!==n,s=!0===s;try{return Ot(i,r)>0||0===Ot(i,r)&&(n||s)&&(!n||!s)?e(this):new this._ctx.collClass(this,(function(){return C.bound(i,r,!n,!s)}))}catch(e){return t(this,Ht)}},equals:function(t){return new this._ctx.collClass(this,(function(){return C.only(t)}))},above:function(t){return new this._ctx.collClass(this,(function(){return C.lowerBound(t,!0)}))},aboveOrEqual:function(t){return new this._ctx.collClass(this,(function(){return C.lowerBound(t)}))},below:function(t){return new this._ctx.collClass(this,(function(){return C.upperBound(t,!0)}))},belowOrEqual:function(t){return new this._ctx.collClass(this,(function(){return C.upperBound(t)}))},startsWith:function(e){return"string"!=typeof e?t(this,Wt):this.between(e,e+Vt,!0,!0)},startsWithIgnoreCase:function(t){return""===t?this.startsWith(t):r(this,(function(t,e){return 0===t.indexOf(e[0])}),[t],Vt)},equalsIgnoreCase:function(t){return r(this,(function(t,e){return t===e[0]}),[t],"")},anyOfIgnoreCase:function(){var t=z.apply(G,arguments);return 0===t.length?e(this):r(this,(function(t,e){return-1!==e.indexOf(t)}),t,"")},startsWithAnyOfIgnoreCase:function(){var t=z.apply(G,arguments);return 0===t.length?e(this):r(this,(function(t,e){return e.some((function(e){return 0===t.indexOf(e)}))}),t,Vt)},anyOf:function(){var i=z.apply(G,arguments),r=Mt;try{i.sort(r)}catch(e){return t(this,Ht)}if(0===i.length)return e(this);var n=new this._ctx.collClass(this,(function(){return C.bound(i[0],i[i.length-1])}));n._ondirectionchange=function(t){r="next"===t?Mt:Rt,i.sort(r)};var s=0;return n._addAlgorithm((function(t,e,n){for(var o=t.key;r(o,i[s])>0;)if(++s===i.length)return e(n),!1;return 0===r(o,i[s])||(e((function(){t.continue(i[s])})),!1)})),n},notEqual:function(t){return this.inAnyRange([[-1/0,t],[t,jt]],{includeLowers:!1,includeUppers:!1})},noneOf:function(){var e=z.apply(G,arguments);if(0===e.length)return new this._ctx.collClass(this);try{e.sort(Mt)}catch(e){return t(this,Ht)}var i=e.reduce((function(t,e){return t?t.concat([[t[t.length-1][1],e]]):[[-1/0,e]]}),null);return i.push([e[e.length-1],jt]),this.inAnyRange(i,{includeLowers:!1,includeUppers:!1})},inAnyRange:function(i,r){var n=this._ctx;if(0===i.length)return e(this);if(!i.every((function(t){return void 0!==t[0]&&void 0!==t[1]&&Mt(t[0],t[1])<=0})))return t(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",rt.InvalidArgument);var s=!r||!1!==r.includeLowers,o=r&&!0===r.includeUppers;var a,h=Mt;function l(t,e){return h(t[0],e[0])}try{(a=i.reduce((function(t,e){for(var i=0,r=t.length;i<r;++i){var n=t[i];if(Ot(e[0],n[1])<0&&Ot(e[1],n[0])>0){n[0]=Ot(s=n[0],o=e[0])<0?s:o,n[1]=Dt(n[1],e[1]);break}}var s,o;return i===r&&t.push(e),t}),[])).sort(l)}catch(e){return t(this,Ht)}var c=0,u=o?function(t){return Mt(t,a[c][1])>0}:function(t){return Mt(t,a[c][1])>=0},d=s?function(t){return Rt(t,a[c][0])>0}:function(t){return Rt(t,a[c][0])>=0};var p=u,f=new n.collClass(this,(function(){return C.bound(a[0][0],a[a.length-1][1],!s,!o)}));return f._ondirectionchange=function(t){"next"===t?(p=u,h=Mt):(p=d,h=Rt),a.sort(l)},f._addAlgorithm((function(t,e,i){for(var r=t.key;p(r);)if(++c===a.length)return e(i),!1;return!!function(t){return!u(t)&&!d(t)}(r)||(0===Ot(r,a[c][1])||0===Ot(r,a[c][0])||e((function(){h===Mt?t.continue(a[c][0]):t.continue(a[c][1])})),!1)})),f},startsWithAnyOf:function(){var i=z.apply(G,arguments);return i.every((function(t){return"string"==typeof t}))?0===i.length?e(this):this.inAnyRange(i.map((function(t){return[t,t+Vt]}))):t(this,"startsWithAnyOf() only works with strings")}}})),E(Tt.prototype,(function(){function t(t,e){t.filter=Nt(t.filter,e)}function e(t,e,i){var r=t.replayFilter;t.replayFilter=r?function(){return Nt(r(),e())}:e,t.justLimit=i&&!r}function i(t,e){if(t.isPrimKey)return e;var i=t.table.schema.idxByName[t.index];if(!i)throw new rt.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return e.index(i.name)}function r(t,e){var r=i(t,e);return t.keysOnly&&"openKeyCursor"in r?r.openKeyCursor(t.range||null,t.dir+t.unique):r.openCursor(t.range||null,t.dir+t.unique)}function n(t,e,i,n,s){var o=t.replayFilter?Nt(t.filter,t.replayFilter()):t.filter;t.or?function(){var a={},h=0;function l(){2==++h&&i()}function c(t,i,r){if(!o||o(i,r,l,n)){var s=i.primaryKey.toString();T(a,s)||(a[s]=!0,e(t,i,r))}}t.or._iterate(c,l,n,s),St(r(t,s),t.algorithm,c,l,n,!t.keysOnly&&t.valueMapper)}():St(r(t,s),Nt(t.algorithm,o),e,i,n,!t.keysOnly&&t.valueMapper)}function s(t){return t.table.schema.instanceTemplate}return{_read:function(t,e){var i=this._ctx;return i.error?i.table._trans(null,(function(t,e){e(i.error)})):i.table._idbstore(Z,t).then(e)},_write:function(t){var e=this._ctx;return e.error?e.table._trans(null,(function(t,i){i(e.error)})):e.table._idbstore($,t,"locked")},_addAlgorithm:function(t){var e=this._ctx;e.algorithm=Nt(e.algorithm,t)},_iterate:function(t,e,i,r){return n(this._ctx,t,e,i,r)},clone:function(t){var e=Object.create(this.constructor.prototype),i=Object.create(this._ctx);return t&&x(i,t),e._ctx=i,e},raw:function(){return this._ctx.valueMapper=null,this},each:function(t){var e=this._ctx;if(Zt){var i=s(e),r=e.table.schema.primKey.keyPath,o=B(i,e.index?e.table.schema.idxByName[e.index].keyPath:r),a=B(i,r);t(i,{key:o,primaryKey:a})}return this._read((function(i,r,s){n(e,t,i,r,s)}))},count:function(t){if(Zt)return bt.resolve(0).then(t);var e=this._ctx;if(Et(e,!0))return this._read((function(t,r,n){var s=i(e,n),o=e.range?s.count(e.range):s.count();o.onerror=ie(r),o.onsuccess=function(i){t(Math.min(i.target.result,e.limit))}}),t);var r=0;return this._read((function(t,i,s){n(e,(function(){return++r,!1}),(function(){t(r)}),i,s)}),t)},sortBy:function(t,e){var i=t.split(".").reverse(),r=i[0],n=i.length-1;function s(t,e){return e?s(t[i[e]],e-1):t[r]}var o="next"===this._ctx.dir?1:-1;function a(t,e){var i=s(t,n),r=s(e,n);return i<r?-o:i>r?o:0}return this.toArray((function(t){return t.sort(a)})).then(e)},toArray:function(t){var e=this._ctx;return this._read((function(t,r,a){if(Zt&&t([s(e)]),o&&"next"===e.dir&&Et(e,!0)&&e.limit>0){var l=e.table.hook.reading.fire,c=i(e,a),u=e.limit<1/0?c.getAll(e.range,e.limit):c.getAll(e.range);u.onerror=ie(r),u.onsuccess=l===h?te(t):Lt(te((function(e){t(e.map(l))})))}else{var d=[];n(e,(function(t){d.push(t)}),(function(){t(d)}),r,a)}}),t)},offset:function(t){var i=this._ctx;return t<=0||(i.offset+=t,Et(i)?e(i,(function(){var e=t;return function(t,i){return 0===e||(1===e?(--e,!1):(i((function(){t.advance(e),e=0})),!1))}})):e(i,(function(){var e=t;return function(){return--e<0}}))),this},limit:function(t){return this._ctx.limit=Math.min(this._ctx.limit,t),e(this._ctx,(function(){var e=t;return function(t,i,r){return--e<=0&&i(r),e>=0}}),!0),this},until:function(e,i){var r=this._ctx;return Zt&&e(s(r)),t(this._ctx,(function(t,r,n){return!e(t.value)||(r(n),i)})),this},first:function(t){return this.limit(1).toArray((function(t){return t[0]})).then(t)},last:function(t){return this.reverse().first(t)},filter:function(e){var i,r;return Zt&&e(s(this._ctx)),t(this._ctx,(function(t){return e(t.value)})),i=this._ctx,r=e,i.isMatch=Nt(i.isMatch,r),this},and:function(t){return this.filter(t)},or:function(t){return new _t(this._ctx.table,t,this)},reverse:function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},desc:function(){return this.reverse()},eachKey:function(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each((function(e,i){t(i.key,i)}))},eachUniqueKey:function(t){return this._ctx.unique="unique",this.eachKey(t)},eachPrimaryKey:function(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each((function(e,i){t(i.primaryKey,i)}))},keys:function(t){var e=this._ctx;e.keysOnly=!e.isMatch;var i=[];return this.each((function(t,e){i.push(e.key)})).then((function(){return i})).then(t)},primaryKeys:function(t){var e=this._ctx;if(o&&"next"===e.dir&&Et(e,!0)&&e.limit>0)return this._read((function(t,r,n){var s=i(e,n),o=e.limit<1/0?s.getAllKeys(e.range,e.limit):s.getAllKeys(e.range);o.onerror=ie(r),o.onsuccess=te(t)})).then(t);e.keysOnly=!e.isMatch;var r=[];return this.each((function(t,e){r.push(e.primaryKey)})).then((function(){return r})).then(t)},uniqueKeys:function(t){return this._ctx.unique="unique",this.keys(t)},firstKey:function(t){return this.limit(1).keys((function(t){return t[0]})).then(t)},lastKey:function(t){return this.reverse().firstKey(t)},distinct:function(){var e=this._ctx,i=e.index&&e.table.schema.idxByName[e.index];if(!i||!i.multi)return this;var r={};return t(this._ctx,(function(t){var e=t.primaryKey.toString(),i=T(r,e);return r[e]=!0,!i})),this}}})),A(wt).from(Tt).extend({modify:function(t){var e=this,i=this._ctx,r=i.table.hook,n=r.updating.fire,s=r.deleting.fire;return Zt&&"function"==typeof t&&t.call({value:i.table.schema.instanceTemplate},i.table.schema.instanceTemplate),this._write((function(i,r,o,h){var l;if("function"==typeof t)l=n===a&&s===a?t:function(e){var i=j(e);if(!1===t.call(this,e,this))return!1;if(T(this,"value")){var r=H(i,this.value),o=n.call(this,r,this.primKey,i,h);o&&(e=this.value,v(o).forEach((function(t){U(e,t,o[t])})))}else s.call(this,this.primKey,e,h)};else if(n===a){var c=v(t),u=c.length;l=function(e){for(var i=!1,r=0;r<u;++r){var n=c[r],s=t[n];B(e,n)!==s&&(U(e,n,s),i=!0)}return i}}else{var d=t;t=V(d),l=function(e){var i=!1,r=n.call(this,t,this.primKey,j(e),h);return r&&x(t,r),v(t).forEach((function(r){var n=t[r];B(e,r)!==n&&(U(e,r,n),i=!0)})),r&&(t=V(d)),i}}var p=0,f=0,g=!1,m=[],y=[],_=null;function b(t){return t&&(m.push(t),y.push(_)),r(new J("Error modifying one or more objects",m,f,y))}function E(){g&&f+m.length===p&&(m.length>0?b():i(f))}e.clone().raw()._iterate((function(t,e){_=e.primaryKey;var i={primKey:e.primaryKey,value:t,onsuccess:null,onerror:null};function r(t){return m.push(t),y.push(i.primKey),E(),!0}if(!1!==l.call(i,t,i)){var n=!T(i,"value");++p,k((function(){var t=n?e.delete():e.update(i.value);t._hookCtx=i,t.onerror=re(r),t.onsuccess=ee((function(){++f,E()}))}),r)}else i.onsuccess&&i.onsuccess(i.value)}),(function(){g=!0,E()}),b,o)}))},delete:function(){var t=this,e=this._ctx,i=e.range,r=e.table.hook.deleting.fire,n=r!==a;if(!n&&Et(e)&&(e.isPrimKey&&!qt||!i))return this._write((function(t,e,r){var n=ie(e),s=i?r.count(i):r.count();s.onerror=n,s.onsuccess=function(){var o=s.result;k((function(){var e=i?r.delete(i):r.clear();e.onerror=n,e.onsuccess=function(){return t(o)}}),(function(t){return e(t)}))}}));var s=n?2e3:1e4;return this._write((function(i,o,a,h){var l=0,c=t.clone({keysOnly:!e.isMatch&&!n}).distinct().limit(s).raw(),u=[],d=function(){return c.each(n?function(t,e){u.push([e.primaryKey,e.value])}:function(t,e){u.push(e.primaryKey)}).then((function(){return n?u.sort((function(t,e){return Mt(t[0],e[0])})):u.sort(Mt),yt(a,h,u,n,r)})).then((function(){var t=u.length;return l+=t,u=[],t<s?l:d()}))};i(d())}))}}),x(this,{Collection:Tt,Table:ft,Transaction:xt,Version:ht,WhereClause:_t,WriteableCollection:wt,WriteableTable:gt}),et.on("versionchange",(function(t){t.newVersion>0?console.warn("Another connection wants to upgrade database '"+et.name+"'. Closing db now to resume the upgrade."):console.warn("Another connection wants to delete database '"+et.name+"'. Closing db now to resume the delete request."),et.close()})),et.on("blocked",(function(t){!t.newVersion||t.newVersion<t.oldVersion?console.warn("Dexie.delete('"+et.name+"') was blocked"):console.warn("Upgrade '"+et.name+"' blocked by other connection holding version "+t.oldVersion/10)})),y.forEach((function(t){t(et)}))}i(e,Xt);var Qt=function(){},Zt=!1;function $t(t){if("function"==typeof t)return new t;if(m(t))return[$t(t[0])];if(t&&"object"==typeof t){var e={};return Jt(e,t),e}return t}function Jt(t,e){return v(e).forEach((function(i){var r=$t(e[i]);t[i]=r})),t}function te(t){return function(e){t(e.target.result)}}function ee(t){return Lt((function(e){var i=e.target,r=i.result,n=i._hookCtx,s=n&&n.onsuccess;s&&s(r),t&&t(r)}),t)}function ie(t){return function(e){return ne(e),t(e.target.error),!1}}function re(t){return Lt((function(e){var i=e.target,r=i.error,n=i._hookCtx,s=n&&n.onerror;return s&&s(r),ne(e),t(r),!1}))}function ne(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}function se(t){var e,i=Yt.dependencies.localStorage;if(!i)return t([]);try{e=JSON.parse(i.getItem("Dexie.DatabaseNames")||"[]")}catch(t){e=[]}t(e)&&i.setItem("Dexie.DatabaseNames",JSON.stringify(e))}function oe(t){var e=function(e){return t.next(e)},i=n(e),r=n((function(e){return t.throw(e)}));function n(t){return function(e){var n=t(e),s=n.value;return n.done?s:s&&"function"==typeof s.then?s.then(i,r):m(s)?bt.all(s).then(i,r):i(s)}}return n(e)()}function ae(t,e,i,r,n,s,o){this.name=t,this.keyPath=e,this.unique=i,this.multi=r,this.auto=n,this.compound=s,this.dotted=o;var a="string"==typeof e?e:e&&"["+[].join.call(e,"+")+"]";this.src=(i?"&":"")+(r?"*":"")+(n?"++":"")+a}function he(t,e,i,r){this.name=t,this.primKey=e||new ae,this.indexes=i||[new ae],this.instanceTemplate=r,this.mappedClass=null,this.idxByName=N(i,(function(t){return[t.name,t]}))}var le=y.idbModules&&y.idbModules.shimIndexedDB?y.idbModules:{};function ce(t){return 1===t.length?t[0]:t}function ue(t){var e=t&&(t.getDatabaseNames||t.webkitGetDatabaseNames);return e&&e.bind(t)}return E(Yt,st),E(Yt,{delete:function(t){var e=new Yt(t),i=e.delete();return i.onblocked=function(t){return e.on("blocked",t),this},i},exists:function(t){return new Yt(t).open().then((function(t){return t.close(),!0})).catch(Yt.NoSuchDatabaseError,(function(){return!1}))},getDatabaseNames:function(t){return new bt((function(t,e){var i=ue(indexedDB);if(i){var r=i();r.onsuccess=function(e){t(D(e.target.result,0))},r.onerror=ie(e)}else se((function(e){return t(e),!1}))})).then(t)},defineClass:function(t){return function(e){e?x(this,e):Zt&&Jt(this,t)}},applyStructure:Jt,ignoreTransaction:function(t){return mt.trans?Ft(mt.transless,t):t()},vip:function(t){return kt((function(){return mt.letThrough=!0,t()}))},async:function(t){return function(){try{var e=oe(t.apply(this,arguments));return e&&"function"==typeof e.then?e:bt.resolve(e)}catch(t){return F(t)}}},spawn:function(t,e,i){try{var r=oe(t.apply(i,e||[]));return r&&"function"==typeof r.then?r:bt.resolve(r)}catch(t){return F(t)}},currentTransaction:{get:function(){return mt.trans||null}},Promise:bt,debug:{get:function(){return e},set:function(t){i(t,"dexie"===t?function(){return!0}:Xt)}},derive:A,extend:x,props:E,override:M,Events:ot,events:ot,getByKeyPath:B,setByKeyPath:U,delByKeyPath:function(t,e){"string"==typeof e?U(t,e,void 0):"length"in e&&[].map.call(e,(function(e){U(t,e,void 0)}))},shallowClone:V,deepClone:j,getObjectDiff:H,asap:I,maxKey:jt,addons:[],connections:Kt,MultiModifyError:rt.Modify,errnames:et,IndexSpec:ae,TableSchema:he,dependencies:{indexedDB:le.shimIndexedDB||y.indexedDB||y.mozIndexedDB||y.webkitIndexedDB||y.msIndexedDB,IDBKeyRange:le.IDBKeyRange||y.IDBKeyRange||y.webkitIDBKeyRange},semVer:Ut,version:Ut.split(".").map((function(t){return parseInt(t)})).reduce((function(t,e,i){return t+e/Math.pow(10,2*i)})),fakeAutoComplete:Qt,default:Yt}),k((function(){Yt.dependencies.localStorage=null!=("undefined"!=typeof chrome&&null!==chrome?chrome.storage:void 0)?null:y.localStorage})),bt.rejectionMapper=function(t,e){if(!t||t instanceof $||t instanceof TypeError||t instanceof SyntaxError||!t.name||!nt[t.name])return t;var i=new nt[t.name](e||t.message,t);return"stack"in t&&w(i,"stack",{get:function(){return this.inner.stack}}),i},R((function(){Yt.fakeAutoComplete=Qt=R,Yt.fake=Zt=!0})),Yt}));var at=e(ot);class ht extends at{constructor(){super("YendorDb"),this.version(1).stores({data:"key, value"})}loadFromKey(t,e){return new Promise((i=>{console.log("loading "+t+" from indexedDb..."),this.data.get(t).then((t=>{let r=t&&t.value?st.json2Object(t.value,e):void 0;i(r)}))}))}saveToKey(t,e){return new Promise((i=>{this.data.put({key:t,value:st.object2Json(e)}).then((t=>{i()}))}))}deleteKey(t){return new Promise((e=>{console.log("deleting "+t+" from indexedDb..."),this.data.delete(t).then((t=>{e()}))}))}}const lt="open",ct="openNodes";let ut;var dt;let pt;var ft;let gt;var vt;let mt;var yt;(dt=ut||(ut={}))[dt.COMPOSITE=1]="COMPOSITE",dt[dt.DECORATOR=2]="DECORATOR",dt[dt.ACTION=3]="ACTION",dt[dt.CONDITION=4]="CONDITION",(ft=pt||(pt={}))[ft.SUCCESS=1]="SUCCESS",ft[ft.FAILURE=2]="FAILURE",ft[ft.RUNNING=3]="RUNNING",ft[ft.ERROR=4]="ERROR",(vt=gt||(gt={}))[vt.GLOBAL=1]="GLOBAL",vt[vt.TREE=2]="TREE",vt[vt.NODE=3]="NODE",(yt=mt||(mt={}))[yt.LESSER=0]="LESSER",yt[yt.LESSER_OR_EQUAL=1]="LESSER_OR_EQUAL",yt[yt.EQUAL=2]="EQUAL",yt[yt.NOT_EQUAL=3]="NOT_EQUAL",yt[yt.GREATER=4]="GREATER",yt[yt.GREATER_OR_EQUAL=5]="GREATER_OR_EQUAL";class xt{globalCtx={};treeCtx={};set(t,e,i,r){void 0===i&&void 0===r?this.globalCtx[t]=e:void 0===r?this.getTreeDictionnary(i)[t]=e:this.getNodeDictionnary(i,r)[t]=e}get(t,e,i){return void 0===e&&void 0===i?this.globalCtx[t]:void 0===i?this.getTreeDictionnary(e)[t]:this.getNodeDictionnary(e,i)[t]}getTreeDictionnary(t){let e=this.treeCtx[t];return void 0===e&&(e={nodeDictionnaries:[],openNodes:[],traversalDepth:0,traversalCycle:0},this.treeCtx[t]=e),e}getNodeDictionnary(t,e){let i=this.getTreeDictionnary(t),r=i.nodeDictionnaries[e];return void 0===r&&(r={},i.nodeDictionnaries[e]=r),r}}class _t{_nodeCount=0;_openNodes=[];get openNodes(){return this._openNodes}get nodeCount(){return this._nodeCount}get context(){return this._context}get tree(){return this._tree}constructor(t,e,i){if(this._tree=t,this._context=e,this.userData=i,!e)throw new Error("Cannot construct!")}enterNode(t){}isOpen(t){return!0===this._context.get(lt,this._tree.id,t.id)}openNode(t){this._nodeCount++,this._openNodes.push(t),this._context.set(lt,!0,this._tree.id,t.id)}tickNode(t){}closeNode(t){this._openNodes.pop(),this._context.set(lt,!1,this._tree.id,t.id)}exitNode(t){}}class bt extends M{static seq=0;constructor(t){super(),this.category=t,this.id=bt.seq++}execute(t){this._enter(t),t.isOpen(this)||this._open(t);let e=this._tick(t);return e!==pt.RUNNING&&this._close(t),this._exit(t),e}_close(t){t.closeNode(this),this.close(t)}enter(t){}open(t){}close(t){}exit(t){}_enter(t){t.enterNode(this),this.enter(t)}_open(t){t.openNode(this),this.open(t)}_tick(t){return t.tickNode(this),this.tick(t)}_exit(t){t.exitNode(this),this.exit(t)}}class Tt{static seq=0;constructor(t,e){this.name=t,this.root=e,this.id=Tt.seq++}tick(t,e){let i=new _t(this,t,e),r=this.root.execute(i),n=t.get(ct,this.id),s=i.openNodes.slice(0),o=0;for(let t=0;t<Math.min(n.length,s.length)&&(o=t+1,n[t]===s[t]);++t);for(let t=n.length-1;t>=o;--t)n[t]._close(i);return t.set(ct,s,this.id),t.set("nodeCount",i.nodeCount,this.id),r}}class Et extends bt{constructor(){super(ut.COMPOSITE)}}class wt extends bt{constructor(){super(ut.DECORATOR)}tick(t){return 1!==this.children.length?(console.log("ERROR : "+this.constructor.name+" should have only one child"),pt.ERROR):this.internalTick(t)}}class At extends bt{constructor(){super(ut.CONDITION)}}class Ct extends bt{constructor(){super(ut.ACTION)}}class St extends Ct{tick(t){return pt.ERROR}}class Ot extends Ct{tick(t){return pt.FAILURE}}class Dt extends Ct{tick(t){return pt.RUNNING}}class Mt extends Ct{tick(t){return pt.SUCCESS}}class Rt extends Ct{constructor(t){super(),this.tickCount=t}tick(t){return this.tickCount--,this.tickCount<=0?pt.SUCCESS:pt.RUNNING}}class Pt extends Et{constructor(t){if(super(),t)for(let e of t)this.addChild(e)}tick(t){for(let e of this.children){let i=e.execute(t);if(i!==pt.FAILURE)return i}return pt.FAILURE}}class It extends Et{constructor(t){if(super(),t)for(let e of t)this.addChild(e)}tick(t){for(let e of this.children){let i=e.execute(t);if(i!==pt.SUCCESS)return i}return pt.SUCCESS}}const Nt="runningChild";class Lt extends Et{open(t){t.context.set(Nt,0,t.tree.id,this.id)}tick(t){let e=t.context.get(Nt,t.tree.id,this.id);for(;e<this.children.length;){let i=this.children[e].execute(t);if(i!==pt.FAILURE)return i===pt.RUNNING&&t.context.set(Nt,e,t.tree.id,this.id),i;e++}return pt.FAILURE}}class kt extends Et{open(t){t.context.set(Nt,0,t.tree.id,this.id)}tick(t){let e=t.context.get(Nt,t.tree.id,this.id);for(;e<this.children.length;){let i=this.children[e].execute(t);if(i!==pt.SUCCESS)return i===pt.RUNNING&&t.context.set(Nt,e,t.tree.id,this.id),i;e++}return pt.SUCCESS}}class Ft extends wt{constructor(t){super(),t&&this.addChild(t)}internalTick(t){let e=this.children[0].execute(t);return e===pt.SUCCESS?pt.FAILURE:e===pt.FAILURE?pt.SUCCESS:e}}const Bt="tickCount";class Ut extends wt{constructor(t,e){super(),this.maxTicks=t,e&&this.addChild(e)}open(t){t.context.set(Bt,0,t.tree.id,this.id)}internalTick(t){let e=t.context.get(Bt,t.tree.id,this.id);return e<this.maxTicks?(t.context.set(Bt,e+1,t.tree.id,this.id),this.children[0].execute(t)):pt.FAILURE}}class Vt extends wt{constructor(t,e,i,r,n){super(),this.contextKey=t,this.contextLevel=e,this.value=i,this.operator=r,n&&this.addChild(n)}internalTick(t){let e;switch(this.contextLevel){default:case gt.GLOBAL:e=t.context.get(this.contextKey);break;case gt.TREE:e=t.context.get(this.contextKey,t.tree.id);break;case gt.NODE:e=t.context.get(this.contextKey,t.tree.id,this.id)}return this.valueMatches(e,this.value,this.operator)?this.children[0].execute(t):pt.FAILURE}valueMatches(t,e,i){if(void 0===e&&void 0===i)return void 0!==t;if(void 0===i)return t===e;switch(i){default:case mt.EQUAL:return t===e;case mt.NOT_EQUAL:return t!==e;case mt.GREATER:return t>e;case mt.GREATER_OR_EQUAL:return t>=e;case mt.LESSER:return t<e;case mt.LESSER_OR_EQUAL:return t<=e}}}let jt,Ht,Wt;new Function("try {return this===window;}catch(e){ return false;}");function Kt(){Ht=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60,(new Date).getTime())},jt=function(){let t=window.location.search.substring(1).split("&"),e={};for(let i of t){let t=i.split("=");2===t.length&&(e[t[0]]=decodeURIComponent(t[1].replace(/\+/g," ")))}return e}()}function Gt(t){Ht(Gt),Wt(t)}nt.registerClass(O),nt.registerClass(D),nt.registerClass(bt),nt.registerClass(At),nt.registerClass(Et),nt.registerClass(Ct),nt.registerClass(wt),nt.registerClass(xt),nt.registerClass(Tt),nt.registerClass(_t),nt.registerClass(Pt),nt.registerClass(It),nt.registerClass(kt),nt.registerClass(Lt),nt.registerClass(St),nt.registerClass(Ot),nt.registerClass(Dt),nt.registerClass(Mt),nt.registerClass(Rt),nt.registerClass(Ft),nt.registerClass(Ut);class zt extends F{constructor(){super(),this._expand=P.BOTH}}class qt{static runScene(t){qt.currentScene&&qt.currentScene.termHierarchy(),qt.currentScene=t,t.initHierarchy(),jt.debug&&(t.computeBoundingBox(),t.expand(be.getConsole().width,be.getConsole().height),t.logSceneGraph())}static getRunningScene(){return qt.currentScene}static pushScene(){qt.sceneStack.push(qt.currentScene)}static popScene(){qt.currentScene&&qt.currentScene.onTerm();let t=qt.sceneStack.pop();if(t)return qt.currentScene=t,qt.currentScene.onInit(),qt.currentScene;Ee.critical("Cannot pop the last scene")}static sceneStack=[]}let Xt,Yt={},Qt={},Zt={},$t={};function Jt(t,e){let i=e?1:0,r=$t[t];r&&(r.rawValue=i,r.pressed=e,r.released=!e,e&&(Xt=r.name))}function te(t,e){let i=e?1:0,r=Qt[t];r&&(r.rawValue=i,r.pressed=e,r.released=!e,e&&(Xt=r.name))}function ee(t,e){"string"==typeof t?(Ee.debug("   Umbra.Input : ascii button "+t),Zt[t.charCodeAt(0)]=e):"MouseButtonEnum"==typeof t?(Ee.debug("   Umbra.Input : mouse button "+t),$t[t]=e):(Ee.debug("   Umbra.Input : key button "+t),Qt[t]=e)}function ie(t){let e={altNegativeButton:t.altNegativeButton,altPositiveButton:t.altPositiveButton,deadZone:t.deadZone,gravity:t.gravity,invert:t.invert,name:t.name,negativeButton:t.negativeButton,negativeDescription:t.negativeDescription,positiveButton:t.positiveButton,positiveDescription:t.positiveDescription,rawValue:0,sensitivity:t.sensitivity,snap:t.snap,type:t.type,value:0};Yt[e.name]=e,Ee.debug("Umbra.Input : new axis "+e.name+" type "+e.type),e.altNegativeButton&&ee(e.altNegativeButton,e),e.altPositiveButton&&ee(e.altPositiveButton,e),e.positiveButton&&ee(e.positiveButton,e),e.negativeButton&&ee(e.negativeButton,e)}class re{static registerEventListener(t,e){re.listeners[e]||(re.listeners[e]=new Array),re.addListener(t,re.listeners[e])}static unregisterEventListener(t,e){if(re.listeners[e]){let i=re.listeners[e].indexOf(t);i>-1&&re.listeners[e].splice(i,1)}}static publishEvent(t,e){if(re.listeners[t])for(let i of re.listeners[t])re.processEvent(t,i,e)}static processEvent(t,e,i){let r=re.eventTypeToCallback(t),n=e[r];n&&"function"==typeof n?void 0!==i?n.call(e,i):n.call(e):t===v?console.log("Warning : object type "+(e.className||"unknown")+" does not implement handler "+r+" for event "+t):Ee.warn("Warning : object type "+(e.className||"unknown")+" does not implement handler "+r+" for event "+t)}static eventTypeToCallback(t){return"on"+t.toLowerCase().replace(/(\b|_)\w/g,(function(t){return t.toUpperCase().replace(/_/,"")}))}static listeners={};static addListener(t,e){let i=0;if(t.node){let r=e.length;do{let r=e[i].node;if(r&&r.getZOrder()<=t.node.getZOrder())break;i++}while(i<r)}e.splice(i-1,0,t)}}let ne,se={buttons:[],cellPos:new O,hasMoved:!1,pixelPos:new O},oe={},ae={},he=new O,le=new O;function ce(){return se.cellPos}function ue(t){return!!se.buttons[t]&&se.buttons[t].released}function de(){for(let t=0,e=se.buttons.length;t<e;++t)se.buttons[t]&&(se.buttons[t].pressed=!1,se.buttons[t].released=!1);for(let t in oe)oe.hasOwnProperty(t)&&(oe[t].pressed=!1,oe[t].released=!1);for(let t in ae)ae.hasOwnProperty(t)&&(ae[t]=!1);!function(){for(let t in Yt)Yt.hasOwnProperty(t)&&(Yt[t].pressed&&(Yt[t].pressed=!1),Yt[t].released&&(Yt[t].released=!1));for(let t in Zt)Zt.hasOwnProperty(t)&&(Zt[t].rawValue=0);Xt=void 0}(),se.hasMoved=!1}function pe(t){var e;se.buttons[t.which]?(se.buttons[t.which].pressed=!0,se.buttons[t.which].released=!1,se.buttons[t.which].status=!0):se.buttons[t.which]={pressed:!0,released:!1,status:!0},he.set(se.pixelPos),le.set(se.cellPos),e=b.LEFT,se.buttons[e]&&se.buttons[e].status&&re.publishEvent(m,{startCellPos:le,startPos:he}),Jt(t.which,!0)}function fe(t){se.buttons[t.which]?(se.buttons[t.which].pressed=!1,se.buttons[t.which].released=!0,se.buttons[t.which].status=!1):se.buttons[t.which]={pressed:!1,released:!0,status:!1},se.pixelPos.equals(he)?re.publishEvent(y):re.publishEvent(x,{startCellPos:le,startPos:he}),Jt(t.which,!1)}function ge(t){ae[t.charCode]=!0,function(t){let e=Zt[t];e&&(e.rawValue=1,e.pressed=!0,e.released=!1,Xt=e.name)}(t.charCode)}function ve(t){oe[t.keyCode]?(oe[t.keyCode].pressed=!0,oe[t.keyCode].released=!1,oe[t.keyCode].status=!0):oe[t.keyCode]={pressed:!0,released:!1,status:!0},te(t.keyCode,!0),t.preventDefault()}function me(t){oe[t.keyCode]?(oe[t.keyCode].pressed=!1,oe[t.keyCode].released=!0,oe[t.keyCode].status=!1):oe[t.keyCode]={pressed:!1,released:!0,status:!1},te(t.keyCode,!1),t.preventDefault()}class ye{static DEFAULT_OPTIONS={consoleHeight:34,consoleWidth:80,defaultBackgroundColor:d,defaultForegroundColor:p,fontFileName:g,renderDivSelector:f,ticksPerSecond:10};_gameTime=0;_elapsedTime=0;paused=!1;dirtyFrame=!0;getConsole(){return this.console}get gameTime(){return this._gameTime}get elapsedTime(){return this._elapsedTime}run(t,e=ye.DEFAULT_OPTIONS){var i,r,s,o,a,h;n(window).focus(this.onGainFocus.bind(this)),n(window).blur(this.onLoseFocus.bind(this)),this.options={backgroundAnimation:e.backgroundAnimation||false,consoleHeight:e.consoleHeight?e.consoleHeight:34,consoleWidth:e.consoleWidth?e.consoleWidth:80,defaultBackgroundColor:e.defaultBackgroundColor||d,defaultForegroundColor:e.defaultForegroundColor||p,fontFileName:e.fontFileName?e.fontFileName:g,renderDivSelector:e.renderDivSelector?e.renderDivSelector:f,ticksPerSecond:e.ticksPerSecond?e.ticksPerSecond:10},jt.font&&(this.options.fontFileName=jt.font),this.dirtyFrame=!0,this.tickLength=1/(this.options.ticksPerSecond||1),this.console=(i=this.options.consoleWidth||80,r=this.options.consoleHeight||34,s=this.options.defaultForegroundColor||p,o=this.options.defaultBackgroundColor||d,a=this.options.renderDivSelector||f,h=this.options.fontFileName||g,"yendor/div"===jt.renderer?new z(i,r,s,o,new Y(a)):new z(i,r,s,o,new X(s,o,a,h,jt.renderer))),qt.runScene(t),Wt=t=>this.onNewFrame(t),Ht(Gt)}onLoseFocus(){this.paused=!0}onGainFocus(){this.paused=!1,de()}onNewFrame(t){try{this._elapsedTime=t-this._gameTime;let e=qt.getRunningScene();this._elapsedTime>=this.tickLength&&(this._gameTime=t,this.paused||(e.updateHierarchy(t),e.computeBoundingBox(),e.expand(this.console.width,this.console.height),de(),this.dirtyFrame=!0)),!this.paused&&this.dirtyFrame&&(e.renderHierarchy(this.console),this.console.render(),this.options.backgroundAnimation||(this.dirtyFrame=!1))}catch(t){console.log(t.stack),Ee.critical(t.fileName+":"+t.lineNumber+"\n"+t.message)}}}var xe;(xe=ne||(ne={}))[xe.DEBUG=1]="DEBUG",xe[xe.INFO=2]="INFO",xe[xe.WARN=3]="WARN",xe[xe.ERROR=4]="ERROR",xe[xe.CRITICAL=5]="CRITICAL";class _e{static colors=["#CCCCCC","#000000","#FFDD66","#FF3333","#FF0000"];enableEvents=!0;onLog(t){console.log("%c"+t.text,"color:"+_e.colors[t.level])}}let be,Te,Ee=new class extends class{debug(t){this.isDebugEnabled()&&this.log(ne.DEBUG,t)}info(t){this.log(ne.INFO,t)}warn(t){this.log(ne.WARN,t)}error(t){this.log(ne.ERROR,t)}critical(t){this.log(ne.CRITICAL,t)}isDebugEnabled(){return jt&&void 0!==jt.debug}}{log(t,e){re.publishEvent(v,{level:t,text:e})}};function we(t){return Kt(),re.registerEventListener(new _e,v),be=t,t&&(n(document).keydown(ve),n(document).keypress(ge),n(document).keyup(me),n(document).mousemove((t=>function(t,e){se.pixelPos.x=t.pageX,se.pixelPos.y=t.pageY,e&&e.getPositionFromPixels(t.pageX,t.pageY,se.cellPos),se.hasMoved=!0}(t,be.getConsole()))),n(document).mousedown(pe),n(document).mouseup(fe)),be}var Ae;let Ce,Se;function Oe(){return Ce}function De(t,e,i,r,n=!1){let s=be.getConsole().height-1;if(i<0||i>s)return;let o=be.getConsole().width-1;e+r>o&&(r=o-e),e<0&&(r+=e,e=0),Me(t,e,i,r,n)}function Me(t,e,i,r,n=!1){let s=be.getConsole().width-1,o=be.getConsole().height-1,a=[],h=[];if(n)for(let n=e;n<e+r;++n)(t.text[n][i]===W||t.text[n][i]===G||t.text[n][i]===H||t.text[n][i]===j||t.text[n][i]===V||i>0&&t.text[n][i-1]===V)&&(a[n-e]=!0),(t.text[n][i]===K||t.text[n][i]===G||t.text[n][i]===H||t.text[n][i]===j||t.text[n][i]===V||i<o&&t.text[n][i+1]===V)&&(h[n-e]=!0);for(let s=e;s<e+r;++s){let r=s-e;n?a[r]&&h[r]?t.text[s][i]=G:a[r]?t.text[s][i]=W:h[r]?t.text[s][i]=K:t.text[s][i]=U:t.text[s][i]=U}n&&(e-1>=0&&e-1<=s&&(t.text[e-1][i]===j?t.text[e-1][i]=G:t.text[e-1][i]===V&&(t.text[e-1][i]=H)),e+r>=0&&e+r<=s&&(t.text[e+r][i]===H?t.text[e+r][i]=G:t.text[e+r][i]===V&&(t.text[e+r][i]=j)))}function Re(t,e,i,r,n=!1){let s=be.getConsole().width-1,o=be.getConsole().height-1,a=[],h=[];if(n)for(let n=i;n<i+r;++n)(t.text[e][n]===j||t.text[e][n]===G||t.text[e][n]===W||t.text[e][n]===K||t.text[e][n]===U||e>0&&t.text[e-1][n]===U)&&(a[n-i]=!0),(t.text[e][n]===H||t.text[e][n]===G||t.text[e][n]===W||t.text[e][n]===K||t.text[e][n]===U||e<s&&t.text[e+1][n]===U)&&(h[n-i]=!0);for(let s=i;s<i+r;++s){let r=s-i;n?a[r]&&h[r]?t.text[e][s]=G:a[r]?t.text[e][s]=j:h[r]?t.text[e][s]=H:t.text[e][s]=V:t.text[e][s]=V}n&&(i-1>=0&&i-1<=o&&(t.text[e][i-1]===W?t.text[e][i-1]=G:t.text[e][i-1]===U&&(t.text[e][i-1]=K)),i+r>=0&&i+r<=o&&(t.text[e][i+r]===K?t.text[e][i+r]=G:t.text[e][i+r]===U&&(t.text[e][i+r]=W)))}function Pe(t,e){return t>=0&&e>=0&&t<be.getConsole().width&&e<be.getConsole().height}function Ie(t,e,i,r,n,s){if(t.clearBack(Oe().color.background,e,i,r,n),t.clearFore(Oe().color.foregroundDisabled,e,i,r,n),t.clearText(32,e+1,i+1,r-2,n-2),function(t,e,i,r,n){let s=be.getConsole().width,o=be.getConsole().height;e+r<=0||e>s||i+n<=0||i>o||(e+r>s&&(r=s-e),e<0&&(r+=e,e=0),i+n>o&&(n=o-i),i<0&&(n+=i,i=0),Pe(e,i)&&(t.text[e][i]=218),Pe(e+r-1,i)&&(t.text[e+r-1][i]=191),Pe(e,i+n-1)&&(t.text[e][i+n-1]=192),Pe(e+r-1,i+n-1)&&(t.text[e+r-1][i+n-1]=217),Me(t,e+1,i,r-2),Me(t,e+1,i+n-1,r-2),Re(t,e,i+1,n-2),Re(t,e+r-1,i+1,n-2))}(t,e,i,r,n),s){let n=s.length,o=e+Math.floor((r-n)/2);Pe(o-1,i)&&(t.text[o-1][i]=j),Pe(o+n,i)&&(t.text[o+n][i]=H),t.print(o,i,s,Oe().color.titleForeground)}}var Ne;(Ae=Te||(Te={}))[Ae.MODAL_SHOW=1]="MODAL_SHOW",Ae[Ae.MODAL_HIDE=2]="MODAL_HIDE",(Ne=Se||(Se={}))[Ne.LEFT=1]="LEFT",Ne[Ne.RIGHT=2]="RIGHT",Ne[Ne.CENTER=3]="CENTER";class Le extends F{static getActiveModal(){return Le.activeModal}static modalStack=[];enableEvents=!0;modal=!1;constructor(){super(),this.setZOrder(1)}isModal(){return this.modal||void 0!==this.__parent&&void 0!==this.__parent.isModal&&this.__parent.isModal()}isActive(){return void 0===Le.activeModal||this.modal&&this===Le.activeModal||void 0!==this.__parent&&void 0!==this.__parent.isActive&&this.__parent.isActive()}show(){this.modal&&(Le.activeModal&&Le.modalStack.push(Le.activeModal),Le.activeModal=this,re.publishEvent(Te[Te.MODAL_SHOW],this)),super.show()}hide(){this.modal&&(Le.activeModal=Le.modalStack.pop(),re.publishEvent(Te[Te.MODAL_HIDE],this)),super.hide()}onTerm(){super.onTerm(),this.showEventType&&re.unregisterEventListener(this,this.showEventType)}showOnEventType(t,e){re.registerEventListener(this,t),this.showEventType=t,this[re.eventTypeToCallback(t)]=function(t){this.show(),e&&e(t)}.bind(this)}setModal(){this.modal=!0}}class ke extends Le{constructor(){super()}init(t,e){this.boundingBox=new D(0,0,t,e),this.__console=new z(t,e)}get console(){return this.__console}resize(t,e){super.resize(t,e),this.__console=new z(t,e)}onRender(t){let e=new O;this.local2Abs(e),this.__console.blit(t,e.x,e.y)}}class Fe extends Le{constructor(t){super(),this.label=t,this.boundingBox.h=1}onRender(t){let e=new O(0,this.boundingBox.y);this.__parent.local2Abs(e);let i=this.getParentBoundingBox(),r=i?i.w:0;if(t.clearBack(Oe().color.background,e.x,e.y,r,1),t.clearFore(Oe().color.foregroundDisabled,e.x,e.y,r,1),De(t,e.x,e.y,r,!0),this.label){let i=this.label.length,n=e.x+Math.floor((r-i)/2);Pe(n-1,e.y)&&(t.text[n-1][e.y]=j),Pe(n+i,e.y)&&(t.text[n+i][e.y]=H),t.print(n,e.y,this.label,Oe().color.titleForeground)}}computeBoundingBox(){this.boundingBox.w=this.label?this.label.length+2:0,this.boundingBox.h=1}}class Be extends Le{constructor(t){super(),this.options=t,void 0!==t.expand&&(this._expand=t.expand)}getOptions(){return this.options}computeBoundingBox(){super.computeBoundingBox(),this.options.minWidth&&this.boundingBox.w<this.options.minWidth&&(this.boundingBox.w=this.options.minWidth),this.options.minHeight&&this.boundingBox.h<this.options.minHeight&&(this.boundingBox.h=this.options.minHeight)}}class Ue extends Be{static isDragging(){return void 0!==Ue.drag}static resetDrag(){Ue.drag=void 0}static get draggedWidget(){return Ue.drag}static startDrag=new O;static dragPos=new D;static dragPixelPos=new D;constructor(t){super(t),void 0===this._expand&&(this._expand=P.BOTH)}getDragPos(){return this===Ue.drag?Ue.dragPos:this.boundingBox}getDragPixelPos(){if(this===Ue.drag)return Ue.dragPixelPos}onInit(){super.onInit(),re.registerEventListener(this,m),re.registerEventListener(this,y),re.registerEventListener(this,x)}onTerm(){re.unregisterEventListener(this,m),re.unregisterEventListener(this,y),re.unregisterEventListener(this,x),super.onTerm()}onStartDrag(t){if(this.isVisible()&&this.isActive()&&this.containsAbsolute(ce())){Ue.drag=this,Ue.dragZOrder=this.getZOrder(),Ue.startDrag.set(ce()),Ue.dragPos.set(this.boundingBox),this.setZOrder(1e3),de();let t=this.getOptions().startDragCallback;t&&t(this,this.getOptions().data)}}onEndDrag(t){if(this===Ue.drag){de();let e=this.getOptions().endDragCallback;e&&e(this,this.getOptions().data),this.onCancelDrag(t),re.publishEvent(_,this)}}onCancelDrag(t){this===Ue.drag&&(this.setZOrder(Ue.dragZOrder),Ue.drag=void 0)}onPreRender(){this.swapDragAndBox()}onPostRender(){this.swapDragAndBox()}onUpdate(t){if(Ue.drag===this){let t=ce().clone();Ue.dragPos.x=t.x+this.boundingBox.x-Ue.startDrag.x,Ue.dragPos.y=t.y+this.boundingBox.y-Ue.startDrag.y;let e=be.getConsole().width-this.boundingBox.w,i=be.getConsole().height-this.boundingBox.h,r=new O(-this.boundingBox.x,-this.boundingBox.y);this.local2Abs(r),Ue.dragPos.x=L(Ue.dragPos.x,-r.x,e-r.x),Ue.dragPos.y=L(Ue.dragPos.y,-r.y,i-r.y),void 0!==this.options.minDragX&&Ue.dragPos.x<this.options.minDragX?Ue.dragPos.x=this.options.minDragX:void 0!==this.options.maxDragX&&Ue.dragPos.x>this.options.maxDragX&&(Ue.dragPos.x=this.options.maxDragX),void 0!==this.options.minDragY&&Ue.dragPos.y<this.options.minDragY?Ue.dragPos.y=this.options.minDragY:void 0!==this.options.maxDragY&&Ue.dragPos.y>this.options.maxDragY&&(Ue.dragPos.y=this.options.maxDragY);let n=se.pixelPos;Ue.dragPixelPos.x=n.x,Ue.dragPixelPos.y=n.y}}swapDragAndBox(){if(Ue.drag===this){let t=this.boundingBox;this.boundingBox=Ue.dragPos,Ue.dragPos=t}}}class Ve extends Be{constructor(t){super(t),void 0===this._expand&&(this._expand=P.BOTH)}onInit(){super.onInit(),re.registerEventListener(this,_)}onTerm(){re.unregisterEventListener(this,_),super.onTerm()}onDrop(t){this.isVisible()&&this.isActive()&&!this.contains(t)&&this.containsAbsolute(ce())&&this.options.dropCallback&&this.options.dropCallback(t,this,this.options.data)}onPostRender(t){if(Ue.isDragging()&&this.isActive()){let e=new O(this.boundingBox.x,this.boundingBox.y);this.__parent.local2Abs(e),t.clearBack(Oe().color.backgroundActive,e.x,e.y,this.boundingBox.w,this.boundingBox.h)}}}class je extends Be{constructor(t){super(t),void 0===this._expand&&(this._expand=P.HORIZONTAL)}toString(){return this.constructor.name+"("+this.options.label+"):"+this.boundingBox.toString()}onRender(t){let e=new O(this.boundingBox.x,this.boundingBox.y);this.__parent.local2Abs(e),this.renderWithColor(t,e,Oe().color.foregroundDisabled,Oe().color.background),this.options.postRender&&this.options.postRender(t,e.x,e.y,this.options,!1)}computeBoundingBox(){this.boundingBox.w=this.options.label.length,this.boundingBox.h=1}renderWithColor(t,e,i,r){t.clearBack(r,e.x,e.y,this.boundingBox.w,this.boundingBox.h),t.clearText(32,e.x,e.y,this.boundingBox.w,this.boundingBox.h);let n=0;switch(this.options.textAlign){case Se.RIGHT:n=this.boundingBox.w-this.options.label.length;break;case Se.CENTER:n=Math.floor((this.boundingBox.w-this.options.label.length)/2)}t.print(e.x+n,e.y,this.options.label,i)}}class He extends je{constructor(t){super(t)}onRender(t){let e=new O(this.boundingBox.x,this.boundingBox.y);this.__parent.local2Abs(e),this.active=this.isActive()&&this.containsAbsolute(ce()),this.renderWithColor(t,e,this.active?Oe().color.foregroundActive:Oe().color.foreground,this.active?Oe().color.backgroundActive:Oe().color.background),this.options.postRender&&this.options.postRender(t,e.x,e.y,this.options,this.active)}onUpdate(t){if(this.active=this.isActive()&&this.containsAbsolute(ce()),this.pressed=this.active&&ue(b.LEFT),this.pressed||this.options.asciiShortcut&&("string"==typeof(e=this.options.asciiShortcut)?ae[e.charCodeAt(0)]:ae[e])){de();let t=!0;this.options.callback&&(t=this.options.callback(this.options.eventData)),t&&(this.options.autoHideWidget&&this.options.autoHideWidget.hide(),this.options.eventType&&re.publishEvent(this.options.eventType,this.options?this.options.eventData:void 0))}var e}}class We extends Be{constructor(t){super(t),void 0===t.minWidth&&(this.options.minWidth=10),this.options.minHeight=1}getValue(){return this.value}setValue(t){this.value=t,this.value=L(this.value,this.options.minValue,this.options.maxValue);let e=Math.floor((this.boundingBox.w-1)*(this.value-this.options.minValue)/(this.options.maxValue-this.options.minValue));this.draggable.moveTo(e,this.draggable.getBoundingBox().y),this.setSliderCharacter()}onInit(){this.dragButton=new He({expand:P.NONE,label:String.fromCharCode(H)}),this.draggable=new Ue({endDragCallback:this.endDragCallback.bind(this),maxDragX:(this.options.minWidth||1)-1,maxDragY:0,minDragX:0,minDragY:0}),this.addChild(this.draggable).addChild(this.dragButton),this.value=this.options.minValue}onRender(t){let e=new O(this.boundingBox.x,this.boundingBox.y);this.__parent.local2Abs(e),t.clearText(0,e.x,e.y,this.boundingBox.w,1),De(t,e.x,e.y,this.boundingBox.w)}onUpdate(t){if(Ue.draggedWidget===this.draggable){let t=new O(this.boundingBox.x,this.boundingBox.y);this.__parent.local2Abs(t);let e=be.getConsole().getPixelPositionFromCell(t.x+this.boundingBox.w,t.y),i=be.getConsole().getPixelPositionFromCell(t.x,t.y),r=this.draggable.getDragPixelPos();this.setSliderCharacter(),this.value=this.options.minValue+(this.options.maxValue+1-this.options.minValue)*(r.x-i.x)/(e.x-i.x),this.value=L(this.value,this.options.minValue,this.options.maxValue)}}setSliderCharacter(){0===this.draggable.getDragPos().x?this.dragButton.getOptions().label=String.fromCharCode(H):this.draggable.getDragPos().x===this.boundingBox.w-1?this.dragButton.getOptions().label=String.fromCharCode(j):this.dragButton.getOptions().label=String.fromCharCode(G)}endDragCallback(t,e){t.moveTo(t.getDragPos())}}class Ke extends Be{constructor(t){super(t),void 0===t.hPadding&&(this.options.hPadding=0),void 0===t.wPadding&&(this.options.wPadding=0)}computeBoundingBox(){super.computeBoundingBox(),this.boundingBox.h+=this.options.hPadding||0,this.boundingBox.w+=this.options.wPadding||0}addChild(t){let e=super.addChild(t);return t instanceof F&&t.moveTo(this.options.wPadding||0,this.options.hPadding||0),e}expandChildren(t,e){for(let i of this.children)i.expand(t-2*(this.options.wPadding||0),e-2*(this.options.hPadding||0))}}class Ge extends Ke{constructor(t){super(t),(!this.options.hPadding||this.options.hPadding<1)&&(this.options.hPadding=1),(!this.options.wPadding||this.options.wPadding<1)&&(this.options.wPadding=1),void 0===this.options.minHeight&&(this.options.minHeight=1)}onInit(){super.onInit();let t=this.options;t.leftButton&&(this.leftButton=this.addChild(new He(t.leftButton)),this.leftButton.setExpandFlag(P.NONE)),t.rightButton&&(this.rightButton=this.addChild(new He(t.rightButton)),this.rightButton.setExpandFlag(P.NONE))}onRender(t){let e=new O;this.local2Abs(e);let i=this.options;Ie(t,e.x,e.y,this.boundingBox.w,this.boundingBox.h,i.title),i.footer&&t.print(Math.floor(e.x+(this.boundingBox.w-i.footer.length)/2),e.y+this.boundingBox.h-1,i.footer)}computeBoundingBox(){this.leftButton&&this.leftButton.hide(),this.rightButton&&this.rightButton.hide(),super.computeBoundingBox();let t=this.options,e=t.title?t.title.length:0;this.boundingBox.w=Math.max(e+4,this.boundingBox.w);let i=t.footer?t.footer.length:0;this.boundingBox.w=Math.max(i+2,this.boundingBox.w),this.leftButton&&(this.leftButton.show(),this.leftButton.moveTo(Math.floor(this.boundingBox.w/4-this.leftButton.getBoundingBox().w/2),this.boundingBox.h-1)),this.rightButton&&(this.rightButton.show(),this.rightButton.moveTo(Math.floor(3*this.boundingBox.w/4-this.rightButton.getBoundingBox().w/2),this.boundingBox.h-1))}}class ze extends Ke{constructor(t){super(t),void 0===this._expand&&(this._expand=P.BOTH)}onUpdate(t){let e;var i;this.options&&(e=this.options.cancelAction),i=Oe().input.cancelAxisName,Yt[i]&&Yt[i].pressed&&(e&&!e()||this.__parent.hide(),de())}}class qe extends Ke{constructor(t){super(t),void 0===this._expand&&(this._expand=P.HORIZONTAL)}computeBoundingBox(){super.computeBoundingBox();let t=this.options.hPadding||0;for(let e of this.children)e.moveTo(this.options.wPadding||0,t),e.getVisibleFlag()&&(t+=e.getBoundingBox().h);this.boundingBox.h=2*t,this.options.minHeight&&this.boundingBox.h<this.options.minHeight&&(this.boundingBox.h=this.options.minHeight)}addChild(t){let e=super.addChild(t);return this.computeBoundingBox(),e}expandChildren(t,e){super.expandChildren(t,0)}}class Xe extends Ke{constructor(t){super(t),void 0===this._expand&&(this._expand=P.VERTICAL)}computeBoundingBox(){super.computeBoundingBox();let t=this.options.wPadding||0;for(let e of this.children)e.moveTo(t,this.options.hPadding||0),e.getVisibleFlag()&&(t+=e.getBoundingBox().w);this.boundingBox.w=2*t,this.options.minWidth&&this.boundingBox.w<this.options.minWidth&&(this.boundingBox.w=this.options.minWidth)}addChild(t){let e=super.addChild(t);return this.computeBoundingBox(),e}expandChildren(t,e){super.expandChildren(0,e)}}const Ye=14737663,Qe=.25,Ze="right hand",$e="left hand",Je="hands",ti="quiver",ei="actors",ii="actorsSeq",ri="LIGHT_ONOFF";let ni;var si;(si=ni||(ni={}))[si.NOACTION=1]="NOACTION",si[si.MOVE_NORTH=2]="MOVE_NORTH",si[si.MOVE_SOUTH=3]="MOVE_SOUTH",si[si.MOVE_EAST=4]="MOVE_EAST",si[si.MOVE_WEST=5]="MOVE_WEST",si[si.MOVE_UP=6]="MOVE_UP",si[si.MOVE_DOWN=7]="MOVE_DOWN",si[si.WAIT=8]="WAIT",si[si.GRAB=9]="GRAB",si[si.USE_ITEM=10]="USE_ITEM",si[si.DROP_ITEM=11]="DROP_ITEM",si[si.THROW_ITEM=12]="THROW_ITEM",si[si.FIRE=13]="FIRE",si[si.ZAP=14]="ZAP",si[si.SELECT_TILE=15]="SELECT_TILE",si[si.SELECT_ITEM=16]="SELECT_ITEM",si[si.VALIDATE=17]="VALIDATE",si[si.CANCEL=18]="CANCEL";let oi=function(){if(Xt)return ni[Xt]},ai=function(t){let e=new O(0,0);switch(t){case ni.MOVE_NORTH:e.y=-1;break;case ni.MOVE_SOUTH:e.y=1;break;case ni.MOVE_EAST:e.x=1;break;case ni.MOVE_WEST:e.x=-1}return e},hi=function(t,e,i,r,n){let s=t;return e&&(s=s.replace(/\[The actor1\'s\] /g,e.getThenames()),s=s.replace(/ \[the actor1\'s\] /g,e.getthenames()),s=s.replace(/\[The actor1\]/g,e.getThename()),s=s.replace(/ \[the actor1\]/g,e.getthename()),s=s.replace(/\[A actor1\]/g,e.getAname()),s=s.replace(/ \[a actor1\]/g,e.getaname()),s=s.replace(/\[s\]/g,e.getVerbEnd()),s=s.replace(/ \[it\]/g,e.getit()),s=s.replace(/ \[its\] /g,e.getits()),s=s.replace(/ \[is\]/g,e.getis())),i&&(s=s.replace(/\[The actor2\'s\] /g,i.getThenames()),s=s.replace(/ \[the actor2\'s\] /g,i.getthenames()),s=s.replace(/\[The actor2\]/g,i.getThename()),s=s.replace(/ \[the actor2\]/g,i.getthename()),s=s.replace(/\[A actor2\]/g,i.getAname()),s=s.replace(/ \[a actor2\]/g,i.getaname()),s=s.replace(/\[s2\]/g,i.getVerbEnd()),s=s.replace(/ \[it2\]/g,i.getit()),s=s.replace(/ \[its2\] /g,i.getits()),s=s.replace(/ \[is2\]/g,i.getis())),void 0!==r&&(s=s.replace(/\[value1\]/g,""+r)),void 0!==n&&(s=s.replace(/\[value2\]/g,""+n)),s};const li=-1;class ci{get id(){return this._id}constructor(t){this._id=t}equals(t){return this._id===t.id}}class ui extends ci{gut=!1;constructor(t,e,i){super(t),this.pos=e,this.sector1Id=i}isDummy(){return void 0===this.sector2Id}getDescription(){return(this.gut?"gut ":"")+"connector "+this.id+" : "+this.pos.x+"-"+this.pos.y+" between "+this.sector1Id+" and "+this.sector2Id}}class di extends ci{cellCount=0;connectors=[];deadEnd=!0;constructor(t,e){super(t),this.seed=e}isDeadEnd(){return this.deadEnd}getDescription(){return(this.deadEnd?"dead end ":"")+"sector "+this.id+" : "+this.seed.x+"-"+this.seed.y+" ("+this.cellCount+" cells)"}addConnector(t){-1===this.connectors.indexOf(t)?(this.connectors.push(t),this.deadEnd&&(this.deadEnd=this.connectors.length<2)):this.deadEnd=!1}}class pi{objectMap=[];objects=[];_sectors=[];_connectors=[];_puzzle=[];get puzzle(){return this._puzzle}get sectors(){return this._sectors}get connectors(){return this._connectors}constructor(t,e){this.width=t,this.height=e;for(let i=0;i<t;++i){this.objectMap[i]=[];for(let t=0;t<e;++t)this.objectMap[i][t]=li}}createSector(t){let e=new di(this.objects.length,t);return this.objects.push(e),this._sectors.push(e),e}createConnector(t,e){let i=new ui(this.objects.length,t,e);return this.objects.push(i),this._connectors.push(i),i}getObjectId(t){return this.objectMap[t.x][t.y]}setObjectId(t,e){this.objectMap[t.x][t.y]=e}getSector(t){return t instanceof O?this.getSectorFromPosition(t):this.getSectorFromId(t)}getConnector(t){return t instanceof O?this.getConnectorFromPos(t):this.getConnectorFromId(t)}getRandomPositionInSector(t,e){let i=new O(-1,0),r=this.getSectorFromId(t),n=e.getNumber(1,r.cellCount);do{do{i.x++,i.x===this.width&&(i.x=0,i.y++,i.y===this.height&&(i.y=0))}while(this.objectMap[i.x][i.y]!==t);n--}while(n>0);return i}computePath(t,e){let i=[],r=[],n=new tt((t=>i[t.id]));i[t]=0,r[t]=void 0,n.push(this.objects[t]);let s=n.pop();for(;s&&s.id!==e;){for(let t of s.connectors){let e=this.objects[t];if(void 0===e.lock){let t=e.sector1Id===s.id?e.sector2Id:e.sector1Id,o=i[s.id]+1;if(void 0===i[t]||i[t]>o){let e=this.objects[t];i[t]=o,r[t]=s.id,n.contains(e)||n.push(e)}}}s=n.pop()}let o=[],a=e;for(;void 0!==a&&void 0!==r[a];)o.splice(0,0,a),a=r[a];return o.splice(0,0,t),o}findFarthestSector(t,e=!1){let i=1,r=li;for(let n of this._sectors)if(n.id!==t&&(n.isDeadEnd()||!e)){let e=this.computePath(t,n.id).length;e>i&&(i=e,r=n.id)}return r}findFarthestDeadEnd(t){return this.findFarthestSector(t,!0)}getSectorFromId(t){let e=this.objects[t];if(!(e instanceof di))throw"TopologyMap : object "+t+" is not a sector";return e}getSectorFromPosition(t){return this.getSectorFromId(this.objectMap[t.x][t.y])}getConnectorFromId(t){let e=this.objects[t];if(!(e instanceof ui))throw"TopologyMap : object "+t+" is not a connector";return e}getConnectorFromPos(t){return this.getConnectorFromId(this.objectMap[t.x][t.y])}}class fi{sectorSeeds=[];findDungeonExits(t,e,i=!1){let r=0;for(let n of this.topologyMap.sectors)if(i||n.isDeadEnd()){let i=this.topologyMap.findFarthestSector(n.id);if(i===li)continue;let s=this.topologyMap.computePath(n.id,i).length;if(s>r){r=s;let o=this.topologyMap.getSector(i);t.x=o.seed.x,t.y=o.seed.y,e.x=n.seed.x,e.y=n.seed.y}}if(0===r&&!i)return this.findDungeonExits(t,e,!0)}buildPuzzle(t,e,i=0){let r=this.topologyMap.computePath(e,t);if(1===r.length)return;let n,s=0,o=this.topologyMap.getSector(r[s]);s++;do{let t=this.topologyMap.getSector(r[s]);s++;for(let e of o.connectors){let i=this.topologyMap.getConnector(e);if(i.sector1Id===t.id||i.sector2Id===t.id){n=i,o=t;break}}}while(s<r.length&&(void 0===n||!n.gut));if(n&&n.gut){n.lock=i;let e=this.topologyMap.findFarthestSector(t);e!==li?(this.topologyMap.getSector(e).key=i,this.topologyMap.puzzle.push({connectorId:n.id,keySectorId:e}),t!==e&&this.buildPuzzle(t,e,i+1)):n.lock=void 0}}buildTopologyMap(t,e){for(this.topologyMap=new pi(t.w,t.h),this.sectorSeeds.push(e);0!==this.sectorSeeds.length;){let e=this.sectorSeeds.shift();e&&this.topologyMap.getObjectId(e)===li&&this.floodFill(t,e.x,e.y)}return this.findGuts(),this.topologyMap}floodFill(t,e,i){let r=[],n=new O(e,i),s=this.topologyMap.createSector(n);for(this.topologyMap.setObjectId(n,s.id),s.cellCount++,r.push(n);0!==r.length;){let e=r.shift();if(!e)break;let i=e.getAdjacentCells(t.w,t.h);for(let n of i)if(!t.isWall(n.x,n.y)&&this.topologyMap.getObjectId(n)!==s.id)if(this.topologyMap.getObjectId(n)===li)t.canWalk(n.x,n.y)?(this.topologyMap.setObjectId(n,s.id),s.cellCount++,r.push(n)):n.x!==e.x&&n.y!==e.y||!this.hasDoor(t,n)||this.topologyMap.setObjectId(n,this.newConnector(e,n,s.id));else if(this.hasDoor(t,n)){let t=this.topologyMap.getConnector(n);t.sector1Id!==s.id&&void 0===t.sector2Id&&(t.sector2Id=s.id,this.topologyMap.getSector(t.sector1Id).addConnector(t.id),this.topologyMap.getSector(t.sector2Id).addConnector(t.id))}}}hasDoor(t,e){return Zr.list.filter((t=>t.pos.equals(e)&&t.isA("door[s]"))).length>0}newConnector(t,e,i){let r,n=this.topologyMap.createConnector(e,i);return t.x===e.x-1?r=new O(e.x+1,e.y):t.x===e.x+1?r=new O(e.x-1,e.y):t.y===e.y-1?r=new O(e.x,e.y+1):t.y===e.y+1&&(r=new O(e.x,e.y-1)),r&&this.sectorSeeds.push(r),n.id}findGuts(){for(let t of this.topologyMap.connectors)t.isDummy()||(t.gut=this.computeGut(t))}computeGut(t){let e=[],i=[];for(e.push(t.sector1Id);e.length>0;){let r=e.shift();if(void 0===r||r===t.sector2Id)return!1;i.push(r);let n=this.topologyMap.getSector(r);for(let r of n.connectors){let s=this.topologyMap.getConnector(r);s.id!==t.id&&(s.sector1Id!==n.id||s.isDummy()||-1!==i.indexOf(s.sector2Id)?s.sector2Id===n.id&&-1===i.indexOf(s.sector1Id)&&e.push(s.sector1Id):e.push(s.sector2Id))}}return!0}}let gi;var vi;let mi;var yi;let xi;var _i;(vi=gi||(gi={}))[vi.NONE=1]="NONE",vi[vi.NORMAL=2]="NORMAL",vi[vi.DETECTED=3]="DETECTED",(yi=mi||(mi={}))[yi.DARKNESS=1]="DARKNESS",yi[yi.PENUMBRA=2]="PENUMBRA",yi[yi.LIGHT=3]="LIGHT",(_i=xi||(xi={}))[_i.NORMAL=1]="NORMAL",_i[_i.TRANSPARENCY=2]="TRANSPARENCY",_i[_i.LIGHTMAP=3]="LIGHTMAP",_i[_i.FOV=4]="FOV",_i[_i.ALL_SEEING_EYE=5]="ALL_SEEING_EYE";class bi extends F{basePriority=0;__renderMode=xi.NORMAL;constructor(t){super(),this.shader=t}getRenderMode(){return this.__renderMode}setRenderMode(t){this.__renderMode=t}initForNewMap(){this.shader.initForNewMap()}}class Ti extends bi{onRender(t){let e=Zr.specialActors[Yr.PLAYER];if(wi.current&&e)switch(this.__renderMode){case xi.NORMAL:this.renderNormal(t);break;case xi.TRANSPARENCY:this.renderTransparency(t);break;case xi.LIGHTMAP:this.renderLightmap(t);break;case xi.FOV:this.renderFov(t);break;case xi.ALL_SEEING_EYE:this.renderAllSeeingEye(t)}}getActorRenderMode(t,e){if(!t.fovOnly&&wi.current.isExplored(t.pos.x,t.pos.y))return gi.NORMAL;let i=Zr.specialActors[Yr.PLAYER];return e>0&&t.ai&&t.destructible&&!t.destructible.isDead()&&O.distance(i.pos,t.pos)<e?gi.DETECTED:wi.current.isInFov(t.pos.x,t.pos.y)?gi.NORMAL:gi.NONE}canIdentifyActor(t){return this.__renderMode===xi.ALL_SEEING_EYE||this.shader.canIdentifyActor(t)}getCellLightLevel(t,e){return this.__renderMode===xi.ALL_SEEING_EYE?mi.LIGHT:this.shader.getCellLightLevel(t,e)}renderActor(t,e,i){let r=this.getActorRenderMode(e,i);if(r!==gi.NONE){let i=e.pos;t.text[i.x][i.y]=this.__renderMode===xi.ALL_SEEING_EYE?e.charCode:this.shader.getActorCharCode(e,r),t.fore[i.x][i.y]=this.__renderMode===xi.ALL_SEEING_EYE?e.col:this.shader.getActorColor(e,r)}}renderActors(t){let e=Zr.specialActors[Yr.PLAYER].ai.getCondition(Ii.DETECT_LIFE),i=e?e.range:0;for(let e of Zr.list){if(e.pickable&&e.pickable.containerId)continue;let r=this.basePriority;e.isA("key[s]")?r+=2:e.isA("item[s]")?r++:e.isA("creature[s]")&&!e.destructible.isDead()&&(r+=3);let n=this.actorPriorityMap[e.pos.x][e.pos.y];(void 0===n||n<r)&&(this.renderActor(t,e,i),this.actorPriorityMap[e.pos.x][e.pos.y]=r)}this.basePriority+=3}renderMap(t){let e=wi.current;this.actorPriorityMap||(this.actorPriorityMap=I(e.w));for(let i=0;i<e.w;i++)for(let r=0;r<e.h;r++)t.back[i][r]=this.shader.getBackgroundColor(e,i,r)}renderAllSeeingEye(t){let e=Zr.specialActors[Yr.PLAYER];t.clearText(),wi.current.resetFov(!0),this.shader.prepareFrame(),this.renderMap(t),this.renderActors(t),wi.current.setDirty(),wi.current.computeFov(e.pos.x,e.pos.y,0)}renderNormal(t){let e=Zr.specialActors[Yr.PLAYER];t.clearText(),wi.current.computeFov(e.pos.x,e.pos.y,0),this.shader.prepareFrame(),this.renderMap(t),this.renderActors(t)}renderTransparency(t){t.clearText(),t.clearBack(0),t.clearFore(0);let e=wi.current;for(let i=0;i<e.w;i++)for(let r=0;r<e.h;r++)t.back[i][r]=e.fov.isTransparent(i,r)?"#BBBBBB":"#888888"}renderLightmap(t){let e=Zr.specialActors[Yr.PLAYER];t.clearText(),wi.current.resetFov(!0),this.shader.prepareFrame(),this.renderMap(t),this.renderActors(t),wi.current.setDirty(),wi.current.computeFov(e.pos.x,e.pos.y,0)}renderFov(t){t.clearText(),t.clearBack(0),t.clearFore(0);let e=wi.current;for(let i=0;i<e.w;i++)for(let r=0;r<e.h;r++)t.back[i][r]=e.isInFov(i,r)?"#BBBBBB":"#888888"}}class Ei{explored=!1;isWall=!0;isWalkable=!1;scentAmount=0}class wi extends D{_currentScentValue=0;_dirty=!0;get renderer(){return this.__renderer}constructor(t){super(),this.__renderer=t}init(t,e){this.resize(t,e),this.tiles=[],this.__inFov=[],this._fov=new J(t,e);for(let i=0;i<t;i++){this.tiles[i]=[],this.__inFov[i]=[];for(let t=0;t<e;t++)this.tiles[i][t]=new Ei}this._dirty=!0,wi.current=this,this.__renderer.onInit()}get currentScentValue(){return this._currentScentValue}get fov(){return this._fov}setDirty(){this._dirty=!0}isWall(t,e){return!this.tiles[t]||!this.tiles[t][e]||this.tiles[t][e].isWall}findRandomWamlkableCell(){let t=B.default,e=t.getNumber(0,this.w-1),i=t.getNumber(0,this.h-1);for(;!this.canWalk(e,i);)e++,e===this.w&&(e=0,i++,i===this.h&&(i=0));return[e,i]}isWallWithAdjacentFloor(t,e){if(!this.isWall(t,e))return;let i=new O(t,e).getAdjacentCells(this.w,this.h,!1);for(let t of i)if(!this.isWall(t.x,t.y))return t}canWalk(t,e){return!this.isWall(t,e)&&0===Zr.list.filter((i=>i.pos.x===t&&i.pos.y===e&&i.blocks)).length}isExplored(t,e){return this.tiles[t][e].explored}isInFov(t,e){return this.__inFov[t]&&this.__inFov[t][e]}getScent(t,e){return this.tiles[t][e].scentAmount}resetFov(t){for(let e=0;e<this.w;e++)for(let i=0;i<this.h;i++)this.__inFov[e][i]=t}computeFov(t,e,i){if(this._dirty){this._fov.computeFov(this.__inFov,t,e,i);for(let t=0;t<this.w;t++)for(let e=0;e<this.h;e++)this.__inFov[t]&&this.__inFov[t][e]&&!this.tiles[t][e].explored&&this.__renderer.getCellLightLevel(t,e)!==mi.DARKNESS&&(this.tiles[t][e].explored=!0)}this._dirty=!1}setFloor(t,e){this._fov.setTransparent(t,e,!0),this.tiles[t][e].isWall=!1,this.tiles[t][e].isWalkable=!0,this._dirty=!0}setWall(t,e){this._fov.setTransparent(t,e,!1),this.tiles[t][e].isWall=!0,this.tiles[t][e].isWalkable=!1,this._dirty=!0}setWalkable(t,e,i){this.tiles[t][e].isWalkable=i,this._dirty=!0}setTransparent(t,e,i){this._fov.setTransparent(t,e,i),this._dirty=!0}reveal(){for(let t=0;t<this.w;t++)for(let e=0;e<this.h;e++)this.tiles[t][e].explored=!0}load(t){this.init(t.w,t.h),this._fov=new J(this.w,this.h);for(let e=0;e<this.w;e++)for(let i=0;i<this.h;i++)this.tiles[e][i].explored=t.tiles[e][i].explored,this.tiles[e][i].scentAmount=t.tiles[e][i].scentAmount,this.tiles[e][i].isWall=t.tiles[e][i].isWall,this.tiles[e][i].isWalkable=t.tiles[e][i].isWalkable,this._fov.setTransparent(e,i,t._fov._transparent[e][i])}updateScentField(t,e){this._currentScentValue++;for(let i=0;i<this.w;i++)for(let r=0;r<this.h;r++)if(this.isInFov(i,r)){let n=this.getScent(i,r),s=i-t,o=r-e,a=Math.floor(Math.sqrt(s*s+o*o)),h=this._currentScentValue-a;h>n&&(this.tiles[i][r].scentAmount=h)}}}class Ai{initForNewMap(){}canIdentifyActor(t){return!0}getActorCharCode(t,e){return t.charCode}getActorColor(t,e){return t.col}getCellLightLevel(t,e){return mi.LIGHT}getBackgroundColor(t,e,i){return t.isInFov(e,i)?t.isWall(e,i)?8285774:12891284:t.isExplored(e,i)?t.isWall(e,i)?100:3289750:0}prepareFrame(){}}class Ci{enableEvents=!0;constructor(t){re.registerEventListener(this,ri),this.initForNewMap(),this.nolightShader=t}initForNewMap(){this.lights={},this.lights[ji.ADDITIVE]=[],this.lights[ji.MAX]=[];let t=Zr.specialActors[Yr.PLAYER];if(t&&t.container){for(let e=0,i=t.container.size();e<i;++e){let i=t.container.get(e);i&&i.light&&(!i.activable||i.activable.isActive())&&this.onLightOnoff(i)}t.light&&this.onLightOnoff(t)}}getCellLightLevel(t,e){if(!this.lightMap)return mi.DARKNESS;let i=this.lightMap[t][e];if(!i)return mi.DARKNESS;let r=S.computeIntensity(i);return r>Qe?mi.LIGHT:r>0?mi.PENUMBRA:mi.DARKNESS}canIdentifyActor(t){if(!t.fovOnly)return!0;let e=this.lightMap[t.pos.x][t.pos.y];return!!e&&S.computeIntensity(e)>Qe}getActorCharCode(t,e){if(!t.fovOnly||t===Zr.specialActors[Yr.PLAYER]||e===gi.DETECTED)return this.nolightShader.getActorCharCode(t,e);let i=this.lightMap[t.pos.x][t.pos.y];return i?S.computeIntensity(i)<=Qe?63:this.nolightShader.getActorCharCode(t,e):63}getActorColor(t,e){if(!t.fovOnly&&wi.current.isExplored(t.pos.x,t.pos.y)||e===gi.DETECTED)return this.nolightShader.getActorColor(t,e);let i=this.lightMap[t.pos.x][t.pos.y];return i?S.colorMultiply(this.nolightShader.getActorColor(t,e),i):0}getBackgroundColor(t,e,i){let r=this.lightMap[e][i];return t.isWall(e,i)&&t.isExplored(e,i)?t.isInFov(e,i)&&r&&S.computeIntensity(r)>Qe?S.colorMultiply(this.nolightShader.getBackgroundColor(t,e,i),r):100:r&&t.isInFov(e,i)?S.colorMultiply(this.nolightShader.getBackgroundColor(t,e,i),r):0}onLightOnoff(t){if(t.light)if(!t.activable||t.activable.isActive())-1===this.lights[t.light.options.renderMode].indexOf(t)&&this.lights[t.light.options.renderMode].push(t);else{let e=this.lights[t.light.options.renderMode].indexOf(t);-1!==e&&this.lights[t.light.options.renderMode].splice(e,1)}}prepareFrame(){this.lightMap||(this.lightMap=I(wi.current.w),this.inFov=I(wi.current.w)),this.clearLightmap(),this.computeLightMaps(ji.ADDITIVE),this.computeLightMaps(ji.MAX)}computeLightMaps(t){for(let e of this.lights[t]){let t=e.light.computeIntensityVariation(be.elapsedTime);this.computeLightMap(e,t)}}clearLightmap(){let t=wi.current.w,e=wi.current.h;for(let i=0;i<t;++i)for(let t=0;t<e;++t)this.lightMap[i][t]=0}computeLightMap(t,e){let i=new D,r=t.light.position;void 0===r&&(r=t.pos),i.x=r.x-t.light.options.range,i.y=r.y-t.light.options.range,i.w=2*t.light.options.range+1,i.h=2*t.light.options.range+1,i.clamp(0,0,wi.current.w,wi.current.h);let n=t.light.options.range;n*=n;let s,o=t.light.options.intensityVariationRange?.25*((1-e)/t.light.options.intensityVariationRange-.5):0;switch(wi.current.fov.computeFov(this.inFov,r.x,r.y,t.light.options.range),t.light.options.renderMode){case ji.MAX:s=S.max;break;default:case ji.ADDITIVE:s=S.add}for(let a=i.x,h=i.x+i.w;a<h;++a){let h=r.x-a+o;h*=h;for(let l=i.y,c=i.y+i.h;l<c;++l){let i=r.y-l-o;if(i*=i,h+i<=n&&this.inFov[a][l]){let r=t.light.computeIntensity(h+i)*e;this.lightMap[a][l]=s(this.lightMap[a][l],S.multiply(t.light.options.color,r))}}}}}class Si extends class{get topologyMap(){return this._topologyMap}constructor(t,e){this.dungeonLevel=t,this.config=e,this.itemProbabilities=e.itemProbabilities,this.creatureProbabilities=e.creatureProbabilities,this.lootProbabilities=e.lootProbabilities,this.doorProbabilities=Xr.computeLevelProbabilities(e.doorProbabilities,t),this.wallLightProbabilities=Xr.computeLevelProbabilities(e.wallLightProbabilities,t),this.keyProbabilities=Xr.computeLevelProbabilities(e.keyProbabilities,t),this.rng=new B}build(t){this.digMap(t);let e=new fi,i=Zr.specialActors[Yr.PLAYER],r=Zr.specialActors[Yr.STAIR_UP],n=Zr.specialActors[Yr.STAIR_DOWN];this._topologyMap=e.buildTopologyMap(t,n.pos),e.findDungeonExits(i.pos,n.pos),i.moveTo(i.pos.x,i.pos.y),e.buildPuzzle(this._topologyMap.getObjectId(i.pos),this._topologyMap.getObjectId(n.pos)),r.pos.x=i.pos.x,r.pos.y=i.pos.y,this.applyPuzzle(),this.createWallTorches(t,this.config.minTorches,this.config.maxTorches),this.fixWallItems(t),this.createLoot()}digMap(t){}dig(t,e,i,r,n){if(r<e){let t=r;r=e,e=t}if(n<i){let t=n;n=i,i=t}0===e&&(e=1),0===i&&(i=1),r===t.w-1&&r--,n===t.h-1&&n--;for(let s=e;s<=r;s++)for(let e=i;e<=n;e++)t.isWall(s,e)&&t.setFloor(s,e)}createRoom(t,e,i,r,n,s){if(this.dig(t,i,r,n,s),e){let t=Zr.specialActors[Yr.PLAYER],e=Zr.specialActors[Yr.STAIR_UP];t.pos.x=Math.floor((i+n)/2),t.pos.y=Math.floor((r+s)/2),e.pos.x=t.pos.x,e.pos.y=t.pos.y}else{this.createMonsters(i,r,n,s,t),this.createItems(i,r,n,s,t);let e=Zr.specialActors[Yr.STAIR_DOWN];e.pos.x=Math.floor((i+n)/2),e.pos.y=Math.floor((r+s)/2)}}createDoor(t){let e=this.rng.getRandomChance(this.doorProbabilities),i=Xr.create(e);i&&(i.register(),i.moveTo(t.x,t.y))}getDoor(t){let e=Zr.list.filter((e=>e.pos.equals(t)&&e.isA("door[s]")));return e&&0===e.length?void 0:e[0]}findVDoorPosition(t,e,i,r){let n=i<r?i:r,s=i<r?r:i;do{if(this.isAVDoorPosition(t,e,n))return new O(e,n);n++}while(n!==s+1)}findHDoorPosition(t,e,i,r){let n=e<i?e:i,s=e<i?i:e;do{if(this.isAHDoorPosition(t,n,r))return new O(n,r);n++}while(n!==s+1)}isADoorPosition(t,e,i){return this.isAHDoorPosition(t,e,i)||this.isAVDoorPosition(t,e,i)}findFloorTile(t,e,i,r,n){let s=new O(Math.floor(t+i/2),Math.floor(e+r/2));for(;n.isWall(s.x,s.y);)s.x++,s.x===t+i&&(s.x=t,s.y++,s.y===e+r&&(s.y=e));return s}isEmptyCell(t,e,i){return!!t.canWalk(e,i)&&0===Zr.list.filter((t=>t.pos.x===e&&t.pos.y===i&&t.isA("item[s]"))).length}isAHDoorPosition(t,e,i){return t.isWall(e,i-1)&&t.isWall(e,i+1)&&this.isEmptyCell(t,e,i)&&this.isEmptyCell(t,e+1,i)&&this.isEmptyCell(t,e-1,i)}isAVDoorPosition(t,e,i){return t.isWall(e-1,i)&&t.isWall(e+1,i)&&this.isEmptyCell(t,e,i)&&this.isEmptyCell(t,e,i+1)&&this.isEmptyCell(t,e,i-1)}createActor(t){let e=this.rng.getRandomChance(t);if(void 0!==e)return Xr.create(e,void 0,void 0)}createMonsters(t,e,i,r,n){let s=Xr.createRandomActors(this.creatureProbabilities,this.dungeonLevel);for(let o of s){let s=this.rng.getNumber(t,i),a=this.rng.getNumber(e,r);n.canWalk(s,a)&&o.moveTo(s,a)}}createWallTorches(t,e,i){let r=this.rng.getNumber(e,i);for(;r>0;){let e=this.createActor(this.wallLightProbabilities);if(e){let i=this.rng.getNumber(0,t.w-1),r=this.rng.getNumber(0,t.h-1);e.moveTo(i,r),e.register()}r--}}findWallWithAdjacentFloor(t,e){let i=!1,r=e.x,n=e.y;for(;!i;){if(r===t.w-1?(r=0,n===t.h-1?n=0:n+=1):r+=1,r===e.x&&n===e.y)return;if(void 0!==t.isWallWithAdjacentFloor(r,n)){0===Zr.list.filter((t=>t.pos.x===r&&t.pos.y===n)).length&&(i=!0,e.moveTo(r,n))}}}fixWallItems(t){for(let e of Zr.list)e.wallActor&&!t.isWallWithAdjacentFloor(e.pos.x,e.pos.y)&&(this.findWallWithAdjacentFloor(t,e.pos),e.moveTo(e.pos.x,e.pos.y),e.light&&(e.light.position=e.pos))}createItems(t,e,i,r,n){let s=Xr.createRandomActors(this.itemProbabilities,this.dungeonLevel);for(let o of s)if(o.wallActor){let n=this.rng.getNumber(t,i),s=this.rng.getNumber(e,r);o.moveTo(n,s)}else for(let s=0;s<100;s++){let s=this.rng.getNumber(t,i),a=this.rng.getNumber(e,r);if(n.canWalk(s,a)){o.moveTo(s,a);break}}}applyPuzzle(){for(let t of this._topologyMap.puzzle){if(this.rng.getNumber(0,1)>.06)continue;let e=this._topologyMap.getConnector(t.connectorId),i=this.getDoor(e.pos);if(!i)throw"Error : connector "+e.id+" with no door";let r=this._topologyMap.getRandomPositionInSector(t.keySectorId,this.rng),n=this.createActor(this.keyProbabilities);n&&(n.moveTo(r.x,r.y),n.register(),Xr.setLock(i,n))}}createLoot(){let t=Zr.specialActors[Yr.PLAYER],e=this._topologyMap.getObjectId(t.pos);for(let t of this._topologyMap.sectors)if(t.id!==e&&t.isDeadEnd()){let e=Xr.createRandomActor(this.config.lootContainerType);if(e){let i=this._topologyMap.getRandomPositionInSector(t.id,this.rng);e.moveTo(i.x,i.y);let r=Xr.createRandomActors(this.lootProbabilities,this.dungeonLevel);for(let t of r)t.moveTo(i.x,i.y),t.pickable.pick(t,e,!1,!0);let n=Xr.createRandomActors(this.creatureProbabilities,this.dungeonLevel);for(let i of n){let r=this._topologyMap.getRandomPositionInSector(t.id,this.rng);if(i.moveTo(r.x,r.y),i.ai.behaviorTree=Xr.getBehaviorTree(this.config.guardAI),!e)throw new Error("No container found!");i.ai.targetId=e.id}}}}}{firstRoom=!0;potentialDoorPos=[];constructor(t,e){super(t,e)}digMap(t){let e=new $(0,0,t.w,t.h);e.splitRecursive(void 0,8,this.config.roomMinSize,1.5),e.traverseInvertedLevelOrder(this.visitNode.bind(this),t),this.createDoors(t)}createRandomRoom(t,e){if(!t.parent)return;let i,r,n,s,o=t.parent.horiz,a=this.config.roomMinSize;o?(n=this.rng.getNumber(a,t.w-1),s=this.rng.getNumber(a,t.h-2),i=t===t.parent.leftChild?this.rng.getNumber(t.x+1,t.x+t.w-n):this.rng.getNumber(t.x,t.x+t.w-n),r=this.rng.getNumber(t.y+1,t.y+t.h-s)):(n=this.rng.getNumber(a,t.w-2),s=this.rng.getNumber(a,t.h-1),r=t===t.parent.leftChild?this.rng.getNumber(t.y+1,t.y+t.h-s):this.rng.getNumber(t.y,t.y+t.h-s),i=this.rng.getNumber(t.x+1,t.x+t.w-n)),this.createRoom(e,this.firstRoom,i,r,i+n-1,r+s-1),this.firstRoom=!1}connectChildren(t,e){if(!t.leftChild||!t.rightChild)return;let i=t.leftChild,r=t.rightChild,n=this.findFloorTile(i.x,i.y,i.w,i.h,e),s=this.findFloorTile(r.x,r.y,r.w,r.h,e);this.dig(e,n.x,n.y,n.x,s.y),this.dig(e,n.x,s.y,s.x,s.y);let o=this.findVDoorPosition(e,n.x,n.y,s.y);o||(o=this.findHDoorPosition(e,n.x,s.x,s.y)),o&&this.potentialDoorPos.push(o)}createDoors(t){for(let e of this.potentialDoorPos)this.isADoorPosition(t,e.x,e.y)&&this.createDoor(e)}visitNode(t,e){let i=e;return t.isLeaf()?this.createRandomRoom(t,i):this.connectChildren(t,i),Q.CONTINUE}}class Oi extends zt{enableEvents=!0;forceNextTurn=!1;constructor(t,e){super(),this.renderer=t,this.persister=e}get map(){return this._map}get rng(){return this._rng}onInit(){re.registerEventListener(this,Te[Te.MODAL_SHOW]),re.registerEventListener(this,Te[Te.MODAL_HIDE]),this._rng=new B,this._map=new wi(this.renderer),this.addChild(this.renderer),function(t){for(let e of t)ie(e)}([{name:ni[ni.MOVE_WEST],positiveButton:E.DOM_VK_LEFT,type:A.KEY_OR_BUTTON},{name:ni[ni.MOVE_WEST],positiveButton:E.DOM_VK_NUMPAD4,type:A.KEY_OR_BUTTON},{name:ni[ni.MOVE_WEST],positiveButton:E.DOM_VK_H,type:A.KEY_OR_BUTTON},{name:ni[ni.MOVE_EAST],positiveButton:E.DOM_VK_RIGHT,type:A.KEY_OR_BUTTON},{name:ni[ni.MOVE_EAST],positiveButton:E.DOM_VK_NUMPAD6,type:A.KEY_OR_BUTTON},{name:ni[ni.MOVE_EAST],positiveButton:E.DOM_VK_L,type:A.KEY_OR_BUTTON},{name:ni[ni.MOVE_NORTH],positiveButton:E.DOM_VK_UP,type:A.KEY_OR_BUTTON},{name:ni[ni.MOVE_NORTH],positiveButton:E.DOM_VK_NUMPAD8,type:A.KEY_OR_BUTTON},{name:ni[ni.MOVE_NORTH],positiveButton:E.DOM_VK_K,type:A.KEY_OR_BUTTON},{name:ni[ni.MOVE_SOUTH],positiveButton:E.DOM_VK_DOWN,type:A.KEY_OR_BUTTON},{name:ni[ni.MOVE_SOUTH],positiveButton:E.DOM_VK_NUMPAD2,type:A.KEY_OR_BUTTON},{name:ni[ni.MOVE_SOUTH],positiveButton:E.DOM_VK_J,type:A.KEY_OR_BUTTON},{name:ni[ni.NOACTION],positiveButton:E.DOM_VK_PERIOD,type:A.KEY_OR_BUTTON},{name:ni[ni.WAIT],positiveButton:E.DOM_VK_NUMPAD5,type:A.KEY_OR_BUTTON},{name:ni[ni.WAIT],positiveButton:E.DOM_VK_SPACE,type:A.KEY_OR_BUTTON},{name:ni[ni.GRAB],positiveButton:E.DOM_VK_G,type:A.KEY_OR_BUTTON},{name:ni[ni.USE_ITEM],positiveButton:E.DOM_VK_I,type:A.KEY_OR_BUTTON},{name:ni[ni.DROP_ITEM],positiveButton:E.DOM_VK_D,type:A.KEY_OR_BUTTON},{name:ni[ni.THROW_ITEM],positiveButton:E.DOM_VK_T,type:A.KEY_OR_BUTTON},{name:ni[ni.VALIDATE],positiveButton:E.DOM_VK_ENTER,type:A.KEY_OR_BUTTON},{name:ni[ni.VALIDATE],positiveButton:E.DOM_VK_RETURN,type:A.KEY_OR_BUTTON},{name:ni[ni.CANCEL],positiveButton:E.DOM_VK_ESCAPE,type:A.KEY_OR_BUTTON},{name:ni[ni.FIRE],positiveButton:E.DOM_VK_F,type:A.KEY_OR_BUTTON},{name:ni[ni.ZAP],positiveButton:E.DOM_VK_Z,type:A.KEY_OR_BUTTON},{name:ni[ni.MOVE_DOWN],positiveButton:">",type:A.KEY_OR_BUTTON},{name:ni[ni.MOVE_UP],positiveButton:"<",type:A.KEY_OR_BUTTON}])}onTerm(){super.onTerm(),re.unregisterEventListener(this,Te[Te.MODAL_SHOW]),re.unregisterEventListener(this,Te[Te.MODAL_HIDE])}onModalShow(t){Zr.scheduler.pause()}onModalHide(t){Zr.scheduler.resume()}onUpdate(t){if((this.forceNextTurn||void 0===Le.getActiveModal()&&void 0!==oi())&&(this.forceNextTurn=!1,Zr.scheduler.resume()),Zr.scheduler.isPaused())return;let e=Zr.specialActors[Yr.PLAYER];if(e){let t=e.pos.x,i=e.pos.y;Zr.scheduler.run(),e.pos.x===t&&e.pos.y===i||(this.map.setDirty(),this.map.computeFov(e.pos.x,e.pos.y,0),this.map.updateScentField(e.pos.x,e.pos.y))}}}let Di;var Mi;let Ri;var Pi;let Ii;var Ni;let Li;var ki;let Fi;var Bi;let Ui;var Vi;let ji;var Hi;let Wi;var Ki;(Mi=Di||(Di={}))[Mi.INSTANT_HEALTH=1]="INSTANT_HEALTH",Mi[Mi.TELEPORT=2]="TELEPORT",Mi[Mi.CONDITION=3]="CONDITION",Mi[Mi.MAP_REVEAL=4]="MAP_REVEAL",Mi[Mi.EVENT=5]="EVENT",(Pi=Ri||(Ri={}))[Pi.SINGLE=1]="SINGLE",Pi[Pi.DOOR=2]="DOOR",Pi[Pi.TOGGLE=3]="TOGGLE",Pi[Pi.LEVER=4]="LEVER",(Ni=Ii||(Ii={}))[Ni.CONFUSED=1]="CONFUSED",Ni[Ni.STUNNED=2]="STUNNED",Ni[Ni.FROZEN=3]="FROZEN",Ni[Ni.HEALTH_VARIATION=4]="HEALTH_VARIATION",Ni[Ni.OVERENCUMBERED=5]="OVERENCUMBERED",Ni[Ni.DETECT_LIFE=6]="DETECT_LIFE",(ki=Li||(Li={}))[ki.WEARER=1]="WEARER",ki[ki.WEARER_INVENTORY=2]="WEARER_INVENTORY",ki[ki.ACTOR_ON_CELL=3]="ACTOR_ON_CELL",ki[ki.CLOSEST_ENEMY=4]="CLOSEST_ENEMY",ki[ki.SELECTED_ACTOR=5]="SELECTED_ACTOR",ki[ki.ACTORS_IN_RANGE=6]="ACTORS_IN_RANGE",ki[ki.SELECTED_RANGE=7]="SELECTED_RANGE",(Bi=Fi||(Fi={}))[Bi.ITEM=1]="ITEM",Bi[Bi.MONSTER=2]="MONSTER",Bi[Bi.PLAYER=3]="PLAYER",(Vi=Ui||(Ui={}))[Vi.NONE=0]="NONE",Vi[Vi.LINEAR=1]="LINEAR",Vi[Vi.NORMAL=2]="NORMAL",Vi[Vi.INVERSE_SQUARE=3]="INVERSE_SQUARE",(Hi=ji||(ji={}))[Hi.ADDITIVE=1]="ADDITIVE",Hi[Hi.MAX=2]="MAX",(Ki=Wi||(Wi={}))[Ki.DESTRUCTIBLE=1]="DESTRUCTIBLE",Ki[Ki.ATTACKER=2]="ATTACKER",Ki[Ki.AI=3]="AI",Ki[Ki.PICKABLE=4]="PICKABLE",Ki[Ki.CONTAINER=5]="CONTAINER",Ki[Ki.EQUIPMENT=6]="EQUIPMENT",Ki[Ki.RANGED=7]="RANGED",Ki[Ki.MAGIC=8]="MAGIC",Ki[Ki.ACTIVABLE=9]="ACTIVABLE",Ki[Ki.LOCKABLE=10]="LOCKABLE",Ki[Ki.LIGHT=11]="LIGHT",Ki[Ki.XP_HOLDER=12]="XP_HOLDER",Ki[Ki.AMMO=13]="AMMO";class Gi{static create(t){switch(t.type){case Ii.HEALTH_VARIATION:return new zi(t);case Ii.STUNNED:return new qi(t);case Ii.FROZEN:return new Yi(t);case Ii.DETECT_LIFE:return new Xi(t);default:return new Gi(t)}}static condNames=[void 0,"confused","stunned","frozen","regeneration","overencumbered","life detection"];constructor(t){t&&(this.initialTime=t.nbTurns,this._time=t.nbTurns,this._type=t.type,this._noDisplay=t.noDisplay||!1,this.name=t.name,this.onlyIfActive=t.onlyIfActive||!1,this._noCorpse=t.noCorpse||!1)}get type(){return this._type}get time(){return this._time}get noCorpse(){return this._noCorpse}get noDisplay(){return this._noDisplay}getName(){return this._noDisplay?void 0:this.name?this.name:Gi.condNames[this._type]}onApply(t){}onRemove(t){}update(t){return!(this._time>0)||(this._time--,this._time>0)}}class zi extends Gi{constructor(t){super(t),t&&t.amount&&(this.hpPerTurn=0===t.nbTurns?t.amount:t.amount/t.nbTurns)}update(t){return t.destructible&&(this.onlyIfActive&&t.activable&&!t.activable.isActive()||(this.hpPerTurn>0?t.destructible.heal(t,this.hpPerTurn):this.hpPerTurn<0&&t.destructible.takeDamage(t,-this.hpPerTurn))),super.update(t)}}class qi extends Gi{constructor(t){super(t)}update(t){if(!super.update(t)){if(this.type!==Ii.STUNNED)return!1;this._type=Ii.CONFUSED,this._time=3}return!0}}class Xi extends Gi{constructor(t){super(t),t&&t.range&&(this.range=t.range)}}class Yi extends Gi{constructor(t){super(t)}onApply(t){this.originalColor=t.col,t.col=Ye}onRemove(t){t.col=this.originalColor}update(t){let e=(this._time-1)/this.initialTime;return t.col=S.add(S.multiply(Ye,e),S.multiply(this.originalColor,1-e)),super.update(t)}}class Qi{constructor(t){t&&(this._method=t.method,this._range=t.range,this._radius=t.radius,this.actorType=t.actorType)}get method(){return this._method}get range(){if(!this._range)throw new Error("They have no range!");return this._range}get radius(){if(!this._radius)throw new Error("They have no radius!");return this._radius}selectTargets(t,e,i){let r=[];switch(this._method){case Li.WEARER:r.push(e);break;case Li.ACTOR_ON_CELL:i&&(r=Zr.list.filter((t=>t.pos.equals(i)&&t.isA("creature[s]"))));break;case Li.CLOSEST_ENEMY:let t=Zr.findClosestEnemy(i||e.pos,this.range);t&&r.push(t);break;case Li.ACTORS_IN_RANGE:r=Zr.list.filter((t=>t.isA("creature[s]")&&O.distance(i||e.pos,t.pos)<this.range));break;case Li.WEARER_INVENTORY:if(!e.container)break;if(e.container.getContent(this.actorType,!0,r),1===r.length)break;if(r.length>1&&(r=[],e.ai&&e.ai.inventoryItemPicker))return new Promise((t=>{e.ai.inventoryItemPicker&&e.ai.inventoryItemPicker.pickItemFromInventory("select an item",e,this.actorType).then((e=>{r.push(e),t(r)}))}));break;case Li.SELECTED_ACTOR:if(e.ai&&e.ai.tilePicker)return new Promise((t=>{e.ai.tilePicker&&e.ai.tilePicker.pickATile("Left-click a target creature,\nor right-click to cancel.",new O(e.pos.x,e.pos.y),this._range,this._radius).then((e=>{t(this.onTileSelected(e))}))}));break;case Li.SELECTED_RANGE:if(e.ai&&e.ai.tilePicker)return new Promise((t=>{e.ai.tilePicker&&e.ai.tilePicker.pickATile("Left-click a target tile,\nor right-click to cancel.",new O(e.pos.x,e.pos.y),this._range,this._radius).then((e=>{t(this.onTileSelected(e))}))}))}return new Promise((t=>{t(r)}))}onTileSelected(t){switch(this._method){case Li.SELECTED_ACTOR:return Zr.list.filter((e=>e.pos.equals(t)&&e.isA("creature[s]")));case Li.SELECTED_RANGE:return Zr.list.filter((e=>e.isA("creature[s]")&&O.distance(t,e.pos)<this.radius))}return[]}}let Zi;var $i;($i=Zi||(Zi={}))[$i.SUCCESS=0]="SUCCESS",$i[$i.FAILURE=1]="FAILURE",$i[$i.SUCCESS_AND_STOP=2]="SUCCESS_AND_STOP",$i[$i.FAILURE_AND_STOP=3]="FAILURE_AND_STOP";class Ji{static booleanToEffectResult(t,e){return t?e?Zi.SUCCESS_AND_STOP:Zi.SUCCESS:e?Zi.FAILURE_AND_STOP:Zi.FAILURE}}class tr extends Ji{_amount=0;canResurrect=!1;_singleActor=!1;get amount(){return this._amount}get singleActor(){return this._singleActor}constructor(t){super(),t&&(this._amount=t.amount,this.successMessage=t.successMessage,this.failureMessage=t.failureMessage,void 0!==t.canResurrect&&(this.canResurrect=t.canResurrect),void 0!==t.singleActor&&(this._singleActor=t.singleActor))}applyTo(t,e=1){return t.destructible?this._amount>0&&(this.canResurrect||!t.destructible.isDead())?this.applyHealingEffectTo(t,e):this.applyWoundingEffectTo(t,e):Zi.FAILURE}applyHealingEffectTo(t,e=1){let i=t.destructible.heal(t,e*this._amount),r=t.getWearer(),n=Ji.booleanToEffectResult(!1,this._singleActor);return i>0&&this.successMessage?(Ee.info(hi(this.successMessage,t,r,i)),n=Ji.booleanToEffectResult(!0,this._singleActor)):i<=0&&this.failureMessage&&Ee.info(hi(this.failureMessage,t)),n}applyWoundingEffectTo(t,e=1){if(t.destructible.isDead())return Zi.FAILURE;let i=t.destructible.computeRealDefense(t),r=-this._amount*e-i,n=t.getWearer();return r>0&&this.successMessage?Ee.info(hi(this.successMessage,t,n,r)):r<=0&&this.failureMessage&&Ee.info(hi(this.failureMessage,t,n)),Ji.booleanToEffectResult(t.destructible.takeDamage(t,-this._amount*e)>0,this._singleActor)}}class er extends Ji{constructor(t){super(),this.successMessage=t}applyTo(t,e=1){let i,r;return[i,r]=wi.current.findRandomWamlkableCell(),t.moveTo(i,r),this.successMessage&&Ee.info(hi(this.successMessage,t)),Zi.SUCCESS_AND_STOP}}class ir extends Ji{constructor(t){super(),t&&(this.eventType=t.eventType,this.eventData=t.eventData)}applyTo(t,e=1){return re.publishEvent(this.eventType,this.eventData),Zi.SUCCESS}}class rr extends Ji{singleActor=!1;constructor(t,e){super(),this.message=e,t&&(this.conditionDef=t.condition,this.singleActor=t.singleActor||!1)}applyTo(t,e=1){return t.ai?(t.ai.addCondition(Gi.create(this.conditionDef),t),this.message&&Ee.info(hi(this.message,t)),Ji.booleanToEffectResult(!0,this.singleActor)):Zi.FAILURE}}class nr extends Ji{applyTo(t,e=1){return t===Zr.specialActors[Yr.PLAYER]?(wi.current.reveal(),Zi.SUCCESS):Zi.FAILURE}}class sr{get effect(){return this._effect}get coef(){return this._coef}constructor(t,e,i,r=!1){this._effect=t,this.targetSelector=e,this.message=i,this.destroyOnEffect=r}apply(t,e,i,r=1){return new Promise((n=>{this._coef=r,this.targetSelector.selectTargets(t,e,i).then((i=>{this.applyEffectToActorList(t,e,i),n(i.length>0)}))}))}applyEffectToActorList(t,e,i){let r=!1;this.message&&Ee.info(hi(this.message,e));for(let t of i){let e=this._effect.applyTo(t,this._coef);if(e!==Zi.SUCCESS&&e!==Zi.SUCCESS_AND_STOP||(r=!0),e===Zi.SUCCESS_AND_STOP||e===Zi.FAILURE_AND_STOP)break}this.destroyOnEffect&&r&&e&&e.container&&t.destroy()}}class or{defense=0;xp=0;constructor(t,e){e&&(this.hp=e.hp,this._maxHp=e._maxHp,this.defense=e.defense,this.corpseChar=e.corpseChar,this.corpseName=e.corpseName,this.deathMessage=e.deathMessage,this.xp=e.xp,this.qualifiers=e.qualifiers,this.loot=e.loot),t&&(t.healthPoints&&(this.hp=t.healthPoints,this._maxHp=t.healthPoints),t.defense&&(this.defense=t.defense),t.corpseName&&(this.corpseName=t.corpseName),t.corpseChar&&(this.corpseChar=t.corpseChar),t.deathMessage&&(this.deathMessage=t.deathMessage),t.xp&&(this.xp=t.xp),t.qualifiers&&(this.qualifiers=t.qualifiers),t.loot&&(this.loot=t.loot))}get maxHp(){return this._maxHp}isDead(){return this.hp<=0}getQualifiedName(t,e=1){if(this.isDead()||void 0===this.qualifiers)return t.getname(e);let i=Math.floor(this.qualifiers.length*this.hp/this._maxHp);return i===this.qualifiers.length&&(i=this.qualifiers.length-1),t.getname(e)+(this.qualifiers[i]?", "+this.qualifiers[i]:"")}computeRealDefense(t){let e=this.defense;if(t.container){let i=t.container.size();for(let r=0;r<i;r++){let i=t.container.get(r);i&&i.equipment&&i.equipment.isEquipped()&&(e+=i.equipment.getDefenseBonus())}}return e}takeDamage(t,e){return this.isDead()?0:((e-=this.computeRealDefense(t))>0?(this.hp-=e,this.isDead()&&(this.hp=0,this.die(t))):e=0,e)}heal(t,e){let i=this.isDead();return this.hp+=e,this.hp>this._maxHp&&(e-=this.hp-this._maxHp,this.hp=this._maxHp),i&&this.hp>0&&this.resurrect(t),e}die(t){if(this.deathMessage){let e=t.getWearer();e&&Ee.info(hi(this.deathMessage,t,e))}this.loot&&this.dropLoot(t),!this.corpseName||t.container.computeTotalWeight()<=0?t.destroy():(this.swapNameAndCorpseName(t),this.wasBlocking=t.blocks,this.wasTransparent=t.transparent,t.blocks=!1,t.transparent||(wi.current.setTransparent(t.pos.x,t.pos.y,!0),t.transparent=!0),t.activable&&t.activable.deactivate(t))}swapNameAndCorpseName(t){if(this.corpseName){let e=t.name;t.name=this.corpseName,this.corpseName=e}if(this.corpseChar){let e=t.ch;t.ch=this.corpseChar,this.corpseChar=e}}resurrect(t){this.swapNameAndCorpseName(t),t.blocks=this.wasBlocking,t.transparent=this.wasTransparent,t.transparent||wi.current.setTransparent(t.pos.x,t.pos.y,!1),t.activable&&(t.equipment&&!t.equipment.isEquipped()||t.activable.activate(t))}dropLoot(t){let e=Xr.createRandomActors(this.loot,0);for(let i of e)i.pickable.pick(i,t,!1)}}class ar{_attackTime=5;constructor(t){t&&(this.power=t.hitPoints,this._attackTime=t.attackTime)}get attackTime(){return this._attackTime}attack(t,e){if(e.destructible&&!e.destructible.isDead()){let i=this.power-e.destructible.computeRealDefense(e),r="[The actor1] attack[s] [the actor2]",n=ne.INFO,s=0;i>=e.destructible.hp?(r+=" and kill[s] [it2] !",n=ne.WARN,t.xpHolder&&e.destructible.xp&&(r+="\n[The actor2] [is2] dead. [The actor1] gain[s] "+e.destructible.xp+" xp.",s=e.destructible.xp)):i>0?(r+=" for "+i+" hit points.",n=ne.WARN):r+=" but it has no effect!",Ee.log(n,hi(r,t,e)),e.destructible.takeDamage(e,this.power),s>0&&t.xpHolder.addXp(t,s)}}}class hr{_capacity=0;actorIds=[];_slotActors=[];get capacity(){return this._capacity}constructor(t,e){this.__listener=e,t&&(this._capacity=t.capacity,this.filter=t.filter,this._slots=t.slots)}getQualifiedName(t,e=1){if(0===this.actorIds.length)return"empty "+t.getname(e);if(this.filter)return this.getCapacityQualifier()+t.getname(e);let i={};for(let t of this.actorIds){let e=Zr.fromId(t);if(e)for(let t of e.getClasses()){if(Xr.getActorDef(t).containerQualifier){let e=i[t]||0;i[t]=e+1}}}let r,n=1;for(let t in i)i.hasOwnProperty(t)&&i[t]>n&&(n=i[t],r=t);return n>.75*this.actorIds.length&&r?this.getCapacityQualifier()+t.getname(e)+" of "+Xr.getActorTypeName(r,2):this.getCapacityQualifier()+t.getname(e)}getContent(t,e=!1,i){void 0===i&&(i=[]);for(let r=0,n=this.size();r<n;++r){let n=this.get(r);n&&(t&&!n.isA(t)||i.push(n),e&&n.container&&n.container.getContent(t,e,i))}return i}getSlots(){return this._slots}getSlotActors(){return this._slotActors}size(){return this.actorIds.length}setListener(t){this.__listener=t}get(t){return Zr.fromId(this.actorIds[t])}contains(t,e){for(let e=0,i=this.size();e<i;e++)if(t===this.actorIds[e])return!0;if(e)for(let e=0,i=this.size();e<i;e++){let i=Zr.fromId(this.actorIds[e]);if(i&&i.container&&i.container.contains(t,!0))return!0}return!1}hasSlot(t){return this._slots&&-1!==this._slots.indexOf(t)}getFromSlot(t){let e=this._slots?this._slots.indexOf(t):-1;if(-1!==e)return Zr.fromId(this._slotActors[e])}equip(t,e,i){let r=this._slots?this._slots.indexOf(i):-1;return-1!==r&&(this._slotActors[r]=e.id,e.pickable.pick(e,t,!1,!0),!0)}shouldAutoEquip(t,e){if(!this._slots||!e.equipment||!e.equipment.getSlots()||t.destructible&&t.destructible.isDead())return!1;let i=e.equipment.getSlots(),r=!1;for(let n=0,s=i.length;n<s&&!r;++n)e.equipment.tryEquipOnSlot(t,i[n])&&(r=!0);if(!r)return!1;let n=e.getInventoryQualifier();if(n)for(let t of this._slotActors){let e=Zr.fromId(t);if(e&&e.isA(n))return!1}return!0}unequip(t){let e=this._slotActors?this._slotActors.indexOf(t.id):-1;if(-1!==e)return this._slotActors[e]=void 0,this._slots?this._slots[e]:void 0}isSlotEmpty(t){let e=this._slots?this._slots.indexOf(t):-1;if(-1===e)return!1;if(this._slotActors[e])return!1;if(t===Ze||t===$e){if(this.getFromSlot(Je))return!1}else if(t===Je&&(this.getFromSlot($e)||this.getFromSlot(Ze)))return!1;return!0}canContain(t){if(!t||!t.pickable)return!1;if(this.filter){let e=!1;for(let i of this.filter)if(t.isA(i)){e=!0;break}if(!e)return!1}return this.computeTotalWeight()+t.pickable.weight<=this._capacity}computeTotalWeight(){let t=0;for(let e of this.actorIds){let i=Zr.fromId(e);i&&i.pickable&&(t+=i.pickable.weight)}return t}add(t,e){return!!this.canContain(t)&&(this.actorIds.push(t.id),this.__listener&&this.__listener.onAdd(t.id,this,e),!0)}remove(t,e){let i=this.actorIds.indexOf(t);-1!==i&&(this.actorIds.splice(i,1),this.__listener&&this.__listener.onRemove(t,this,e))}getCapacityQualifier(){return this.computeTotalWeight()/this._capacity>.8?"almost full ":""}}class lr{_destroyedWhenThrown=!1;get weight(){return this._weight}get onThrowEffect(){return this.onThrowEffector?this.onThrowEffector.effect:void 0}get destroyedWhenThrown(){return this._destroyedWhenThrown}get containerId(){return this._containerId}constructor(t){t&&(this._weight=t.weight,t.destroyedWhenThrown&&(this._destroyedWhenThrown=t.destroyedWhenThrown),t.onUseEffector&&(this.onUseEffector=Xr.createEffector(t.onUseEffector)),t.onThrowEffector&&(this.onThrowEffector=Xr.createEffector(t.onThrowEffector)))}getOnThrowEffector(){return this.onThrowEffector}getOnUseEffector(){return this.onUseEffector}setOnUseEffect(t,e,i,r=!1){this.onUseEffector=new sr(t,e,i,r)}setOnThrowEffect(t,e,i,r=!1){this.onThrowEffector=new sr(t,e,i,r)}pick(t,e,i,r){if(this._containerId!==e.id&&e.container&&e.container.add(t,e)){if(this._containerId){let i=Zr.fromId(this._containerId);i&&t.pickable.drop(t,i,e,void 0,void 0,void 0,r)}return this._containerId=e.id,t.moveTo(e.pos.x,e.pos.y),!i||!e.isA("creature[s]")||e.destructible&&e.destructible.isDead()||Ee.info(hi("[The actor1] pick[s] [the actor2].",e,t)),r||(t.equipment&&e.isPlayer()&&e.container.shouldAutoEquip(e,t)?t.equipment.equip(t,e):t.equipment&&t.activable&&t.activable.isActive()&&t.activable.deactivate(t)),!0}return!1}drop(t,e,i,r,n="drop",s=!1,o){let a=Zr.fromId(this._containerId);a&&a.container.remove(t.id,e),i||(this._containerId=void 0,t.pos.x=r?r.x:e.pos.x,t.pos.y=r?r.y:e.pos.y,t.register()),!o&&t.equipment&&t.equipment.unequip(t,e,!0),s&&Ee.info(e.getThename()+" "+n+e.getVerbEnd()+t.getthename())}use(t,e){return this.onUseEffector?this.onUseEffector.apply(t,e):(t.equipment?t.equipment.use(t,e):t.activable&&t.activable.activate(t),new Promise((t=>{t(!0)})))}throw(t,e,i,r,n){return new Promise((s=>{r||(r=t.computeThrowRange(e)),e.ai.tilePicker&&e.ai.tilePicker.pickATile("Left-click where to throw the "+t.name+",\nor right-click to cancel.",new O(e.pos.x,e.pos.y),r).then((r=>{this.throwOnPos(t,e,i,r,n),s()}))}))}throwOnPos(t,e,i,r,n=1){t.pickable.drop(t,e,void 0,r,"throw",!i),t.pickable.onThrowEffector&&(t.pickable.onThrowEffector.apply(t,e,r,n),t.pickable.destroyedWhenThrown&&t.destroy())}}class cr{equipped=!1;defenseBonus=0;constructor(t){t&&(this.slots=t.slots,t.defense&&(this.defenseBonus=t.defense))}isEquipped(){return this.equipped}getSlots(){return this.slots}getDefenseBonus(){return this.defenseBonus}use(t,e){this.equipped?this.unequip(t,e):this.equip(t,e)}canUseSlot(t){return this.slots&&-1!==this.slots.indexOf(t)}tryEquipOnSlot(t,e){if(!t.container.hasSlot(e))return!1;if(t.container.getFromSlot(e))return!1;if(e===Je){if(t.container.getFromSlot(Ze))return!1;if(t.container.getFromSlot($e))return!1}else if((e===Ze||e===$e)&&t.container.getFromSlot(Je))return!1;return!0}equipOnSlot(t,e,i){let r=e.container.getFromSlot(i);if(r)r.equipment.unequip(r,e);else if(i===Je){let t=e.container.getFromSlot(Ze);t&&t.equipment.unequip(t,e);let i=e.container.getFromSlot($e);i&&i.equipment.unequip(i,e)}else if(i===Ze||i===$e){let t=e.container.getFromSlot(Je);t&&t.equipment.unequip(t,e)}this.equipped=!0,e.container.equip(e,t,i),e===Zr.specialActors[Yr.PLAYER]&&Ee.warn(hi("[The actor1] equip[s] [the actor2] on [its] "+i,e,t)),t.activable&&!t.activable.isActive()&&t.activable.activate(t)}equip(t,e){if(this.slots){if(this.slots.length>1)for(let i of this.slots)if(this.tryEquipOnSlot(e,i))return void this.equipOnSlot(t,e,i);this.equipOnSlot(t,e,this.slots[0])}else Ee.error(hi("Error! Cannot equip [the actor1]",t))}unequip(t,e,i=!1){this.equipped=!1;let r=e.container.unequip(t);r&&!i&&e===Zr.specialActors[Yr.PLAYER]&&Ee.warn(hi("[The actor1] unequip[s] [the actor2] from [its] "+r,e,t)),!i&&t.activable&&t.activable.deactivate(t)}}class ur{get loadTime(){return this._loadTime}get damageCoef(){return this._damageCoef}get projectileType(){return this._projectileType}get projectile(){return this.projectileId?Zr.fromId(this.projectileId):void 0}get range(){return this._range}constructor(t){t&&(this._damageCoef=t.damageCoef,this._projectileType=t.projectileType,this._loadTime=t.loadTime,this._range=t.range)}fire(t,e){return new Promise((i=>{let r=this.findCompatibleProjectile(t);r?(this.projectileId=r.id,Ee.info(hi("[The actor1] fire[s] [a actor2].",t,r)),r.pickable.throw(r,t,!0,this._range,e.ranged.damageCoef).then((()=>{i(!0)}))):t===Zr.specialActors[Yr.PLAYER]&&(Ee.warn("No "+this._projectileType+" available."),i(!1))}))}findCompatibleProjectile(t){let e;if(t.container&&(e=t.container.getFromSlot(ti),!e||!e.isA(this._projectileType))){e=void 0;let i=t.container.size();for(let r=0;r<i;++r){let i=t.container.get(r);if(i&&i.isA(this._projectileType)){e=i;break}}}return e}}class dr{get charges(){return this._charges}constructor(t){t&&(this.maxCharges=t.charges,this._charges=t.charges,this.onFireEffector=Xr.createEffector(t.onFireEffect))}zap(t,e){return 0===this._charges?Ee.info(hi("[The actor1's] "+t.name+" is uncharged",e)):this.onFireEffector&&this.onFireEffector.apply(t,e).then((i=>(i&&this.doPostZap(t,e),new Promise((t=>{t(i)}))))),new Promise((t=>{t(!1)}))}doPostZap(t,e){this._charges--,this._charges>0?Ee.info("Remaining charges : "+this._charges):Ee.info(hi("[The actor1's] "+t.name+" is uncharged",e))}}class pr{active=!1;constructor(t){t&&this.init(t)}init(t){t&&(this.activateMessage=t.activateMessage,this.deactivateMessage=t.deactivateMessage,this.type=t.type,t.onActivateEffector&&(this.onActivateEffector=Xr.createEffector(t.onActivateEffector)),t.activeByDefault&&(this.active=!0))}isActive(){return this.active}activate(t,e){if(t.lock&&t.lock.isLocked()){let i=t.lock.keyId;if(!(e&&e.container&&e.container.contains(i,!0)))return Ee.info(hi("[The actor1] is locked and needs a key.",t)),!1;{t.lock.unlock(i),e.container.remove(i,e);let r=Zr.fromId(i);r&&r.destroy(),Ee.info(hi("[The actor1] unlock[s] [the actor2].",e,t))}}return(!t.destructible||!t.destructible.isDead())&&(this.active=!0,this.displayState(t),this.type!==Ri.SINGLE?t.light&&re.publishEvent(ri,t):this.active=!1,this.onActivateEffector&&e&&this.onActivateEffector.apply(t,e),!0)}deactivate(t){return this.active=!1,this.displayState(t),t.light&&re.publishEvent(ri,t),!0}switchLever(t,e){return this.active?this.deactivate(t):this.activate(t,e)}displayState(t){this.isActive()?this.activateMessage&&Ee.info(hi(this.activateMessage,t)):this.deactivateMessage&&Ee.info(hi(this.deactivateMessage,t))}}class fr extends pr{constructor(t){super(t)}activate(t,e){let i=void 0!==this.actorId?Zr.fromId(this.actorId):void 0;return!(!i||!i.activable)&&i.activable.activate(i,e)}deactivate(t,e){let i=void 0!==this.actorId?Zr.fromId(this.actorId):void 0;return!(!i||!i.activable)&&i.activable.deactivate(i)}switchLever(t,e){let i=void 0!==this.actorId?Zr.fromId(this.actorId):void 0;return!(!i||!i.activable)&&i.activable.switchLever(i,e)}}class gr{locked=!0;constructor(t){this._keyId=t}isLocked(){return this.locked}get keyId(){return this._keyId}unlock(t){return this._keyId===t&&(this.locked=!1,!0)}lock(){this.locked=!0}}class vr extends pr{constructor(t){super(t),t&&(this.seeThrough=t.seeThrough)}activate(t,e){if(super.activate(t,e)){let e=wi.current;return t.ch="/",t.blocks=!1,t.transparent=!0,e.setWalkable(t.pos.x,t.pos.y,!0),e.setTransparent(t.pos.x,t.pos.y,!0),!0}return!1}deactivate(t){let e=wi.current;return e.canWalk(t.pos.x,t.pos.y)?(super.deactivate(t),t.ch="+",t.blocks=!0,t.transparent=this.seeThrough,e.setWalkable(t.pos.x,t.pos.y,!1),e.setTransparent(t.pos.x,t.pos.y,this.seeThrough),!0):(Ee.info(hi("Cannot close [the actor1]",t)),!1)}}const mr="player",yr="path",xr="pathFinder",_r=2566178,br=16720418,Tr=8204811,Er=8093050,wr=8388736,Ar="guard",Cr="version",Sr="dungeonLevel",Or="statusPanel",Dr="map",Mr="topologyMap",Rr="OPEN_MAIN_MENU",Pr="OPEN_DEBUG_MENU",Ir="NEW_GAME",Nr="CHANGE_STATUS";let Lr;var kr;(kr=Lr||(Lr={}))[kr.INITIALIZING=1]="INITIALIZING",kr[kr.NEXT_LEVEL=2]="NEXT_LEVEL",kr[kr.RUNNING=3]="RUNNING",kr[kr.NEXT_TURN=4]="NEXT_TURN",kr[kr.VICTORY=5]="VICTORY",kr[kr.DEFEAT=6]="DEFEAT";class Fr extends Ct{constructor(t=!0){super(),this.useDiagonals=t}tick(t){let e=t.userData,i=Zr.specialActors[Yr.PLAYER];return i.pos.isAdjacent(e.pos,this.useDiagonals)?(e.ai.moveToCell(e,i.pos,!0),pt.SUCCESS):pt.FAILURE}}class Br extends Ct{constructor(t,e=0,i=!0){super(),this.targetContextKey=t,this.minRange=e,this.allowDiagonals=i}tick(t){let e=wi.current,i=t.userData,r=t.context.get(yr,t.tree.id,this.id);if(e.isInFov(i.pos.x,i.pos.y)){let n;if(n=this.targetContextKey===Ar?Zr.fromId(i.ai.targetId):t.context.get(this.targetContextKey),!n)throw new Error("Could not find "+this.targetContextKey+" registered!");if(!n.pos.isAdjacent(i.pos,!1)&&O.taxiDistance(n.pos,i.pos)>this.minRange){if(!r||0===r.length||r[0].x!==n.pos.x||r[0].y!==n.pos.y){let s=t.context.get(xr);s||(s=new et(e.w,e.h,(function(t,i){return e.canWalk(i.x,i.y)?1:0}),void 0,this.allowDiagonals),t.context.set(xr,s)),r=s.getPath(i.pos,n.pos),t.context.set(yr,r,t.tree.id,this.id)}return r?(this.followPath(i,r),pt.RUNNING):(i.wait(i.ai.walkTime),pt.SUCCESS)}return pt.SUCCESS}return r&&r.length>0?(this.followPath(i,r),pt.RUNNING):pt.FAILURE}followPath(t,e){let i=e.pop();i&&t.ai.moveToCell(t,i,!1)}}class Ur extends Ct{constructor(t){super(),this.scentThreshold=t}tick(t){let e=t.userData,i=Zr.specialActors[Yr.PLAYER],r=Math.abs(e.pos.x-i.pos.x),n=Math.abs(e.pos.y-i.pos.y);if(r<=1&&n<=1)return pt.SUCCESS;let s=this.findHighestScentCell(e);return s?(e.ai.moveToCell(e,s,!1),pt.RUNNING):pt.FAILURE}findHighestScentCell(t){let e,i=0,r=wi.current,n=t.pos.getAdjacentCells(r.w,r.h);for(let t of n)if(!r.isWall(t.x,t.y)){let n=r.getScent(t.x,t.y);n>r.currentScentValue-this.scentThreshold&&n>i&&(i=n,e=t)}return e}}class Vr extends Ct{tick(t){let e=t.userData;return e.wait(e.ai.walkTime),pt.SUCCESS}}const jr="CHILD_STATUS";class Hr{get context(){return this.__context||(this.__context=new xt,this.__context.set(mr,Zr.specialActors[Yr.PLAYER])),this.__context}get behaviorTree(){return this.__behaviorTree}set behaviorTree(t){this.__behaviorTree=t,t&&(this.behaviorTreeName=t.name)}constructor(t,e,i,r){this._walkTime=t,this.setPickers(e,i,r)}postLoad(){void 0!==this.behaviorTreeName&&(this.__behaviorTree=Xr.getBehaviorTree(this.behaviorTreeName))}setPickers(t,e,i){this.__tilePicker=t,this.__inventoryItemPicker=e,this.__lootHandler=i}getConditionTimeMultiplier(){let t=1;return this.hasCondition(Ii.OVERENCUMBERED)&&(t*=1.5),this.hasCondition(Ii.FROZEN)&&(t*=3),t}get tilePicker(){return this.__tilePicker}get inventoryItemPicker(){return this.__inventoryItemPicker}get lootHandler(){return this.__lootHandler}get conditions(){return this._conditions}get walkTime(){return this._walkTime}set walkTime(t){this._walkTime=t}update(t){if(this._conditions)for(let e=0,i=this._conditions.length;e<i;++e){let r=this._conditions[e];r.onlyIfActive&&t.activable&&!t.activable.isActive()||r.update(t)||(r.onRemove(t),this._conditions.splice(e,1),e--,i--)}}addCondition(t,e){this._conditions||(this._conditions=[]),this._conditions.push(t),t.onApply(e)}removeCondition(t){if(this._conditions)for(let e=0,i=this._conditions.length;e<i;++e)if(this._conditions[e].type===t){this._conditions.splice(e,1);break}}getConditionDescription(t){if(!this._conditions)return;let e=0;for(;e<this._conditions.length;){let i=this._conditions[e];if(i.getName()&&!(i.noDisplay||i.noCorpse&&t.destructible&&t.destructible.isDead()))return i.getName();e++}}hasActiveConditions(){let t=this._conditions?this._conditions.length:0;for(let e=0;e<t;e++)if(this._conditions[e].time>0)return!0;return!1}getCondition(t){let e=this._conditions?this._conditions.length:0;for(let i=0;i<e;i++)if(this._conditions[i].type===t)return this._conditions[i]}hasCondition(t){return void 0!==this.getCondition(t)}onAdd(t,e,i){this.checkOverencumberedCondition(e,i)}onRemove(t,e,i){this.checkOverencumberedCondition(e,i)}moveToCell(t,e,i){let r=e.x-t.pos.x,n=e.y-t.pos.y,s=r>0?1:r<0?-1:0,o=n>0?1:n<0?-1:0;this.move(t,s,o,i)}move(t,e,i,r){let n=t.pos.x,s=t.pos.y,o=wi.current;o.canWalk(n+e,s+i)?(n+=e,s+=i):o.canWalk(n+e,s)?n+=e:o.canWalk(n,s+i)&&(s+=i),this.moveOrAttack(t,n,s,r)}tryActivate(t){let e=Zr.list.filter((e=>(e.activable&&!e.pickable||e.container&&(!e.pickable||void 0===e.pickable.containerId))&&e.pos.equals(t.pos)&&e!==t));return e.length>0?(this.activateActors(t,e),!0):(e=Zr.list.filter((e=>(e.activable&&!e.pickable||e.container&&(!e.pickable||void 0===e.pickable.containerId))&&e.pos.isAdjacent(t.pos,!1)&&e!==t)),e.length>0&&(this.activateActors(t,e),!0))}moveOrAttack(t,e,i,r=!0){if(this.hasCondition(Ii.STUNNED))return t.wait(this._walkTime),!1;if(this.hasCondition(Ii.CONFUSED)&&(e=t.pos.x+B.default.getNumber(-1,1),i=t.pos.y+B.default.getNumber(-1,1)),e===t.pos.x&&i===t.pos.y)return t.wait(this._walkTime),!1;if(wi.current.isWall(e,i))return t.wait(this._walkTime),!1;let n=Zr.list.filter((t=>t.pos.x===e&&t.pos.y===i&&t.isA("creature[s]")&&!t.destructible.isDead()));if(n.length>0){if(r){let e=t.getAttacker();return e.attack(t,n[0]),t.wait(e.attackTime),!1}return t.wait(this._walkTime),!0}return n=Zr.list.filter((t=>t.pos.x===e&&t.pos.y===i&&t.isA("door[s]")&&!t.activable.isActive())),n.length>0?(n[0].activable.activate(n[0],t),t.wait(this._walkTime),!1):wi.current.canWalk(e,i)?(t.wait(this._walkTime),t.moveTo(e,i),!0):(t.wait(this._walkTime),!1)}activateActors(t,e){let i=[];for(let r of e)r.activable?(r.activable.switchLever(r,t),t.wait(this._walkTime)):r.container&&i.push(r);i.length>0&&this.lootHandler&&this.lootHandler.lootContainer(t,i)}checkOverencumberedCondition(t,e){!this.hasCondition(Ii.OVERENCUMBERED)&&t.computeTotalWeight()>=.9*t.capacity?this.addCondition(Gi.create({nbTurns:-1,type:Ii.OVERENCUMBERED,noCorpse:!0}),e):this.hasCondition(Ii.OVERENCUMBERED)&&t.computeTotalWeight()<.9*t.capacity&&this.removeCondition(Ii.OVERENCUMBERED)}}class Wr extends Hr{constructor(t){super(t,void 0,void 0,void 0)}update(t){super.update(t),t.wait(this.walkTime)}}class Kr extends Hr{constructor(t,e,i,r){super(t,e,i,r)}update(t){let e=oi();if(void 0!==e)if(super.update(t),this.hasCondition(Ii.STUNNED)||t.destructible&&t.destructible.isDead())t.wait(this.walkTime);else switch(e){case ni.MOVE_NORTH:case ni.MOVE_SOUTH:case ni.MOVE_EAST:case ni.MOVE_WEST:let i=ai(e);this.moveOrAttack(t,t.pos.x+i.x,t.pos.y+i.y);break;case ni.WAIT:t.wait(this.walkTime);break;case ni.GRAB:case ni.USE_ITEM:case ni.DROP_ITEM:case ni.THROW_ITEM:case ni.FIRE:case ni.ZAP:this.hasCondition(Ii.CONFUSED)||this.handleAction(t,e);break;case ni.MOVE_UP:case ni.MOVE_DOWN:}else Zr.scheduler.isPaused()||Zr.scheduler.pause()}moveOrAttack(t,e,i){if(!super.moveOrAttack(t,e,i))return!1;let r=new O(t.pos.x,t.pos.y);return Zr.describeCell(r),!0}handleAction(t,e){switch(e){case ni.GRAB:this.pickupItem(t);break;case ni.USE_ITEM:this.inventoryItemPicker&&this.inventoryItemPicker.pickItemFromInventory("use an item",t).then((e=>{this.useItem(t,e)}));break;case ni.DROP_ITEM:this.inventoryItemPicker&&this.inventoryItemPicker.pickItemFromInventory("drop an item",t).then((e=>{this.dropItem(t,e)}));break;case ni.THROW_ITEM:this.inventoryItemPicker&&this.inventoryItemPicker.pickItemFromInventory("throw an item",t).then((e=>{this.throwItem(t,e)}));break;case ni.FIRE:this.fire(t);break;case ni.ZAP:this.zap(t)}}fire(t){let e=t.container.getFromSlot(Ze);e&&e.ranged||(e=t.container.getFromSlot(Je)),e&&e.ranged||(e=t.container.getFromSlot($e)),e&&e.ranged?(t.wait(e.ranged.loadTime),e.ranged.fire(t,e).then((t=>{}))):Ee.error("You have no ranged weapon equipped.")}zap(t){let e=t.container.getFromSlot(Ze);e&&e.magic||(e=t.container.getFromSlot(Je)),e&&e.magic||(e=t.container.getFromSlot($e)),e&&e.magic?e.magic.zap(e,t).then((t=>{})):Ee.error("You have no magic item equipped.")}useItem(t,e){e.pickable&&e.pickable.use(e,t).then((e=>{e&&t.wait(this.walkTime)}))}dropItem(t,e){e.pickable&&e.pickable.drop(e,t,void 0,void 0,void 0,!0),t.wait(this.walkTime)}throwItem(t,e){e.pickable&&e.pickable.throw(e,Zr.specialActors[Yr.PLAYER],!1).then((()=>{t.wait(this.walkTime)}))}pickupItem(t){let e=!1,i=!1;t.wait(this.walkTime);for(let r of Zr.list)if(r.pickable&&r.pos.equals(t.pos)&&void 0===r.pickable.containerId&&(e=!0,t.container.canContain(r))){r.pickable.pick(r,t,!0),i=!0;break}e?i||Ee.warn("Your inventory is full."):this.tryActivate(t)||Ee.warn("There's nothing to pick here.")}}class Gr extends Hr{constructor(t,e){super(t,void 0,void 0,void 0),e&&e.behaviorTree&&(this.behaviorTree=e.behaviorTree)}update(t){super.update(t),t.destructible&&t.destructible.isDead()?t.wait(this.walkTime):this.behaviorTree&&this.behaviorTree.tick(this.context,t)}}class zr{_xpLevel=0;_xp=0;constructor(t){t&&(this.baseLevel=t.baseLevel,this.newLevel=t.newLevel)}get xpLevel(){return this._xpLevel}get xp(){return this._xp}getNextLevelXp(){return this.baseLevel+this._xpLevel*this.newLevel}addXp(t,e){this._xp+=e;let i=this.getNextLevelXp();this._xp>=i&&(this._xpLevel++,this._xp-=i,Ee.error(hi("[The actor1's] battle skills grow stronger! [The actor1] reached level "+this.xpLevel,t)))}}class qr{constructor(t){this._options=t}get options(){return this._options}get position(){return this.pos}set position(t){this.pos=t}setRange(t){switch(this._options.range=t,this._options.falloffType){case Ui.LINEAR:this.rangeFactor1=1/(t*t);break;case Ui.NORMAL:this.rangeFactor1=1/(1+t*t*.05),this.rangeFactor2=1/(1-this.rangeFactor1);break;case Ui.NONE:this.rangeFactor1=0,this.rangeFactor2=0;break;default:throw new Error("UNEXPECTED FALLOF TYPE")}}computeIntensityVariation(t){if(!this._options.intensityVariationPattern)return 1;let e;return this.patternTime||void 0===this._options.intensityVariationLength||(this.patternTime=B.default.getNumber(0,this._options.intensityVariationLength)),e="noise"===this._options.intensityVariationPattern?this.computeNoiseIntensityVariation(t):this.computePatternIntensityVariation(t),1-(this._options.intensityVariationRange||1)+e*(this._options.intensityVariationRange||1)}computeIntensity(t){switch(void 0===this.rangeFactor1&&this.setRange(this._options.range),this._options.falloffType){case Ui.LINEAR:return 1-t*this.rangeFactor1;case Ui.INVERSE_SQUARE:return 1/(1+t);case Ui.NORMAL:return(1/(1+.05*t)-this.rangeFactor1)*this.rangeFactor2;case Ui.NONE:return 1;default:throw new Error("UNEXPECTED FALLOFF TYPE!")}}computeNoiseIntensityVariation(t){return this.__noise||(this.__noise=new it(B.default)),this.patternTime+=t/(this._options.intensityVariationLength||1),.5*(this.__noise.get1D(this.patternTime,1)+1)}computePatternIntensityVariation(t){if(void 0===this._options.intensityVariationPattern)return 0;for(this.patternTime+=t;this.patternTime>(this._options.intensityVariationLength||1);)this.patternTime-=this._options.intensityVariationLength||1;let e=this._options.intensityVariationPattern.length,i=e*this.patternTime/(this._options.intensityVariationLength||1),r=Math.floor(i),n=i-r,s=(r+1)%e;return((1-n)*(this._options.intensityVariationPattern.charCodeAt(r)-48)+n*(this._options.intensityVariationPattern.charCodeAt(s)-48))/9}}class Xr{static registerBehaviorTree(t){let e=N(t.name);Xr.btTrees[e]=t}static registerActorDef(t){Xr.actorDefs[t.name]=t,Xr.actorTypes.push(t.name)}static getActorDef(t){let e=Xr.actorDefs[t];return void 0===e&&Ee.warn("WARN: unknown actor type "+t),e}static getActorTypes(){return Xr.actorTypes}static computeLevelProbabilities(t,e){let i={};for(let r of t.classProb)r.clazz&&("number"==typeof r.prob?i[r.clazz]=r.prob:i[r.clazz]=Xr.getValueForLevel(r.prob,e));return i}static createRandomActors(t,e){let i=Xr.getRandomCountFromMap(t),r=[],n=Xr.computeLevelProbabilities(t,e);for(;i>0;){let t=Zr.lootRng.getRandomChance(n);if(t&&"undefined"!==t){let e=this.createRandomActor(t);e&&r.push(e)}i--}return r}static createRandomActor(t){let e=Xr.getActorDef(t);if(e){e.abstract&&(t=Xr.getRandomActorClass(t));let i=Xr.create(t);return i&&i.register(),i}Ee.warn("WARN : unknown actor type "+t)}static create(t,e,i,r){if(Xr.actorDefs[t])return Xr.createActor(Xr.actorDefs[t],e,i,r);Xr.unknownClasses[t]||(Ee.warn("WARN : unknown actor type "+t),Xr.unknownClasses[t]=!0)}static createInContainer(t,e){for(let i of e){let e=Xr.create(i);e&&(e.register(),e.pickable&&e.pickable.pick(e,t,!1))}}static createEffector(t){return new sr(Xr.createEffect(t.effect),Xr.createTargetSelector(t.targetSelector),t.message,t.destroyOnEffect)}static load(t){return new Promise((e=>{t.loadFromKey(ii).then((t=>{Xr.seq=t,e()}))}))}static save(t){t.saveToKey(ii,Xr.seq)}static deleteSavedGame(t){t.deleteKey(ii)}static setLock(t,e){t.lock=new gr(e.id)}static getActorTypeName(t,e){let i=Xr.getActorDef(t);return i?1===e?-1!==i.name.indexOf("[s]")?i.name.replace("[s]",""):-1!==i.name.indexOf("[es]")?i.name.replace("[es]",""):i.name:-1!==i.name.indexOf("[s]")?i.name.replace("[s]","s"):-1!==i.name.indexOf("[es]")?i.name.replace("[es]","es"):void 0===i.pluralName?i.name:i.pluralName:(Ee.error("Unknown actor type "+t),"")}static getBehaviorTree(t){let e=N(t);return Xr.btTrees[e]}static seq=1;static unknownClasses={};static actorDefs={};static actorTypes=[];static btTrees={};static getValueForLevel(t,e){for(let i=t.length-1;i>=0;--i)if(e>=t[i][0])return t[i][1];return 0}static getRandomCountFromMap(t){return void 0!==t.maxCount?Zr.lootRng.getNumber(t.minCount||0,t.maxCount):void 0!==t.countProb?Zr.lootRng.getRandomChance(t.countProb):0}static getConcreteActorClass(t,e){e=e||[];for(let i in Xr.actorDefs)if(Xr.actorDefs.hasOwnProperty(i)){let r=Xr.actorDefs[i];r.prototypes&&-1!==r.prototypes.indexOf(t)&&(r.abstract?Xr.getConcreteActorClass(i,e):e.push(i))}return e}static getRandomActorClass(t){let e=Xr.getConcreteActorClass(t);return e[Zr.lootRng.getNumber(0,e.length-1)]}static createActor(t,e,i,r){let n=new Zr(t.name+"|"+Xr.seq);return Xr.seq++,Xr.populateActor(n,t,e,i,r),n.name=Xr.getActorTypeName(t.name,1),n.pluralName=Xr.getActorTypeName(t.name,2),n.charCode||Ee.critical("ERROR : no character defined for actor type "+t.name),n}static populateActor(t,e,i,r,n){if(e.prototypes)for(let s of e.prototypes)Xr.actorDefs[s]?Xr.populateActor(t,Xr.actorDefs[s],i,r,n):Xr.unknownClasses[s]||(Ee.warn("WARN : unknown actor class "+s),Xr.unknownClasses[s]=!0);if(t.init(e),e.pickable&&(t.pickable=new lr(e.pickable)),e.ai&&(t.ai=Xr.createAi(t,e.ai,i,r,n)),e.attacker&&(t.attacker=new ar(e.attacker)),e.destructible&&(t.destructible=new or(e.destructible,t.destructible)),e.light&&(t.light=new qr(e.light)),e.equipment&&(t.equipment=new cr(e.equipment)),e.ranged&&(t.ranged=new ur(e.ranged)),e.magic&&(t.magic=new dr(e.magic)),e.xpHolder&&(t.xpHolder=new zr(e.xpHolder)),e.container&&(t.container=new hr(e.container,t.ai)),e.activable)if(t.activable)t.activable.init(e.activable);else switch(e.activable.type){case Ri.SINGLE:case Ri.TOGGLE:t.activable=new pr(e.activable);break;case Ri.DOOR:t.activable=new vr(e.activable);break;case Ri.LEVER:t.activable=new fr(e.activable)}}static createTargetSelector(t){return new Qi(t)}static createEffect(t){switch(t.type){case Di.CONDITION:return new rr(t,t.successMessage);case Di.INSTANT_HEALTH:return new tr(t);case Di.MAP_REVEAL:return new nr;case Di.TELEPORT:return new er(t.successMessage);case Di.EVENT:default:return new ir(t)}}static createCondition(t){return Gi.create(t)}static createAi(t,e,i,r,n){let s;switch(e.type){case Fi.ITEM:s=new Wr(e.walkTime);break;case Fi.MONSTER:s=new Gr(e.walkTime,t.ai);break;case Fi.PLAYER:default:s=new Kr(e.walkTime,i,r,n)}if(e.conditions)for(let i of e.conditions)s.addCondition(Xr.createCondition(i),t);return e.treeName&&(s.behaviorTree=Xr.getBehaviorTree(e.treeName)),s}}let Yr;var Qr;(Qr=Yr||(Yr={}))[Qr.PLAYER=1]="PLAYER",Qr[Qr.STAIR_UP=2]="STAIR_UP",Qr[Qr.STAIR_DOWN=3]="STAIR_DOWN";class Zr extends class{_nextActionTime=0;getNextActionTime(){return this._nextActionTime}wait(t){this._nextActionTime+=t}}{static list=[];static specialActors={};static scheduler=new rt;static lootRng=new B;static fromId(t){if(void 0!==t)return Zr.map[t]}static findClosestEnemy(t,e){let i,r=1e8;for(let n of Zr.list)if(n!==Zr.specialActors[Yr.PLAYER]&&n.isA("creature[s]")&&!n.destructible.isDead()){let s=O.distance(t,n.pos);s<r&&(void 0===e||s<e||0===e)&&(r=s,i=n)}return i}static load(t){return new Promise((e=>{t.loadFromKey(ei).then((t=>{for(let t of Zr.list){let e;t.isA("player")?e=Yr.PLAYER:t.isA("stairs up")?e=Yr.STAIR_UP:t.isA("stairs down")&&(e=Yr.STAIR_DOWN),void 0!==e&&(Zr.specialActors[e]=t)}e()}))}))}static deleteSavedGame(t){t.deleteKey(ei)}static describeCell(t,e=!1){for(let i of Zr.list.filter((i=>i.pos.x===t.x&&i.pos.y===t.y&&(e||i!==Zr.specialActors[Yr.PLAYER])&&(!i.pickable||void 0===i.pickable.containerId))))Ee.info(i.getTheresaname()+" here.")}static map={};blocks=!1;transparent=!0;fovOnly=!0;wallActor=!1;classes=[];features={};_singular=!0;get id(){return this._id}get readableId(){return this._readableId}constructor(t){super(),this._pos=new O,t&&(this._readableId=t,this._id=N(this._readableId),Zr.map[this._id]=this,Ee.isDebugEnabled()&&Ee.debug("new actor "+this.readableId+"["+this._id.toString(16)+"]")),Zr.list.push(this)}register(){this.ai&&Zr.scheduler.add(this),!this.light||this.activable&&!this.activable.isActive()||re.publishEvent(ri,this),this.moveTo(this.pos.x,this.pos.y)}postLoad(){Zr.map[this._id]=this,this.register(),this.ai&&this.container&&this.container.setListener(this.ai)}getAttacker(){if(this.container)for(let t=0,e=this.container.size();t<e;++t){let e=this.container.get(t);if(e&&e.equipment&&e.equipment.isEquipped()&&e.attacker)return e.attacker}return this.attacker}destroy(){let t=this.getWearer();if(t&&t.container.remove(this.id,t),this.ai&&Zr.scheduler.remove(this),this.activable&&this.activable.isActive()&&this.light&&this.activable.deactivate(this),this.container){let t=this.container.size();for(;t>0;){let e=this.container.get(0);e&&e.destroy(),--t}}delete Zr.map[this._id];let e=Zr.list.indexOf(this);-1!==e&&Zr.list.splice(e,1)}equals(t){return this._id===t._id}init(t){if(t&&(t.ch&&(this._ch=t.ch.charCodeAt(0)),t.name&&(this.type=t.name),void 0!==t.color&&(this.col=t.color),void 0!==t.plural&&(this._singular=!t.plural),void 0!==t.blockWalk&&(this.blocks=t.blockWalk),void 0!==t.blockSight&&(this.transparent=!t.blockSight),t.wallActor&&(this.wallActor=t.wallActor),void 0!==t.displayOutOfFov&&(this.fovOnly=!t.displayOutOfFov),t.prototypes))for(let e of t.prototypes)this.classes.push(e)}get pos(){return this._pos}moveTo(t,e){if(!this.transparent&&wi.current?(wi.current.setTransparent(this.pos.x,this.pos.y,!0),this._pos.moveTo(t,e),wi.current.setTransparent(this.pos.x,this.pos.y,!1)):this._pos.moveTo(t,e),this.container)for(let i=0,r=this.container.size();i<r;++i){let r=this.container.get(i);r&&r.moveTo(t,e)}}computeThrowRange(t){let e=this.pickable.weight,i=e<.5?3:15/e;return this.equipment&&this.equipment.canUseSlot(ti)&&(i*=2.5),i}isA(t){return this.type===t||-1!==this.classes.indexOf(t)}getClasses(){return this.classes}isPlayer(){return this===Zr.specialActors[Yr.PLAYER]}get ch(){return String.fromCharCode(this._ch)}get charCode(){return this._ch}set ch(t){this._ch=t.charCodeAt(0)}isSingular(){return this._singular}isStackable(){return!this.destructible&&(!this.equipment||!this.equipment.isEquipped()||this.equipment.canUseSlot(ti))}hasFeature(t){return void 0!==this.features[t]}getWearer(){if(this.pickable&&this.pickable.containerId)return Zr.map[this.pickable.containerId]}get destructible(){return this.features[Wi.DESTRUCTIBLE]}set destructible(t){this.features[Wi.DESTRUCTIBLE]=t}get attacker(){return this.features[Wi.ATTACKER]}set attacker(t){this.features[Wi.ATTACKER]=t}get ai(){return this.features[Wi.AI]}set ai(t){this.features[Wi.AI]=t}get pickable(){return this.features[Wi.PICKABLE]}set pickable(t){this.features[Wi.PICKABLE]=t}get container(){return this.features[Wi.CONTAINER]}set container(t){this.features[Wi.CONTAINER]=t}get equipment(){return this.features[Wi.EQUIPMENT]}set equipment(t){this.features[Wi.EQUIPMENT]=t}get ranged(){return this.features[Wi.RANGED]}set ranged(t){this.features[Wi.RANGED]=t}get magic(){return this.features[Wi.MAGIC]}set magic(t){this.features[Wi.MAGIC]=t}get activable(){return this.features[Wi.ACTIVABLE]}set activable(t){this.features[Wi.ACTIVABLE]=t}get lock(){return this.features[Wi.LOCKABLE]}set lock(t){this.features[Wi.LOCKABLE]=t}get light(){return this.features[Wi.LIGHT]}set light(t){this.features[Wi.LIGHT]=t}get xpHolder(){return this.features[Wi.XP_HOLDER]}set xpHolder(t){this.features[Wi.XP_HOLDER]=t}isInContainer(){return this.pickable&&void 0!==this.pickable.containerId}contains(t,e){return this.container&&this.container.contains(t,e)}getname(t=1){let e=t>1?this.pluralName:this.name;return this.isPlayer()?"you":this.ai&&this.ai.hasCondition(Ii.FROZEN)?"frozen "+e:e}getaname(){if(this.isPlayer())return"you";if(!this.isSingular())return" "+this.getname();let t=this.getname();return(-1!=="aeiou".indexOf(t[0])?" an ":" a ")+t}getAname(){if(this.isPlayer())return"You";if(!this.isSingular())return this.getname();let t=this.getname();return(-1!=="aeiou".indexOf(t[0])?"An ":"A ")+t}getTheresaname(){return"There"+(this.isSingular()?"'s":" are")+this.getaname()}getthename(t=1){return this.isPlayer()?" you":1===t?" the "+this.getname():" "+t+" "+this.getname(t)}getThename(t=1){return this.isPlayer()?"You":1===t?"The "+this.getname():" "+t+" "+this.getname(t)}getThenames(){return this.isPlayer()?"Your ":this.getThename()+"'s "}getthenames(){return this.isPlayer()?" your ":this.getthename()+"'s "}getits(){return this.isPlayer()?" your ":" its "}getit(){return this.isPlayer()?" you":" it"}getis(){return this.isPlayer()?" are":this.isSingular()?" is":" are"}getVerbEnd(){return this.isPlayer()?"":this.isSingular()?"s":""}getInventoryQualifier(){let t=this;for(let e of t.getClasses()){if(Xr.getActorDef(e).containerQualifier)return e}}getDescription(t=1){let e=this.container&&!this.isA("creature[s]")?this.container.getQualifiedName(this,t):this.destructible?this.destructible.getQualifiedName(this,t):this.getname(t);if(this.magic&&(this.magic.charges>0?e+=", "+this.magic.charges+" charges":e+=", uncharged"),this.ai){let t=this.ai.getConditionDescription(this);t&&(e+=", "+t)}return e}update(){this.ai&&this.ai.update(this)}}class $r{constructor(t,e){this._color=t,this._text=e}get text(){return this._text}get color(){return this._color}darkenColor(){this._color=S.multiply(this._color,.8)}}class Jr extends ke{static MESSAGE_X=22;messages=[];mouseLookText="";init(t,e){super.init(t,e),this.moveToBottomLeft(),this.messageHeight=e-1,re.registerEventListener(this,v)}onTerm(){super.onTerm(),re.registerEventListener(this,v)}onLog(t){if(t.level===ne.DEBUG)return;let e,i=t.text.split("\n");this.messages.length+i.length>this.messageHeight&&this.messages.splice(0,this.messages.length+i.length-this.messageHeight);for(let t of this.messages)t.darkenColor();switch(t.level){default:case ne.INFO:e=15658734;break;case ne.WARN:e=16753920;break;case ne.ERROR:case ne.CRITICAL:e=br}for(let t of i)this.messages.push(new $r(e,t))}onUpdate(t){if(!wi.current)return;let e=ce();if(wi.current.contains(e.x,e.y)&&wi.current.isExplored(e.x,e.y)){let t=Zr.list.filter((t=>t.pos.equals(e)));this.handleMouseLook(t,e)}}onRender(t){let e=Zr.specialActors[Yr.PLAYER];void 0!==e&&(this.console.clearBack(0),this.console.clearText(),this.console.print(0,0,this.mouseLookText),this.renderBar(1,1,20,"HP",e.destructible.hp,e.destructible.maxHp,16727871,8339263),this.renderBar(1,2,20,"XP("+e.xpHolder.xpLevel+")",e.xpHolder.xp,e.xpHolder.getNextLevelXp(),10436607,4128895),this.renderConditions(e.ai.conditions),this.renderMessages(),super.onRender(t))}clear(){this.messages=[],this.mouseLookText=""}renderConditions(t){if(t)for(let e=0,i=t.length;e<i&&e<4;++e){let i=t[e];this.renderBar(1,3+e,20,i.getName(),i.time,i.initialTime,4169535,32575,!1)}}handleMouseLook(t,e){let i=t.length;this.mouseLookText="";let r=Zr.specialActors[Yr.PLAYER];if(r){let e=r.ai.getCondition(Ii.DETECT_LIFE),n=e?e.range:0;for(let e=0;e<i;++e){let i=t[e];i.isInContainer()||wi.current.renderer.getActorRenderMode(i,n)===gi.NONE||(e>0&&(this.mouseLookText+=","),this.mouseLookText+=wi.current.renderer.canIdentifyActor(i)?i.getDescription():"?")}}}renderMessages(){for(let t=0;t<this.messages.length;++t){let e=this.messages[t];this.console.print(Jr.MESSAGE_X,t+1,e.text,e.color)}}renderBar(t,e,i,r,n,s,o,a,h=!0){this.console.clearBack(a,t,e,i,1);let l=Math.floor(n/s*i);l>0&&this.console.clearBack(o,t,e,l,1);let c=r||"";h&&-1!==s&&(r&&(c+=" : "),c+=Math.floor(n)+"/"+Math.floor(s)),this.console.print(t+Math.floor((i-c.length)/2),e,c)}}nt.registerClass(Gi),nt.registerClass(zi),nt.registerClass(Xi),nt.registerClass(Yi),nt.registerClass(qi),nt.registerClass(Qi),nt.registerClass(sr),nt.registerClass(Zr),nt.registerClass($r),nt.registerClass(Jr),nt.registerClass(pi),nt.registerClass(di),nt.registerClass(ui),nt.registerClass(ir),nt.registerClass(ui),nt.registerClass(rr),nt.registerClass(tr),nt.registerClass(nr),nt.registerClass(er),nt.registerClass(or),nt.registerClass(ar),nt.registerClass(pr),nt.registerClass(hr),nt.registerClass(lr),nt.registerClass(cr),nt.registerClass(ur),nt.registerClass(dr),nt.registerClass(gr),nt.registerClass(vr),nt.registerClass(fr),nt.registerClass(Hr),nt.registerClass(zr),nt.registerClass(Wr),nt.registerClass(Gr),nt.registerClass(Kr),nt.registerClass(qr),nt.registerClass(Br),nt.registerClass(Ur),nt.registerClass(Vr),nt.registerClass(Fr);const tn="creature[s]",en="humanoid[s]",rn="hostile humanoid[s]",nn="goblin[s]",sn="orc[s]",on="troll[s]",an="human[s]",hn="player",ln="magic",cn="item[s]",un="flask[s]",dn="money",pn="gold piece[s]",fn="container[s]",gn="static container[s]",vn="small chest[s]",mn="chest[s]",yn="crate[s]",xn="barrel[s]",_n="pickable container[s]",bn="pouch[es]",Tn="bag[s]",En="satchel[s]",wn="pack[s]",An="map case[s]",Cn="key ring[s]",Sn="potion[s]",On="health potion[s]",Dn="regeneration potion[s]",Mn="scroll[s]",Rn="scroll[s] of lighting bolt",Pn="scroll[s] of fireball",In="scroll[s] of confusion",Nn="weapon[s]",Ln="blade[s]",kn="knife[s]",Fn="short sword[s]",Bn="longsword[s]",Un="greatsword[s]",Vn="shield[s]",jn="wooden shield[s]",Hn="iron shield[s]",Wn="ranged",Kn="short bow[s]",Gn="long bow[s]",zn="crossbow[s]",qn="wand[s]",Xn="wand[s] of frost",Yn="staff[s]",Qn="staff[s] of teleportation",Zn="staff[s] of life detection",$n="staff[s] of mapping",Jn="sunrod[s]",ts="projectile[s]",es="arrow[s]",is="bone arrow[s]",rs="iron arrow[s]",ns="bolt[s]",ss="key[s]",os="device[s]",as="stairs",hs="stairs up",ls="stairs down",cs="door[s]",us="wooden door[s]",ds="iron door[s]",ps="basic hostile",fs="guard";Xr.registerBehaviorTree(new Tt(ps,new It([new Pt([new Br(mr,0,!1),new Ur(10),new Ft(new Vr)]),new Fr(!1)]))),Xr.registerBehaviorTree(new Tt(fs,new Pt([new class extends Vt{constructor(t,e,i,r){super(t,gt.GLOBAL,e,i,r)}internalTick(t){let e,i=t.userData;if(e=this.contextKey===Ar?Zr.fromId(i.ai.targetId):t.context.get(this.contextKey),!e)throw new Error("Test node has no target! "+this.contextKey);let r=O.distance(e.pos,i.pos),n=t.context.get(jr,t.tree.id,this.id);return n===pt.RUNNING||this.valueMatches(r,this.value,this.operator)?(n=this.children[0].execute(t),t.context.set(jr,n,t.tree.id,this.id),n):pt.FAILURE}}(Ar,15,mt.GREATER,new Br(Ar,3,!1)),new class extends Ct{constructor(t){super(),this.tree=t}tick(t){return this.tree.tick(t.context,t.userData)}}(Xr.getBehaviorTree(ps))]))),Xr.registerActorDef({name:tn,abstract:!0,blockWalk:!0,destructible:{corpseChar:"%",qualifiers:["almost dead","badly wounded","wounded","lightly wounded",""]}}),Xr.registerActorDef({name:en,abstract:!0,container:{capacity:20,slots:[$e,Ze,Je]},prototypes:[tn]}),Xr.registerActorDef({name:rn,abstract:!0,ai:{type:Fi.MONSTER,walkTime:4,treeName:ps},prototypes:[en]}),Xr.registerActorDef({name:nn,ai:{type:Fi.MONSTER,walkTime:4},attacker:{attackTime:4,hitPoints:1},ch:"g",color:4161343,destructible:{corpseName:"goblin corpse",defense:0,healthPoints:3,loot:{classProb:[{clazz:pn,prob:1},{clazz:void 0,prob:3}]},xp:10},prototypes:[rn]}),Xr.registerActorDef({name:sn,ai:{type:Fi.MONSTER,walkTime:5},attacker:{attackTime:5,hitPoints:2},ch:"o",color:4161343,destructible:{corpseName:"dead orc",defense:0,healthPoints:9,loot:{classProb:[{clazz:pn,prob:1},{clazz:Sn,prob:1}],countProb:{0:30,1:50,2:20}},xp:35},prototypes:[rn]}),Xr.registerActorDef({name:on,ai:{type:Fi.MONSTER,walkTime:6},attacker:{attackTime:6,hitPoints:3},blockSight:!0,ch:"T",color:32512,destructible:{corpseName:"troll carcass",defense:1,healthPoints:15,loot:{classProb:[{clazz:pn,prob:1},{clazz:Sn,prob:1}],countProb:{0:15,1:60,2:25}},xp:100},prototypes:[rn]}),Xr.registerActorDef({name:an,abstract:!0,ch:"@",container:{capacity:20,slots:[$e,Ze,Je,ti]},prototypes:[en]}),Xr.registerActorDef({name:hn,ai:{type:Fi.PLAYER,walkTime:5},attacker:{attackTime:5,hitPoints:2},blockWalk:!1,color:16777215,destructible:{corpseName:"your cadaver",defense:0,healthPoints:30},light:{color:16777215,falloffType:Ui.NORMAL,range:8,renderMode:ji.MAX},prototypes:[an],xpHolder:{baseLevel:200,newLevel:150}}),Xr.registerActorDef({name:cn,abstract:!0}),Xr.registerActorDef({name:un,abstract:!0,ch:"!",containerQualifier:!0,prototypes:[cn]}),Xr.registerActorDef({name:dn,abstract:!0,ch:"$",containerQualifier:!0,pickable:{weight:.05},plural:!0,prototypes:[cn]}),Xr.registerActorDef({name:pn,color:12885548,plural:!1,prototypes:[dn]}),Xr.registerActorDef({name:fn,abstract:!0,ch:"]"}),Xr.registerActorDef({name:gn,abstract:!0,color:2891284,prototypes:[fn,os]}),Xr.registerActorDef({name:vn,container:{capacity:5},prototypes:[gn]}),Xr.registerActorDef({name:mn,container:{capacity:15},prototypes:[gn]}),Xr.registerActorDef({name:yn,container:{capacity:20},prototypes:[gn]}),Xr.registerActorDef({name:xn,container:{capacity:30},prototypes:[gn]}),Xr.registerActorDef({name:_n,abstract:!0,color:Tr,pickable:{weight:.2},prototypes:[fn,cn]}),Xr.registerActorDef({name:bn,container:{capacity:2},prototypes:[_n]}),Xr.registerActorDef({name:Tn,container:{capacity:5},prototypes:[_n]}),Xr.registerActorDef({name:En,container:{capacity:10},prototypes:[_n]}),Xr.registerActorDef({name:wn,container:{capacity:40},prototypes:[_n]}),Xr.registerActorDef({name:Cn,container:{capacity:5,filter:[ss]},prototypes:[_n]}),Xr.registerActorDef({name:An,container:{capacity:5,filter:[Mn]},prototypes:[_n]}),Xr.registerActorDef({name:Sn,abstract:!0,containerQualifier:!0,prototypes:[un]}),Xr.registerActorDef({name:On,color:wr,pickable:{destroyedWhenThrown:!0,onThrowEffector:{destroyOnEffect:!0,effect:{amount:3,failureMessage:"The potion explodes on [the actor1] but it has no effect",successMessage:"The potion explodes on [the actor1], healing [it] for [value1] hit points.",type:Di.INSTANT_HEALTH},targetSelector:{method:Li.SELECTED_RANGE,radius:1}},onUseEffector:{destroyOnEffect:!0,effect:{amount:5,failureMessage:"[The actor1] drink[s] the health potion but it has no effect",successMessage:"[The actor1] drink[s] the health potion and regain[s] [value1] hit points.",type:Di.INSTANT_HEALTH},targetSelector:{method:Li.WEARER}},weight:.5},prototypes:[Sn]}),Xr.registerActorDef({name:Dn,color:wr,pickable:{destroyedWhenThrown:!0,onThrowEffector:{destroyOnEffect:!0,effect:{condition:{amount:6,name:"regeneration",nbTurns:12,type:Ii.HEALTH_VARIATION},successMessage:"The potion explodes on [the actor1].\nLife is flowing through [it].",type:Di.CONDITION},targetSelector:{method:Li.SELECTED_RANGE,radius:1}},onUseEffector:{destroyOnEffect:!0,effect:{condition:{amount:10,name:"regeneration",nbTurns:20,type:Ii.HEALTH_VARIATION},successMessage:"[The actor1] drink[s] the regeneration potion and feel[s]\nthe life flowing through [it].",type:Di.CONDITION},targetSelector:{method:Li.WEARER}},weight:.5},prototypes:[Sn]}),Xr.registerActorDef({name:Mn,abstract:!0,ch:"#",color:12899966,containerQualifier:!0,prototypes:[cn]}),Xr.registerActorDef({name:Rn,pickable:{onUseEffector:{destroyOnEffect:!0,effect:{amount:-20,successMessage:"A lightning bolt strikes [the actor1] with a loud thunder!\nThe damage is [value1] hit points.",type:Di.INSTANT_HEALTH},targetSelector:{method:Li.CLOSEST_ENEMY,range:5}},weight:.1},prototypes:[Mn]}),Xr.registerActorDef({name:Pn,pickable:{onUseEffector:{destroyOnEffect:!0,effect:{amount:-12,successMessage:"[The actor1] get[s] burned for [value1] hit points.",type:Di.INSTANT_HEALTH},message:"A fireball explodes, burning everything within 3 tiles.",targetSelector:{method:Li.SELECTED_RANGE,radius:3,range:10}},weight:.1},prototypes:[Mn]}),Xr.registerActorDef({name:In,pickable:{onUseEffector:{destroyOnEffect:!0,effect:{condition:{nbTurns:12,type:Ii.CONFUSED,noCorpse:!0},successMessage:"[The actor1's] eyes look vacant,\nas [it] start[s] to stumble around!",type:Di.CONDITION},targetSelector:{method:Li.SELECTED_ACTOR,range:5}},weight:.1},prototypes:[Mn]}),Xr.registerActorDef({name:Nn,abstract:!0,containerQualifier:!0,prototypes:[cn]}),Xr.registerActorDef({name:Ln,abstract:!0,ch:"/",color:8553352,containerQualifier:!0,prototypes:[Nn]}),Xr.registerActorDef({name:kn,attacker:{attackTime:3,hitPoints:3},equipment:{slots:[Ze]},pickable:{onThrowEffector:{destroyOnEffect:!1,effect:{amount:-1,successMessage:"The sword hits [the actor1] for [value1] hit points.",type:Di.INSTANT_HEALTH},targetSelector:{method:Li.ACTOR_ON_CELL}},weight:.5},prototypes:[Ln]}),Xr.registerActorDef({name:Fn,attacker:{attackTime:4,hitPoints:4},equipment:{slots:[Ze]},pickable:{onThrowEffector:{destroyOnEffect:!1,effect:{amount:-4,successMessage:"The sword hits [the actor1] for [value1] hit points.",type:Di.INSTANT_HEALTH},targetSelector:{method:Li.ACTOR_ON_CELL}},weight:2},prototypes:[Ln]}),Xr.registerActorDef({name:Bn,attacker:{attackTime:5,hitPoints:6},equipment:{slots:[Ze]},pickable:{onThrowEffector:{destroyOnEffect:!1,effect:{amount:-6,successMessage:"The sword hits [the actor1] for [value1] hit points.",type:Di.INSTANT_HEALTH},targetSelector:{method:Li.ACTOR_ON_CELL}},weight:3},prototypes:[Ln]}),Xr.registerActorDef({name:Un,attacker:{attackTime:6,hitPoints:10},equipment:{slots:[Je]},pickable:{onThrowEffector:{destroyOnEffect:!1,effect:{amount:-10,successMessage:"The sword hits [the actor1] for [value1] hit points.",type:Di.INSTANT_HEALTH},targetSelector:{method:Li.ACTOR_ON_CELL}},weight:4},prototypes:[Ln]}),Xr.registerActorDef({name:Vn,abstract:!0,ch:"[",containerQualifier:!0,pickable:{onThrowEffector:{destroyOnEffect:!1,effect:{condition:{nbTurns:2,type:Ii.STUNNED,noCorpse:!0},successMessage:"The shield hits [the actor1] and stuns [it]!",type:Di.CONDITION},targetSelector:{method:Li.ACTOR_ON_CELL}},weight:5},prototypes:[Nn]}),Xr.registerActorDef({name:jn,color:Tr,equipment:{defense:1,slots:[$e]},prototypes:[Vn]}),Xr.registerActorDef({name:Hn,color:Er,equipment:{defense:1.5,slots:[$e]},prototypes:[Vn]}),Xr.registerActorDef({name:ts,abstract:!0,ch:"\\",containerQualifier:!0,equipment:{slots:[ti]},prototypes:[Nn]}),Xr.registerActorDef({name:es,abstract:!0,containerQualifier:!0,prototypes:[ts]}),Xr.registerActorDef({name:is,color:16765316,pickable:{onThrowEffector:{destroyOnEffect:!1,effect:{amount:-1,successMessage:"The arrow hits [the actor1] for [value1] points.",type:Di.INSTANT_HEALTH,singleActor:!0},targetSelector:{method:Li.ACTOR_ON_CELL}},weight:.1},prototypes:[es]}),Xr.registerActorDef({name:rs,color:Tr,pickable:{onThrowEffector:{destroyOnEffect:!1,effect:{amount:-1.25,successMessage:"The arrow hits [the actor1] for [value1] points.",type:Di.INSTANT_HEALTH,singleActor:!0},targetSelector:{method:Li.ACTOR_ON_CELL}},weight:.1},prototypes:[es]}),Xr.registerActorDef({name:ns,color:Er,pickable:{onThrowEffector:{destroyOnEffect:!1,effect:{amount:-.5,successMessage:"The bolt hits [the actor1] for [value1] points.",type:Di.INSTANT_HEALTH,singleActor:!0},targetSelector:{method:Li.ACTOR_ON_CELL}},weight:.1},prototypes:[ts]}),Xr.registerActorDef({name:Wn,abstract:!0,ch:")",color:Tr,pickable:{weight:2},prototypes:[Nn]}),Xr.registerActorDef({name:Kn,equipment:{slots:[Je]},prototypes:[Wn],ranged:{damageCoef:4,loadTime:4,projectileType:es,range:15}}),Xr.registerActorDef({name:Gn,equipment:{slots:[Je]},prototypes:[Wn],ranged:{damageCoef:8,loadTime:6,projectileType:es,range:30}}),Xr.registerActorDef({name:zn,equipment:{slots:[Ze]},prototypes:[Wn],ranged:{damageCoef:8,loadTime:5,projectileType:ns,range:10}}),Xr.registerActorDef({name:ln,abstract:!0}),Xr.registerActorDef({name:qn,abstract:!0,ch:"/",color:Tr,containerQualifier:!0,equipment:{slots:[Ze]},pickable:{weight:.5},prototypes:[Nn]}),Xr.registerActorDef({name:Xn,magic:{charges:5,onFireEffect:{destroyOnEffect:!1,effect:{condition:{nbTurns:10,type:Ii.FROZEN,noDisplay:!0},successMessage:"[The actor1] [is] covered with frost.",type:Di.CONDITION},message:"[The actor1] zap[s] [its] wand.",targetSelector:{method:Li.SELECTED_ACTOR,range:5}}},prototypes:[qn]}),Xr.registerActorDef({name:Yn,abstract:!0,ch:"/",color:Tr,containerQualifier:!0,equipment:{slots:[Ze,$e]},pickable:{weight:3},prototypes:[Nn]}),Xr.registerActorDef({name:Jn,activable:{type:Ri.TOGGLE},prototypes:[Yn,ln]}),Xr.registerActorDef({name:Qn,magic:{charges:5,onFireEffect:{destroyOnEffect:!1,effect:{successMessage:"[The actor1] disappear[s] suddenly.",type:Di.TELEPORT,singleActor:!0},message:"[The actor1] zap[s] [its] staff.",targetSelector:{method:Li.SELECTED_ACTOR,range:5}}},prototypes:[Yn,ln]}),Xr.registerActorDef({name:Zn,magic:{charges:5,onFireEffect:{destroyOnEffect:!1,effect:{condition:{nbTurns:30,range:15,type:Ii.DETECT_LIFE},successMessage:"[The actor1] [is] aware of life around [it].",type:Di.CONDITION},message:"[The actor1] zap[s] [its] staff.",targetSelector:{method:Li.WEARER}}},prototypes:[Yn,ln]}),Xr.registerActorDef({name:$n,magic:{charges:5,onFireEffect:{destroyOnEffect:!1,effect:{type:Di.MAP_REVEAL},message:"[The actor1] zap[s] [its] staff.",targetSelector:{method:Li.WEARER}}},prototypes:[Yn,ln]}),Xr.registerActorDef({name:ss,ch:"p",color:Er,pickable:{weight:.1},prototypes:[cn]}),Xr.registerActorDef({name:os,abstract:!0}),Xr.registerActorDef({name:cs,abstract:!0,blockWalk:!0,ch:"+",displayOutOfFov:!0,prototypes:[os]}),Xr.registerActorDef({name:us,activable:{activateMessage:"[The actor1] is open",deactivateMessage:"[The actor1] is closed.",seeThrough:!1,type:Ri.DOOR},blockSight:!0,color:Tr,prototypes:[cs]}),Xr.registerActorDef({name:ds,activable:{activateMessage:"[The actor1] is open",deactivateMessage:"[The actor1] is closed.",seeThrough:!0,type:Ri.DOOR},blockSight:!1,color:Er,prototypes:[cs]}),Xr.registerActorDef({name:as,abstract:!0,color:16777215,displayOutOfFov:!0,plural:!0,prototypes:[os]}),Xr.registerActorDef({name:hs,activable:{activateMessage:"The stairs have collapsed. You can't go up anymore...",type:Ri.SINGLE},ch:"<",prototypes:[as]}),Xr.registerActorDef({name:ls,activable:{onActivateEffector:{destroyOnEffect:!1,effect:{eventData:Lr.NEXT_LEVEL,eventType:Nr,type:Di.EVENT},targetSelector:{method:Li.WEARER}},type:Ri.SINGLE},ch:">",prototypes:[as]});class gs extends Le{static CATEGORIES=[fn,Nn,un,Mn];constructor(t){super(),this.numberSelector=t}onInit(){super.onInit(),this.itemPanel=this.addChild(new qe({minHeight:16,minWidth:30}))}initFromContainer(t,e,i,r){this.owner=t,this.rootActor=t,this.itemClassFilter=r,this.resolve=e,this.autoHideWidget=i,this.buildStackedInventory(this.owner.container,r),this.show()}onUpdate(t){Ue.isDragging()||(this.buildStackedInventory(this.rootActor.container,this.itemClassFilter),this.itemPanel.initHierarchy())}displayParentContainer(){if(this.rootActor.pickable){let t=Zr.fromId(this.rootActor.pickable.containerId);t&&this.setRootActor(t)}}computeItemLabel(t,e=1,i=""){let r=t.ch+" ";return e>1&&(r+=e+" "),r+=t.getDescription(e),i+r}addItemToStack(t){for(let e of this.inventory)if(e[0].name===t.name)return e.push(t),!0;return!1}buildStackedInventory(t,e){this.inventory=[];for(let i=0,r=t.size();i<r;++i){let r=t.get(i);if(r&&(!e||r.isA(e))){if(!(r.isStackable()&&this.addItemToStack(r))){let t=[];t.push(r),this.inventory.push(t)}}}this.inventory.sort(this.compareActors.bind(this)),this.createButtons()}compareActors(t,e){let i=this.getActorSortLevel(t[0],gs.CATEGORIES)-this.getActorSortLevel(e[0],gs.CATEGORIES);return 0!==i?Math.sign(i):t[0].name.localeCompare(e[0].name)}getActorSortLevel(t,e){let i=0;for(;i<e.length&&!t.isA(e[i]);)i++;return i}createButtons(){this.itemPanel.clearChildren(),this.itemPanel.addChild(new Ve({data:this.rootActor,dropCallback:this.onDrop.bind(this)})).addChild(new He({callback:this.selectItem.bind(this),eventData:this.rootActor,label:this.computeItemLabel(this.rootActor),postRender:this.postRenderItem.bind(this)}));for(let t of this.inventory){let e=t[0];if(!e.equipment||!e.equipment.isEquipped()){let i=this.itemPanel;e.container&&(i=this.itemPanel.addChild(new Ve({data:e,dropCallback:this.onDrop.bind(this)}))),i.addChild(new Ue({data:t})).addChild(new He({autoHideWidget:this.autoHideWidget,callback:this.selectItem.bind(this),eventData:e,label:this.computeItemLabel(e,t.length," "),postRender:this.postRenderItem.bind(this)}))}}}onDrop(t,e,i){let r=t.getOptions().data,n=i;r.length>1?this.numberSelector.selectNumber("How many?",0,r.length,1).then((t=>{this.onDropItem(r,n,t)})):this.onDropItem(r,n,1)}onDropItem(t,e,i){let r=t[0];if(r.pickable.containerId===e.id){let r=Zr.fromId(e.pickable.containerId);if(r)return void this.removeItemsFromContainer(t,r,e,i)}else 0===this.putItemsInContainer(t,e,i,e!==this.owner)&&(e===this.owner?Ee.warn(hi("You cannot take [the actor1].",r)):Ee.warn(hi("You cannot put [the actor1] in [the actor2].",r,e)))}removeItemsFromContainer(t,e,i,r){let n=0;for(let i=0;i<r;++i)t[i].pickable.pick(t[i],e,!1)&&n++;1===n?(this.owner.wait(2),re.publishEvent(Nr,Lr.NEXT_TURN),Ee.info(hi("You remove [the actor1] from [the actor2].",t[0],i))):n>1&&(this.owner.wait(2),re.publishEvent(Nr,Lr.NEXT_TURN),Ee.info(hi("You remove"+t[0].getthename(n)+" from [the actor1].",i)))}putItemsInContainer(t,e,i,r){let n=0;for(let r=0;r<i;++r)t[r].pickable.pick(t[r],e,!1)&&n++;return r&&(1===i?(this.owner.wait(2),re.publishEvent(Nr,Lr.NEXT_TURN),Ee.info(hi("You put [the actor1] in [the actor2].",t[0],e))):i>1&&(this.owner.wait(2),Ee.info(hi("You put"+t[0].getthename(i)+" in [the actor1].",e)))),n}postRenderItem(t,e,i,r,n){t.fore[e][i]=r.eventData.col,t.fore[e+1][i]=r.eventData.col}setRootActor(t){this.rootActor=t}selectItem(t){if(Ue.resetDrag(),t.container)t===this.rootActor?this.displayParentContainer():this.setRootActor(t);else if(this.resolve)return this.resolve(t),!0;return!1}}class vs extends Le{constructor(){super()}onInit(){super.onInit(),this.itemPanel=this.addChild(new qe({}))}initFromContainer(t,e,i){this.owner=t,this.resolve=e,this.autoHideWidget=i,this.createButtons()&&this.show()}onUpdate(t){Ue.isDragging()||(this.createButtons(),this.itemPanel.initHierarchy())}createButtons(){this.itemPanel.clearChildren();let t=this.owner.container.getSlots();if(!t||0===t.length)return!1;this.slotWidth=this.getSlotsWidth(this.owner.container);for(let e of t){let t=this.owner.container.getFromSlot(e);if(t){let i=this.itemPanel;t.container&&(i=this.itemPanel.addChild(new Ve({data:t,dropCallback:this.onDrop.bind(this)}))),i.addChild(new Ue({data:t})).addChild(new He({autoHideWidget:this.autoHideWidget,callback:this.selectItem.bind(this),eventData:t,label:this.computeEquippedItemLabel(e,this.slotWidth,t,1),postRender:this.postRenderEquippedItem.bind(this)}))}else this.itemPanel.addChild(new He({autoHideWidget:this.autoHideWidget,label:this.computeEquippedItemLabel(e,this.slotWidth,void 0,1),postRender:this.postRenderEquippedItem.bind(this)}))}return!0}onDrop(t,e,i){let r=t.getOptions().data,n=i;if(r.pickable.pick(r,n,!1))return this.owner.wait(2),re.publishEvent(Nr,Lr.NEXT_TURN),void(n!==this.owner&&Ee.info(hi("You put [the actor1] in [the actor2].",r,n)));n===this.owner?Ee.warn(hi("You cannot take [the actor1].",r)):Ee.warn(hi("You cannot put [the actor1] in [the actor2].",r,n))}postRenderEquippedItem(t,e,i,r,n){let s=r.eventData;s&&(t.fore[e+this.slotWidth+2][i]=s.col),t.text[e+this.slotWidth][i]=V,t.fore[e+this.slotWidth][i]=Oe().color.foregroundDisabled}getSlotsWidth(t){let e=0,i=t.getSlots();if(i)for(let t of i)t.length>e&&(e=t.length);return e}computeEquippedItemLabel(t,e,i,r){let n=t;if(i){let s=2+e-t.length;for(;s>0;)n+=" ",s--;n+=i.ch+" ",r>1&&(n+=r+" "),n+=i.getDescription(r)}return n}selectItem(t){return Ue.resetDrag(),this.resolve&&this.resolve(t),!0}}class ms extends Le{constructor(t,e={}){super(),this.numberSelector=t,this.frameOption=e}onInit(){super.onInit(),this.frame=this.addChild(new Ge(this.frameOption));let t=this.frame.addChild(new qe({}));this.containerPanel=t.addChild(new gs(this.numberSelector)),this.equipmentSeparator=t.addChild(new Fe("Equipment")),this.slotsPanel=t.addChild(new vs)}initForCreature(t,e,i,r){this.resolve=e,this.owner=t,this.setFrameTitle(t.getthename()+" "),this.containerPanel.initFromContainer(t,e,i,r),this.slotsPanel.initFromContainer(t,e,i),void 0===t.container.getSlots()?(this.slotsPanel.hide(),this.equipmentSeparator.hide()):(this.slotsPanel.show(),this.equipmentSeparator.show()),this.show()}onUpdate(t){super.onUpdate(t),this.setFrameFooter(Math.floor(10*this.owner.container.computeTotalWeight())/10+"/"+this.owner.container.capacity)}setFrameTitle(t){this.frame.getOptions().title=t}getFrameTitle(){return this.frame.getOptions().title}setFrameFooter(t){this.frame.getOptions().footer=t}}class ys extends ms{currentCreature=0;constructor(t,e={}){super(t,e)}onInit(){super.onInit(),this.nextItemButton=this.addChild(new He({callback:this.nextCreature.bind(this),label:">"})),this.nextItemButton.setZOrder(this.getZOrder()+1),this.nextItemButton.setExpandFlag(P.NONE),this.prevItemButton=this.addChild(new He({callback:this.prevCreature.bind(this),label:"<"})),this.prevItemButton.setZOrder(this.getZOrder()+1),this.prevItemButton.setExpandFlag(P.NONE)}getCurrentContainer(){return this.creatures[this.currentCreature]}initForCreatures(t,e,i,r){this.creatures=Array.isArray(t)?t:[t],this.resolve=e,this.autoHideWidget=i,this.itemClassFilter=r,this.setCurrentCreature(0)}setCurrentCreature(t){if(this.currentCreature=t,super.initForCreature(this.creatures[t],this.resolve,this.autoHideWidget,this.itemClassFilter),this.creatures.length>1){let e=this.creatures[t].getthename()+" "+(t+1)+"/"+this.creatures.length+" ";this.setFrameTitle(e),this.nextItemButton.hide(),this.prevItemButton.hide(),this.computeBoundingBox(),this.nextItemButton.moveTo(Math.floor((this.boundingBox.w+e.length)/2)-1,0),this.prevItemButton.moveTo(Math.floor((this.boundingBox.w-e.length)/2),0),this.prevItemButton.show(),this.nextItemButton.show()}else this.nextItemButton.hide(),this.prevItemButton.hide()}nextCreature(t){return this.setCurrentCreature((this.currentCreature+1)%this.creatures.length),!0}prevCreature(t){return this.setCurrentCreature(0===this.currentCreature?this.creatures.length-1:this.currentCreature-1),!0}}class xs extends Le{constructor(t){super(),this.numberSelector=t,this.setModal()}onInit(){super.onInit();let t=this.addChild(new ze({cancelAction:this.onCancel.bind(this)}));this.panel=t.addChild(new ms(this.numberSelector,{leftButton:{label:"Close",autoHideWidget:this}})),this.hide()}pickItemFromInventory(t,e,i){return new Promise((r=>{this.panel.initForCreature(e,r,this,i),this.panel.setFrameTitle(t+" - ESC to close"),this.show()}))}onRender(t){this.center()}onCancel(){return Ue.resetDrag(),!0}}class _s extends Le{constructor(t){super(),this.numberSelector=t,this.setModal()}onInit(){super.onInit(),this.hide();let t=this.addChild(new ze({cancelAction:this.onCancel.bind(this)})).addChild(new Xe({}));this.looterPanel=t.addChild(new ms(this.numberSelector,{leftButton:{label:"Close",autoHideWidget:this}})),this.lootedPanel=t.addChild(new ys(this.numberSelector,{rightButton:{label:"Take all",callback:this.takeAll.bind(this)}}))}hasLoot(t){for(const e of t)return e.container.computeTotalWeight()>0}lootContainer(t,e){this.hasLoot(n.isArray(e)?e:[e])?(this.looter=t,this.looted=e,this.looterPanel.initForCreature(t,this.onSelectLooterItem.bind(this)),this.lootedPanel.initForCreatures(e,this.onSelectLootedItem.bind(this)),this.show()):Ee.warn("There's nothing to loot!")}onRender(t){this.center()}takeAll(t){let e=this.lootedPanel.getCurrentContainer();for(;e.container.size()>0;){let t=e.container.get(0);if(!t.pickable.pick(t,this.looter,!0))return!0}return!0}onSelectLooterItem(t){t.pickable.pick(t,this.lootedPanel.getCurrentContainer(),!0)}onSelectLootedItem(t){t.pickable.pick(t,this.looter,!0)}onCancel(){return Ue.resetDrag(),!0}}class bs extends Le{enableEvents=!0;tilePos=new O;tileIsValid=!1;constructor(){super(),this.hide(),this.setModal()}pickATile(t,e,i,r){return new Promise((n=>{this.resolve=n,this.origin=e,this.range=i,this.radius=r,this.tileIsValid=!0;let s=Zr.specialActors[Yr.PLAYER];this.tilePos.x=s.pos.x,this.tilePos.y=s.pos.y,this.show(),Ee.warn(t)}))}onRender(t){t.contains(this.tilePos)&&(t.text[this.tilePos.x][this.tilePos.y]=this.tileIsValid?"+".charCodeAt(0):"x".charCodeAt(0),t.fore[this.tilePos.x][this.tilePos.y]=this.tileIsValid?65280:16720418);let e=!(!this.range||!this.origin),i=!!this.radius;if(e||i){let r=new O;for(r.x=0;r.x<wi.current.w;++r.x)for(r.y=0;r.y<wi.current.h;++r.y){let n=!this.origin||!e||O.distance(this.origin,r)<=(this.range||0),s=!(!this.tileIsValid||!i)&&O.distance(this.tilePos,r)<=(this.radius||0)?1.2:n?1:.8;1!==s&&(t.back[r.x][r.y]=S.multiply(t.back[r.x][r.y],s),t.fore[r.x][r.y]=S.multiply(t.fore[r.x][r.y],s))}}}onUpdate(t){this.handleMouseMove(),this.handleMouseClick(),this.checkKeyboardInput()}checkKeyboardInput(){if(oi()===ni.CANCEL)return this.hide(),void de();let t=oi();if(void 0!==t){let e=ai(t);switch(-1===e.y&&this.tilePos.y>0?(this.tilePos.y--,de()):1===e.y&&this.tilePos.y<wi.current.h-1&&(this.tilePos.y++,de()),-1===e.x&&this.tilePos.x>0?(this.tilePos.x--,de()):1===e.x&&this.tilePos.x<wi.current.w-1&&(this.tilePos.x++,de()),t){case ni.CANCEL:this.hide(),de();break;case ni.VALIDATE:this.tileIsValid&&(this.hide(),de(),this.resolve(this.tilePos))}}this.tileIsValid=this.checkTileValidity()}handleMouseClick(){ue(b.LEFT)?this.tileIsValid&&(this.hide(),this.resolve(this.tilePos)):ue(b.RIGHT)&&this.hide()}handleMouseMove(){if(se.hasMoved){let t=ce();this.tilePos.x=t.x,this.tilePos.y=t.y,this.tileIsValid=this.checkTileValidity()}}checkTileValidity(){return!!wi.current.isInFov(this.tilePos.x,this.tilePos.y)&&!(this.origin&&this.range&&O.distance(this.origin,this.tilePos)>this.range)}}class Ts extends Le{constructor(){super(),this.setModal()}onInit(){super.onInit();let t=this.addChild(new ze({cancelAction:this.onCancel.bind(this)}));this.frame=t.addChild(new Ge({}));let e=this.frame.addChild(new qe({}));this.label=e.addChild(new je({label:"0"})),this.slider=e.addChild(new We({maxValue:0,minValue:0})),e.addChild(new He({autoHideWidget:this,callback:this.onPressOk.bind(this),label:"Ok",textAlign:Se.CENTER})),this.hide()}onRender(t){this.center()}onUpdate(t){super.onUpdate(t),this.label.getOptions().label=Math.floor(this.slider.getValue()).toFixed(0)}selectNumber(t,e,i,r){return new Promise((n=>{this.resolve=n,this.frame.getOptions().title=t,this.slider.getOptions().minValue=e,this.slider.getOptions().maxValue=i,this.slider.setValue(void 0===r?e:r),this.show()}))}onPressOk(t){return this.resolve(Math.floor(this.slider.getValue())),!0}onCancel(){return!0}}class Es extends Le{constructor(){super(),this.showOnEventType(Rr),this.hide();let t=this.addChild(new ze({})).addChild(new Ge({})).addChild(new qe({}));t.addChild(new He({autoHideWidget:this,callback:t=>(qt.getRunningScene().logSceneGraph(),!0),label:"Resume game",textAlign:Se.CENTER})),t.addChild(new He({autoHideWidget:this,eventType:Ir,label:"New game",textAlign:Se.CENTER})),jt.debug&&t.addChild(new He({autoHideWidget:this,eventType:Pr,label:"debug",textAlign:Se.CENTER}))}onRender(t){this.center()}onUpdate(t){}}class ws extends Le{constructor(){super(),this.showOnEventType(Pr),this.hide();let t=this.addChild(new ze({})).addChild(new Ge({})).addChild(new qe({}));t.addChild(this.mapRenderModeButton("dbg map transp",xi.TRANSPARENCY)),t.addChild(this.mapRenderModeButton("dbg map light",xi.LIGHTMAP)),t.addChild(this.mapRenderModeButton("dbg map fov",xi.FOV)),t.addChild(this.mapRenderModeButton("dbg map all",xi.ALL_SEEING_EYE)),t.addChild(this.mapRenderModeButton("dbg map normal",xi.NORMAL)),t.addChild(new He({autoHideWidget:this,callback:t=>(qt.getRunningScene().logSceneGraph(),!0),label:"log scene graph"}))}onRender(t){this.center()}onUpdate(t){}mapRenderModeButton(t,e){return new He({autoHideWidget:this,callback:t=>(wi.current.renderer.setRenderMode(e),!0),label:t})}}let As={creatureProbabilities:{classProb:[{clazz:nn,prob:60},{clazz:sn,prob:30},{clazz:on,prob:[[3,10],[5,20],[7,30]]}],maxCount:2},doorProbabilities:{classProb:[{clazz:us,prob:80},{clazz:ds,prob:20}]},itemProbabilities:{classProb:[{clazz:is,prob:5},{clazz:rs,prob:5},{clazz:ns,prob:5},{clazz:Kn,prob:1},{clazz:Gn,prob:[[5,1]]},{clazz:zn,prob:1},{clazz:Fn,prob:[[4,1],[12,0]]},{clazz:jn,prob:[[2,1],[12,0]]},{clazz:Bn,prob:[[6,1]]},{clazz:Hn,prob:[[7,1]]},{clazz:Un,prob:[[8,1]]}],countProb:{0:50,1:40,2:10}},keyProbabilities:{classProb:[{clazz:ss,prob:1}]},lootContainerType:gn,lootProbabilities:{classProb:[{clazz:On,prob:[[0,20],[5,15]]},{clazz:Dn,prob:[[0,20],[5,15]]},{clazz:Rn,prob:[[3,10]]},{clazz:Pn,prob:7},{clazz:In,prob:7},{clazz:Kn,prob:1},{clazz:Gn,prob:[[5,1]]},{clazz:zn,prob:1},{clazz:Fn,prob:[[4,1],[12,0]]},{clazz:Xn,prob:1},{clazz:Qn,prob:1},{clazz:Zn,prob:1},{clazz:$n,prob:1},{clazz:jn,prob:[[2,1],[12,0]]},{clazz:Bn,prob:[[6,1]]},{clazz:Hn,prob:[[7,1]]},{clazz:Un,prob:[[8,1]]},{clazz:Jn,prob:1}],maxCount:4,minCount:1},maxTorches:10,minTorches:4,roomMinSize:4,wallLightProbabilities:{classProb:[]},guardAI:fs};class Cs extends Oi{dungeonLevel=1;constructor(){super(new Ti(new Ci(new Ai)),new ht),As.noItem=void 0!==jt.noitem,As.noMonster=void 0!==jt.nomonster}get topologyMap(){return this._topotologyMap}onInit(){super.onInit()}newLevel(){let t=Zr.specialActors[Yr.PLAYER],e=[];for(let i of Zr.list)i===t||!i.isA("key[s]")&&t.contains(i.id,!0)||e.push(i);for(let t of e)t.destroy();this.createStairs()}newGame(){for(;Zr.list.length>0;)Zr.list[Zr.list.length-1].destroy();this.createStairs(),this.createPlayer()}createStairs(){let t=Xr.create(hs);if(!t)return void Ee.critical("Missing actor type "+hs);Zr.specialActors[Yr.STAIR_UP]=t;let e=Xr.create(ls);e?Zr.specialActors[Yr.STAIR_DOWN]=e:Ee.critical("Missing actor type "+ls)}createPlayer(){let t=Xr.create(hn,this.playerTilePicker,this.playerInventoryPicker,this.playerLootHandler);t?(Zr.specialActors[Yr.PLAYER]=t,t.register()):Ee.critical("Missing actor type "+hn)}buildMap(t,e){e.init(be.getConsole().width,be.getConsole().height-7),this.renderer.initForNewMap();let i=new Si(t,As);return i.build(e),i.topologyMap}}class Ss extends Cs{onInit(){this.status=Lr.INITIALIZING,super.onInit(),this.createGui(),re.registerEventListener(this,Nr),re.registerEventListener(this,Ir),jt.clearsavegame?this.onNewGame():this.persister.loadFromKey(Cr).then((t=>{t&&"18"===t.toString()?this.loadGame():this.onNewGame()}))}onTerm(){super.onTerm(),re.unregisterEventListener(this,Nr),re.unregisterEventListener(this,Ir)}onChangeStatus(t){this.status=t,t===Lr.DEFEAT&&Ee.critical("You died!")}onNewGame(){this.dungeonLevel=1,this.deleteSavedGame(),this.newGame(),this._topotologyMap=this.buildMap(this.dungeonLevel,this.map),this.status=Lr.RUNNING,this.gui.status.clear();let t=Zr.specialActors[Yr.PLAYER],e=Xr.create(bn);e&&Xr.createInContainer(e,[pn,pn,pn,pn,pn]);let i=Xr.create(Tn);i&&(e&&e.pickable.pick(e,i,!1),Xr.createInContainer(i,[On]),i.moveTo(t.pos.x,t.pos.y)),Xr.createInContainer(t,[kn]),Zr.describeCell(t.pos)}onSaveGame(t){Zr.specialActors[Yr.PLAYER].destructible.isDead()?this.deleteSavedGame():(t.saveToKey(Sr,this.dungeonLevel),t.saveToKey(Cr,"18"),t.saveToKey(Dr,this._map),t.saveToKey(Mr,this._topotologyMap),t.saveToKey(Or,this.gui.status),Xr.save(t))}onUpdate(t){if(this.status===Lr.INITIALIZING)return;let e=Zr.specialActors[Yr.PLAYER];if(e&&!e.destructible.isDead()){let e=Zr.scheduler.isPaused();this.status===Lr.NEXT_TURN&&(this.forceNextTurn=!0,this.status=Lr.RUNNING),super.onUpdate(t),!e&&Zr.scheduler.isPaused()&&(this.persister.saveToKey(ei,Zr.list),this.onSaveGame(this.persister))}this.handleKeyboardInput(),this.status===Lr.NEXT_LEVEL&&(this.gotoNextLevel(),this.status=Lr.RUNNING),e.destructible.isDead()&&this.status!==Lr.DEFEAT&&re.publishEvent(Nr,Lr.DEFEAT)}onRender(t){}createGui(){let t=new Ts;var e;this.gui={inventory:new xs(t),loot:new _s(t),mainMenu:new Es,status:new Jr,tilePicker:new bs},jt.debug&&(this.gui.debugMenu=new ws,this.addChild(this.gui.debugMenu)),this.gui.status.init(be.getConsole().width,7),this.playerInventoryPicker=this.gui.inventory,this.playerTilePicker=this.gui.tilePicker,this.playerLootHandler=this.gui.loot,this.gui.inventory.resize(be.getConsole().width,be.getConsole().height-7),this.addChild(this.gui.status),this.addChild(this.gui.inventory),this.addChild(this.gui.mainMenu),this.addChild(this.gui.tilePicker),this.addChild(this.gui.loot),this.addChild(t),e={color:{background:_r,backgroundActive:3684400,backgroundDisabled:_r,foreground:16619295,foregroundActive:16768912,foregroundDisabled:6058315,titleForeground:16777215},input:{cancelAxisName:ni[ni.CANCEL],focusNextWidgetAxisName:ni[ni.MOVE_SOUTH],focusPreviousWidgetAxisName:ni[ni.MOVE_NORTH],validateAxisName:ni[ni.VALIDATE]}},Ce=e}loadGame(){try{this.persister.loadFromKey(Sr).then((t=>(this.dungeonLevel=t,this.persister.loadFromKey(Dr,this._map)))).then((t=>Xr.load(this.persister))).then((()=>Zr.load(this.persister))).then((()=>(Zr.specialActors[Yr.PLAYER].ai.setPickers(this.playerTilePicker,this.playerInventoryPicker,this.playerLootHandler),this.persister.loadFromKey(Mr)))).then((t=>(this._topotologyMap=t,this.persister.loadFromKey(Or,this.gui.status)))).then((t=>{this.status=Lr.RUNNING})).catch((t=>{Ee.critical("Error while loading game :"+t),this.onNewGame()}))}catch(t){Ee.critical("Error while loading game :"+t),this.onNewGame()}}deleteSavedGame(){this.persister.deleteKey(Sr),this.persister.deleteKey(Cr),this.persister.deleteKey(Dr),Xr.deleteSavedGame(this.persister),Zr.deleteSavedGame(this.persister),this.persister.deleteKey(Or)}gotoNextLevel(){this.dungeonLevel++,this.newLevel();let t=Zr.specialActors[Yr.PLAYER];t.destructible.heal(t,t.destructible.maxHp/2),Ee.warn("You take a moment to rest, and recover your strength."),Ee.warn("After a rare moment of peace, you descend deeper\ninto the heart of the dungeon..."),Ee.warn("Level..."+this.dungeonLevel),this._topotologyMap=this.buildMap(this.dungeonLevel,this._map)}handleKeyboardInput(){void 0===Le.getActiveModal()&&oi()===ni.CANCEL&&(de(),re.publishEvent(Rr))}}n((function(){let t;try{t=new ye,we(t)}catch(t){return console.log("ERROR in "+t.fileName+":"+t.lineNumber+" : "+t.message),void console.log(t.stack)}try{const e=80,i=34;let r=new Ss;t.run(r,{consoleHeight:i,consoleWidth:e})}catch(t){Ee.critical("ERROR in "+t.fileName+":"+t.lineNumber+" : "+t.message),Ee.critical(t.stack)}}))}();
//# sourceMappingURL=index.b244b0e2.js.map
